"tanx.io"===window.location.hostname&&(!function(e,t,a,n,o,c,s){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),s=t.getElementsByTagName(a)[0],c.async=1,c.src=n,s.parentNode.insertBefore(c,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-23605814-1","auto"),ga("send","pageview"));"use strict";function Events(){Object.defineProperty(this,"_events",{enumerable:!1,configurable:!1,writable:!0,value:{}})}function EventHandle(e,t,n){this.owner=e,this.name=t,this.fn=n}Events.prototype.on=function(e,t){var n=this._events[e];return void 0===n?(this._events[e]=[t],this.emit("event:on",t)):-1==n.indexOf(t)&&(n.push(t),this.emit("event:on",t)),new EventHandle(this,e,t)},Events.prototype.once=function(e,t){var n=this._events[e];return t.once=!0,n?-1==n.indexOf(t)&&(n.push(t),this.emit("event:once",t)):(this._events[e]=[t],this.emit("event:once",t)),new EventHandle(this,e,t)},Events.prototype.emit=function(e){var t=this._events[e];if(!t)return this;t=t.slice(0);for(var n=Array.prototype.slice.call(arguments,1),i=0;i<t.length;i++)if(t[i]){try{t[i].apply(this,n)}catch(s){console.info("%c%s %c(event error)","color: #06f",e,"color: #f00"),console.log(s.stack)}t[i]&&t[i].once&&this._events[e]&&this._events[e].splice(this._events[e].indexOf(t[i]),1)}return this},Events.prototype.unbind=function(e,t){if(e){var n=this._events[e];if(!n)return this;if(t){var i=n.indexOf(t);-1!==i&&(1===n.length?delete this._events[e]:n.splice(i,1))}else delete this._events[e]}else this._events={};return this},EventHandle.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},EventHandle.prototype.call=function(){this.fn&&this.fn.apply(this.owner,arguments)},EventHandle.prototype.on=function(e,t){return this.owner.on(e,t)};pc.Angle=function(t){this._theta=t*pc.Angle.RA||0,this._normalize()},pc.Angle.RA=180/Math.PI,pc.Angle.prototype={copy:function(t){return this._theta=t._theta,this},dot:function(t){return this.x*t.x+this.y*t.y},lerp:function(t,e){var n=this.distance(t);if(n)return Math.abs(n)<e?(this._theta=t._theta,this):(this._theta+=Math.sign(n)*e,this._normalize(),this)},distance:function(t){var e=t._theta-this._theta;return Math.abs(e)>Math.PI?(Math.PI2-Math.abs(e))*(-1*Math.sign(e)):e},fromVec2:function(t){return t instanceof Array||(t=t.data),this._theta=Math.atan2(t[0],t[1]),this},_normalize:function(){return this._theta-=Math.PI2*Math.floor((this._theta+Math.PI)/Math.PI2),this}},Object.defineProperty(pc.Angle.prototype,"radians",{get:function(){return this._theta},set:function(t){this._theta=t,this._normalize()}}),Object.defineProperty(pc.Angle.prototype,"degrees",{get:function(){return this._theta*pc.Angle.RA},set:function(t){this._theta=t/pc.Angle.RA,this._normalize()}}),Object.defineProperty(pc.Angle.prototype,"x",{get:function(){return Math.sin(this._theta)}}),Object.defineProperty(pc.Angle.prototype,"y",{get:function(){return Math.cos(this._theta)}}),pc.Vec2.prototype.fromAngle=function(t){return this.data[0]=Math.sin(t._theta),this.data[1]=Math.cos(t._theta),this},Math.sign=Math.sign||function(t){return 0===t||isNaN(t)?t:t>0?1:-1},Math.PI2=2*Math.PI;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.eio=e()}}(function(){var e;return function t(e,r,n){function o(i,a){if(!r[i]){if(!e[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(s)return s(i,!0);var p=new Error("Cannot find module '"+i+"'");throw p.code="MODULE_NOT_FOUND",p}var u=r[i]={exports:{}};e[i][0].call(u.exports,function(t){var r=e[i][1][t];return o(r?r:t)},u,u.exports,t,e,r,n)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,r){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(e,t,r){(function(r){function n(e,t){if(!(this instanceof n))return new n(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:r.location&&"https:"==location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(r.location?location.hostname:"localhost"),this.port=t.port||(r.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=f.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate?t.perMessageDeflate||{}:!1,!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized?null:t.rejectUnauthorized;var o="object"==typeof r&&r;o.global===o&&t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),this.open()}function o(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var s=e("./transports"),i=e("component-emitter"),a=e("debug")("engine.io-client:socket"),c=e("indexof"),p=e("engine.io-parser"),u=e("parseuri"),h=e("parsejson"),f=e("parseqs");t.exports=n,n.priorWebsocketSuccess=!1,i(n.prototype),n.protocol=p.protocol,n.Socket=n,n.Transport=e("./transport"),n.transports=e("./transports"),n.parser=e("engine.io-parser"),n.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=o(this.query);t.EIO=p.protocol,t.transport=e,this.id&&(t.sid=this.id);var r=new s[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return r},n.prototype.open=function(){var e;if(this.rememberUpgrade&&n.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(r){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},n.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},n.prototype.probe=function(e){function t(){if(f.onlyBinaryUpgrades){var t=!this.supportsBinary&&f.transport.supportsBinary;h=h||t}h||(a('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",function(t){if(!h)if("pong"==t.type&&"probe"==t.data){if(a('probe transport "%s" pong',e),f.upgrading=!0,f.emit("upgrading",u),!u)return;n.priorWebsocketSuccess="websocket"==u.name,a('pausing current transport "%s"',f.transport.name),f.transport.pause(function(){h||"closed"!=f.readyState&&(a("changing transport and sending upgrade packet"),p(),f.setTransport(u),u.send([{type:"upgrade"}]),f.emit("upgrade",u),u=null,f.upgrading=!1,f.flush())})}else{a('probe transport "%s" failed',e);var r=new Error("probe error");r.transport=u.name,f.emit("upgradeError",r)}}))}function r(){h||(h=!0,p(),u.close(),u=null)}function o(t){var n=new Error("probe error: "+t);n.transport=u.name,r(),a('probe transport "%s" failed because of error: %s',e,t),f.emit("upgradeError",n)}function s(){o("transport closed")}function i(){o("socket closed")}function c(e){u&&e.name!=u.name&&(a('"%s" works - aborting "%s"',e.name,u.name),r())}function p(){u.removeListener("open",t),u.removeListener("error",o),u.removeListener("close",s),f.removeListener("close",i),f.removeListener("upgrading",c)}a('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),h=!1,f=this;n.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",o),u.once("close",s),this.once("close",i),this.once("upgrading",c),u.open()},n.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;t>e;e++)this.probe(this.upgrades[e])}},n.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(h(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},n.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},n.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},n.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},n.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},n.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},n.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},n.prototype.write=n.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},n.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!=this.readyState&&"closed"!=this.readyState){r=r||{},r.compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emit("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}},n.prototype.close=function(){function e(){n.onClose("forced close"),a("socket closing - telling transport to close"),n.transport.close()}function t(){n.removeListener("upgrade",t),n.removeListener("upgradeError",t),e()}function r(){n.once("upgrade",t),n.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}return this},n.prototype.onError=function(e){a("socket error %j",e),n.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},n.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){a('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},n.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;n>r;r++)~c(this.transports,e[r])&&t.push(e[r]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:24,parsejson:27,parseqs:28,parseuri:29}],4:[function(e,t,r){function n(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders}var o=e("engine.io-parser"),s=e("component-emitter");t.exports=n,s(n.prototype),n.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},n.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},n.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},n.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},n.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},n.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},n.prototype.onPacket=function(e){this.emit("packet",e)},n.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(e,t,r){(function(t){function n(e){var r,n=!1,a=!1,c=!1!==e.jsonp;if(t.location){var p="https:"==location.protocol,u=location.port;u||(u=p?443:80),n=e.hostname!=location.hostname||u!=e.port,a=e.secure!=p}if(e.xdomain=n,e.xscheme=a,r=new o(e),"open"in r&&!e.forceJSONP)return new s(e);if(!c)throw new Error("JSONP disabled");return new i(e)}var o=e("xmlhttprequest-ssl"),s=e("./polling-xhr"),i=e("./polling-jsonp"),a=e("./websocket");r.polling=n,r.websocket=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(e,t,r){(function(r){function n(){}function o(e){s.call(this,e),this.query=this.query||{},a||(r.___eio||(r.___eio=[]),a=r.___eio),this.index=a.length;var t=this;a.push(function(e){t.onData(e)}),this.query.j=this.index,r.document&&r.addEventListener&&r.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=n)},!1)}var s=e("./polling"),i=e("component-inherit");t.exports=o;var a,c=/\n/g,p=/\\n/g;i(o,s),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r),this.script=t;var n="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);n&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype.doWrite=function(e,t){function r(){n(),t()}function n(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var t='<iframe src="javascript:0" name="'+o.iframeId+'">';s=document.createElement(t)}catch(e){s=document.createElement("iframe"),s.name=o.iframeId,s.src="javascript:0"}s.id=o.iframeId,o.form.appendChild(s),o.iframe=s}var o=this;if(!this.form){var s,i=document.createElement("form"),a=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=u,i.method="POST",i.setAttribute("accept-charset","utf-8"),a.name="d",i.appendChild(a),document.body.appendChild(i),this.form=i,this.area=a}this.form.action=this.uri(),n(),e=e.replace(p,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(h){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==o.iframe.readyState&&r()}:this.iframe.onload=r}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,"component-inherit":16}],7:[function(e,t,r){(function(r){function n(){}function o(e){if(c.call(this,e),r.location){var t="https:"==location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!=r.location.hostname||n!=e.port,this.xs=e.secure!=t}else this.extraHeaders=e.extraHeaders}function s(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function i(){for(var e in s.requests)s.requests.hasOwnProperty(e)&&s.requests[e].abort()}var a=e("xmlhttprequest-ssl"),c=e("./polling"),p=e("component-emitter"),u=e("component-inherit"),h=e("debug")("engine.io-client:polling-xhr");t.exports=o,t.exports.Request=s,u(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new s(e)},o.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),o=this;n.on("success",t),n.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=n},o.prototype.doPoll=function(){h("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},p(s.prototype),s.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),n=this;try{h("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck(!0);for(var o in this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&t.setRequestHeader(o,this.extraHeaders[o])}}catch(i){}if(this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?n.onLoad():setTimeout(function(){n.onError(t.status)},0))},h("xhr data %s",this.data),t.send(this.data)}catch(i){return void setTimeout(function(){n.onError(i)},0)}r.document&&(this.index=s.requestsCount++,s.requests[this.index]=this)},s.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},s.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},s.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},s.prototype.cleanup=function(e){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(t){}r.document&&delete s.requests[this.index],this.xhr=null}},s.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(r){}if("application/octet-stream"===t)e=this.xhr.response;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(r){for(var n=new Uint8Array(this.xhr.response),o=[],s=0,i=n.length;i>s;s++)o.push(n[s]);e=String.fromCharCode.apply(null,o)}else e=this.xhr.responseText}catch(r){this.onError(r)}null!=e&&this.onData(e)},s.prototype.hasXDR=function(){return"undefined"!=typeof r.XDomainRequest&&!this.xs&&this.enablesXDR},s.prototype.abort=function(){this.cleanup()},r.document&&(s.requestsCount=0,s.requests={},r.attachEvent?r.attachEvent("onunload",i):r.addEventListener&&r.addEventListener("beforeunload",i,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(e,t,r){function n(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),o.call(this,e)}var o=e("../transport"),s=e("parseqs"),i=e("engine.io-parser"),a=e("component-inherit"),c=e("yeast"),p=e("debug")("engine.io-client:polling");t.exports=n;var u=function(){var t=e("xmlhttprequest-ssl"),r=new t({xdomain:!1});return null!=r.responseType}();a(n,o),n.prototype.name="polling",n.prototype.doOpen=function(){this.poll()},n.prototype.pause=function(e){function t(){p("paused"),r.readyState="paused",e()}var r=this;if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(p("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){p("pre-pause polling complete"),--n||t()})),this.writable||(p("we are currently writing - waiting to pause"),n++,this.once("drain",function(){p("pre-pause writing complete"),--n||t()}))}else t()},n.prototype.poll=function(){p("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},n.prototype.onData=function(e){var t=this;p("polling got data %s",e);var r=function(e,r,n){return"opening"==t.readyState&&t.onOpen(),"close"==e.type?(t.onClose(),!1):void t.onPacket(e)};i.decodePayload(e,this.socket.binaryType,r),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():p('ignoring poll - transport state "%s"',this.readyState))},n.prototype.doClose=function(){function e(){p("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(p("transport open - closing"),e()):(p("transport not open - deferring close"),this.once("open",e))},n.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")},t=this;i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=s.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(r=":"+this.port),e.length&&(e="?"+e);var n=-1!==this.hostname.indexOf(":");return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:28,"xmlhttprequest-ssl":10,yeast:31}],9:[function(e,t,r){(function(r){function n(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,o.call(this,e)}var o=e("../transport"),s=e("engine.io-parser"),i=e("parseqs"),a=e("component-inherit"),c=e("yeast"),p=e("debug")("engine.io-client:websocket"),u=r.WebSocket||r.MozWebSocket,h=u||("undefined"!=typeof window?null:e("ws"));t.exports=n,a(n,o),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.ws=u?new h(e):new h(e,t,r),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(n.prototype.onData=function(e){var t=this;setTimeout(function(){o.prototype.onData.call(t,e)},0)}),n.prototype.write=function(e){function t(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}var n=this;this.writable=!1;for(var o=e.length,i=0,a=o;a>i;i++)!function(e){s.encodePacket(e,n.supportsBinary,function(s){if(!u){var i={};if(e.options&&(i.compress=e.options.compress),n.perMessageDeflate){var a="string"==typeof s?r.Buffer.byteLength(s):s.length;a<n.perMessageDeflate.threshold&&(i.compress=!1)}}try{u?n.ws.send(s):n.ws.send(s,i)}catch(c){p("websocket closed before onclose event")}--o||t()})}(e[i])},n.prototype.onClose=function(){o.prototype.onClose.call(this)},n.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),e=i.encode(e),e.length&&(e="?"+e);var n=-1!==this.hostname.indexOf(":");return t+"://"+(n?"["+this.hostname+"]":this.hostname)+r+this.path+e},n.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===n.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:28,ws:14,yeast:31}],10:[function(e,t,r){var n=e("has-cors");t.exports=function(e){var t=e.xdomain,r=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(s){}try{if("undefined"!=typeof XDomainRequest&&!r&&o)return new XDomainRequest}catch(s){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(s){}}},{"has-cors":23}],11:[function(e,t,r){function n(e,t,r){function n(e,o){if(n.count<=0)throw new Error("after called too many times");--n.count,e?(s=!0,t(e),t=r):0!==n.count||s||t(null,o)}var s=!1;return r=r||o,n.count=e,0===e?t():n}function o(){}t.exports=n},{}],12:[function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(0>t&&(t+=n),0>r&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var o=new Uint8Array(e),s=new Uint8Array(r-t),i=t,a=0;r>i;i++,a++)s[a]=o[i];return s.buffer}},{}],13:[function(e,t,r){!function(e){"use strict";r.encode=function(t){var r,n=new Uint8Array(t),o=n.length,s="";for(r=0;o>r;r+=3)s+=e[n[r]>>2],s+=e[(3&n[r])<<4|n[r+1]>>4],s+=e[(15&n[r+1])<<2|n[r+2]>>6],s+=e[63&n[r+2]];return o%3===2?s=s.substring(0,s.length-1)+"=":o%3===1&&(s=s.substring(0,s.length-2)+"=="),s},r.decode=function(t){var r,n,o,s,i,a=.75*t.length,c=t.length,p=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),h=new Uint8Array(u);for(r=0;c>r;r+=4)n=e.indexOf(t[r]),o=e.indexOf(t[r+1]),s=e.indexOf(t[r+2]),i=e.indexOf(t[r+3]),h[p++]=n<<2|o>>4,h[p++]=(15&o)<<4|s>>2,h[p++]=(3&s)<<6|63&i;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(e,t,r){},{}],15:[function(e,t,r){function n(e){return e?o(e):void 0}function o(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){n.off(e,r),t.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var n,o=0;o<r.length;o++)if(n=r[o],n===t||n.fn===t){r.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var n=0,o=r.length;o>n;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],16:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],17:[function(e,t,r){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(s=o))}),e.splice(s,0,n),e}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function i(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(t){}}function a(){var e;try{e=r.storage.debug}catch(t){}return e}function c(){try{return window.localStorage}catch(e){}}r=t.exports=e("./debug"),r.log=s,r.formatArgs=o,r.save=i,r.load=a,r.useColors=n,r.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){return JSON.stringify(e)},r.enable(a())},{"./debug":18}],18:[function(e,t,r){function n(){return r.colors[u++%r.colors.length]}function o(e){function t(){}function o(){var e=o,t=+new Date,s=t-(p||t);e.diff=s,e.prev=p,e.curr=t,p=t,null==e.useColors&&(e.useColors=r.useColors()),null==e.color&&e.useColors&&(e.color=n());var i=Array.prototype.slice.call(arguments);i[0]=r.coerce(i[0]),"string"!=typeof i[0]&&(i=["%o"].concat(i));var a=0;i[0]=i[0].replace(/%([a-z%])/g,function(t,n){if("%%"===t)return t;a++;var o=r.formatters[n];if("function"==typeof o){var s=i[a];t=o.call(e,s),i.splice(a,1),a--}return t}),"function"==typeof r.formatArgs&&(i=r.formatArgs.apply(e,i));var c=o.log||r.log||console.log.bind(console);c.apply(e,i)}t.enabled=!1,o.enabled=!0;var s=r.enabled(e)?o:t;return s.namespace=e,s}function s(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,o=0;n>o;o++)t[o]&&(e=t[o].replace(/\*/g,".*?"),"-"===e[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))}function i(){r.enable("")}function a(e){var t,n;for(t=0,n=r.skips.length;n>t;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;n>t;t++)if(r.names[t].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}r=t.exports=o,r.coerce=c,r.disable=i,r.enable=s,r.enabled=a,r.humanize=e("ms"),r.names=[],r.skips=[],r.formatters={};var p,u=0},{ms:26}],19:[function(e,t,r){(function(t){function n(e,t){var n="b"+r.packets[e.type]+e.data.data;return t(n)}function o(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var o=e.data,s=new Uint8Array(o),i=new Uint8Array(1+o.byteLength);i[0]=m[e.type];for(var a=0;a<s.length;a++)i[a+1]=s[a];return n(i.buffer)}function s(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var o=new FileReader;return o.onload=function(){e.data=o.result,r.encodePacket(e,t,!0,n)},o.readAsArrayBuffer(e.data)}function i(e,t,n){if(!t)return r.encodeBase64Packet(e,n);if(g)return s(e,t,n);var o=new Uint8Array(1);o[0]=m[e.type];var i=new w([o.buffer,e.data]);return n(i)}function a(e,t,r){for(var n=new Array(e.length),o=f(e.length,r),s=function(e,r,o){t(r,function(t,r){n[e]=r,o(t,n)})},i=0;i<e.length;i++)s(i,e[i],o)}var c=e("./keys"),p=e("has-binary"),u=e("arraybuffer.slice"),h=e("base64-arraybuffer"),f=e("after"),l=e("utf8"),d=navigator.userAgent.match(/Android/i),y=/PhantomJS/i.test(navigator.userAgent),g=d||y;r.protocol=3;var m=r.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},v=c(m),b={type:"error",data:"parser error"},w=e("blob");r.encodePacket=function(e,r,s,a){"function"==typeof r&&(a=r,r=!1),"function"==typeof s&&(a=s,s=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return o(e,r,a);if(w&&c instanceof t.Blob)return i(e,r,a);if(c&&c.base64)return n(e,a);var p=m[e.type];return void 0!==e.data&&(p+=s?l.encode(String(e.data)):String(e.data)),a(""+p)},r.encodeBase64Packet=function(e,n){var o="b"+r.packets[e.type];if(w&&e.data instanceof t.Blob){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];n(o+e)},s.readAsDataURL(e.data)}var i;try{i=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(a){for(var c=new Uint8Array(e.data),p=new Array(c.length),u=0;u<c.length;u++)p[u]=c[u];i=String.fromCharCode.apply(null,p)}return o+=t.btoa(i),n(o)},r.decodePacket=function(e,t,n){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return r.decodeBase64Packet(e.substr(1),t);if(n)try{e=l.decode(e)}catch(o){return b}var s=e.charAt(0);return Number(s)==s&&v[s]?e.length>1?{type:v[s],
data:e.substring(1)}:{type:v[s]}:b}var i=new Uint8Array(e),s=i[0],a=u(e,1);return w&&"blob"===t&&(a=new w([a])),{type:v[s],data:a}},r.decodeBase64Packet=function(e,r){var n=v[e.charAt(0)];if(!t.ArrayBuffer)return{type:n,data:{base64:!0,data:e.substr(1)}};var o=h.decode(e.substr(1));return"blob"===r&&w&&(o=new w([o])),{type:n,data:o}},r.encodePayload=function(e,t,n){function o(e){return e.length+":"+e}function s(e,n){r.encodePacket(e,i?t:!1,!0,function(e){n(null,o(e))})}"function"==typeof t&&(n=t,t=null);var i=p(e);return t&&i?w&&!g?r.encodePayloadAsBlob(e,n):r.encodePayloadAsArrayBuffer(e,n):e.length?void a(e,s,function(e,t){return n(t.join(""))}):n("0:")},r.decodePayload=function(e,t,n){if("string"!=typeof e)return r.decodePayloadAsBinary(e,t,n);"function"==typeof t&&(n=t,t=null);var o;if(""==e)return n(b,0,1);for(var s,i,a="",c=0,p=e.length;p>c;c++){var u=e.charAt(c);if(":"!=u)a+=u;else{if(""==a||a!=(s=Number(a)))return n(b,0,1);if(i=e.substr(c+1,s),a!=i.length)return n(b,0,1);if(i.length){if(o=r.decodePacket(i,t,!0),b.type==o.type&&b.data==o.data)return n(b,0,1);var h=n(o,c+s,p);if(!1===h)return}c+=s,a=""}}return""!=a?n(b,0,1):void 0},r.encodePayloadAsArrayBuffer=function(e,t){function n(e,t){r.encodePacket(e,!0,!0,function(e){return t(null,e)})}return e.length?void a(e,n,function(e,r){var n=r.reduce(function(e,t){var r;return r="string"==typeof t?t.length:t.byteLength,e+r.toString().length+r+2},0),o=new Uint8Array(n),s=0;return r.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);r=n.buffer}t?o[s++]=0:o[s++]=1;for(var a=r.byteLength.toString(),i=0;i<a.length;i++)o[s++]=parseInt(a[i]);o[s++]=255;for(var n=new Uint8Array(r),i=0;i<n.length;i++)o[s++]=n[i]}),t(o.buffer)}):t(new ArrayBuffer(0))},r.encodePayloadAsBlob=function(e,t){function n(e,t){r.encodePacket(e,!0,!0,function(e){var r=new Uint8Array(1);if(r[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);e=n.buffer,r[0]=0}for(var s=e instanceof ArrayBuffer?e.byteLength:e.size,i=s.toString(),a=new Uint8Array(i.length+1),o=0;o<i.length;o++)a[o]=parseInt(i[o]);if(a[i.length]=255,w){var c=new w([r.buffer,a.buffer,e]);t(null,c)}})}a(e,n,function(e,r){return t(new w(r))})},r.decodePayloadAsBinary=function(e,t,n){"function"==typeof t&&(n=t,t=null);for(var o=e,s=[],i=!1;o.byteLength>0;){for(var a=new Uint8Array(o),c=0===a[0],p="",h=1;255!=a[h];h++){if(p.length>310){i=!0;break}p+=a[h]}if(i)return n(b,0,1);o=u(o,2+p.length),p=parseInt(p);var f=u(o,0,p);if(c)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(l){var d=new Uint8Array(f);f="";for(var h=0;h<d.length;h++)f+=String.fromCharCode(d[h])}s.push(f),o=u(o,p)}var y=s.length;s.forEach(function(e,o){n(r.decodePacket(e,t,!0),o,y)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:21,"has-binary":22,utf8:30}],20:[function(e,t,r){t.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},{}],21:[function(e,t,r){(function(e){function r(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var o=new Uint8Array(r.byteLength);o.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=o.buffer}e[t]=n}}}function n(e,t){t=t||{};var n=new s;r(e);for(var o=0;o<e.length;o++)n.append(e[o]);return t.type?n.getBlob(t.type):n.getBlob()}function o(e,t){return r(e),new Blob(e,t||{})}var s=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,i=function(){try{var e=new Blob(["hi"]);return 2===e.size}catch(t){return!1}}(),a=i&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return 2===e.size}catch(t){return!1}}(),c=s&&s.prototype.append&&s.prototype.getBlob;t.exports=function(){return i?a?e.Blob:o:c?n:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(e,t,r){(function(r){function n(e){function t(e){if(!e)return!1;if(r.Buffer&&r.Buffer.isBuffer(e)||r.ArrayBuffer&&e instanceof ArrayBuffer||r.Blob&&e instanceof Blob||r.File&&e instanceof File)return!0;if(o(e)){for(var n=0;n<e.length;n++)if(t(e[n]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return!0}return!1}return t(e)}var o=e("isarray");t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:25}],23:[function(e,t,r){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){t.exports=!1}},{}],24:[function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},{}],25:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],26:[function(e,t,r){function n(e){if(e=""+e,!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*h;case"days":case"day":case"d":return r*u;case"hours":case"hour":case"hrs":case"hr":case"h":return r*p;case"minutes":case"minute":case"mins":case"min":case"m":return r*c;case"seconds":case"second":case"secs":case"sec":case"s":return r*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}}function o(e){return e>=u?Math.round(e/u)+"d":e>=p?Math.round(e/p)+"h":e>=c?Math.round(e/c)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function s(e){return i(e,u,"day")||i(e,p,"hour")||i(e,c,"minute")||i(e,a,"second")||e+" ms"}function i(e,t,r){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var a=1e3,c=60*a,p=60*c,u=24*p,h=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?n(e):t["long"]?s(e):o(e)}},{}],27:[function(e,t,r){(function(e){var r=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s=/(?:^|:|,)(?:\s*\[)+/g,i=/^\s+/,a=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(i,"").replace(a,""),e.JSON&&JSON.parse?JSON.parse(t):r.test(t.replace(n,"@").replace(o,"]").replace(s,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(e,t,r){r.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},r.decode=function(e){for(var t={},r=e.split("&"),n=0,o=r.length;o>n;n++){var s=r[n].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},{}],29:[function(e,t,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,r=e.indexOf("["),s=e.indexOf("]");-1!=r&&-1!=s&&(e=e.substring(0,r)+e.substring(r,s).replace(/:/g,";")+e.substring(s,e.length));for(var i=n.exec(e||""),a={},c=14;c--;)a[o[c]]=i[c]||"";return-1!=r&&-1!=s&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},{}],30:[function(t,r,n){(function(t){!function(o){function s(e){for(var t,r,n=[],o=0,s=e.length;s>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&s>o?(r=e.charCodeAt(o++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--)):n.push(t);return n}function i(e){for(var t,r=e.length,n=-1,o="";++n<r;)t=e[n],t>65535&&(t-=65536,o+=w(t>>>10&1023|55296),t=56320|1023&t),o+=w(t);return o}function a(e){if(e>=55296&&57343>=e)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function c(e,t){return w(e>>t&63|128)}function p(e){if(0==(4294967168&e))return w(e);var t="";return 0==(4294965248&e)?t=w(e>>6&31|192):0==(4294901760&e)?(a(e),t=w(e>>12&15|224),t+=c(e,6)):0==(4292870144&e)&&(t=w(e>>18&7|240),t+=c(e,12),t+=c(e,6)),t+=w(63&e|128)}function u(e){for(var t,r=s(e),n=r.length,o=-1,i="";++o<n;)t=r[o],i+=p(t);return i}function h(){if(b>=v)throw Error("Invalid byte index");var e=255&m[b];if(b++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function f(){var e,t,r,n,o;if(b>v)throw Error("Invalid byte index");if(b==v)return!1;if(e=255&m[b],b++,0==(128&e))return e;if(192==(224&e)){var t=h();if(o=(31&e)<<6|t,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=h(),r=h(),o=(15&e)<<12|t<<6|r,o>=2048)return a(o),o;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=h(),r=h(),n=h(),o=(15&e)<<18|t<<12|r<<6|n,o>=65536&&1114111>=o))return o;throw Error("Invalid UTF-8 detected")}function l(e){m=s(e),v=m.length,b=0;for(var t,r=[];(t=f())!==!1;)r.push(t);return i(r)}var d="object"==typeof n&&n,y="object"==typeof r&&r&&r.exports==d&&r,g="object"==typeof t&&t;g.global!==g&&g.window!==g||(o=g);var m,v,b,w=String.fromCharCode,x={version:"2.0.0",encode:u,decode:l};if("function"==typeof e&&"object"==typeof e.amd&&e.amd)e(function(){return x});else if(d&&!d.nodeType)if(y)y.exports=x;else{var k={},B=k.hasOwnProperty;for(var S in x)B.call(x,S)&&(d[S]=x[S])}else o.utf8=x}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(e,t,r){"use strict";function n(e){var t="";do t=a[e%c]+t,e=Math.floor(e/c);while(e>0);return t}function o(e){var t=0;for(h=0;h<e.length;h++)t=t*c+p[e.charAt(h)];return t}function s(){var e=n(+new Date);return e!==i?(u=0,i=e):e+"."+n(u++)}for(var i,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),c=64,p={},u=0,h=0;c>h;h++)p[a[h]]=h;s.encode=n,s.decode=o,t.exports=s},{}]},{},[1])(1)});function u(t){function e(t,r,i){if("undefined"==typeof t&&(t=e.DEFAULT_CAPACITY),"undefined"==typeof r&&(r=e.DEFAULT_ENDIAN),"undefined"==typeof i&&(i=e.DEFAULT_NOASSERT),!i){if(t|=0,0>t)throw RangeError("Illegal capacity");r=!!r,i=!!i}this.buffer=0===t?o:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=r,this.noAssert=i}function r(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function i(){var t=[],e=[];return function(){return 0===arguments.length?e.join("")+h.apply(String,t):(1024<t.length+arguments.length&&(e.push(h.apply(String,t)),t.length=0),void Array.prototype.push.apply(t,arguments))}}function n(t,e,r,i,n){var f;f=8*n-i-1;var s=(1<<f)-1,o=s>>1,h=-7;n=r?n-1:0;var a=r?-1:1,l=t[e+n];for(n+=a,r=l&(1<<-h)-1,l>>=-h,h+=f;h>0;r=256*r+t[e+n],n+=a,h-=8);for(f=r&(1<<-h)-1,r>>=-h,h+=i;h>0;f=256*f+t[e+n],n+=a,h-=8);if(0===r)r=1-o;else{if(r===s)return f?NaN:1/0*(l?-1:1);f+=Math.pow(2,i),r-=o}return(l?-1:1)*f*Math.pow(2,r-i)}function f(t,e,r,i,n,f){var s,o=8*f-n-1,h=(1<<o)-1,a=h>>1,l=23===n?Math.pow(2,-24)-Math.pow(2,-77):0;f=i?0:f-1;var u=i?1:-1,g=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(e=isNaN(e)?1:0,i=h):(i=Math.floor(Math.log(e)/Math.LN2),1>e*(s=Math.pow(2,-i))&&(i--,s*=2),e=i+a>=1?e+l/s:e+l*Math.pow(2,1-a),e*s>=2&&(i++,s/=2),i+a>=h?(e=0,i=h):i+a>=1?(e=(e*s-1)*Math.pow(2,n),i+=a):(e=e*Math.pow(2,a-1)*Math.pow(2,n),i=0));n>=8;t[r+f]=255&e,f+=u,e/=256,n-=8);for(i=i<<n|e,o+=n;o>0;t[r+f]=255&i,f+=u,i/=256,o-=8);t[r+f-u]|=128*g}e.VERSION="5.0.0",e.LITTLE_ENDIAN=!0,e.BIG_ENDIAN=!1,e.DEFAULT_CAPACITY=16,e.DEFAULT_ENDIAN=e.BIG_ENDIAN,e.DEFAULT_NOASSERT=!1,e.Long=t||null;var s=e.prototype;Object.defineProperty(s,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var o=new ArrayBuffer(0),h=String.fromCharCode;e.accessor=function(){return Uint8Array},e.allocate=function(t,r,i){return new e(t,r,i)},e.concat=function(t,r,i,n){"boolean"!=typeof r&&"string"==typeof r||(n=i,i=r,r=void 0);for(var f,s=0,o=0,h=t.length;h>o;++o)e.isByteBuffer(t[o])||(t[o]=e.wrap(t[o],r)),f=t[o].limit-t[o].offset,f>0&&(s+=f);if(0===s)return new e(0,i,n);for(r=new e(s,i,n),o=0;h>o;)i=t[o++],f=i.limit-i.offset,0>=f||(r.view.set(i.view.subarray(i.offset,i.limit),r.offset),r.offset+=f);return r.limit=r.offset,r.offset=0,r},e.isByteBuffer=function(t){return!0===(t&&t.__isByteBuffer__)},e.type=function(){return ArrayBuffer},e.wrap=function(t,r,i,n){if("string"!=typeof r&&(n=i,i=r,r=void 0),"string"==typeof t)switch("undefined"==typeof r&&(r="utf8"),r){case"base64":return e.fromBase64(t,i);case"hex":return e.fromHex(t,i);case"binary":return e.fromBinary(t,i);case"utf8":return e.fromUTF8(t,i);case"debug":return e.fromDebug(t,i);default:throw Error("Unsupported encoding: "+r)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");if(e.isByteBuffer(t))return r=s.clone.call(t),r.markedOffset=-1,r;if(t instanceof Uint8Array)r=new e(0,i,n),0<t.length&&(r.buffer=t.buffer,r.offset=t.byteOffset,r.limit=t.byteOffset+t.byteLength,r.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)r=new e(0,i,n),0<t.byteLength&&(r.buffer=t,r.offset=0,r.limit=t.byteLength,r.view=0<t.byteLength?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");for(r=new e(t.length,i,n),r.limit=t.length,i=0;i<t.length;++i)r.view[i]=t[i]}return r},s.readBytes=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var i=this.slice(e,e+t);return r&&(this.offset+=t),i},s.writeBytes=s.append,s.writeInt8=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),this.view[e-1]=t,r&&(this.offset+=1),this},s.writeByte=s.writeInt8,s.readInt8=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}return t=this.view[t],128===(128&t)&&(t=-(255-t+1)),e&&(this.offset+=1),t},s.readByte=s.readInt8,s.writeUint8=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),this.view[e-1]=t,r&&(this.offset+=1),this},s.writeUInt8=s.writeUint8,s.readUint8=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}return t=this.view[t],e&&(this.offset+=1),t},s.readUInt8=s.readUint8,s.writeInt16=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},s.writeShort=s.writeInt16,s.readInt16=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),32768===(32768&r)&&(r=-(65535-r+1)),e&&(this.offset+=2),r},s.readShort=s.readInt16,s.writeUint16=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},s.writeUInt16=s.writeUint16,s.readUint16=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),e&&(this.offset+=2),r},s.readUInt16=s.readUint16,s.writeInt32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},s.writeInt=s.writeInt32,s.readInt32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),e&&(this.offset+=4),0|r},s.readInt=s.readInt32,s.writeUint32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},s.writeUInt32=s.writeUint32,s.readUint32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),e&&(this.offset+=4),r},s.readUInt32=s.readUint32,t&&(s.writeInt64=function(e,r){var i="undefined"==typeof r;if(i&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||0!==r%1)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),r+=8;var n=this.buffer.byteLength;r>n&&this.resize((n*=2)>r?n:r),r-=8;var n=e.low,f=e.high;return this.littleEndian?(this.view[r+3]=n>>>24&255,this.view[r+2]=n>>>16&255,this.view[r+1]=n>>>8&255,this.view[r]=255&n,r+=4,this.view[r+3]=f>>>24&255,this.view[r+2]=f>>>16&255,this.view[r+1]=f>>>8&255,this.view[r]=255&f):(this.view[r]=f>>>24&255,this.view[r+1]=f>>>16&255,this.view[r+2]=f>>>8&255,this.view[r+3]=255&f,r+=4,this.view[r]=n>>>24&255,this.view[r+1]=n>>>16&255,this.view[r+2]=n>>>8&255,this.view[r+3]=255&n),i&&(this.offset+=8),this},s.writeLong=s.writeInt64,s.readInt64=function(e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=0,n=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0,e+=4,n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0):(n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0,e+=4,i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),e=new t(i,n,!1),r&&(this.offset+=8),e},s.readLong=s.readInt64,s.writeUint64=function(e,r){var i="undefined"==typeof r;if(i&&(r=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof r||0!==r%1)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),r+=8;var n=this.buffer.byteLength;r>n&&this.resize((n*=2)>r?n:r),r-=8;var n=e.low,f=e.high;return this.littleEndian?(this.view[r+3]=n>>>24&255,this.view[r+2]=n>>>16&255,this.view[r+1]=n>>>8&255,this.view[r]=255&n,r+=4,this.view[r+3]=f>>>24&255,this.view[r+2]=f>>>16&255,this.view[r+1]=f>>>8&255,this.view[r]=255&f):(this.view[r]=f>>>24&255,this.view[r+1]=f>>>16&255,this.view[r+2]=f>>>8&255,this.view[r+3]=255&f,r+=4,this.view[r]=n>>>24&255,this.view[r+1]=n>>>16&255,this.view[r+2]=n>>>8&255,this.view[r+3]=255&n),i&&(this.offset+=8),this},s.writeUInt64=s.writeUint64,s.readUint64=function(e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=0,n=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0,e+=4,n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0):(n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0,e+=4,i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),e=new t(i,n,!0),r&&(this.offset+=8),e},s.readUInt64=s.readUint64),s.writeFloat32=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),f(this.view,t,e-4,this.littleEndian,23,4),r&&(this.offset+=4),this},s.writeFloat=s.writeFloat32,s.readFloat32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}return t=n(this.view,t,this.littleEndian,23,4),e&&(this.offset+=4),t},s.readFloat=s.readFloat32,s.writeFloat64=function(t,e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var i=this.buffer.byteLength;return e>i&&this.resize((i*=2)>e?i:e),f(this.view,t,e-8,this.littleEndian,52,8),r&&(this.offset+=8),this},s.writeDouble=s.writeFloat64,s.readFloat64=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}return t=n(this.view,t,this.littleEndian,52,8),e&&(this.offset+=8),t},s.readDouble=s.readFloat64,e.MAX_VARINT32_BYTES=5,e.calculateVarint32=function(t){return t>>>=0,128>t?1:16384>t?2:2097152>t?3:268435456>t?4:5},e.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},e.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},s.writeVarint32=function(t,r){var i="undefined"==typeof r;if(i&&(r=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof r||0!==r%1)throw TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var n,f=e.calculateVarint32(t);for(r+=f,n=this.buffer.byteLength,r>n&&this.resize((n*=2)>r?n:r),r-=f,t>>>=0;t>=128;)n=127&t|128,this.view[r++]=n,t>>>=7;return this.view[r++]=t,i?(this.offset=r,this):f},s.writeVarint32ZigZag=function(t,r){return this.writeVarint32(e.zigZagEncode32(t),r)},s.readVarint32=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,i=0,n=0;do{if(!this.noAssert&&t>this.limit)throw t=Error("Truncated"),t.truncated=!0,t;r=this.view[t++],5>i&&(n|=(127&r)<<7*i),++i}while(0!==(128&r));return n|=0,e?(this.offset=t,n):{value:n,length:i}},s.readVarint32ZigZag=function(t){return t=this.readVarint32(t),"object"==typeof t?t.value=e.zigZagDecode32(t.value):t=e.zigZagDecode32(t),t},t&&(e.MAX_VARINT64_BYTES=10,e.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var r=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0;return e=e.shiftRightUnsigned(56).toInt()>>>0,0==e?0==i?16384>r?128>r?1:2:2097152>r?3:4:16384>i?128>i?5:6:2097152>i?7:8:128>e?9:10},e.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},e.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},s.writeVarint64=function(r,i){var n="undefined"==typeof i;if(n&&(i=this.offset),!this.noAssert){if("number"==typeof r)r=t.fromNumber(r);else if("string"==typeof r)r=t.fromString(r);else if(!(r&&r instanceof t))throw TypeError("Illegal value: "+r+" (not an integer or Long)");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof r?r=t.fromNumber(r,!1):"string"==typeof r?r=t.fromString(r,!1):!1!==r.unsigned&&(r=r.toSigned());var f=e.calculateVarint64(r),s=r.toInt()>>>0,o=r.shiftRightUnsigned(28).toInt()>>>0,h=r.shiftRightUnsigned(56).toInt()>>>0;i+=f;var a=this.buffer.byteLength;switch(i>a&&this.resize((a*=2)>i?a:i),i-=f,f){case 10:this.view[i+9]=h>>>7&1;case 9:this.view[i+8]=9!==f?128|h:127&h;case 8:this.view[i+7]=8!==f?o>>>21|128:o>>>21&127;case 7:this.view[i+6]=7!==f?o>>>14|128:o>>>14&127;case 6:this.view[i+5]=6!==f?o>>>7|128:o>>>7&127;case 5:this.view[i+4]=5!==f?128|o:127&o;case 4:this.view[i+3]=4!==f?s>>>21|128:s>>>21&127;case 3:this.view[i+2]=3!==f?s>>>14|128:s>>>14&127;case 2:this.view[i+1]=2!==f?s>>>7|128:s>>>7&127;case 1:this.view[i]=1!==f?128|s:127&s}return n?(this.offset+=f,this):f},s.writeVarint64ZigZag=function(t,r){return this.writeVarint64(e.zigZagEncode64(t),r)},s.readVarint64=function(e){var r="undefined"==typeof e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=e,n=0,f=0,s=0,o=0,o=this.view[e++],n=127&o;if(128&o&&(o=this.view[e++],n|=(127&o)<<7,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],n|=(127&o)<<14,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],n|=(127&o)<<21,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],f=127&o,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],f|=(127&o)<<7,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],f|=(127&o)<<14,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],f|=(127&o)<<21,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],s=127&o,128&o||this.noAssert&&"undefined"==typeof o)&&(o=this.view[e++],s|=(127&o)<<7,128&o||this.noAssert&&"undefined"==typeof o))throw Error("Buffer overrun");return n=t.fromBits(n|f<<28,f>>>4|s<<24,!1),r?(this.offset=e,n):{value:n,length:e-i}},s.readVarint64ZigZag=function(r){return(r=this.readVarint64(r))&&r.value instanceof t?r.value=e.zigZagDecode64(r.value):r=e.zigZagDecode64(r),r}),s.writeCString=function(t,e){var i="undefined"==typeof e;i&&(e=this.offset);var n,f=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(n=0;f>n;++n)if(0===t.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return f=l.a(r(t))[1],e+=f+1,n=this.buffer.byteLength,e>n&&this.resize((n*=2)>e?n:e),e-=f+1,l.b(r(t),function(t){this.view[e++]=t}.bind(this)),this.view[e++]=0,i?(this.offset=e,this):f},s.readCString=function(t){var e="undefined"==typeof t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,n=t,f=-1;return l.c(function(){if(0===f)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return f=this.view[t++],0===f?null:f}.bind(this),r=i(),!0),e?(this.offset=t,r()):{string:r(),length:t-n}},s.writeIString=function(t,e){var i="undefined"==typeof e;if(i&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,f=e;n=l.a(r(t),this.noAssert)[1],e+=4+n;var s=this.buffer.byteLength;if(e>s&&this.resize((s*=2)>e?s:e),e-=4+n,this.littleEndian?(this.view[e+3]=n>>>24&255,this.view[e+2]=n>>>16&255,this.view[e+1]=n>>>8&255,this.view[e]=255&n):(this.view[e]=n>>>24&255,this.view[e+1]=n>>>16&255,this.view[e+2]=n>>>8&255,this.view[e+3]=255&n),e+=4,l.b(r(t),function(t){this.view[e++]=t}.bind(this)),e!==f+4+n)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+n));return i?(this.offset=e,this):e-f},s.readIString=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var i=t,n=this.readUint32(t),n=this.readUTF8String(n,e.METRICS_BYTES,t+=4);return t+=n.length,r?(this.offset=t,n.string):{string:n.string,length:t-i}},e.METRICS_CHARS="c",e.METRICS_BYTES="b",s.writeUTF8String=function(t,e){var i="undefined"==typeof e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,f=e;n=l.a(r(t))[1],e+=n;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=n,l.b(r(t),function(t){this.view[e++]=t}.bind(this)),i?(this.offset=e,this):e-f},s.writeString=s.writeUTF8String,e.calculateUTF8Chars=function(t){return l.a(r(t))[0]},e.calculateUTF8Bytes=function(t){return l.a(r(t))[1]},e.calculateString=e.calculateUTF8Bytes,s.readUTF8String=function(t,r,n){"number"==typeof r&&(n=r,r=void 0);var f="undefined"==typeof n;if(f&&(n=this.offset),"undefined"==typeof r&&(r=e.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||0!==n%1)throw TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var s,o=0,h=n;if(r===e.METRICS_CHARS){if(s=i(),l.f(function(){return t>o&&n<this.limit?this.view[n++]:null}.bind(this),function(t){++o,l.e(t,s)}),o!==t)throw RangeError("Illegal range: Truncated data, "+o+" == "+t);return f?(this.offset=n,s()):{string:s(),length:n-h}}if(r===e.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||0!==n%1)throw TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+"+t+") <= "+this.buffer.byteLength)}var a=n+t;if(l.c(function(){return a>n?this.view[n++]:null}.bind(this),s=i(),this.noAssert),n!==a)throw RangeError("Illegal range: Truncated data, "+n+" == "+a);return f?(this.offset=n,s()):{string:s(),length:n-h}}throw TypeError("Unsupported metrics: "+r)},s.readString=s.readUTF8String,s.writeVString=function(t,i){var n="undefined"==typeof i;if(n&&(i=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var f,s,o=i;f=l.a(r(t),this.noAssert)[1],s=e.calculateVarint32(f),i+=s+f;var h=this.buffer.byteLength;if(i>h&&this.resize((h*=2)>i?h:i),i-=s+f,i+=this.writeVarint32(f,i),l.b(r(t),function(t){this.view[i++]=t}.bind(this)),i!==o+f+s)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+f+s));return n?(this.offset=i,this):i-o},s.readVString=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var i=t,n=this.readVarint32(t),n=this.readUTF8String(n.value,e.METRICS_BYTES,t+=n.length);return t+=n.length,r?(this.offset=t,n.string):{string:n.string,length:t-i}},s.append=function(t,r,i){"number"!=typeof r&&"string"==typeof r||(i=r,r=void 0);var n="undefined"==typeof i;if(n&&(i=this.offset),!this.noAssert){if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}if(t instanceof e||(t=e.wrap(t,r)),r=t.limit-t.offset,0>=r)return this;i+=r;var f=this.buffer.byteLength;return i>f&&this.resize((f*=2)>i?f:i),this.view.set(t.view.subarray(t.offset,t.limit),i-r),t.offset+=r,n&&(this.offset+=r),this},s.appendTo=function(t,e){return t.append(this,e),this},s.assert=function(t){return this.noAssert=!t,this},s.capacity=function(){return this.buffer.byteLength},s.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},s.clone=function(t){var r=new e(0,this.littleEndian,this.noAssert);return t?(r.buffer=new ArrayBuffer(this.buffer.byteLength),r.view=new Uint8Array(r.buffer)):(r.buffer=this.buffer,r.view=this.view),r.offset=this.offset,r.markedOffset=this.markedOffset,r.limit=this.limit,r},s.compact=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var r=e-t;if(0===r)return this.buffer=o,this.view=null,0<=this.markedOffset&&(this.markedOffset-=t),this.limit=this.offset=0,this;var i=new ArrayBuffer(r),n=new Uint8Array(i);return n.set(this.view.subarray(t,e)),this.buffer=i,this.view=n,0<=this.markedOffset&&(this.markedOffset-=t),this.offset=0,this.limit=r,this},s.copy=function(t,r){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||0!==r%1)throw TypeError("Illegal end: Not an integer");if(r>>>=0,0>t||t>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(t===r)return new e(0,this.littleEndian,this.noAssert);var i=r-t,n=new e(i,this.littleEndian,this.noAssert);return n.offset=0,n.limit=i,0<=n.markedOffset&&(n.markedOffset-=t),this.copyTo(n,0,t,r),n},s.copyTo=function(t,r,i,n){var f,s;if(!this.noAssert&&!e.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(r=(s="undefined"==typeof r)?t.offset:0|r,i=(f="undefined"==typeof i)?this.offset:0|i,n="undefined"==typeof n?this.limit:0|n,0>r||r>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+r+" <= "+t.buffer.byteLength);if(0>i||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var o=n-i;return 0===o?t:(t.ensureCapacity(r+o),t.view.set(this.view.subarray(i,n),r),f&&(this.offset+=o),s&&(t.offset+=o),this)},s.ensureCapacity=function(t){var e=this.buffer.byteLength;return t>e?this.resize((e*=2)>t?e:t):this},s.fill=function(t,e,r){var i="undefined"==typeof e;if(i&&(e=this.offset),"string"==typeof t&&0<t.length&&(t=t.charCodeAt(0)),"undefined"==typeof e&&(e=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||0!==r%1)throw TypeError("Illegal end: Not an integer");if(r>>>=0,0>e||e>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(e>=r)return this;for(;r>e;)this.view[e++]=t;return i&&(this.offset=e),this},s.flip=function(){return this.limit=this.offset,this.offset=0,this},s.mark=function(t){if(t="undefined"==typeof t?this.offset:t,!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},s.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},s.LE=function(t){return this.littleEndian="undefined"!=typeof t?!!t:!0,this},s.BE=function(t){return this.littleEndian="undefined"!=typeof t?!t:!1,this},s.prepend=function(t,r,i){"number"!=typeof r&&"string"==typeof r||(i=r,r=void 0);var n="undefined"==typeof i;if(n&&(i=this.offset),!this.noAssert){if("number"!=typeof i||0!==i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}if(t instanceof e||(t=e.wrap(t,r)),r=t.limit-t.offset,0>=r)return this;var f=r-i;if(f>0){var s=new ArrayBuffer(this.buffer.byteLength+f),o=new Uint8Array(s);o.set(this.view.subarray(i,this.buffer.byteLength),r),
this.buffer=s,this.view=o,this.offset+=f,0<=this.markedOffset&&(this.markedOffset+=f),this.limit+=f,i+=f}else new Uint8Array(this.buffer);return this.view.set(t.view.subarray(t.offset,t.limit),i-r),t.offset=t.limit,n&&(this.offset-=r),this},s.prependTo=function(t,e){return t.prepend(this,e),this},s.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},s.remaining=function(){return this.limit-this.offset},s.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},s.resize=function(t){if(!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal capacity: "+t+" (not an integer)");if(t|=0,0>t)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){t=new ArrayBuffer(t);var e=new Uint8Array(t);e.set(this.view),this.buffer=t,this.view=e}return this},s.reverse=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e?this:(Array.prototype.reverse.call(this.view.subarray(t,e)),this)},s.skip=function(t){if(!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(0>e||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},s.slice=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=t,r.limit=e,r},s.toBuffer=function(t){var e=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof e||0!==e%1)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof r||0!==r%1)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,0>e||e>r||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}return t||0!==e||r!==this.buffer.byteLength?e===r?o:(t=new ArrayBuffer(r-e),new Uint8Array(t).set(new Uint8Array(this.buffer).subarray(e,r),0),t):this.buffer},s.toArrayBuffer=s.toBuffer,s.toString=function(t,e,r){if("undefined"==typeof t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(r=e=t="utf8"),t){case"utf8":return this.toUTF8(e,r);case"base64":return this.toBase64(e,r);case"hex":return this.toHex(e,r);case"binary":return this.toBinary(e,r);case"debug":return this.toDebug();case"columns":return this.m();default:throw Error("Unsupported encoding: "+t)}};var a=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],r=[],i=0,n=e.length;n>i;++i)r[e[i]]=i;return t.h=function(t,r){for(var i,n;null!==(i=t());)r(e[i>>2&63]),n=(3&i)<<4,null!==(i=t())?(n|=i>>4&15,r(e[63&(n|i>>4&15)]),n=(15&i)<<2,null!==(i=t())?(r(e[63&(n|i>>6&3)]),r(e[63&i])):(r(e[63&n]),r(61))):(r(e[63&n]),r(61),r(61))},t.g=function(t,e){function i(t){throw Error("Illegal character code: "+t)}for(var n,f,s;null!==(n=t());)if(f=r[n],"undefined"==typeof f&&i(n),null!==(n=t())&&(s=r[n],"undefined"==typeof s&&i(n),e(f<<2>>>0|(48&s)>>4),null!==(n=t()))){if(f=r[n],"undefined"==typeof f){if(61===n)break;i(n)}if(e((15&s)<<4>>>0|(60&f)>>2),null!==(n=t())){if(s=r[n],"undefined"==typeof s){if(61===n)break;i(n)}e((3&f)<<6>>>0|s)}}},t.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)},t}();s.toBase64=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),t|=0,e|=0,0>t||e>this.capacity||t>e)throw RangeError("begin, end");var r;return a.h(function(){return e>t?this.view[t++]:null}.bind(this),r=i()),r()},e.fromBase64=function(t,i){if("string"!=typeof t)throw TypeError("str");var n=new e(t.length/4*3,i),f=0;return a.g(r(t),function(t){n.view[f++]=t}),n.limit=f,n},e.btoa=function(t){return e.fromBinary(t).toBase64()},e.atob=function(t){return e.fromBase64(t).toBinary()},s.toBinary=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),t|=0,e|=0,0>t||e>this.capacity()||t>e)throw RangeError("begin, end");if(t===e)return"";for(var r=[],i=[];e>t;)r.push(this.view[t++]),1024<=r.length&&(i.push(String.fromCharCode.apply(String,r)),r=[]);return i.join("")+String.fromCharCode.apply(String,r)},e.fromBinary=function(t,r){if("string"!=typeof t)throw TypeError("str");for(var i,n=0,f=t.length,s=new e(f,r);f>n;){if(i=t.charCodeAt(n),i>255)throw RangeError("illegal char code: "+i);s.view[n++]=i}return s.limit=f,s},s.toDebug=function(t){for(var e,r=-1,i=this.buffer.byteLength,n="",f="",s="";i>r;){if(-1!==r&&(e=this.view[r],n=16>e?n+("0"+e.toString(16).toUpperCase()):n+e.toString(16).toUpperCase(),t&&(f+=e>32&&127>e?String.fromCharCode(e):".")),++r,t&&r>0&&0===r%16&&r!==i){for(;51>n.length;)n+=" ";s+=n+f+"\n",n=f=""}n=r===this.offset&&r===this.limit?n+(r===this.markedOffset?"!":"|"):r===this.offset?n+(r===this.markedOffset?"[":"<"):r===this.limit?n+(r===this.markedOffset?"]":">"):n+(r===this.markedOffset?"'":t||0!==r&&r!==i?" ":"")}if(t&&" "!==n){for(;51>n.length;)n+=" ";s+=n+f+"\n"}return t?s:n},e.fromDebug=function(t,r,i){var n=t.length;r=new e((n+1)/3|0,r,i);for(var f,s=0,o=0,h=!1,a=!1,l=!1,u=!1,g=!1;n>s;){switch(f=t.charAt(s++)){case"!":if(!i){if(a||l||u){g=!0;break}a=l=u=!0}r.offset=r.markedOffset=r.limit=o,h=!1;break;case"|":if(!i){if(a||u){g=!0;break}a=u=!0}r.offset=r.limit=o,h=!1;break;case"[":if(!i){if(a||l){g=!0;break}a=l=!0}r.offset=r.markedOffset=o,h=!1;break;case"<":if(!i){if(a){g=!0;break}a=!0}r.offset=o,h=!1;break;case"]":if(!i){if(u||l){g=!0;break}u=l=!0}r.limit=r.markedOffset=o,h=!1;break;case">":if(!i){if(u){g=!0;break}u=!0}r.limit=o,h=!1;break;case"'":if(!i){if(l){g=!0;break}l=!0}r.markedOffset=o,h=!1;break;case" ":h=!1;break;default:if(!i&&h){g=!0;break}if(f=parseInt(f+t.charAt(s++),16),!i&&(isNaN(f)||0>f||f>255))throw TypeError("Illegal str: Not a debug encoded string");r.view[o++]=f,h=!0}if(g)throw TypeError("Illegal str: Invalid symbol at "+s)}if(!i){if(!a||!u)throw TypeError("Illegal str: Missing offset or limit");if(o<r.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+o+" < "+n)}return r},s.toHex=function(t,e){if(t="undefined"==typeof t?this.offset:t,e="undefined"==typeof e?this.limit:e,!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var r,i=Array(e-t);e>t;)r=this.view[t++],16>r?i.push("0",r.toString(16)):i.push(r.toString(16));return i.join("")},e.fromHex=function(t,r,i){if(!i){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(0!==t.length%2)throw TypeError("Illegal str: Length not a multiple of 2")}var n=t.length;r=new e(n/2|0,r);for(var f,s=0,o=0;n>s;s+=2){if(f=parseInt(t.substring(s,s+2),16),!i&&(!isFinite(f)||0>f||f>255))throw TypeError("Illegal str: Contains non-hex characters");r.view[o++]=f}return r.limit=o,r};var l=function(){var t={j:1114111,i:function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)128>r?e(127&r):(2048>r?e(r>>6&31|192):(65536>r?e(r>>12&15|224):(e(r>>18&7|240),e(r>>12&63|128)),e(r>>6&63|128)),e(63&r|128)),r=null},f:function(t,e){function r(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e}for(var i,n,f,s;null!==(i=t());)if(0===(128&i))e(i);else if(192===(224&i))null===(n=t())&&r([i,n]),e((31&i)<<6|63&n);else if(224===(240&i))null!==(n=t())&&null!==(f=t())||r([i,n,f]),e((15&i)<<12|(63&n)<<6|63&f);else{if(240!==(248&i))throw RangeError("Illegal starting byte: "+i);null!==(n=t())&&null!==(f=t())&&null!==(s=t())||r([i,n,f,s]),e((7&i)<<18|(63&n)<<12|(63&f)<<6|63&s)}},d:function(t,e){for(var r,i=null;null!==(r=null!==i?i:t());)r>=55296&&57343>=r&&null!==(i=t())&&i>=56320&&57343>=i?(e(1024*(r-55296)+i-56320+65536),i=null):e(r);null!==i&&e(i)},e:function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)65535>=r?e(r):(r-=65536,e((r>>10)+55296),e(r%1024+56320)),r=null},b:function(e,r){t.d(e,function(e){t.i(e,r)})},c:function(e,r){t.f(e,function(e){t.e(e,r)})},k:function(t){return 128>t?1:2048>t?2:65536>t?3:4},l:function(t){for(var e,r=0;null!==(e=t());)r+=128>e?1:2048>e?2:65536>e?3:4;return r},a:function(e){var r=0,i=0;return t.d(e,function(t){++r,i+=128>t?1:2048>t?2:65536>t?3:4}),[r,i]}};return t}();return s.toUTF8=function(t,e){if("undefined"==typeof t&&(t=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||0!==t%1)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||0!==e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>t||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var r;try{l.c(function(){return e>t?this.view[t++]:null}.bind(this),r=i())}catch(n){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return r()},e.fromUTF8=function(t,i,n){if(!n&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var f=new e(l.a(r(t),!0)[1],i,n),s=0;return l.b(r(t),function(t){f.view[s++]=t}),f.limit=s,f},e}if("function"==typeof define&&define.amd)define(["long"],u);else if("function"==typeof require&&"object"==typeof module&&module&&module.exports){var B=module,C,D;try{D=require("long")}catch(E){}C=u(D),B.exports=C}else(this.dcodeIO=this.dcodeIO||{}).ByteBuffer=u(this.dcodeIO.Long);!function(e,t){"function"==typeof define&&define.amd?define(["ByteBuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(e,t){var i={};return i.ByteBuffer=e,i.Long=e.Long||null,i.VERSION="4.1.3",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},"double":{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},"float":{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},"enum":{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=function(){var e={};return e.IS_NODE=!("object"!=typeof process||"[object process]"!=process+""||process.browser),e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(r){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,i){if(i&&"function"!=typeof i&&(i=null),e.IS_NODE){var r=require("fs");if(i)r.readFile(t,function(e,t){i(e?null:""+t)});else try{return r.readFileSync(t)}catch(n){return null}}else{var s=e.XHR();if(s.open("GET",t,!!i),s.setRequestHeader("Accept","text/plain"),"function"==typeof s.overrideMimeType&&s.overrideMimeType("text/plain"),!i)return s.send(null),200==s.status||0==s.status&&"string"==typeof s.responseText?s.responseText:null;s.onreadystatechange=function(){4==s.readyState&&i(200==s.status||0==s.status&&"string"==typeof s.responseText?s.responseText:null)},4!=s.readyState&&s.send(null)}},e.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},e}(),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(e,t){function i(e,i){var r=-1,n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))r=parseInt(e);else if(t.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(0>n?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=n*r|0,!i&&0>r)throw Error("illegal id value: "+(0>n?"-":"")+e);return r}function r(e){var i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return i*parseInt(e,10);if(t.NUMBER_HEX.test(e))return i*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return i*parseInt(e.substring(1),8);if("inf"===e)return 1/0*i;if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return i*parseFloat(e);throw Error("illegal number value: "+(0>i?"-":"")+e)}function n(e,t,i){"undefined"==typeof e[t]?e[t]=i:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(i))}var s={},o=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},a=o.prototype;a._readString=function(){var e='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;e.lastIndex=this.index-1;var i=e.exec(this.source);if(!i)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,i[1]},a.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,i;do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if("\n"===i&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(i=this.source.charAt(this.index)))return"/";do{if("\n"===i&&++this.line,++this.index===this.source.length)return null;e=i,i=this.source.charAt(this.index)}while("*"!==e||"/"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(i=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(i++)))for(;i<this.source.length&&!t.DELIM.test(this.source.charAt(i));)++i;return i=this.source.substring(this.index,this.index=i),'"'!==i&&"'"!==i||(this._stringOpen=i),i},a.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},a.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},a.omit=function(e){return this.peek()===e?(this.next(),!0):!1},a.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},s.Tokenizer=o;var l=function(e){this.tn=new o(e),this.proto3=!1},a=l.prototype;return a.parse=function(){var e,i={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},r=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!r||null!==i["package"])throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),i["package"]=e;break;case"import":if(!r)throw Error("unexpected 'import'");e=this.tn.peek(),"public"===e&&this.tn.next(),e=this._readString(),this.tn.skip(";"),i.imports.push(e);break;case"syntax":if(!r)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(i.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(i,null),r=!1;break;case"enum":this._parseEnum(i),r=!1;break;case"option":this._parseOption(i);break;case"service":this._parseService(i);break;case"extend":this._parseExtend(i);break;default:throw Error("unexpected '"+e+"'")}}catch(n){throw n.message="Parse error at line "+this.tn.line+": "+n.message,n}return delete i.name,i},l.parse=function(e){return new l(e).parse()},a._readString=function(){var e,t="";do{if(e=this.tn.next(),"'"!==e&&'"'!==e)throw Error("illegal string delimiter: "+e);t+=this.tn.next(),this.tn.skip(e),e=this.tn.peek()}while('"'===e||'"'===e);return t},a._readValue=function(e){var i=this.tn.peek();if('"'===i||"'"===i)return this._readString();if(this.tn.next(),t.NUMBER.test(i))return r(i);if(t.BOOL.test(i))return"true"===i.toLowerCase();if(e&&t.TYPEREF.test(i))return i;throw Error("illegal value: "+i)},a._parseOption=function(e,i){var r=this.tn.next(),n=!1;if("("===r&&(n=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error("illegal option name: "+r);var s=r;n&&(this.tn.skip(")"),s="("+s+")",r=this.tn.peek(),t.FQTYPEREF.test(r)&&(s+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,s),i||this.tn.skip(";")},a._parseOptionValue=function(e,i){var r=this.tn.peek();if("{"!==r)n(e.options,i,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!t.NAME.test(r))throw Error("illegal option name: "+i+"."+r);this.tn.omit(":")?n(e.options,i+"."+r,this._readValue(!0)):this._parseOptionValue(e,i+"."+r)}},a._parseService=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal service name at line "+this.tn.line+": "+i);var r={name:i,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(r);else{if("rpc"!==i)throw Error("illegal service token: "+i);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},a._parseServiceRPC=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal rpc service method name: "+i);var r=i,n={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(n.request_stream=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("illegal rpc service request type: "+i);if(n.request=i,this.tn.skip(")"),i=this.tn.next(),"returns"!==i.toLowerCase())throw Error("illegal rpc service request type delimiter: "+i);if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(n.response_stream=!0,i=this.tn.next()),n.response=i,this.tn.skip(")"),i=this.tn.peek(),"{"===i){for(this.tn.next();"}"!==(i=this.tn.next());){if("option"!==i)throw Error("illegal rpc service token: "+i);this._parseOption(n)}this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof e.rpc&&(e.rpc={}),e.rpc[r]=n},a._parseMessage=function(e,r){var n=!!r,s=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},oneofs:{}};if(!t.NAME.test(s))throw Error("illegal "+(n?"group":"message")+" name: "+s);for(o.name=s,n&&(this.tn.skip("="),r.id=i(this.tn.next()),o.isGroup=!0),s=this.tn.peek(),"["===s&&r&&this._parseFieldOptions(r),this.tn.skip("{");"}"!==(s=this.tn.next());)if(t.RULE.test(s))this._parseMessageField(o,s);else if("oneof"===s)this._parseMessageOneOf(o);else if("enum"===s)this._parseEnum(o);else if("message"===s)this._parseMessage(o);else if("option"===s)this._parseOption(o);else if("extensions"===s)this._parseExtensions(o);else if("extend"===s)this._parseExtend(o);else{if(!t.TYPEREF.test(s))throw Error("illegal message token: "+s);if(!this.proto3)throw Error("illegal field rule: "+s);this._parseMessageField(o,"optional",s)}return this.tn.omit(";"),e.messages.push(o),o},a._parseMessageField=function(e,r,n){if(!t.RULE.test(r))throw Error("illegal message field rule: "+r);var s={rule:r,type:"",name:"",options:{},id:0};if("map"===r){if(n)throw Error("illegal type: "+n);if(this.tn.skip("<"),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(s.keytype=r,this.tn.skip(","),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field: "+r);if(s.type=r,this.tn.skip(">"),r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);s.name=r,this.tn.skip("="),s.id=i(this.tn.next()),r=this.tn.peek(),"["===r&&this._parseFieldOptions(s),this.tn.skip(";")}else if(n="undefined"!=typeof n?n:this.tn.next(),"group"===n){if(r=this._parseMessage(e,s),!/^[A-Z]/.test(r.name))throw Error("illegal group name: "+r.name);s.type=r.name,s.name=r.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(n)&&!t.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(s.type=n,r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);s.name=r,this.tn.skip("="),s.id=i(this.tn.next()),r=this.tn.peek(),"["===r&&this._parseFieldOptions(s),this.tn.skip(";")}return e.fields.push(s),s},a._parseMessageOneOf=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal oneof name: "+i);var r=i,n=[];for(this.tn.skip("{");"}"!==(i=this.tn.next());)i=this._parseMessageField(e,"optional",i),i.oneof=r,n.push(i.id);this.tn.omit(";"),e.oneofs[r]=n},a._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},a._parseEnum=function(e){var r={name:"",values:[],options:{}},n=this.tn.next();if(!t.NAME.test(n))throw Error("illegal name: "+n);for(r.name=n,this.tn.skip("{");"}"!==(n=this.tn.next());)if("option"===n)this._parseOption(r);else{if(!t.NAME.test(n))throw Error("illegal name: "+n);this.tn.skip("=");var s={name:n,id:i(this.tn.next(),!0)},n=this.tn.peek();"["===n&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),r.values.push(s)}this.tn.omit(";"),e.enums.push(r)},a._parseExtensions=function(t){var i=this.tn.next(),n=[];"min"===i?n.push(e.ID_MIN):"max"===i?n.push(e.ID_MAX):n.push(r(i)),this.tn.skip("to"),i=this.tn.next(),"min"===i?n.push(e.ID_MIN):"max"===i?n.push(e.ID_MAX):n.push(r(i)),this.tn.skip(";"),t.extensions=n},a._parseExtend=function(e){var i=this.tn.next();if(!t.TYPEREF.test(i))throw Error("illegal extend reference: "+i);var r={ref:i,fields:[]};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(r,i);else{if(!t.TYPEREF.test(i))throw Error("illegal extend token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(r,"optional",i)}return this.tn.omit(";"),e.messages.push(r),r},a.toString=function(){return"Parser at line "+this.tn.line},s.Parser=l,s}(i,i.Lang),i.Reflect=function(t){function i(e,i){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,"undefined"==typeof i?e.unsigned:i);if("string"==typeof e)return t.Long.fromString(e,i||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,i||!1);throw Error("not convertible to Long")}function r(e,i){var n=i.readVarint32(),s=7&n,n=n>>>3;switch(s){case t.WIRE_TYPES.VARINT:do n=i.readUint8();while(128===(128&n));break;case t.WIRE_TYPES.BITS64:i.offset+=8;break;case t.WIRE_TYPES.LDELIM:n=i.readVarint32(),i.offset+=n;break;case t.WIRE_TYPES.STARTGROUP:r(n,i);break;case t.WIRE_TYPES.ENDGROUP:if(n===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+n+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+s)}return!0}var n={},s=function(e,t,i){this.builder=e,this.parent=t,this.name=i},o=s.prototype;o.fqn=function(){for(var e=this.name,t=this;;){if(t=t.parent,null==t)break;e=t.name+"."+e}return e},o.toString=function(e){return(e?this.className+" ":"")+this.fqn()},o.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=s;var a=function(e,t,i,r,n){s.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=n||"proto2"},o=a.prototype=Object.create(s.prototype);o.getChildren=function(e){if(e=e||null,null==e)return this.children.slice();for(var t=[],i=0,r=this.children.length;r>i;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},o.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof f.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof f.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},o.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,r=this.children.length;r>i;++i)if(this.children[i][t]===e)return this.children[i];return null},o.resolve=function(e,t){var i="string"==typeof e?e.split("."):e,r=this,s=0;if(""===i[s]){for(;null!==r.parent;)r=r.parent;s++}do{do{if(!(r instanceof n.Namespace)){r=null;break}if(r=r.getChild(i[s]),!(r&&r instanceof n.T)||t&&!(r instanceof n.Namespace)){r=null;break}s++}while(s<i.length);if(null!=r)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=r);return r},o.qn=function(e){var t=[],i=e;do t.unshift(i.name),i=i.parent;while(null!==i);for(i=1;i<=t.length;i++){var r=t.slice(t.length-i);if(e===this.resolve(r,e instanceof n.Namespace))return r.join(".")}return e.fqn()},o.build=function(){for(var e,t={},i=this.children,r=0,n=i.length;n>r;++r)e=i[r],e instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},o.buildOpt=function(){for(var e={},t=Object.keys(this.options),i=0,r=t.length;r>i;++i)e[t[i]]=this.options[t[i]];return e},o.getOption=function(e){return"undefined"==typeof e?this.options:"undefined"!=typeof this.options[e]?this.options[e]:null},n.Namespace=a;var l=function(e,i,r,n){if(this.type=e,this.resolvedType=i,this.isMapKey=r,this.syntax=n,r&&0>t.MAP_KEY_TYPES.indexOf(e))throw Error("Invalid map key type: "+e.name)},u=l.prototype;l.defaultFieldValue=function(i){if("string"==typeof i&&(i=t.TYPES[i]),"undefined"==typeof i.defaultValue)throw Error("default value for type "+i.name+" is not supported");return i==t.TYPES.bytes?new e(0):i.defaultValue},u.verifyValue=function(r){var n=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof r||r===r&&0!==r%1)&&n(typeof r,"not an integer"),r>4294967295?0|r:r;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof r||r===r&&0!==r%1)&&n(typeof r,"not an integer"),0>r?r>>>0:r;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return i(r,!1)}catch(s){n(typeof r,s.message)}else n(typeof r,"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return i(r,!0)}catch(o){n(typeof r,o.message)}else n(typeof r,"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof r&&n(typeof r,"not a boolean"),r;case t.TYPES["float"]:case t.TYPES["double"]:return"number"!=typeof r&&n(typeof r,"not a number"),r;case t.TYPES.string:return"string"==typeof r||r&&r instanceof String||n(typeof r,"not a string"),""+r;case t.TYPES.bytes:return e.isByteBuffer(r)?r:e.wrap(r,"base64");case t.TYPES["enum"]:for(var a=this.resolvedType.getChildren(t.Reflect.Enum.Value),l=0;l<a.length;l++)if(a[l].name==r||a[l].id==r)return a[l].id;if("proto3"===this.syntax)return("number"!=typeof r||r===r&&0!==r%1)&&n(typeof r,"not an integer"),(r>4294967295||0>r)&&n(typeof r,"not in range for uint32"),r;n(r,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:if(r&&"object"==typeof r||n(typeof r,"object expected"),r instanceof this.resolvedType.clazz)return r;if(r instanceof t.Builder.Message){var l,n={};for(l in r)r.hasOwnProperty(l)&&(n[l]=r[l]);r=n}return new this.resolvedType.clazz(r)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+r+" (undefined type "+this.type+")")},u.calculateLength=function(i,r){if(null===r)return 0;var n;switch(this.type){case t.TYPES.int32:return 0>r?e.calculateVarint64(r):e.calculateVarint32(r);case t.TYPES.uint32:return e.calculateVarint32(r);case t.TYPES.sint32:return e.calculateVarint32(e.zigZagEncode32(r));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES["float"]:return 4;case t.TYPES.int64:case t.TYPES.uint64:return e.calculateVarint64(r);case t.TYPES.sint64:return e.calculateVarint64(e.zigZagEncode64(r));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES["enum"]:return e.calculateVarint32(r);case t.TYPES["double"]:return 8;case t.TYPES.string:return n=e.calculateUTF8Bytes(r),e.calculateVarint32(n)+n;case t.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");return e.calculateVarint32(r.remaining())+r.remaining();case t.TYPES.message:return n=this.resolvedType.calculate(r),e.calculateVarint32(n)+n;case t.TYPES.group:return n=this.resolvedType.calculate(r),n+e.calculateVarint32(i<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")},u.encodeValue=function(i,r,n){if(null===r)return n;switch(this.type){case t.TYPES.int32:0>r?n.writeVarint64(r):n.writeVarint32(r);break;case t.TYPES.uint32:n.writeVarint32(r);break;case t.TYPES.sint32:n.writeVarint32ZigZag(r);break;case t.TYPES.fixed32:n.writeUint32(r);break;case t.TYPES.sfixed32:n.writeInt32(r);break;case t.TYPES.int64:case t.TYPES.uint64:n.writeVarint64(r);break;case t.TYPES.sint64:n.writeVarint64ZigZag(r);break;case t.TYPES.fixed64:n.writeUint64(r);break;case t.TYPES.sfixed64:n.writeInt64(r);break;case t.TYPES.bool:"string"==typeof r?n.writeVarint32("false"===r.toLowerCase()?0:!!r):n.writeVarint32(r?1:0);break;case t.TYPES["enum"]:n.writeVarint32(r);break;case t.TYPES["float"]:n.writeFloat32(r);break;case t.TYPES["double"]:n.writeFloat64(r);break;case t.TYPES.string:n.writeVString(r);break;case t.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");i=r.offset,n.writeVarint32(r.remaining()),n.append(r),r.offset=i;break;case t.TYPES.message:i=(new e).LE(),this.resolvedType.encode(r,i),n.writeVarint32(i.offset),n.append(i.flip());break;case t.TYPES.group:this.resolvedType.encode(r,n),n.writeVarint32(i<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")}return n},u.decode=function(e,i,r){if(i!=this.type.wireType)throw Error("Unexpected wire type for element");switch(this.type){case t.TYPES.int32:return 0|e.readVarint32();case t.TYPES.uint32:return e.readVarint32()>>>0;case t.TYPES.sint32:return 0|e.readVarint32ZigZag();case t.TYPES.fixed32:return e.readUint32()>>>0;case t.TYPES.sfixed32:return 0|e.readInt32();case t.TYPES.int64:return e.readVarint64();case t.TYPES.uint64:return e.readVarint64().toUnsigned();case t.TYPES.sint64:return e.readVarint64ZigZag();case t.TYPES.fixed64:return e.readUint64();case t.TYPES.sfixed64:return e.readInt64();case t.TYPES.bool:return!!e.readVarint32();case t.TYPES["enum"]:return e.readVarint32();case t.TYPES["float"]:return e.readFloat();case t.TYPES["double"]:return e.readDouble();case t.TYPES.string:return e.readVString();case t.TYPES.bytes:if(r=e.readVarint32(),e.remaining()<r)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+r+" required but got only "+e.remaining());return i=e.clone(),i.limit=i.offset+r,e.offset+=r,i;case t.TYPES.message:return r=e.readVarint32(),this.resolvedType.decode(e,r);case t.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},u.valueFromString=function(i){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return this.verifyValue(parseInt(i));case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return this.verifyValue(i);case t.TYPES.bool:return"true"===i;case t.TYPES.string:return this.verifyValue(i);case t.TYPES.bytes:return e.fromBinary(i)}},u.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===t.TYPES.bytes?e.toString("binary"):e.toString()},n.Element=l;var f=function(e,i,r,n,s,o){a.call(this,e,i,r,n,o),this.className="Message",this.extensions=[t.ID_MIN,t.ID_MAX],this.clazz=null,this.isGroup=!!s,this._fieldsByName=this._fieldsById=this._fields=null},u=f.prototype=Object.create(a.prototype);u.build=function(i){if(this.clazz&&!i)return this.clazz;i=function(t,i){function r(i,n,s,o){if(null===i||"object"!=typeof i){if(o&&o instanceof t.Reflect.Enum){var a=t.Reflect.Enum.getName(o.object,i);if(null!==a)return a}return i}if(e.isByteBuffer(i))return n?i.toBase64():i.toBuffer();if(t.Long.isLong(i))return s?i.toString():t.Long.fromValue(i);var l;if(Array.isArray(i))return l=[],i.forEach(function(e,t){l[t]=r(e,n,s,o)}),l;if(l={},i instanceof t.Map){for(var a=i.entries(),u=a.next();!u.done;u=a.next())l[i.keyElem.valueToString(u.value[0])]=r(u.value[1],n,s,i.valueElem.resolvedType);return l}var f,a=i.$type,u=void 0;for(f in i)i.hasOwnProperty(f)&&(a&&(u=a.getChild(f))?l[f]=r(i[f],n,s,u.resolvedType):l[f]=r(i[f],n,s));return l}var n=i.getChildren(t.Reflect.Message.Field),s=i.getChildren(t.Reflect.Message.OneOf),o=function(r,a){t.Builder.Message.call(this);for(var l=0,u=s.length;u>l;++l)this[s[l].name]=null;for(l=0,u=n.length;u>l;++l){var f=n[l];this[f.name]=f.repeated?[]:f.map?new t.Map(f):null,!f.required&&"proto3"!==i.syntax||null===f.defaultValue||(this[f.name]=f.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===r||"object"!=typeof r||!("function"!=typeof r.encode||r instanceof o)||Array.isArray(r)||r instanceof t.Map||e.isByteBuffer(r)||r instanceof ArrayBuffer||t.Long&&r instanceof t.Long)for(l=0,u=arguments.length;u>l;++l)"undefined"!=typeof(f=arguments[l])&&this.$set(n[l].name,f);else this.$set(r)},a=o.prototype=Object.create(t.Builder.Message.prototype);a.add=function(e,r,n){var s=i._fieldsByName[e];if(!n){if(!s)throw Error(this+"#"+e+" is undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));if(!s.repeated)throw Error(this+"#"+e+" is not a repeated field");r=s.verifyValue(r,!0)}return null===this[e]&&(this[e]=[]),this[e].push(r),this},a.$add=a.add,a.set=function(e,r,n){if(e&&"object"==typeof e){n=r;for(var s in e)e.hasOwnProperty(s)&&"undefined"!=typeof(r=e[s])&&this.$set(s,r,n);return this}if(s=i._fieldsByName[e],n)this[e]=r;else{if(!s)throw Error(this+"#"+e+" is not a field: undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));this[s.name]=r=s.verifyValue(r)}return s&&s.oneof&&(n=this[s.oneof.name],null!==r?(null!==n&&n!==s.name&&(this[n]=null),this[s.oneof.name]=s.name):n===e&&(this[s.oneof.name]=null)),this},a.$set=a.set,a.get=function(e,r){if(r)return this[e];var n=i._fieldsByName[e];if(!(n&&n instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(n instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));return this[n.name]},a.$get=a.get;for(var l=0;l<n.length;l++){var u=n[l];u instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")}),t=t.substring(0,1).toUpperCase()+t.substring(1),r=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),n=function(t,i){return this[e.name]=i?t:e.verifyValue(t),this},s=function(){return this[e.name]};null===i.getChild("set"+t)&&(a["set"+t]=n),null===i.getChild("set_"+r)&&(a["set_"+r]=n),null===i.getChild("get"+t)&&(a["get"+t]=s),null===i.getChild("get_"+r)&&(a["get_"+r]=s)}(u)}return a.encode=function(t,r){"boolean"==typeof t&&(r=t,t=void 0);var n=!1;t||(t=new e,n=!0);var s=t.littleEndian;try{return i.encode(this,t.LE(),r),(n?t.flip():t).LE(s)}catch(o){throw t.LE(s),o}},o.encode=function(e,t,i){return new o(e).encode(t,i)},a.calculate=function(){return i.calculate(this)},a.encodeDelimited=function(t){var r=!1;t||(t=new e,r=!0);var n=(new e).LE();return i.encode(this,n).flip(),t.writeVarint32(n.remaining()),t.append(n),r?t.flip():t},a.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},a.toArrayBuffer=a.encodeAB,a.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},a.toBuffer=a.encodeNB,a.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},a.toBase64=a.encode64,a.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},a.toHex=a.encodeHex,a.toRaw=function(e,t){return r(this,!!e,!!t,this.$type)},a.encodeJSON=function(){return JSON.stringify(r(this,!0,!0,this.$type))},o.decode=function(t,r){"string"==typeof t&&(t=e.wrap(t,r?r:"base64")),t=e.isByteBuffer(t)?t:e.wrap(t);var n=t.littleEndian;try{var s=i.decode(t.LE());return t.LE(n),s}catch(o){throw t.LE(n),o}},o.decodeDelimited=function(t,r){if("string"==typeof t&&(t=e.wrap(t,r?r:"base64")),t=e.isByteBuffer(t)?t:e.wrap(t),1>t.remaining())return null;var n=t.offset,s=t.readVarint32();if(t.remaining()<s)return t.offset=n,null;try{var o=i.decode(t.slice(t.offset,t.offset+s).LE());return t.offset+=s,o}catch(a){throw t.offset+=s,a}},o.decode64=function(e){return o.decode(e,"base64")},o.decodeHex=function(e){return o.decode(e,"hex")},o.decodeJSON=function(e){return new o(JSON.parse(e))},a.toString=function(){return i.toString()},Object.defineProperty&&(Object.defineProperty(o,"$options",{value:i.buildOpt()}),Object.defineProperty(a,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:i}),Object.defineProperty(a,"$type",{value:i})),o}(t,this),this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,s=this.children.length;s>n;n++)if(r=this.children[n],r instanceof p||r instanceof f||r instanceof d){if(i.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");i[r.name]=r.build()}else if(r instanceof f.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof f.OneOf||r instanceof c))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=i},u.encode=function(e,t,i){for(var r,n,s=null,o=0,a=this._fields.length;a>o;++o)r=this._fields[o],n=e[r.name],r.required&&null===n?null===s&&(s=r):r.encode(i?n:r.verifyValue(n),t,e);if(null!==s)throw e=Error("Missing at least one required field for "+this.toString(!0)+": "+s),e.encoded=t,e;return t},u.calculate=function(e){for(var t,i,r=0,n=0,s=this._fields.length;s>n;++n){if(t=this._fields[n],i=e[t.name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);r+=t.calculate(i,e)}return r},u.decode=function(e,i,n){i="number"==typeof i?i:-1;for(var s,o,a,l=e.offset,u=new this.clazz;e.offset<l+i||-1===i&&0<e.remaining();){if(s=e.readVarint32(),o=7&s,a=s>>>3,o===t.WIRE_TYPES.ENDGROUP){if(a!==n)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(n?n+" expected":"not a group")+")");break}if(s=this._fieldsById[a])s.repeated&&!s.options.packed?u[s.name].push(s.decode(o,e)):s.map?(o=s.decode(o,e),u[s.name].set(o[0],o[1])):(u[s.name]=s.decode(o,e),s.oneof&&(o=u[s.oneof.name],null!==o&&o!==s.name&&(u[o]=null),u[s.oneof.name]=s.name));else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:s=e.readVarint32(),e.offset+=s;break;case t.WIRE_TYPES.STARTGROUP:for(;r(a,e););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+o);
}}for(e=0,i=this._fields.length;i>e;++e)if(s=this._fields[e],null===u[s.name])if("proto3"===this.syntax)u[s.name]=s.defaultValue;else{if(s.required)throw e=Error("Missing at least one required field for "+this.toString(!0)+": "+s.name),e.decoded=u,e;t.populateDefaults&&null!==s.defaultValue&&(u[s.name]=s.defaultValue)}return u},n.Message=f;var h=function(e,i,r,n,o,a,l,u,h,p){s.call(this,e,i,a),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=n||null,this.type=o,this.resolvedType=null,this.id=l,this.options=u||{},this.defaultValue=null,this.oneof=h||null,this.syntax=p||"proto2",this.originalName=this.name,this.keyElement=this.element=null,!this.builder.options.convertFieldsToCamelCase||this instanceof f.ExtensionField||(this.name=t.Util.toCamelCase(this.name))},u=h.prototype=Object.create(s.prototype);u.build=function(){this.element=new l(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new l(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=l.defaultFieldValue(this.type)},u.verifyValue=function(e,i){i=i||!1;var r=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);if(null===e)return this.required&&r(typeof e,"required"),"proto3"===this.syntax&&this.type!==t.TYPES.message&&r(typeof e,"proto3 field without field presence cannot be null"),null;if(this.repeated&&!i){Array.isArray(e)||(e=[e]);for(var n=[],r=0;r<e.length;r++)n.push(this.element.verifyValue(e[r]));return n}return this.map&&!i?e instanceof t.Map?e:(e instanceof Object||r(typeof e,"expected ProtoBuf.Map or raw object for map field"),new t.Map(this,e)):(!this.repeated&&Array.isArray(e)&&r(typeof e,"no array expected"),this.element.verifyValue(e))},u.hasWirePresence=function(e,i){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&i[this.oneof.name]===this.name)return!0;switch(this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:case t.TYPES.uint32:case t.TYPES.fixed32:return 0!==e;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:case t.TYPES.uint64:case t.TYPES.fixed64:return 0!==e.low||0!==e.high;case t.TYPES.bool:return e;case t.TYPES["float"]:case t.TYPES["double"]:return 0!==e;case t.TYPES.string:return 0<e.length;case t.TYPES.bytes:return 0<e.remaining();case t.TYPES["enum"]:return 0!==e;case t.TYPES.message:return null!==e;default:return!0}},u.encode=function(i,r,n){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return r;try{if(this.repeated){var s;if(this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){r.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r.ensureCapacity(r.offset+=1);var o=r.offset;for(s=0;s<i.length;s++)this.element.encodeValue(this.id,i[s],r);var a=r.offset-o,l=e.calculateVarint32(a);if(l>1){var u=r.slice(o,r.offset),o=o+(l-1);r.offset=o,r.append(u)}r.writeVarint32(a,o-l)}else for(s=0;s<i.length;s++)r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i[s],r)}else this.map?i.forEach(function(i,n,s){s=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,n)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),r.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),r.writeVarint32(s),r.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,n,r),r.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,i,r)},this):this.hasWirePresence(i,n)&&(r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i,r))}catch(f){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+f+")")}return r},u.calculate=function(i,r){if(i=this.verifyValue(i),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var n=0;try{if(this.repeated){var s,o;if(this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(n+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s=o=0;s<i.length;s++)o+=this.element.calculateLength(this.id,i[s]);n+=e.calculateVarint32(o),n+=o}else for(s=0;s<i.length;s++)n+=e.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,i[s])}else this.map?i.forEach(function(i,r,s){i=e.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+e.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),n+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),n+=e.calculateVarint32(i),n+=i},this):this.hasWirePresence(i,r)&&(n+=e.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,i))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+a+")")}return n},u.decode=function(e,i,r){if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==t.WIRE_TYPES.LDELIM||this.map&&e==t.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){for(e=i.readVarint32(),e=i.offset+e,r=[];i.offset<e;)r.push(this.decode(this.type.wireType,i,!0));return r}if(this.map){var n=l.defaultFieldValue(this.keyType);if(r=l.defaultFieldValue(this.type),e=i.readVarint32(),i.remaining()<e)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+e+" required but got only "+i.remaining());var s=i.clone();for(s.limit=s.offset+e,i.offset+=e;0<s.remaining();)if(i=s.readVarint32(),e=7&i,i>>>=3,1===i)n=this.keyElement.decode(s,e,i);else{if(2!==i)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(s,e,i)}return[n,r]}return this.element.decode(i,e,this.id)},n.Message.Field=h,u=function(e,t,i,r,n,s,o){h.call(this,e,t,i,null,r,n,s,o)},u.prototype=Object.create(h.prototype),n.Message.ExtensionField=u,n.Message.OneOf=function(e,t,i){s.call(this,e,t,i),this.fields=[]};var p=function(e,t,i,r,n){a.call(this,e,t,i,r,n),this.className="Enum",this.object=null};p.getName=function(e,t){for(var i,r=Object.keys(e),n=0;n<r.length;++n)if(e[i=r[n]]===t)return i;return null},(p.prototype=Object.create(a.prototype)).build=function(e){if(this.object&&!e)return this.object;e=new t.Builder.Enum;for(var i=this.getChildren(p.Value),r=0,n=i.length;n>r;++r)e[i[r].name]=i[r].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=e},n.Enum=p,u=function(e,t,i,r){s.call(this,e,t,i),this.className="Enum.Value",this.id=r},u.prototype=Object.create(s.prototype),n.Enum.Value=u;var c=function(e,t,i,r){s.call(this,e,t,i),this.field=r};c.prototype=Object.create(s.prototype),n.Extension=c;var d=function(e,t,i,r){a.call(this,e,t,i,r),this.className="Service",this.clazz=null};(d.prototype=Object.create(a.prototype)).build=function(i){return this.clazz&&!i?this.clazz:this.clazz=function(t,i){for(var r=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},n=r.prototype=Object.create(t.Builder.Service.prototype),s=i.getChildren(t.Reflect.Service.RPCMethod),o=0;o<s.length;o++)(function(t){n[t.name]=function(r,n){try{try{r=t.resolvedRequestType.clazz.decode(e.wrap(r))}catch(s){if(!(s instanceof TypeError))throw s}if(null===r||"object"!=typeof r)throw Error("Illegal arguments");r instanceof t.resolvedRequestType.clazz||(r=new t.resolvedRequestType.clazz(r)),this.rpcImpl(t.fqn(),r,function(e,r){if(e)n(e);else{try{r=t.resolvedResponseType.clazz.decode(r)}catch(s){}r&&r instanceof t.resolvedResponseType.clazz?n(null,r):n(Error("Illegal response type received in service method "+i.name+"#"+t.name))}})}catch(o){setTimeout(n.bind(this,o),0)}},r[t.name]=function(e,i,n){new r(e)[t.name](i,n)},Object.defineProperty&&(Object.defineProperty(r[t.name],"$options",{value:t.buildOpt()}),Object.defineProperty(n[t.name],"$options",{value:r[t.name].$options}))})(s[o]);return Object.defineProperty&&(Object.defineProperty(r,"$options",{value:i.buildOpt()}),Object.defineProperty(n,"$options",{value:r.$options}),Object.defineProperty(r,"$type",{value:i}),Object.defineProperty(n,"$type",{value:i})),r}(t,this)},n.Service=d;var E=function(e,t,i,r){s.call(this,e,t,i),this.className="Service.Method",this.options=r||{}};return(E.prototype=Object.create(s.prototype)).buildOpt=o.buildOpt,n.Service.Method=E,o=function(e,t,i,r,n,s,o,a){E.call(this,e,t,i,a),this.className="Service.RPCMethod",this.requestName=r,this.responseName=n,this.requestStream=s,this.responseStream=o,this.resolvedResponseType=this.resolvedRequestType=null},o.prototype=Object.create(E.prototype),n.Service.RPCMethod=o,n}(i),i.Builder=function(e,t,i){function r(e){e.messages&&e.messages.forEach(function(t){t.syntax=e.syntax,r(t)}),e.enums&&e.enums.forEach(function(t){t.syntax=e.syntax})}var n=function(e){this.ptr=this.ns=new i.Namespace(this,null,""),this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},s=n.prototype;return n.isMessage=function(e){return"string"==typeof e.name&&"undefined"==typeof e.values&&"undefined"==typeof e.rpc},n.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&"undefined"!=typeof e.id},n.isEnum=function(e){return!("string"!=typeof e.name||"undefined"==typeof e.values||!Array.isArray(e.values)||0===e.values.length)},n.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},n.isExtend=function(e){return"string"==typeof e.ref},s.reset=function(){return this.ptr=this.ns,this},s.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new i.Namespace(this,this.ptr,e)),this.ptr=t},this),this},s.create=function(t){if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var r=[t];0<r.length;){if(t=r.pop(),!Array.isArray(t))throw Error("not a valid namespace: "+JSON.stringify(t));for(;0<t.length;){var s=t.shift();if(n.isMessage(s)){var o=new i.Message(this,this.ptr,s.name,s.options,s.isGroup,s.syntax),a={};s.oneofs&&Object.keys(s.oneofs).forEach(function(e){o.addChild(a[e]=new i.Message.OneOf(this,o,e))},this),s.fields&&s.fields.forEach(function(e){if(null!==o.getChild(0|e.id))throw Error("duplicate or invalid field id in "+o.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+o.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=a[e.oneof]))throw Error("illegal oneof in "+o.name+"#"+e.name+": "+e.oneof);e=new i.Message.Field(this,o,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,s.syntax),t&&t.fields.push(e),o.addChild(e)},this);var l=[];if(s.enums&&s.enums.forEach(function(e){l.push(e)}),s.messages&&s.messages.forEach(function(e){l.push(e)}),s.services&&s.services.forEach(function(e){l.push(e)}),s.extensions&&(o.extensions=s.extensions,o.extensions[0]<e.ID_MIN&&(o.extensions[0]=e.ID_MIN),o.extensions[1]>e.ID_MAX&&(o.extensions[1]=e.ID_MAX)),this.ptr.addChild(o),0<l.length){r.push(t),t=l,l=null,this.ptr=o,o=null;continue}l=null}else if(n.isEnum(s))o=new i.Enum(this,this.ptr,s.name,s.options,s.syntax),s.values.forEach(function(e){o.addChild(new i.Enum.Value(this,o,e.name,e.id))},this),this.ptr.addChild(o);else if(n.isService(s))o=new i.Service(this,this.ptr,s.name,s.options),Object.keys(s.rpc).forEach(function(e){var t=s.rpc[e];o.addChild(new i.Service.RPCMethod(this,o,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(o);else{if(!n.isExtend(s))throw Error("not a valid definition: "+JSON.stringify(s));if(o=this.ptr.resolve(s.ref,!0))s.fields.forEach(function(t){if(null!==o.getChild(0|t.id))throw Error("duplicate extended field id in "+o.name+": "+t.id);if(t.id<o.extensions[0]||t.id>o.extensions[1])throw Error("illegal extended field id in "+o.name+": "+t.id+" ("+o.extensions.join(" to ")+" expected)");var r=t.name;this.options.convertFieldsToCamelCase&&(r=e.Util.toCamelCase(r)),r=new i.Message.ExtensionField(this,o,t.rule,t.type,this.ptr.fqn()+"."+r,t.id,t.options),t=new i.Extension(this,this.ptr,t.name,r),r.extension=t,this.ptr.addChild(t),o.addChild(r)},this);else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("extended message "+s.ref+" is not defined")}o=s=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},s["import"]=function(t,i){var n="/";if("string"==typeof i){if(e.Util.IS_NODE&&(i=require("path").resolve(i)),!0===this.files[i])return this.reset();this.files[i]=!0}else if("object"==typeof i){var s=i.root;if(e.Util.IS_NODE&&(s=require("path").resolve(s)),(0<=s.indexOf("\\")||0<=i.file.indexOf("\\"))&&(n="\\"),s=s+n+i.file,!0===this.files[s])return this.reset();this.files[s]=!0}if(t.imports&&0<t.imports.length){var o=!1;"object"==typeof i?(this.importRoot=i.root,o=!0,s=this.importRoot,i=i.file,(0<=s.indexOf("\\")||0<=i.indexOf("\\"))&&(n="\\")):"string"==typeof i?this.importRoot?s=this.importRoot:0<=i.indexOf("/")?(s=i.replace(/\/[^\/]*$/,""),""===s&&(s="/")):0<=i.indexOf("\\")?(s=i.replace(/\\[^\\]*$/,""),n="\\"):s=".":s=null;for(var a=0;a<t.imports.length;a++)if("string"==typeof t.imports[a]){if(!s)throw Error("cannot determine import root");var l=t.imports[a];if("google/protobuf/descriptor.proto"!==l&&(l=s+n+l,!0!==this.files[l])){/\.proto$/i.test(l)&&!e.DotProto&&(l=l.replace(/\.proto$/,".json"));var u=e.Util.fetch(l);if(null===u)throw Error("failed to import '"+l+"' in '"+i+"': file not found");/\.json$/i.test(l)?this["import"](JSON.parse(u+""),l):this["import"](e.DotProto.Parser.parse(u),l)}}else i?/\.(\w+)$/.test(i)?this["import"](t.imports[a],i.replace(/^(.+)\.(\w+)$/,function(e,t,i){return t+"_import"+a+"."+i})):this["import"](t.imports[a],i+"_import"+a):this["import"](t.imports[a]);o&&(this.importRoot=null)}t["package"]&&this.define(t["package"]),t.syntax&&r(t);var f=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){f.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=f),t.enums&&(this.create(t.enums),this.ptr=f),t.services&&(this.create(t.services),this.ptr=f),t["extends"]&&this.create(t["extends"]),this.reset()},s.resolveAll=function(){var r;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof i.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof i.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(r=(this.ptr instanceof i.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!r)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=r,r instanceof i.Enum){if(this.ptr.type=e.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==r.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(r instanceof i.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=r.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(r=this.ptr.parent.resolve(this.ptr.requestName,!0),!(r&&r instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=r,r=this.ptr.parent.resolve(this.ptr.responseName,!0),!(r&&r instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=r}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},s.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;e="string"==typeof e?e.split("."):e;for(var t=this.result,i=0;i<e.length;i++){if(!t[e[i]]){t=null;break}t=t[e[i]]}return t},s.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},s.toString=function(){return"Builder"},n.Message=function(){},n.Enum=function(){},n.Service=function(){},n}(i,i.Lang,i.Reflect),i.Map=function(e,t){function i(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var r=function(e,i){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),i)for(var r=Object.keys(i),n=0;n<r.length;n++){var s=this.keyElem.valueFromString(r[n]),o=this.valueElem.verifyValue(i[r[n]]);this.map[this.keyElem.valueToString(s)]={key:s,value:o}}},n=r.prototype;return n.clear=function(){this.map={}},n["delete"]=function(e){e=this.keyElem.valueToString(this.keyElem.verifyValue(e));var t=e in this.map;return delete this.map[e],t},n.entries=function(){for(var e,t=[],r=Object.keys(this.map),n=0;n<r.length;n++)t.push([(e=this.map[r[n]]).key,e.value]);return i(t)},n.keys=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return i(e)},n.values=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return i(e)},n.forEach=function(e,t){for(var i,r=Object.keys(this.map),n=0;n<r.length;n++)e.call(t,(i=this.map[r[n]]).value,i.key,this)},n.set=function(e,t){var i=this.keyElem.verifyValue(e),r=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(i)]={key:i,value:r},this},n.get=function(e){return e=this.keyElem.valueToString(this.keyElem.verifyValue(e)),e in this.map?this.map[e].value:void 0},n.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},r}(i,i.Reflect),i.loadProto=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=void 0),i.loadJson(i.DotProto.Parser.parse(e),t,r)},i.protoFromString=i.loadProto,i.loadProtoFile=function(e,t,r){if(t&&"object"==typeof t?(r=t,t=null):t&&"function"==typeof t||(t=null),t)return i.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(n){if(null===n)t(Error("Failed to fetch file"));else try{t(null,i.loadProto(n,r,e))}catch(s){t(s)}});var n=i.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===n?null:i.loadProto(n,r,e)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(e){return e=e||{},"undefined"==typeof e.convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=i.convertFieldsToCamelCase),"undefined"==typeof e.populateAccessors&&(e.populateAccessors=i.populateAccessors),new i.Builder(e)},i.loadJson=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=null),t&&"object"==typeof t||(t=i.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t["import"](e,r),t.resolveAll(),t},i.loadJsonFile=function(e,t,r){if(t&&"object"==typeof t?(r=t,t=null):t&&"function"==typeof t||(t=null),t)return i.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(n){if(null===n)t(Error("Failed to fetch file"));else try{t(null,i.loadJson(JSON.parse(n),r,e))}catch(s){t(s)}});var n=i.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===n?null:i.loadJson(JSON.parse(n),r,e)},i});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.less=e()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;r.length>s;s++)i(r[s]);return i}({1:[function(e,t){var n=e("./utils").addDataAttr,r=e("./browser");t.exports=function(e,t){n(t,r.currentScript(e)),void 0===t.isFileProtocol&&(t.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(e.location.protocol)),t.async=t.async||!1,t.fileAsync=t.fileAsync||!1,t.poll=t.poll||(t.isFileProtocol?1e3:1500),t.env=t.env||("127.0.0.1"==e.location.hostname||"0.0.0.0"==e.location.hostname||"localhost"==e.location.hostname||e.location.port&&e.location.port.length>0||t.isFileProtocol?"development":"production");var i=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(e.location.hash);i&&(t.dumpLineNumbers=i[1]),void 0===t.useFileCache&&(t.useFileCache=!0),void 0===t.onReady&&(t.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(e,t){e("promise/polyfill.js");var n=window.less||{};e("./add-default-options")(window,n);var r=t.exports=e("./index")(window,n);window.less=r,n.onReady&&(/!watch/.test(window.location.hash)&&r.watch(),r.registerStylesheetsImmediately(),r.pageLoadFinished=r.refresh("development"===r.env))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":95}],3:[function(e,t){var n=e("./utils");t.exports={createCSS:function(e,t,r){var i=r.href||"",o="less:"+(r.title||n.extractId(i)),s=e.getElementById(o),a=!1,u=e.createElement("style");u.setAttribute("type","text/css"),r.media&&u.setAttribute("media",r.media),u.id=o,u.styleSheet||(u.appendChild(e.createTextNode(t)),a=null!==s&&s.childNodes.length>0&&u.childNodes.length>0&&s.firstChild.nodeValue===u.firstChild.nodeValue);var l=e.getElementsByTagName("head")[0];if(null===s||a===!1){var c=r&&r.nextSibling||null;c?c.parentNode.insertBefore(u,c):l.appendChild(u)}if(s&&a===!1&&s.parentNode.removeChild(s),u.styleSheet)try{u.styleSheet.cssText=t}catch(h){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(e){var t=e.document;return t.currentScript||function(){var e=t.getElementsByTagName("script");return e[e.length-1]}()}}},{"./utils":9}],4:[function(e,t){t.exports=function(e,t,n){var r=null;if("development"!==t.env)try{r="undefined"==typeof e.localStorage?null:e.localStorage}catch(i){}return{setCSS:function(e,t,i){if(r){n.info("saving "+e+" to cache.");try{r.setItem(e,i),r.setItem(e+":timestamp",t)}catch(o){n.error('failed to save "'+e+'" to local storage for caching.')}}},getCSS:function(e,t){var n=r&&r.getItem(e),i=r&&r.getItem(e+":timestamp");return i&&t.lastModified&&new Date(t.lastModified).valueOf()===new Date(i).valueOf()?n:void 0}}}},{}],5:[function(e,t){var n=e("./utils"),r=e("./browser");t.exports=function(e,t,i){function o(t,o){var s,a,u="less-error-message:"+n.extractId(o||""),l='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',c=e.document.createElement("div"),h=[],f=t.filename||o,p=f.match(/([^\/]+(\?.*)?)$/)[1];c.id=u,c.className="less-error-message",a="<h3>"+(t.type||"Syntax")+"Error: "+(t.message||"There is an error in your .less file")+'</h3><p>in <a href="'+f+'">'+p+"</a> ";var d=function(e,t,n){void 0!==e.extract[t]&&h.push(l.replace(/\{line\}/,(parseInt(e.line,10)||0)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};t.extract&&(d(t,0,""),d(t,1,"line"),d(t,2,""),a+="on line "+t.line+", column "+(t.column+1)+":</p><ul>"+h.join("")+"</ul>"),t.stack&&(t.extract||i.logLevel>=4)&&(a+="<br/>Stack Trace</br />"+t.stack.split("\n").slice(1).join("<br/>")),c.innerHTML=a,r.createCSS(e.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),c.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===i.env&&(s=setInterval(function(){var t=e.document,n=t.body;n&&(t.getElementById(u)?n.replaceChild(c,t.getElementById(u)):n.insertBefore(c,n.firstChild),clearInterval(s))},10))}function s(e,t){i.errorReporting&&"html"!==i.errorReporting?"console"===i.errorReporting?c(e,t):"function"==typeof i.errorReporting&&i.errorReporting("add",e,t):o(e,t)}function a(t){var r=e.document.getElementById("less-error-message:"+n.extractId(t));r&&r.parentNode.removeChild(r)}function u(){}function l(e){i.errorReporting&&"html"!==i.errorReporting?"console"===i.errorReporting?u(e):"function"==typeof i.errorReporting&&i.errorReporting("remove",e):a(e)}function c(e,n){var r="{line} {content}",o=e.filename||n,s=[],a=(e.type||"Syntax")+"Error: "+(e.message||"There is an error in your .less file")+" in "+o+" ",u=function(e,t,n){void 0!==e.extract[t]&&s.push(r.replace(/\{line\}/,(parseInt(e.line,10)||0)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};e.extract&&(u(e,0,""),u(e,1,"line"),u(e,2,""),a+="on line "+e.line+", column "+(e.column+1)+":\n"+s.join("\n")),e.stack&&(e.extract||i.logLevel>=4)&&(a+="\nStack Trace\n"+e.stack),t.logger.error(a)}return{add:s,remove:l}}},{"./browser":3,"./utils":9}],6:[function(e,t){t.exports=function(t,n){function r(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return n.error("browser doesn't support AJAX."),null}}var i=e("../less/environment/abstract-file-manager.js"),o={},s=function(){};return s.prototype=new i,s.prototype.alwaysMakePathsAbsolute=function(){return!0},s.prototype.join=function(e,t){return e?this.extractUrlParts(t,e).path:t},s.prototype.doXHR=function(e,i,o,s){function a(t,n,r){t.status>=200&&300>t.status?n(t.responseText,t.getResponseHeader("Last-Modified")):"function"==typeof r&&r(t.status,e)}var u=r(),l=t.isFileProtocol?t.fileAsync:t.async;"function"==typeof u.overrideMimeType&&u.overrideMimeType("text/css"),n.debug("XHR: Getting '"+e+"'"),u.open("GET",e,l),u.setRequestHeader("Accept",i||"text/x-less, text/css; q=0.9, */*; q=0.5"),u.send(null),t.isFileProtocol&&!t.fileAsync?0===u.status||u.status>=200&&300>u.status?o(u.responseText):s(u.status,e):l?u.onreadystatechange=function(){4==u.readyState&&a(u,o,s)}:a(u,o,s)},s.prototype.supports=function(){return!0},s.prototype.clearFileCache=function(){o={}},s.prototype.loadFile=function(e,t,n,r,i){t&&!this.isPathAbsolute(e)&&(e=t+e),n=n||{};var s=this.extractUrlParts(e,window.location.href),a=s.url;if(n.useFileCache&&o[a])try{var u=o[a];i(null,{contents:u,filename:a,webInfo:{lastModified:new Date}})}catch(l){i({filename:a,message:"Error loading file "+a+" error was "+l.message})}else this.doXHR(a,n.mime,function(e,t){o[a]=e,i(null,{contents:e,filename:a,webInfo:{lastModified:t}})},function(e,t){i({type:"File",message:"'"+t+"' wasn't found ("+e+")",href:a})})},s}},{"../less/environment/abstract-file-manager.js":14}],7:[function(e,t){var n=e("./utils").addDataAttr,r=e("./browser");t.exports=function(t,i){function o(e){return i.postProcessor&&"function"==typeof i.postProcessor&&(e=i.postProcessor.call(e,e)||e),e}function s(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function a(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var r=n.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,r)}}function u(e){for(var t,n=f.getElementsByTagName("style"),r=0;n.length>r;r++)if(t=n[r],t.type.match(w)){var o=s(i);o.modifyVars=e;var u=t.innerHTML||"";o.filename=f.location.href.replace(/#.*$/,""),p.render(u,o,a(function(e,t,n){t?g.add(t,"inline"):(e.type="text/css",e.styleSheet?e.styleSheet.cssText=n.css:e.innerHTML=n.css)},null,t))}}function l(e,t,r,a,u){function l(n){var i=n.contents,s=n.filename,u=n.webInfo,l={currentDirectory:m.getPath(s),filename:s,rootFilename:s,relativeUrls:c.relativeUrls};if(l.entryPath=l.currentDirectory,l.rootpath=c.rootpath||l.currentDirectory,u&&(u.remaining=a,!c.modifyVars)){var h=y.getCSS(s,u);if(!r&&h)return u.local=!0,void t(null,h,i,e,u,s)}g.remove(s),c.rootFileInfo=l,p.render(i,c,function(n,r){n?(n.href=s,t(n)):(r.css=o(r.css),c.modifyVars||y.setCSS(e.href,u.lastModified,r.css),t(null,r.css,i,e,u,s))})}var c=s(i);n(c,e),c.mime=e.type,u&&(c.modifyVars=u),m.loadFile(e.href,null,c,d,function(e,n){return e?void t(e):void l(n)})}function c(e,t,n){for(var r=0;p.sheets.length>r;r++)l(p.sheets[r],e,t,p.sheets.length-(r+1),n)}function h(){"development"===p.env&&(p.watchTimer=setInterval(function(){p.watchMode&&(m.clearFileCache(),c(function(e,n,i,o){e?g.add(e,e.href||o.href):n&&r.createCSS(t.document,n,o)}))},i.poll))}var f=t.document,p=e("../less")();p.options=i;var d=p.environment,v=e("./file-manager")(i,p.logger),m=new v;d.addFileManager(m),p.FileManager=v,e("./log-listener")(p,i);var g=e("./error-reporting")(t,p,i),y=p.cache=i.cache||e("./cache")(t,i,p.logger);i.functions&&p.functions.functionRegistry.addMultiple(i.functions);var w=/^text\/(x-)?less$/;return p.watch=function(){return p.watchMode||(p.env="development",h()),this.watchMode=!0,!0},p.unwatch=function(){return clearInterval(p.watchTimer),this.watchMode=!1,!1},p.registerStylesheetsImmediately=function(){var e=f.getElementsByTagName("link");p.sheets=[];for(var t=0;e.length>t;t++)("stylesheet/less"===e[t].rel||e[t].rel.match(/stylesheet/)&&e[t].type.match(w))&&p.sheets.push(e[t])},p.registerStylesheets=function(){return new Promise(function(e){p.registerStylesheetsImmediately(),e()})},p.modifyVars=function(e){return p.refresh(!0,e,!1)},p.refresh=function(e,n,i){return(e||i)&&i!==!1&&m.clearFileCache(),new Promise(function(i,o){var s,a,l;s=a=new Date,c(function(e,n,u,c,h){return e?(g.add(e,e.href||c.href),void o(e)):(p.logger.info(h.local?"loading "+c.href+" from cache.":"rendered "+c.href+" successfully."),r.createCSS(t.document,n,c),p.logger.info("css for "+c.href+" generated in "+(new Date-a)+"ms"),0===h.remaining&&(l=new Date-s,p.logger.info("less has finished. css generated in "+l+"ms"),i({startTime:s,endTime:a,totalMilliseconds:l,sheets:p.sheets.length})),void(a=new Date))},e,n),u(n)})},p.refreshStyles=u,p}},{"../less":30,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(e,t){t.exports=function(e,t){var n=4,r=3,i=2,o=1;t.logLevel="undefined"!=typeof t.logLevel?t.logLevel:"development"===t.env?r:o,t.loggers||(t.loggers=[{debug:function(e){t.logLevel>=n&&console.log(e)},info:function(e){t.logLevel>=r&&console.log(e)},warn:function(e){t.logLevel>=i&&console.warn(e)},error:function(e){t.logLevel>=o&&console.error(e)}}]);for(var s=0;t.loggers.length>s;s++)e.logger.addListener(t.loggers[s])}},{}],9:[function(e,t){t.exports={extractId:function(e){return e.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(e,t){for(var n in t.dataset)if(t.dataset.hasOwnProperty(n))if("env"===n||"dumpLineNumbers"===n||"rootpath"===n||"errorReporting"===n)e[n]=t.dataset[n];else try{e[n]=JSON.parse(t.dataset[n])}catch(r){}}}},{}],10:[function(e,t){var n={};t.exports=n;var r=function(e,t,n){if(e)for(var r=0;n.length>r;r++)e.hasOwnProperty(n[r])&&(t[n[r]]=e[n[r]])},i=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];n.Parse=function(e){r(e,this,i),"string"==typeof this.paths&&(this.paths=[this.paths])};var o=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];n.Eval=function(e,t){r(e,this,o),"string"==typeof this.paths&&(this.paths=[this.paths]),this.frames=t||[],this.importantScope=this.importantScope||[]},n.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},n.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},n.Eval.prototype.isMathOn=function(){return this.strictMath?this.parensStack&&this.parensStack.length:!0},n.Eval.prototype.isPathRelative=function(e){return!/^(?:[a-z-]+:|\/|#)/i.test(e)},n.Eval.prototype.normalizePath=function(e){var t,n=e.split("/").reverse();for(e=[];0!==n.length;)switch(t=n.pop()){case".":break;case"..":0===e.length||".."===e[e.length-1]?e.push(t):e.pop();break;default:e.push(t)}return e.join("/")}},{}],11:[function(e,t){t.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(e,t){t.exports={colors:e("./colors"),unitConversions:e("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(e,t){t.exports={length:{m:1,cm:.01,mm:.001,"in":.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(e,t){var n=function(){};n.prototype.getPath=function(e){var t=e.lastIndexOf("?");return t>0&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),0>t&&(t=e.lastIndexOf("\\")),0>t?"":e.slice(0,t+1)},n.prototype.tryAppendExtension=function(e,t){return/(\.[a-z]*$)|([\?;].*)$/.test(e)?e:e+t},n.prototype.tryAppendLessExtension=function(e){return this.tryAppendExtension(e,".less")},n.prototype.supportsSync=function(){return!1},n.prototype.alwaysMakePathsAbsolute=function(){return!1},n.prototype.isPathAbsolute=function(e){return/^(?:[a-z-]+:|\/|\\|#)/i.test(e)},n.prototype.join=function(e,t){return e?e+t:t},n.prototype.pathDiff=function(e,t){var n,r,i,o,s=this.extractUrlParts(e),a=this.extractUrlParts(t),u="";if(s.hostPart!==a.hostPart)return"";for(r=Math.max(a.directories.length,s.directories.length),n=0;r>n&&a.directories[n]===s.directories[n];n++);for(o=a.directories.slice(n),i=s.directories.slice(n),n=0;o.length-1>n;n++)u+="../";for(n=0;i.length-1>n;n++)u+=i[n]+"/";return u},n.prototype.extractUrlParts=function(e,t){var n,r,i=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,o=e.match(i),s={},a=[];if(!o)throw new Error("Could not parse sheet href - '"+e+"'");if(t&&(!o[1]||o[2])){if(r=t.match(i),!r)throw new Error("Could not parse page url - '"+t+"'");o[1]=o[1]||r[1]||"",o[2]||(o[3]=r[3]+o[3])}if(o[3]){for(a=o[3].replace(/\\/g,"/").split("/"),n=0;a.length>n;n++)"."===a[n]&&(a.splice(n,1),n-=1);for(n=0;a.length>n;n++)".."===a[n]&&n>0&&(a.splice(n-1,2),n-=2)}return s.hostPart=o[1],s.directories=a,s.path=(o[1]||"")+a.join("/"),s.fileUrl=s.path+(o[4]||""),s.url=s.fileUrl+(o[5]||""),s},t.exports=n},{}],15:[function(e,t){var n=e("../logger"),r=function(e,t){this.fileManagers=t||[],e=e||{};for(var n=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],r=[],i=r.concat(n),o=0;i.length>o;o++){var s=i[o],a=e[s];a?this[s]=a.bind(e):r.length>o&&this.warn("missing required function in environment - "+s)}};r.prototype.getFileManager=function(e,t,r,i,o){e||n.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==t&&n.warn("getFileManager called with null directory.. Please report this issue. continuing.");var s=this.fileManagers;r.pluginManager&&(s=[].concat(s).concat(r.pluginManager.getFileManagers()));for(var a=s.length-1;a>=0;a--){var u=s[a];if(u[o?"supportsSync":"supports"](e,t,r,i))return u}return null},r.prototype.addFileManager=function(e){this.fileManagers.push(e)},r.prototype.clearFileManagers=function(){this.fileManagers=[]},t.exports=r},{"../logger":32}],16:[function(e){function t(e,t,r){var i,o,s,a,u=t.alpha,l=r.alpha,c=[];s=l+u*(1-l);for(var h=0;3>h;h++)i=t.rgb[h]/255,o=r.rgb[h]/255,a=e(i,o),s&&(a=(l*o+u*(i-l*(i+o-a)))/s),c[h]=255*a;return new n(c,s)}var n=e("../tree/color"),r=e("./function-registry"),i={multiply:function(e,t){return e*t},screen:function(e,t){return e+t-e*t},overlay:function(e,t){return e*=2,1>=e?i.multiply(e,t):i.screen(e-1,t)},softlight:function(e,t){var n=1,r=e;return t>.5&&(r=1,n=e>.25?Math.sqrt(e):((16*e-12)*e+4)*e),e-(1-2*t)*r*(n-e)},hardlight:function(e,t){return i.overlay(t,e)},difference:function(e,t){return Math.abs(e-t)},exclusion:function(e,t){return e+t-2*e*t},average:function(e,t){return(e+t)/2},negation:function(e,t){return 1-Math.abs(e+t-1)}};for(var o in i)i.hasOwnProperty(o)&&(t[o]=t.bind(null,i[o]));r.addMultiple(t)},{"../tree/color":49,"./function-registry":21}],17:[function(e){function t(e){return Math.min(1,Math.max(0,e))}function n(e){return o.hsla(e.h,e.s,e.l,e.a)}function r(e){if(e instanceof s)return parseFloat(e.unit.is("%")?e.value/100:e.value);if("number"==typeof e)return e;throw{type:"Argument",message:"color functions take numbers as parameters"}}function i(e,t){return e instanceof s&&e.unit.is("%")?parseFloat(e.value*t/100):r(e)}var o,s=e("../tree/dimension"),a=e("../tree/color"),u=e("../tree/quoted"),l=e("../tree/anonymous"),c=e("./function-registry");o={rgb:function(e,t,n){return o.rgba(e,t,n,1)},rgba:function(e,t,n,o){var s=[e,t,n].map(function(e){return i(e,255)});return o=r(o),new a(s,o)},hsl:function(e,t,n){return o.hsla(e,t,n,1)},hsla:function(e,n,i,s){function a(e){return e=0>e?e+1:e>1?e-1:e,1>6*e?l+(u-l)*e*6:1>2*e?u:2>3*e?l+(u-l)*(2/3-e)*6:l}e=r(e)%360/360,n=t(r(n)),i=t(r(i)),s=t(r(s));var u=.5>=i?i*(n+1):i+n-i*n,l=2*i-u;return o.rgba(255*a(e+1/3),255*a(e),255*a(e-1/3),s)},hsv:function(e,t,n){return o.hsva(e,t,n,1)},hsva:function(e,t,n,i){e=r(e)%360/360*360,t=r(t),n=r(n),i=r(i);var s,a;s=Math.floor(e/60%6),a=e/60-s;var u=[n,n*(1-t),n*(1-a*t),n*(1-(1-a)*t)],l=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return o.rgba(255*u[l[s][0]],255*u[l[s][1]],255*u[l[s][2]],i)},hue:function(e){return new s(e.toHSL().h)},saturation:function(e){return new s(100*e.toHSL().s,"%")},lightness:function(e){return new s(100*e.toHSL().l,"%")},hsvhue:function(e){return new s(e.toHSV().h)},hsvsaturation:function(e){return new s(100*e.toHSV().s,"%")},hsvvalue:function(e){return new s(100*e.toHSV().v,"%")},red:function(e){return new s(e.rgb[0])},green:function(e){return new s(e.rgb[1])},blue:function(e){return new s(e.rgb[2])},alpha:function(e){return new s(e.toHSL().a)},luma:function(e){return new s(e.luma()*e.alpha*100,"%")},luminance:function(e){var t=.2126*e.rgb[0]/255+.7152*e.rgb[1]/255+.0722*e.rgb[2]/255;return new s(t*e.alpha*100,"%")},saturate:function(e,r,i){if(!e.rgb)return null;var o=e.toHSL();return o.s+="undefined"!=typeof i&&"relative"===i.value?o.s*r.value/100:r.value/100,o.s=t(o.s),n(o)},desaturate:function(e,r,i){var o=e.toHSL();return o.s-="undefined"!=typeof i&&"relative"===i.value?o.s*r.value/100:r.value/100,o.s=t(o.s),n(o)},lighten:function(e,r,i){var o=e.toHSL();return o.l+="undefined"!=typeof i&&"relative"===i.value?o.l*r.value/100:r.value/100,o.l=t(o.l),n(o)},darken:function(e,r,i){var o=e.toHSL();return o.l-="undefined"!=typeof i&&"relative"===i.value?o.l*r.value/100:r.value/100,o.l=t(o.l),n(o)},fadein:function(e,r,i){var o=e.toHSL();return o.a+="undefined"!=typeof i&&"relative"===i.value?o.a*r.value/100:r.value/100,o.a=t(o.a),n(o)},fadeout:function(e,r,i){var o=e.toHSL();return o.a-="undefined"!=typeof i&&"relative"===i.value?o.a*r.value/100:r.value/100,o.a=t(o.a),n(o)},fade:function(e,r){var i=e.toHSL();return i.a=r.value/100,i.a=t(i.a),n(i)},spin:function(e,t){var r=e.toHSL(),i=(r.h+t.value)%360;return r.h=0>i?360+i:i,n(r)},mix:function(e,t,n){e.toHSL&&t.toHSL||(console.log(t.type),console.dir(t)),n||(n=new s(50));var r=n.value/100,i=2*r-1,o=e.toHSL().a-t.toHSL().a,u=((i*o==-1?i:(i+o)/(1+i*o))+1)/2,l=1-u,c=[e.rgb[0]*u+t.rgb[0]*l,e.rgb[1]*u+t.rgb[1]*l,e.rgb[2]*u+t.rgb[2]*l],h=e.alpha*r+t.alpha*(1-r);return new a(c,h)},greyscale:function(e){return o.desaturate(e,new s(100))},contrast:function(e,t,n,i){if(!e.rgb)return null;if("undefined"==typeof n&&(n=o.rgba(255,255,255,1)),"undefined"==typeof t&&(t=o.rgba(0,0,0,1)),t.luma()>n.luma()){var s=n;n=t,t=s}return i="undefined"==typeof i?.43:r(i),e.luma()<i?n:t},argb:function(e){return new l(e.toARGB())},color:function(e){if(e instanceof u&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(e.value))return new a(e.value.slice(1));if(e instanceof a||(e=a.fromKeyword(e.value)))return e.value=void 0,e;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(e,t){return o.mix(o.rgb(255,255,255),e,t)},shade:function(e,t){return o.mix(o.rgb(0,0,0),e,t)}},c.addMultiple(o)},{"../tree/anonymous":45,"../tree/color":49,"../tree/dimension":55,"../tree/quoted":72,"./function-registry":21}],18:[function(e,t){t.exports=function(t){var n=e("../tree/quoted"),r=e("../tree/url"),i=e("./function-registry"),o=function(e,t){return new r(t,e.index,e.currentFileInfo).eval(e.context)},s=e("../logger");i.add("data-uri",function(e,i){i||(i=e,e=null);var a=e&&e.value,u=i.value,l=this.currentFileInfo,c=l.relativeUrls?l.currentDirectory:l.entryPath,h=u.indexOf("#"),f="";-1!==h&&(f=u.slice(h),u=u.slice(0,h));var p=t.getFileManager(u,c,this.context,t,!0);if(!p)return o(this,i);var d=!1;if(e)d=/;base64$/.test(a);else{if(a=t.mimeLookup(u),"image/svg+xml"===a)d=!1;else{var v=t.charsetLookup(a);d=["US-ASCII","UTF-8"].indexOf(v)<0}d&&(a+=";base64")}var m=p.loadFileSync(u,c,this.context,t);if(!m.contents)return s.warn("Skipped data-uri embedding of "+u+" because file not found"),o(this,i||e);var g=m.contents;if(d&&!t.encodeBase64)return o(this,i);g=d?t.encodeBase64(g):encodeURIComponent(g);var y="data:"+a+","+g+f,w=32768;return y.length>=w&&this.context.ieCompat!==!1?(s.warn("Skipped data-uri embedding of "+u+" because its size ("+y.length+" characters) exceeds IE8-safe "+w+" characters!"),o(this,i||e)):new r(new n('"'+y+'"',y,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":32,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],19:[function(e,t){var n=e("../tree/keyword"),r=e("./function-registry"),i={eval:function(){var e=this.value_,t=this.error_;if(t)throw t;return null!=e?e?n.True:n.False:void 0},value:function(e){this.value_=e},error:function(e){this.error_=e},reset:function(){this.value_=this.error_=null}};r.add("default",i.eval.bind(i)),t.exports=i},{"../tree/keyword":64,"./function-registry":21}],20:[function(e,t){var n=e("../tree/expression"),r=function(e,t,n,r){this.name=e.toLowerCase(),this.index=n,this.context=t,this.currentFileInfo=r,this.func=t.frames[0].functionRegistry.get(this.name)};r.prototype.isValid=function(){return Boolean(this.func)},r.prototype.call=function(e){return Array.isArray(e)&&(e=e.filter(function(e){return"Comment"!==e.type}).map(function(e){if("Expression"===e.type){var t=e.value.filter(function(e){return"Comment"!==e.type});return 1===t.length?t[0]:new n(t)}return e})),this.func.apply(this,e)},t.exports=r},{"../tree/expression":58}],21:[function(e,t){function n(e){return{_data:{},add:function(e,t){e=e.toLowerCase(),this._data.hasOwnProperty(e),this._data[e]=t},addMultiple:function(e){Object.keys(e).forEach(function(t){this.add(t,e[t])}.bind(this))},get:function(t){return this._data[t]||e&&e.get(t)},inherit:function(){return n(this)}}}t.exports=n(null)},{}],22:[function(e,t){t.exports=function(t){var n={functionRegistry:e("./function-registry"),functionCaller:e("./function-caller")};return e("./default"),e("./color"),e("./color-blending"),e("./data-uri")(t),e("./math"),e("./number"),e("./string"),e("./svg")(t),e("./types"),n}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":24,"./number":25,"./string":26,"./svg":27,"./types":28}],23:[function(e,t){var n=e("../tree/dimension"),r=function(){};r._math=function(e,t,r){if(!(r instanceof n))throw{type:"Argument",message:"argument must be a number"};return null==t?t=r.unit:r=r.unify(),new n(e(parseFloat(r.value)),t)},t.exports=r},{"../tree/dimension":55}],24:[function(e){var t=e("./function-registry"),n=e("./math-helper.js"),r={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var i in r)r.hasOwnProperty(i)&&(r[i]=n._math.bind(null,Math[i],r[i]));r.round=function(e,t){var r="undefined"==typeof t?0:t.value;return n._math(function(e){return e.toFixed(r)},null,e)},t.addMultiple(r)},{"./function-registry":21,"./math-helper.js":23}],25:[function(e){var t=e("../tree/dimension"),n=e("../tree/anonymous"),r=e("./function-registry"),i=e("./math-helper.js"),o=function(e,r){switch(r=Array.prototype.slice.call(r),r.length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var i,o,s,a,u,l,c,h,f=[],p={};for(i=0;r.length>i;i++)if(s=r[i],s instanceof t)if(a=""===s.unit.toString()&&void 0!==h?new t(s.value,h).unify():s.unify(),l=""===a.unit.toString()&&void 0!==c?c:a.unit.toString(),c=""!==l&&void 0===c||""!==l&&""===f[0].unify().unit.toString()?l:c,h=""!==l&&void 0===h?s.unit.toString():h,o=void 0!==p[""]&&""!==l&&l===c?p[""]:p[l],void 0!==o)u=""===f[o].unit.toString()&&void 0!==h?new t(f[o].value,h).unify():f[o].unify(),(e&&u.value>a.value||!e&&a.value>u.value)&&(f[o]=s);else{if(void 0!==c&&l!==c)throw{type:"Argument",message:"incompatible types"};p[l]=f.length,f.push(s)}else Array.isArray(r[i].value)&&Array.prototype.push.apply(r,Array.prototype.slice.call(r[i].value));return 1==f.length?f[0]:(r=f.map(function(e){return e.toCSS(this.context)}).join(this.context.compress?",":", "),new n((e?"min":"max")+"("+r+")"))};r.addMultiple({min:function(){return o(!0,arguments)},max:function(){return o(!1,arguments)},convert:function(e,t){return e.convertTo(t.value)},pi:function(){return new t(Math.PI)},mod:function(e,n){return new t(e.value%n.value,e.unit)},pow:function(e,n){if("number"==typeof e&&"number"==typeof n)e=new t(e),n=new t(n);else if(!(e instanceof t&&n instanceof t))throw{type:"Argument",message:"arguments must be numbers"};return new t(Math.pow(e.value,n.value),e.unit)},percentage:function(e){var t=i._math(function(e){return 100*e},"%",e);return t}})},{"../tree/anonymous":45,"../tree/dimension":55,"./function-registry":21,"./math-helper.js":23}],26:[function(e){var t=e("../tree/quoted"),n=e("../tree/anonymous"),r=e("../tree/javascript"),i=e("./function-registry");i.addMultiple({e:function(e){return new n(e instanceof r?e.evaluated:e.value)},escape:function(e){return new n(encodeURI(e.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(e,n,r,i){var o=e.value;return r="Quoted"===r.type?r.value:r.toCSS(),o=o.replace(new RegExp(n.value,i?i.value:""),r),new t(e.quote||"",o,e.escaped)},"%":function(e){for(var n=Array.prototype.slice.call(arguments,1),r=e.value,i=0;n.length>i;i++)r=r.replace(/%[sda]/i,function(e){var t="Quoted"===n[i].type&&e.match(/s/i)?n[i].value:n[i].toCSS();return e.match(/[A-Z]$/)?encodeURIComponent(t):t});return r=r.replace(/%%/g,"%"),new t(e.quote||"",r,e.escaped)}})},{"../tree/anonymous":45,"../tree/javascript":62,"../tree/quoted":72,"./function-registry":21}],27:[function(e,t){t.exports=function(){var t=e("../tree/dimension"),n=e("../tree/color"),r=e("../tree/expression"),i=e("../tree/quoted"),o=e("../tree/url"),s=e("./function-registry");s.add("svg-gradient",function(e){function s(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position] or direction, color list"}}var a,u,l,c,h,f,p,d,v="linear",m='x="0" y="0" width="1" height="1"',g={compress:!1},y=e.toCSS(g);switch(2==arguments.length?(arguments[1].value.length<2&&s(),a=arguments[1].value):arguments.length<3?s():a=Array.prototype.slice.call(arguments,1),y){case"to bottom":u='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":u='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":u='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":u='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":v="radial",u='cx="50%" cy="50%" r="75%"',m='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"
}}for(l='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+v+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+u+">",c=0;a.length>c;c+=1)a[c]instanceof r?(h=a[c].value[0],f=a[c].value[1]):(h=a[c],f=void 0),h instanceof n&&((0===c||c+1===a.length)&&void 0===f||f instanceof t)||s(),p=f?f.toCSS(g):0===c?"0%":"100%",d=h.alpha,l+='<stop offset="'+p+'" stop-color="'+h.toRGB()+'"'+(1>d?' stop-opacity="'+d+'"':"")+"/>";return l+="</"+v+"Gradient><rect "+m+' fill="url(#gradient)" /></svg>',l=encodeURIComponent(l),l="data:image/svg+xml,"+l,new o(new i("'"+l+"'",l,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":49,"../tree/dimension":55,"../tree/expression":58,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],28:[function(e){var t=e("../tree/keyword"),n=e("../tree/detached-ruleset"),r=e("../tree/dimension"),i=e("../tree/color"),o=e("../tree/quoted"),s=e("../tree/anonymous"),a=e("../tree/url"),u=e("../tree/operation"),l=e("./function-registry"),c=function(e,n){return e instanceof n?t.True:t.False},h=function(e,n){if(void 0===n)throw{type:"Argument",message:"missing the required second argument to isunit."};if(n="string"==typeof n.value?n.value:n,"string"!=typeof n)throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return e instanceof r&&e.unit.is(n)?t.True:t.False},f=function(e){var t=Array.isArray(e.value)?e.value:Array(e);return t};l.addMultiple({isruleset:function(e){return c(e,n)},iscolor:function(e){return c(e,i)},isnumber:function(e){return c(e,r)},isstring:function(e){return c(e,o)},iskeyword:function(e){return c(e,t)},isurl:function(e){return c(e,a)},ispixel:function(e){return h(e,"px")},ispercentage:function(e){return h(e,"%")},isem:function(e){return h(e,"em")},isunit:h,unit:function(e,n){if(!(e instanceof r))throw{type:"Argument",message:"the first argument to unit must be a number"+(e instanceof u?". Have you forgotten parenthesis?":"")};return n=n?n instanceof t?n.value:n.toCSS():"",new r(e.value,n)},"get-unit":function(e){return new s(e.unit)},extract:function(e,t){return t=t.value-1,f(e)[t]},length:function(e){return new r(f(e).length)}})},{"../tree/anonymous":45,"../tree/color":49,"../tree/detached-ruleset":54,"../tree/dimension":55,"../tree/keyword":64,"../tree/operation":70,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],29:[function(e,t){var n=e("./contexts"),r=e("./parser/parser"),i=e("./plugins/function-importer");t.exports=function(e){var t=function(e,t){this.rootFilename=t.filename,this.paths=e.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=e.mime,this.error=null,this.context=e,this.queue=[],this.files={}};return t.prototype.push=function(t,o,s,a,u){var l=this;this.queue.push(t);var c=function(e,n,r){l.queue.splice(l.queue.indexOf(t),1);var i=r===l.rootFilename;a.optional&&e?u(null,{rules:[]},!1,null):(l.files[r]=n,e&&!l.error&&(l.error=e),u(e,n,i,r))},h={relativeUrls:this.context.relativeUrls,entryPath:s.entryPath,rootpath:s.rootpath,rootFilename:s.rootFilename},f=e.getFileManager(t,s.currentDirectory,this.context,e);if(!f)return void c({message:"Could not find a file-manager for "+t});o&&(t=f.tryAppendExtension(t,a.plugin?".js":".less"));var p=function(e){var t=e.filename,o=e.contents.replace(/^\uFEFF/,"");h.currentDirectory=f.getPath(t),h.relativeUrls&&(h.rootpath=f.join(l.context.rootpath||"",f.pathDiff(h.currentDirectory,h.entryPath)),!f.isPathAbsolute(h.rootpath)&&f.alwaysMakePathsAbsolute()&&(h.rootpath=f.join(h.entryPath,h.rootpath))),h.filename=t;var u=new n.Parse(l.context);u.processImports=!1,l.contents[t]=o,(s.reference||a.reference)&&(h.reference=!0),a.plugin?new i(u,h).eval(o,function(e,n){c(e,n,t)}):a.inline?c(null,o,t):new r(u,l,h).parse(o,function(e,n){c(e,n,t)})},d=f.loadFile(t,s.currentDirectory,this.context,e,function(e,t){e?c(e):p(t)});d&&d.then(p,c)},t}},{"./contexts":10,"./parser/parser":37,"./plugins/function-importer":39}],30:[function(e,t){t.exports=function(t,n){var r,i,o,s,a,u={version:[2,5,3],data:e("./data"),tree:e("./tree"),Environment:a=e("./environment/environment"),AbstractFileManager:e("./environment/abstract-file-manager"),environment:t=new a(t,n),visitors:e("./visitors"),Parser:e("./parser/parser"),functions:e("./functions")(t),contexts:e("./contexts"),SourceMapOutput:r=e("./source-map-output")(t),SourceMapBuilder:i=e("./source-map-builder")(r,t),ParseTree:o=e("./parse-tree")(i),ImportManager:s=e("./import-manager")(t),render:e("./render")(t,o,s),parse:e("./parse")(t,o,s),LessError:e("./less-error"),transformTree:e("./transform-tree"),utils:e("./utils"),PluginManager:e("./plugin-manager"),logger:e("./logger")};return u}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":29,"./less-error":31,"./logger":32,"./parse":34,"./parse-tree":33,"./parser/parser":37,"./plugin-manager":38,"./render":40,"./source-map-builder":41,"./source-map-output":42,"./transform-tree":43,"./tree":61,"./utils":82,"./visitors":86}],31:[function(e,t){var n=e("./utils"),r=t.exports=function(e,t,r){Error.call(this);var i=e.filename||r;if(t&&i){var o=t.contents[i],s=n.getLocation(e.index,o),a=s.line,u=s.column,l=e.call&&n.getLocation(e.call,o).line,c=o.split("\n");this.type=e.type||"Syntax",this.filename=i,this.index=e.index,this.line="number"==typeof a?a+1:null,this.callLine=l+1,this.callExtract=c[l],this.column=u,this.extract=[c[a-1],c[a],c[a+1]]}this.message=e.message,this.stack=e.stack};if("undefined"==typeof Object.create){var i=function(){};i.prototype=Error.prototype,r.prototype=new i}else r.prototype=Object.create(Error.prototype);r.prototype.constructor=r},{"./utils":82}],32:[function(e,t){t.exports={error:function(e){this._fireEvent("error",e)},warn:function(e){this._fireEvent("warn",e)},info:function(e){this._fireEvent("info",e)},debug:function(e){this._fireEvent("debug",e)},addListener:function(e){this._listeners.push(e)},removeListener:function(e){for(var t=0;this._listeners.length>t;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)},_fireEvent:function(e,t){for(var n=0;this._listeners.length>n;n++){var r=this._listeners[n][e];r&&r(t)}},_listeners:[]}},{}],33:[function(e,t){var n=e("./less-error"),r=e("./transform-tree"),i=e("./logger");t.exports=function(e){var t=function(e,t){this.root=e,this.imports=t};return t.prototype.toCSS=function(t){var o,s,a={};try{o=r(this.root,t)}catch(u){throw new n(u,this.imports)}try{var l=Boolean(t.compress);l&&i.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var c={compress:l,dumpLineNumbers:t.dumpLineNumbers,strictUnits:Boolean(t.strictUnits),numPrecision:8};t.sourceMap?(s=new e(t.sourceMap),a.css=s.toCSS(o,c,this.imports)):a.css=o.toCSS(c)}catch(u){throw new n(u,this.imports)}if(t.pluginManager)for(var h=t.pluginManager.getPostProcessors(),f=0;h.length>f;f++)a.css=h[f].process(a.css,{sourceMap:s,options:t,imports:this.imports});t.sourceMap&&(a.map=s.getExternalSourceMap()),a.imports=[];for(var p in this.imports.files)this.imports.files.hasOwnProperty(p)&&p!==this.imports.rootFilename&&a.imports.push(p);return a},t}},{"./less-error":31,"./logger":32,"./transform-tree":43}],34:[function(e,t){var n,r=e("./contexts"),i=e("./parser/parser"),o=e("./plugin-manager");t.exports=function(t,s,a){var u=function(t,s,l){if(s=s||{},"function"==typeof s&&(l=s,s={}),!l){n||(n="undefined"==typeof Promise?e("promise"):Promise);var c=this;return new n(function(e,n){u.call(c,t,s,function(t,r){t?n(t):e(r)})})}var h,f,p=new o(this);if(p.addPlugins(s.plugins),s.pluginManager=p,h=new r.Parse(s),s.rootFileInfo)f=s.rootFileInfo;else{var d=s.filename||"input",v=d.replace(/[^\/\\]*$/,"");f={filename:d,relativeUrls:h.relativeUrls,rootpath:h.rootpath||"",currentDirectory:v,entryPath:v,rootFilename:d},f.rootpath&&"/"!==f.rootpath.slice(-1)&&(f.rootpath+="/")}var m=new a(h,f);new i(h,m,f).parse(t,function(e,t){return e?l(e):void l(null,t,m,s)},s)};return u}},{"./contexts":10,"./parser/parser":37,"./plugin-manager":38,promise:void 0}],35:[function(e,t){t.exports=function(e,t){function n(t){var n=a-m;512>n&&!t||!n||(v.push(e.slice(m,a+1)),m=a+1)}var r,i,o,s,a,u,l,c,h,f=e.length,p=0,d=0,v=[],m=0;for(a=0;f>a;a++)if(l=e.charCodeAt(a),!(l>=97&&122>=l||34>l))switch(l){case 40:d++,i=a;continue;case 41:if(--d<0)return t("missing opening `(`",a);continue;case 59:d||n();continue;case 123:p++,r=a;continue;case 125:if(--p<0)return t("missing opening `{`",a);p||d||n();continue;case 92:if(f-1>a){a++;continue}return t("unescaped `\\`",a);case 34:case 39:case 96:for(h=0,u=a,a+=1;f>a;a++)if(c=e.charCodeAt(a),!(c>96)){if(c==l){h=1;break}if(92==c){if(a==f-1)return t("unescaped `\\`",a);a++}}if(h)continue;return t("unmatched `"+String.fromCharCode(l)+"`",u);case 47:if(d||a==f-1)continue;if(c=e.charCodeAt(a+1),47==c)for(a+=2;f>a&&(c=e.charCodeAt(a),!(13>=c)||10!=c&&13!=c);a++);else if(42==c){for(o=u=a,a+=2;f-1>a&&(c=e.charCodeAt(a),125==c&&(s=a),42!=c||47!=e.charCodeAt(a+1));a++);if(a==f-1)return t("missing closing `*/`",u);a++}continue;case 42:if(f-1>a&&47==e.charCodeAt(a+1))return t("unmatched `/*`",a);continue}return 0!==p?o>r&&s>o?t("missing closing `}` or `*/`",r):t("missing closing `}`",r):0!==d?t("missing closing `)`",i):(n(!0),v)}},{}],36:[function(e,t){var n=e("./chunker");t.exports=function(){var e,t,r,i,o,s,a,u=[],l={};l.save=function(){a=l.i,u.push({current:s,i:l.i,j:t})},l.restore=function(e){(l.i>r||l.i===r&&e&&!i)&&(r=l.i,i=e);var n=u.pop();s=n.current,a=l.i=n.i,t=n.j},l.forget=function(){u.pop()},l.isWhitespace=function(t){var n=l.i+(t||0),r=e.charCodeAt(n);return r===c||r===p||r===h||r===f},l.$re=function(e){l.i>a&&(s=s.slice(l.i-a),a=l.i);var t=e.exec(s);return t?(y(t[0].length),"string"==typeof t?t:1===t.length?t[0]:t):null},l.$char=function(t){return e.charAt(l.i)!==t?null:(y(1),t)},l.$str=function(t){for(var n=t.length,r=0;n>r;r++)if(e.charAt(l.i+r)!==t.charAt(r))return null;return y(n),t},l.$quoted=function(){var t=e.charAt(l.i);if("'"===t||'"'===t){for(var n=e.length,r=l.i,i=1;n>i+r;i++){var o=e.charAt(i+r);switch(o){case"\\":i++;continue;case"\r":case"\n":break;case t:var s=e.substr(r,i+1);return y(i+1),s}}return null}};var c=32,h=9,f=10,p=13,d=43,v=44,m=47,g=57;l.autoCommentAbsorb=!0,l.commentStore=[],l.finished=!1;var y=function(n){for(var r,i,u,d=l.i,v=t,g=l.i-a,w=l.i+s.length-g,x=l.i+=n,b=e;w>l.i;l.i++){if(r=b.charCodeAt(l.i),l.autoCommentAbsorb&&r===m){if(i=b.charAt(l.i+1),"/"===i){u={index:l.i,isLineComment:!0};var S=b.indexOf("\n",l.i+2);0>S&&(S=w),l.i=S,u.text=b.substr(u.i,l.i-u.i),l.commentStore.push(u);continue}if("*"===i){var C=b.indexOf("*/",l.i+2);if(C>=0){u={index:l.i,text:b.substr(l.i,C+2-l.i),isLineComment:!1},l.i+=u.text.length-1,l.commentStore.push(u);continue}}break}if(r!==c&&r!==f&&r!==h&&r!==p)break}if(s=s.slice(n+l.i-x+g),a=l.i,!s.length){if(o.length-1>t)return s=o[++t],y(0),!0;l.finished=!0}return d!==l.i||v!==t};return l.peek=function(t){if("string"==typeof t){for(var n=0;t.length>n;n++)if(e.charAt(l.i+n)!==t.charAt(n))return!1;return!0}return t.test(s)},l.peekChar=function(t){return e.charAt(l.i)===t},l.currentChar=function(){return e.charAt(l.i)},l.getInput=function(){return e},l.peekNotNumeric=function(){var t=e.charCodeAt(l.i);return t>g||d>t||t===m||t===v},l.start=function(i,u,c){e=i,l.i=t=a=r=0,o=u?n(i,c):[i],s=o[0],y(0)},l.end=function(){var t,n=l.i>=e.length;return r>l.i&&(t=i,l.i=r),{isFinished:n,furthest:l.i,furthestPossibleErrorMessage:t,furthestReachedEnd:l.i>=e.length-1,furthestChar:e[l.i]}},l}},{"./chunker":35}],37:[function(e,t){var n=e("../less-error"),r=e("../tree"),i=e("../visitors"),o=e("./parser-input"),s=e("../utils"),a=function u(e,t,a){function l(e,t){var n="[object Function]"===Object.prototype.toString.call(e)?e.call(p):d.$re(e);return n?n:void h(t||("string"==typeof e?"expected '"+e+"' got '"+d.currentChar()+"'":"unexpected token"))}function c(e,t){return d.$char(e)?e:void h(t||"expected '"+e+"' got '"+d.currentChar()+"'")}function h(e,r){throw new n({index:d.i,filename:a.filename,type:r||"Syntax",message:e},t)}function f(e){var t=a.filename;return{lineNumber:s.getLocation(e,d.getInput()).line+1,fileName:t}}var p,d=o();return{parse:function(o,s,l){var c,h,f,p,v=null,m="";if(h=l&&l.globalVars?u.serializeVars(l.globalVars)+"\n":"",f=l&&l.modifyVars?"\n"+u.serializeVars(l.modifyVars):"",e.pluginManager)for(var g=e.pluginManager.getPreProcessors(),y=0;g.length>y;y++)o=g[y].process(o,{context:e,imports:t,fileInfo:a});(h||l&&l.banner)&&(m=(l&&l.banner?l.banner:"")+h,p=t.contentsIgnoredChars,p[a.filename]=p[a.filename]||0,p[a.filename]+=m.length),o=o.replace(/\r\n?/g,"\n"),o=m+o.replace(/^\uFEFF/,"")+f,t.contents[a.filename]=o;try{d.start(o,e.chunkInput,function(e,r){throw new n({index:r,type:"Parse",message:e,filename:a.filename},t)}),c=new r.Ruleset(null,this.parsers.primary()),c.root=!0,c.firstRoot=!0}catch(w){return s(new n(w,t,a.filename))}var x=d.end();if(!x.isFinished){var b=x.furthestPossibleErrorMessage;b||(b="Unrecognised input","}"===x.furthestChar?b+=". Possibly missing opening '{'":")"===x.furthestChar?b+=". Possibly missing opening '('":x.furthestReachedEnd&&(b+=". Possibly missing something")),v=new n({type:"Parse",message:b,index:x.furthest,filename:a.filename},t)}var S=function(e){return e=v||e||t.error,e?(e instanceof n||(e=new n(e,t,a.filename)),s(e)):s(null,c)};return e.processImports===!1?S():void new i.ImportVisitor(t,S).run(c)},parsers:p={primary:function(){for(var e,t=this.mixin,n=[];;){for(;e=this.comment(),e;)n.push(e);if(d.finished)break;if(d.peek("}"))break;if(e=this.extendRule())n=n.concat(e);else if(e=t.definition()||this.rule()||this.ruleset()||t.call()||this.rulesetCall()||this.directive())n.push(e);else{for(var r=!1;d.$char(";");)r=!0;if(!r)break}}return n},comment:function(){if(d.commentStore.length){var e=d.commentStore.shift();return new r.Comment(e.text,e.isLineComment,e.index,a)}},entities:{quoted:function(){var e,t=d.i,n=!1;return d.save(),d.$char("~")&&(n=!0),(e=d.$quoted())?(d.forget(),new r.Quoted(e.charAt(0),e.substr(1,e.length-2),n,t,a)):void d.restore()},keyword:function(){var e=d.$char("%")||d.$re(/^[_A-Za-z-][_A-Za-z0-9-]*/);return e?r.Color.fromKeyword(e)||new r.Keyword(e):void 0},call:function(){var e,t,n,i,o=d.i;return d.peek(/^url\(/i)?void 0:(d.save(),(e=d.$re(/^([\w-]+|%|progid:[\w\.]+)\(/))?(e=e[1],t=e.toLowerCase(),"alpha"===t&&(i=p.alpha())?(d.forget(),i):(n=this.arguments(),d.$char(")")?(d.forget(),new r.Call(e,n,o,a)):void d.restore("Could not parse call arguments or missing ')'"))):void d.forget())},arguments:function(){for(var e,t=[];(e=this.assignment()||p.expression(),e)&&(t.push(e),d.$char(",")););return t},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var e,t;return d.save(),(e=d.$re(/^\w+(?=\s?=)/i))&&d.$char("=")&&(t=p.entity())?(d.forget(),new r.Assignment(e,t)):void d.restore()},url:function(){var e,t=d.i;return d.autoCommentAbsorb=!1,d.$str("url(")?(e=this.quoted()||this.variable()||d.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",d.autoCommentAbsorb=!0,c(")"),new r.URL(null!=e.value||e instanceof r.Variable?e:new r.Anonymous(e),t,a)):void(d.autoCommentAbsorb=!0)},variable:function(){var e,t=d.i;return"@"===d.currentChar()&&(e=d.$re(/^@@?[\w-]+/))?new r.Variable(e,t,a):void 0},variableCurly:function(){var e,t=d.i;return"@"===d.currentChar()&&(e=d.$re(/^@\{([\w-]+)\}/))?new r.Variable("@"+e[1],t,a):void 0},color:function(){var e;if("#"===d.currentChar()&&(e=d.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var t=e.input.match(/^#([\w]+).*/);return t=t[1],t.match(/^[A-Fa-f0-9]+$/)||h("Invalid HEX color code"),new r.Color(e[1],void 0,"#"+t)}},dimension:function(){if(!d.peekNotNumeric()){var e=d.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return e?new r.Dimension(e[1],e[2]):void 0}},unicodeDescriptor:function(){var e;return e=d.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/),e?new r.UnicodeDescriptor(e[0]):void 0},javascript:function(){var e,t=d.i;d.save();var n=d.$char("~"),i=d.$char("`");return i?(e=d.$re(/^[^`]*`/))?(d.forget(),new r.JavaScript(e.substr(0,e.length-1),Boolean(n),t,a)):void d.restore("invalid javascript definition"):void d.restore()}},variable:function(){var e;return"@"===d.currentChar()&&(e=d.$re(/^(@[\w-]+)\s*:/))?e[1]:void 0},rulesetCall:function(){var e;return"@"===d.currentChar()&&(e=d.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/))?new r.RulesetCall(e[1]):void 0},extend:function(e){var t,n,i,o,s,a=d.i;if(d.$str(e?"&:extend(":":extend(")){do{for(i=null,t=null;!(i=d.$re(/^(all)(?=\s*(\)|,))/))&&(n=this.element());)t?t.push(n):t=[n];i=i&&i[1],t||h("Missing target selector for :extend()."),s=new r.Extend(new r.Selector(t),i,a),o?o.push(s):o=[s]}while(d.$char(","));return l(/^\)/),e&&l(/^;/),o}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var e,t,n,i,o,s,u=d.currentChar(),l=!1,h=d.i;if("."===u||"#"===u){for(d.save();e=d.i,i=d.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/),i;)n=new r.Element(o,i,e,a),t?t.push(n):t=[n],o=d.$char(">");return t&&(d.$char("(")&&(s=this.args(!0).args,c(")")),p.important()&&(l=!0),p.end())?(d.forget(),new r.mixin.Call(t,s,h,a,l)):void d.restore()}},args:function(e){var t,n,i,o,s,a,u,l=p.entities,c={args:null,variadic:!1},f=[],v=[],m=[];for(d.save();;){if(e)a=p.detachedRuleset()||p.expression();else{if(d.commentStore.length=0,d.$str("...")){c.variadic=!0,d.$char(";")&&!t&&(t=!0),(t?v:m).push({variadic:!0});break}a=l.variable()||l.literal()||l.keyword()}if(!a)break;o=null,a.throwAwayComments&&a.throwAwayComments(),s=a;var g=null;if(e?a.value&&1==a.value.length&&(g=a.value[0]):g=a,g&&g instanceof r.Variable)if(d.$char(":")){if(f.length>0&&(t&&h("Cannot mix ; and , as delimiter types"),n=!0),s=p.detachedRuleset()||p.expression(),!s){if(!e)return d.restore(),c.args=[],c;h("could not understand value for named argument")}o=i=g.name}else if(d.$str("...")){if(!e){c.variadic=!0,d.$char(";")&&!t&&(t=!0),(t?v:m).push({name:a.name,variadic:!0});break}u=!0}else e||(i=o=g.name,s=null);s&&f.push(s),m.push({name:o,value:s,expand:u}),d.$char(",")||(d.$char(";")||t)&&(n&&h("Cannot mix ; and , as delimiter types"),t=!0,f.length>1&&(s=new r.Value(f)),v.push({name:i,value:s,expand:u}),i=null,f=[],n=!1)}return d.forget(),c.args=t?v:m,c},definition:function(){var e,t,n,i,o=[],s=!1;if(!("."!==d.currentChar()&&"#"!==d.currentChar()||d.peek(/^[^{]*\}/)))if(d.save(),t=d.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){e=t[1];var a=this.args(!1);if(o=a.args,s=a.variadic,!d.$char(")"))return void d.restore("Missing closing ')'");if(d.commentStore.length=0,d.$str("when")&&(i=l(p.conditions,"expected condition")),n=p.block())return d.forget(),new r.mixin.Definition(e,o,n,i,s);d.restore()}else d.forget()}},entity:function(){var e=this.entities;return this.comment()||e.literal()||e.variable()||e.url()||e.call()||e.keyword()||e.javascript()},end:function(){return d.$char(";")||d.peek("}")},alpha:function(){var e;return d.$re(/^opacity=/i)?(e=d.$re(/^\d+/),e||(e=l(this.entities.variable,"Could not parse alpha")),c(")"),new r.Alpha(e)):void 0},element:function(){var e,t,n,i=d.i;return t=this.combinator(),e=d.$re(/^(?:\d+\.\d+|\d+)%/)||d.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||d.$char("*")||d.$char("&")||this.attribute()||d.$re(/^\([^&()@]+\)/)||d.$re(/^[\.#:](?=@)/)||this.entities.variableCurly(),e||(d.save(),d.$char("(")?(n=this.selector())&&d.$char(")")?(e=new r.Paren(n),d.forget()):d.restore("Missing closing ')'"):d.forget()),e?new r.Element(t,e,i,a):void 0},combinator:function(){var e=d.currentChar();if("/"===e){d.save();var t=d.$re(/^\/[a-z]+\//i);if(t)return d.forget(),new r.Combinator(t);d.restore()}if(">"===e||"+"===e||"~"===e||"|"===e||"^"===e){for(d.i++,"^"===e&&"^"===d.currentChar()&&(e="^^",d.i++);d.isWhitespace();)d.i++;return new r.Combinator(e)}return new r.Combinator(d.isWhitespace(-1)?" ":null)},lessSelector:function(){return this.selector(!0)},selector:function(e){for(var t,n,i,o,s,u,c,f=d.i;(e&&(n=this.extend())||e&&(u=d.$str("when"))||(o=this.element()))&&(u?c=l(this.conditions,"expected condition"):c?h("CSS guard can only be used at the end of selector"):n?s=s?s.concat(n):n:(s&&h("Extend can only be used at the end of selector"),i=d.currentChar(),t?t.push(o):t=[o],o=null),"{"!==i&&"}"!==i&&";"!==i&&","!==i&&")"!==i););return t?new r.Selector(t,s,c,f,a):void(s&&h("Extend must be used to extend a selector, it cannot be used on its own"))},attribute:function(){if(d.$char("[")){var e,t,n,i=this.entities;return(e=i.variableCurly())||(e=l(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),n=d.$re(/^[|~*$^]?=/),n&&(t=i.quoted()||d.$re(/^[0-9]+%/)||d.$re(/^[\w-]+/)||i.variableCurly()),c("]"),new r.Attribute(e,n,t)}},block:function(){var e;return d.$char("{")&&(e=this.primary())&&d.$char("}")?e:void 0},blockRuleset:function(){var e=this.block();return e&&(e=new r.Ruleset(null,e)),e},detachedRuleset:function(){var e=this.blockRuleset();return e?new r.DetachedRuleset(e):void 0},ruleset:function(){var t,n,i,o;for(d.save(),e.dumpLineNumbers&&(o=f(d.i));(n=this.lessSelector(),n)&&(t?t.push(n):t=[n],d.commentStore.length=0,n.condition&&t.length>1&&h("Guards are only currently allowed on a single selector."),d.$char(","));)n.condition&&h("Guards are only currently allowed on a single selector."),d.commentStore.length=0;if(t&&(i=this.block())){d.forget();var s=new r.Ruleset(t,i,e.strictImports);return e.dumpLineNumbers&&(s.debugInfo=o),s}d.restore()},rule:function(t){var n,i,o,s,u,l=d.i,c=d.currentChar();if("."!==c&&"#"!==c&&"&"!==c&&":"!==c)if(d.save(),n=this.variable()||this.ruleProperty()){if(u="string"==typeof n,u&&(i=this.detachedRuleset()),d.commentStore.length=0,!i){s=!u&&n.length>1&&n.pop().value;var h=!t&&(e.compress||u);if(h&&(i=this.value()),!i&&(i=this.anonymousValue()))return d.forget(),new r.Rule(n,i,!1,s,l,a);h||i||(i=this.value()),o=this.important()}if(i&&this.end())return d.forget(),new r.Rule(n,i,o,s,l,a);if(d.restore(),i&&!t)return this.rule(!0)}else d.forget()},anonymousValue:function(){var e=d.$re(/^([^@+\/'"*`(;{}-]*);/);return e?new r.Anonymous(e[1]):void 0},"import":function(){var e,t,n=d.i,i=d.$re(/^@import?\s+/);if(i){var o=(i?this.importOptions():null)||{};if(e=this.entities.quoted()||this.entities.url())return t=this.mediaFeatures(),d.$char(";")||(d.i=n,h("missing semi-colon or unrecognised media features on import")),t=t&&new r.Value(t),new r.Import(e,t,o,n,a);d.i=n,h("malformed import statement")}},importOptions:function(){var e,t,n,r={};if(!d.$char("("))return null;do if(e=this.importOption()){switch(t=e,n=!0,t){case"css":t="less",n=!1;break;case"once":t="multiple",n=!1}if(r[t]=n,!d.$char(","))break}while(e);return c(")"),r},importOption:function(){var e=d.$re(/^(less|css|multiple|once|inline|reference|optional)/);return e?e[1]:void 0},mediaFeature:function(){var e,t,n=this.entities,i=[];d.save();do if(e=n.keyword()||n.variable())i.push(e);else if(d.$char("(")){if(t=this.property(),e=this.value(),!d.$char(")"))return d.restore("Missing closing ')'"),null;if(t&&e)i.push(new r.Paren(new r.Rule(t,e,null,null,d.i,a,!0)));else{if(!e)return d.restore("badly formed media feature definition"),null;i.push(new r.Paren(e))}}while(e);return d.forget(),i.length>0?new r.Expression(i):void 0},mediaFeatures:function(){var e,t=this.entities,n=[];do if(e=this.mediaFeature()){if(n.push(e),!d.$char(","))break}else if(e=t.variable(),e&&(n.push(e),!d.$char(",")))break;while(e);return n.length>0?n:null},media:function(){var t,n,i,o;return e.dumpLineNumbers&&(o=f(d.i)),d.save(),d.$str("@media")?(t=this.mediaFeatures(),(n=this.block())?(d.forget(),i=new r.Media(n,t,d.i,a),e.dumpLineNumbers&&(i.debugInfo=o),i):void d.restore("media definitions require block statements after any features")):void d.restore()},plugin:function(){var e,t=d.i,n=d.$re(/^@plugin?\s+/);if(n){var i={plugin:!0};if(e=this.entities.quoted()||this.entities.url())return d.$char(";")||(d.i=t,h("missing semi-colon on plugin")),new r.Import(e,null,i,t,a);d.i=t,h("malformed plugin statement")}},directive:function(){var t,n,i,o,s,u,l,c=d.i,p=!0,v=!0;if("@"===d.currentChar()){if(n=this["import"]()||this.plugin()||this.media())return n;if(d.save(),t=d.$re(/^@[a-z-]+/)){switch(o=t,"-"==t.charAt(1)&&t.indexOf("-",2)>0&&(o="@"+t.slice(t.indexOf("-",2)+1)),o){case"@counter-style":s=!0,p=!0;break;case"@charset":s=!0,p=!1;break;case"@namespace":u=!0,p=!1;break;case"@keyframes":s=!0;break;case"@host":case"@page":l=!0;break;case"@document":case"@supports":l=!0,v=!1}return d.commentStore.length=0,s?(n=this.entity(),n||h("expected "+t+" identifier")):u?(n=this.expression(),n||h("expected "+t+" expression")):l&&(n=(d.$re(/^[^{;]+/)||"").trim(),n&&(n=new r.Anonymous(n))),p&&(i=this.blockRuleset()),i||!p&&n&&d.$char(";")?(d.forget(),new r.Directive(t,n,i,c,a,e.dumpLineNumbers?f(c):null,!1,v)):void d.restore("directive options not recognised")}}},value:function(){var e,t=[];do if(e=this.expression(),e&&(t.push(e),!d.$char(",")))break;while(e);return t.length>0?new r.Value(t):void 0},important:function(){return"!"===d.currentChar()?d.$re(/^! *important/):void 0},sub:function(){var e,t;return d.save(),d.$char("(")?(e=this.addition(),e&&d.$char(")")?(d.forget(),t=new r.Expression([e]),t.parens=!0,t):void d.restore("Expected ')'")):void d.restore()},multiplication:function(){var e,t,n,i,o;if(e=this.operand()){for(o=d.isWhitespace(-1);!d.peek(/^\/[*\/]/);){if(d.save(),n=d.$char("/")||d.$char("*"),!n){d.forget();break}if(t=this.operand(),!t){d.restore();break}d.forget(),e.parensInOp=!0,t.parensInOp=!0,i=new r.Operation(n,[i||e,t],o),o=d.isWhitespace(-1)}return i||e}},addition:function(){var e,t,n,i,o;if(e=this.multiplication()){for(o=d.isWhitespace(-1);(n=d.$re(/^[-+]\s+/)||!o&&(d.$char("+")||d.$char("-")),n)&&(t=this.multiplication(),t);)e.parensInOp=!0,t.parensInOp=!0,i=new r.Operation(n,[i||e,t],o),o=d.isWhitespace(-1);return i||e}},conditions:function(){var e,t,n,i=d.i;if(e=this.condition()){for(;d.peek(/^,\s*(not\s*)?\(/)&&d.$char(",")&&(t=this.condition(),t);)n=new r.Condition("or",n||e,t,i);return n||e}},condition:function(){var e,t,n,i,o=this.entities,s=d.i,a=!1;return d.$str("not")&&(a=!0),c("("),e=this.addition()||o.keyword()||o.quoted(),e?(d.$char(">")?i=d.$char("=")?">=":">":d.$char("<")?i=d.$char("=")?"<=":"<":d.$char("=")&&(i=d.$char(">")?"=>":d.$char("<")?"=<":"="),i?(t=this.addition()||o.keyword()||o.quoted(),t?n=new r.Condition(i,e,t,s,a):h("expected expression")):n=new r.Condition("=",e,new r.Keyword("true"),s,a),c(")"),d.$str("and")?new r.Condition("and",n,this.condition()):n):void 0},operand:function(){var e,t=this.entities;d.peek(/^-[@\(]/)&&(e=d.$char("-"));var n=this.sub()||t.dimension()||t.color()||t.variable()||t.call();return e&&(n.parensInOp=!0,n=new r.Negative(n)),n},expression:function(){var e,t,n=[];do e=this.comment(),e?n.push(e):(e=this.addition()||this.entity(),e&&(n.push(e),d.peek(/^\/[\/*]/)||(t=d.$char("/"),t&&n.push(new r.Anonymous(t)))));while(e);return n.length>0?new r.Expression(n):void 0},property:function(){var e=d.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);return e?e[1]:void 0},ruleProperty:function(){function e(e){var t=d.i,n=d.$re(e);return n?(o.push(t),i.push(n[1])):void 0}var t,n,i=[],o=[];d.save();var s=d.$re(/^([_a-zA-Z0-9-]+)\s*:/);if(s)return i=[new r.Keyword(s[1])],d.forget(),i;for(e(/^(\*?)/);e(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/););if(i.length>1&&e(/^((?:\+_|\+)?)\s*:/)){for(d.forget(),""===i[0]&&(i.shift(),o.shift()),n=0;i.length>n;n++)t=i[n],i[n]="@"!==t.charAt(0)?new r.Keyword(t):new r.Variable("@"+t.slice(2,-1),o[n],a);return i}d.restore()}}}};a.serializeVars=function(e){var t="";for(var n in e)if(Object.hasOwnProperty.call(e,n)){var r=e[n];t+=("@"===n[0]?"":"@")+n+": "+r+(";"===String(r).slice(-1)?"":";")}return t},t.exports=a},{"../less-error":31,"../tree":61,"../utils":82,"../visitors":86,"./parser-input":36}],38:[function(e,t){var n=function(e){this.less=e,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};n.prototype.addPlugins=function(e){if(e)for(var t=0;e.length>t;t++)this.addPlugin(e[t])},n.prototype.addPlugin=function(e){this.installedPlugins.push(e),e.install(this.less,this)},n.prototype.addVisitor=function(e){this.visitors.push(e)},n.prototype.addPreProcessor=function(e,t){var n;for(n=0;this.preProcessors.length>n&&!(this.preProcessors[n].priority>=t);n++);this.preProcessors.splice(n,0,{preProcessor:e,priority:t})},n.prototype.addPostProcessor=function(e,t){var n;for(n=0;this.postProcessors.length>n&&!(this.postProcessors[n].priority>=t);n++);this.postProcessors.splice(n,0,{postProcessor:e,priority:t})},n.prototype.addFileManager=function(e){this.fileManagers.push(e)},n.prototype.getPreProcessors=function(){for(var e=[],t=0;this.preProcessors.length>t;t++)e.push(this.preProcessors[t].preProcessor);return e},n.prototype.getPostProcessors=function(){for(var e=[],t=0;this.postProcessors.length>t;t++)e.push(this.postProcessors[t].postProcessor);return e},n.prototype.getVisitors=function(){return this.visitors},n.prototype.getFileManagers=function(){return this.fileManagers},t.exports=n},{}],39:[function(e,t){var n=e("../less-error"),r=e("../tree"),i=t.exports=function(e,t){this.fileInfo=t};i.prototype.eval=function(e,t){var i,o,s={};o={add:function(e,t){s[e]=t},addMultiple:function(e){Object.keys(e).forEach(function(t){s[t]=e[t]})}};try{(i=new Function("functions","tree","fileInfo",e))(o,r,this.fileInfo)}catch(a){t(new n({message:"Plugin evaluation error: '"+a.name+": "+a.message.replace(/["]/g,"'")+"'",filename:this.fileInfo.filename}),null)}t(null,{functions:s})}},{"../less-error":31,"../tree":61}],40:[function(e,t){var n;t.exports=function(t,r){var i=function(t,o,s){if("function"==typeof o&&(s=o,o={}),!s){n||(n="undefined"==typeof Promise?e("promise"):Promise);var a=this;return new n(function(e,n){i.call(a,t,o,function(t,r){t?n(t):e(r)})})}this.parse(t,o,function(e,t,n,i){if(e)return s(e);var o;try{var a=new r(t,n);o=a.toCSS(i)}catch(e){return s(e)}s(null,o)})};return i}},{promise:void 0}],41:[function(e,t){t.exports=function(e,t){var n=function(e){this.options=e};return n.prototype.toCSS=function(t,n,r){var i=new e({contentsIgnoredCharsMap:r.contentsIgnoredChars,rootNode:t,contentsMap:r.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),o=i.toCSS(n);return this.sourceMap=i.sourceMap,this.sourceMapURL=i.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=i.normalizeFilename(this.options.sourceMapInputFilename)),o+this.getCSSAppendage()},n.prototype.getCSSAppendage=function(){var e=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";e="data:application/json;base64,"+t.encodeBase64(this.sourceMap)}return e?"/*# sourceMappingURL="+e+" */":""},n.prototype.getExternalSourceMap=function(){return this.sourceMap},n.prototype.setExternalSourceMap=function(e){this.sourceMap=e},n.prototype.isInline=function(){return this.options.sourceMapFileInline},n.prototype.getSourceMapURL=function(){return this.sourceMapURL},n.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},n.prototype.getInputFilename=function(){return this.sourceMapInputFilename},n}},{}],42:[function(e,t){t.exports=function(e){var t=function(t){this._css=[],this._rootNode=t.rootNode,this._contentsMap=t.contentsMap,this._contentsIgnoredCharsMap=t.contentsIgnoredCharsMap,t.sourceMapFilename&&(this._sourceMapFilename=t.sourceMapFilename.replace(/\\/g,"/")),
this._outputFilename=t.outputFilename,this.sourceMapURL=t.sourceMapURL,t.sourceMapBasepath&&(this._sourceMapBasepath=t.sourceMapBasepath.replace(/\\/g,"/")),t.sourceMapRootpath?(this._sourceMapRootpath=t.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=t.outputSourceFiles,this._sourceMapGeneratorConstructor=e.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return t.prototype.normalizeFilename=function(e){return e=e.replace(/\\/g,"/"),this._sourceMapBasepath&&0===e.indexOf(this._sourceMapBasepath)&&(e=e.substring(this._sourceMapBasepath.length),("\\"===e.charAt(0)||"/"===e.charAt(0))&&(e=e.substring(1))),(this._sourceMapRootpath||"")+e},t.prototype.add=function(e,t,n,r){if(e){var i,o,s,a,u;if(t){var l=this._contentsMap[t.filename];this._contentsIgnoredCharsMap[t.filename]&&(n-=this._contentsIgnoredCharsMap[t.filename],0>n&&(n=0),l=l.slice(this._contentsIgnoredCharsMap[t.filename])),l=l.substring(0,n),o=l.split("\n"),a=o[o.length-1]}if(i=e.split("\n"),s=i[i.length-1],t)if(r)for(u=0;i.length>u;u++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+u+1,column:0===u?this._column:0},original:{line:o.length+u,column:0===u?a.length:0},source:this.normalizeFilename(t.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:o.length,column:a.length},source:this.normalizeFilename(t.filename)});1===i.length?this._column+=s.length:(this._lineNumber+=i.length-1,this._column=s.length),this._css.push(e)}},t.prototype.isEmpty=function(){return 0===this._css.length},t.prototype.toCSS=function(e){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var t in this._contentsMap)if(this._contentsMap.hasOwnProperty(t)){var n=this._contentsMap[t];this._contentsIgnoredCharsMap[t]&&(n=n.slice(this._contentsIgnoredCharsMap[t])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(t),n)}if(this._rootNode.genCSS(e,this),this._css.length>0){var r,i=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?r=this.sourceMapURL:this._sourceMapFilename&&(r=this._sourceMapFilename),this.sourceMapURL=r,this.sourceMap=i}return this._css.join("")},t}},{}],43:[function(e,t){var n=e("./contexts"),r=e("./visitors"),i=e("./tree");t.exports=function(e,t){t=t||{};var o,s=t.variables,a=new n.Eval(t);"object"!=typeof s||Array.isArray(s)||(s=Object.keys(s).map(function(e){var t=s[e];return t instanceof i.Value||(t instanceof i.Expression||(t=new i.Expression([t])),t=new i.Value([t])),new i.Rule("@"+e,t,!1,null,0)}),a.frames=[new i.Ruleset(null,s)]);var u,l=[],c=[new r.JoinSelectorVisitor,new r.ExtendVisitor,new r.ToCSSVisitor({compress:Boolean(t.compress)})];if(t.pluginManager){var h=t.pluginManager.getVisitors();for(u=0;h.length>u;u++){var f=h[u];f.isPreEvalVisitor?l.push(f):f.isPreVisitor?c.splice(0,0,f):c.push(f)}}for(u=0;l.length>u;u++)l[u].run(e);for(o=e.eval(a),u=0;c.length>u;u++)c[u].run(o);return o}},{"./contexts":10,"./tree":61,"./visitors":86}],44:[function(e,t){var n=e("./node"),r=function(e){this.value=e};r.prototype=new n,r.prototype.type="Alpha",r.prototype.accept=function(e){this.value=e.visit(this.value)},r.prototype.eval=function(e){return this.value.eval?new r(this.value.eval(e)):this},r.prototype.genCSS=function(e,t){t.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(e,t):t.add(this.value),t.add(")")},t.exports=r},{"./node":69}],45:[function(e,t){var n=e("./node"),r=function(e,t,n,r,i,o){this.value=e,this.index=t,this.mapLines=r,this.currentFileInfo=n,this.rulesetLike="undefined"==typeof i?!1:i,this.isReferenced=o||!1};r.prototype=new n,r.prototype.type="Anonymous",r.prototype.eval=function(){return new r(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike,this.isReferenced)},r.prototype.compare=function(e){return e.toCSS&&this.toCSS()===e.toCSS()?0:void 0},r.prototype.isRulesetLike=function(){return this.rulesetLike},r.prototype.genCSS=function(e,t){t.add(this.value,this.currentFileInfo,this.index,this.mapLines)},r.prototype.markReferenced=function(){this.isReferenced=!0},r.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},t.exports=r},{"./node":69}],46:[function(e,t){var n=e("./node"),r=function(e,t){this.key=e,this.value=t};r.prototype=new n,r.prototype.type="Assignment",r.prototype.accept=function(e){this.value=e.visit(this.value)},r.prototype.eval=function(e){return this.value.eval?new r(this.key,this.value.eval(e)):this},r.prototype.genCSS=function(e,t){t.add(this.key+"="),this.value.genCSS?this.value.genCSS(e,t):t.add(this.value)},t.exports=r},{"./node":69}],47:[function(e,t){var n=e("./node"),r=function(e,t,n){this.key=e,this.op=t,this.value=n};r.prototype=new n,r.prototype.type="Attribute",r.prototype.eval=function(e){return new r(this.key.eval?this.key.eval(e):this.key,this.op,this.value&&this.value.eval?this.value.eval(e):this.value)},r.prototype.genCSS=function(e,t){t.add(this.toCSS(e))},r.prototype.toCSS=function(e){var t=this.key.toCSS?this.key.toCSS(e):this.key;return this.op&&(t+=this.op,t+=this.value.toCSS?this.value.toCSS(e):this.value),"["+t+"]"},t.exports=r},{"./node":69}],48:[function(e,t){var n=e("./node"),r=e("../functions/function-caller"),i=function(e,t,n,r){this.name=e,this.args=t,this.index=n,this.currentFileInfo=r};i.prototype=new n,i.prototype.type="Call",i.prototype.accept=function(e){this.args&&(this.args=e.visitArray(this.args))},i.prototype.eval=function(e){var t,n=this.args.map(function(t){return t.eval(e)}),o=new r(this.name,e,this.index,this.currentFileInfo);if(o.isValid())try{if(t=o.call(n),null!=t)return t}catch(s){throw{type:s.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(s.message?": "+s.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new i(this.name,n,this.index,this.currentFileInfo)},i.prototype.genCSS=function(e,t){t.add(this.name+"(",this.currentFileInfo,this.index);for(var n=0;this.args.length>n;n++)this.args[n].genCSS(e,t),this.args.length>n+1&&t.add(", ");t.add(")")},t.exports=i},{"../functions/function-caller":20,"./node":69}],49:[function(e,t){function n(e,t){return Math.min(Math.max(e,0),t)}function r(e){return"#"+e.map(function(e){return e=n(Math.round(e),255),(16>e?"0":"")+e.toString(16)}).join("")}var i=e("./node"),o=e("../data/colors"),s=function(e,t,n){this.rgb=Array.isArray(e)?e:6==e.length?e.match(/.{2}/g).map(function(e){return parseInt(e,16)}):e.split("").map(function(e){return parseInt(e+e,16)}),this.alpha="number"==typeof t?t:1,"undefined"!=typeof n&&(this.value=n)};s.prototype=new i,s.prototype.type="Color",s.prototype.luma=function(){var e=this.rgb[0]/255,t=this.rgb[1]/255,n=this.rgb[2]/255;return e=.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4),t=.03928>=t?t/12.92:Math.pow((t+.055)/1.055,2.4),n=.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*e+.7152*t+.0722*n},s.prototype.genCSS=function(e,t){t.add(this.toCSS(e))},s.prototype.toCSS=function(e,t){var r,i,o=e&&e.compress&&!t;if(this.value)return this.value;if(i=this.fround(e,this.alpha),1>i)return"rgba("+this.rgb.map(function(e){return n(Math.round(e),255)}).concat(n(i,1)).join(","+(o?"":" "))+")";if(r=this.toRGB(),o){var s=r.split("");s[1]===s[2]&&s[3]===s[4]&&s[5]===s[6]&&(r="#"+s[1]+s[3]+s[5])}return r},s.prototype.operate=function(e,t,n){for(var r=[],i=this.alpha*(1-n.alpha)+n.alpha,o=0;3>o;o++)r[o]=this._operate(e,t,this.rgb[o],n.rgb[o]);return new s(r,i)},s.prototype.toRGB=function(){return r(this.rgb)},s.prototype.toHSL=function(){var e,t,n=this.rgb[0]/255,r=this.rgb[1]/255,i=this.rgb[2]/255,o=this.alpha,s=Math.max(n,r,i),a=Math.min(n,r,i),u=(s+a)/2,l=s-a;if(s===a)e=t=0;else{switch(t=u>.5?l/(2-s-a):l/(s+a),s){case n:e=(r-i)/l+(i>r?6:0);break;case r:e=(i-n)/l+2;break;case i:e=(n-r)/l+4}e/=6}return{h:360*e,s:t,l:u,a:o}},s.prototype.toHSV=function(){var e,t,n=this.rgb[0]/255,r=this.rgb[1]/255,i=this.rgb[2]/255,o=this.alpha,s=Math.max(n,r,i),a=Math.min(n,r,i),u=s,l=s-a;if(t=0===s?0:l/s,s===a)e=0;else{switch(s){case n:e=(r-i)/l+(i>r?6:0);break;case r:e=(i-n)/l+2;break;case i:e=(n-r)/l+4}e/=6}return{h:360*e,s:t,v:u,a:o}},s.prototype.toARGB=function(){return r([255*this.alpha].concat(this.rgb))},s.prototype.compare=function(e){return e.rgb&&e.rgb[0]===this.rgb[0]&&e.rgb[1]===this.rgb[1]&&e.rgb[2]===this.rgb[2]&&e.alpha===this.alpha?0:void 0},s.fromKeyword=function(e){var t,n=e.toLowerCase();return o.hasOwnProperty(n)?t=new s(o[n].slice(1)):"transparent"===n&&(t=new s([0,0,0],0)),t?(t.value=e,t):void 0},t.exports=s},{"../data/colors":11,"./node":69}],50:[function(e,t){var n=e("./node"),r=function(e){" "===e?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=e?e.trim():"",this.emptyOrWhitespace=""===this.value)};r.prototype=new n,r.prototype.type="Combinator";var i={"":!0," ":!0,"|":!0};r.prototype.genCSS=function(e,t){var n=e.compress||i[this.value]?"":" ";t.add(n+this.value+n)},t.exports=r},{"./node":69}],51:[function(e,t){var n=e("./node"),r=e("./debug-info"),i=function(e,t,n,r){this.value=e,this.isLineComment=t,this.currentFileInfo=r};i.prototype=new n,i.prototype.type="Comment",i.prototype.genCSS=function(e,t){this.debugInfo&&t.add(r(e,this),this.currentFileInfo,this.index),t.add(this.value)},i.prototype.isSilent=function(e){var t=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,n=e.compress&&"!"!==this.value[2];return this.isLineComment||t||n},i.prototype.markReferenced=function(){this.isReferenced=!0},t.exports=i},{"./debug-info":53,"./node":69}],52:[function(e,t){var n=e("./node"),r=function(e,t,n,r,i){this.op=e.trim(),this.lvalue=t,this.rvalue=n,this.index=r,this.negate=i};r.prototype=new n,r.prototype.type="Condition",r.prototype.accept=function(e){this.lvalue=e.visit(this.lvalue),this.rvalue=e.visit(this.rvalue)},r.prototype.eval=function(e){var t=function(e,t,r){switch(e){case"and":return t&&r;case"or":return t||r;default:switch(n.compare(t,r)){case-1:return"<"===e||"=<"===e||"<="===e;case 0:return"="===e||">="===e||"=<"===e||"<="===e;case 1:return">"===e||">="===e;default:return!1}}}(this.op,this.lvalue.eval(e),this.rvalue.eval(e));return this.negate?!t:t},t.exports=r},{"./node":69}],53:[function(e,t){var n=function(e,t,r){var i="";if(e.dumpLineNumbers&&!e.compress)switch(e.dumpLineNumbers){case"comments":i=n.asComment(t);break;case"mediaquery":i=n.asMediaQuery(t);break;case"all":i=n.asComment(t)+(r||"")+n.asMediaQuery(t)}return i};n.asComment=function(e){return"/* line "+e.debugInfo.lineNumber+", "+e.debugInfo.fileName+" */\n"},n.asMediaQuery=function(e){var t=e.debugInfo.fileName;return/^[a-z]+:\/\//i.test(t)||(t="file://"+t),"@media -sass-debug-info{filename{font-family:"+t.replace(/([.:\/\\])/g,function(e){return"\\"==e&&(e="/"),"\\"+e})+"}line{font-family:\\00003"+e.debugInfo.lineNumber+"}}\n"},t.exports=n},{}],54:[function(e,t){var n=e("./node"),r=e("../contexts"),i=function(e,t){this.ruleset=e,this.frames=t};i.prototype=new n,i.prototype.type="DetachedRuleset",i.prototype.evalFirst=!0,i.prototype.accept=function(e){this.ruleset=e.visit(this.ruleset)},i.prototype.eval=function(e){var t=this.frames||e.frames.slice(0);return new i(this.ruleset,t)},i.prototype.callEval=function(e){return this.ruleset.eval(this.frames?new r.Eval(e,this.frames.concat(e.frames)):e)},t.exports=i},{"../contexts":10,"./node":69}],55:[function(e,t){var n=e("./node"),r=e("../data/unit-conversions"),i=e("./unit"),o=e("./color"),s=function(e,t){this.value=parseFloat(e),this.unit=t&&t instanceof i?t:new i(t?[t]:void 0)};s.prototype=new n,s.prototype.type="Dimension",s.prototype.accept=function(e){this.unit=e.visit(this.unit)},s.prototype.eval=function(){return this},s.prototype.toColor=function(){return new o([this.value,this.value,this.value])},s.prototype.genCSS=function(e,t){if(e&&e.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var n=this.fround(e,this.value),r=String(n);if(0!==n&&1e-6>n&&n>-1e-6&&(r=n.toFixed(20).replace(/0+$/,"")),e&&e.compress){if(0===n&&this.unit.isLength())return void t.add(r);n>0&&1>n&&(r=r.substr(1))}t.add(r),this.unit.genCSS(e,t)},s.prototype.operate=function(e,t,n){var r=this._operate(e,t,this.value,n.value),i=this.unit.clone();if("+"===t||"-"===t)if(0===i.numerator.length&&0===i.denominator.length)i=n.unit.clone(),this.unit.backupUnit&&(i.backupUnit=this.unit.backupUnit);else if(0===n.unit.numerator.length&&0===i.denominator.length);else{if(n=n.convertTo(this.unit.usedUnits()),e.strictUnits&&n.unit.toString()!==i.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+i.toString()+"' and '"+n.unit.toString()+"'.");r=this._operate(e,t,this.value,n.value)}else"*"===t?(i.numerator=i.numerator.concat(n.unit.numerator).sort(),i.denominator=i.denominator.concat(n.unit.denominator).sort(),i.cancel()):"/"===t&&(i.numerator=i.numerator.concat(n.unit.denominator).sort(),i.denominator=i.denominator.concat(n.unit.numerator).sort(),i.cancel());return new s(r,i)},s.prototype.compare=function(e){var t,r;if(e instanceof s){if(this.unit.isEmpty()||e.unit.isEmpty())t=this,r=e;else if(t=this.unify(),r=e.unify(),0!==t.unit.compare(r.unit))return;return n.numericCompare(t.value,r.value)}},s.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},s.prototype.convertTo=function(e){var t,n,i,o,a,u=this.value,l=this.unit.clone(),c={};if("string"==typeof e){for(t in r)r[t].hasOwnProperty(e)&&(c={},c[t]=e);e=c}a=function(e,t){return i.hasOwnProperty(e)?(t?u/=i[e]/i[o]:u*=i[e]/i[o],o):e};for(n in e)e.hasOwnProperty(n)&&(o=e[n],i=r[n],l.map(a));return l.cancel(),new s(u,l)},t.exports=s},{"../data/unit-conversions":13,"./color":49,"./node":69,"./unit":78}],56:[function(e,t){var n=e("./node"),r=e("./selector"),i=e("./ruleset"),o=function(e,t,n,i,o,s,a,u){var l;if(this.name=e,this.value=t,n)for(Array.isArray(n)?this.rules=n:(this.rules=[n],this.rules[0].selectors=new r([],null,null,this.index,o).createEmptySelectors()),l=0;this.rules.length>l;l++)this.rules[l].allowImports=!0;this.index=i,this.currentFileInfo=o,this.debugInfo=s,this.isReferenced=a,this.isRooted=u||!1};o.prototype=new n,o.prototype.type="Directive",o.prototype.accept=function(e){var t=this.value,n=this.rules;n&&(this.rules=e.visitArray(n)),t&&(this.value=e.visit(t))},o.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},o.prototype.isCharset=function(){return"@charset"===this.name},o.prototype.genCSS=function(e,t){var n=this.value,r=this.rules;t.add(this.name,this.currentFileInfo,this.index),n&&(t.add(" "),n.genCSS(e,t)),r?this.outputRuleset(e,t,r):t.add(";")},o.prototype.eval=function(e){var t,n,r=this.value,i=this.rules;return t=e.mediaPath,n=e.mediaBlocks,e.mediaPath=[],e.mediaBlocks=[],r&&(r=r.eval(e)),i&&(i=[i[0].eval(e)],i[0].root=!0),e.mediaPath=t,e.mediaBlocks=n,new o(this.name,r,i,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced,this.isRooted)},o.prototype.variable=function(e){return this.rules?i.prototype.variable.call(this.rules[0],e):void 0},o.prototype.find=function(){return this.rules?i.prototype.find.apply(this.rules[0],arguments):void 0},o.prototype.rulesets=function(){return this.rules?i.prototype.rulesets.apply(this.rules[0]):void 0},o.prototype.markReferenced=function(){var e,t;if(this.isReferenced=!0,this.rules)for(t=this.rules,e=0;t.length>e;e++)t[e].markReferenced&&t[e].markReferenced()},o.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},o.prototype.outputRuleset=function(e,t,n){var r,i=n.length;if(e.tabLevel=(0|e.tabLevel)+1,e.compress){for(t.add("{"),r=0;i>r;r++)n[r].genCSS(e,t);return t.add("}"),void e.tabLevel--}var o="\n"+Array(e.tabLevel).join("  "),s=o+"  ";if(i){for(t.add(" {"+s),n[0].genCSS(e,t),r=1;i>r;r++)t.add(s),n[r].genCSS(e,t);t.add(o+"}")}else t.add(" {"+o+"}");e.tabLevel--},t.exports=o},{"./node":69,"./ruleset":75,"./selector":76}],57:[function(e,t){var n=e("./node"),r=e("./paren"),i=e("./combinator"),o=function(e,t,n,r){this.combinator=e instanceof i?e:new i(e),this.value="string"==typeof t?t.trim():t?t:"",this.index=n,this.currentFileInfo=r};o.prototype=new n,o.prototype.type="Element",o.prototype.accept=function(e){var t=this.value;this.combinator=e.visit(this.combinator),"object"==typeof t&&(this.value=e.visit(t))},o.prototype.eval=function(e){return new o(this.combinator,this.value.eval?this.value.eval(e):this.value,this.index,this.currentFileInfo)},o.prototype.genCSS=function(e,t){t.add(this.toCSS(e),this.currentFileInfo,this.index)},o.prototype.toCSS=function(e){e=e||{};var t=this.value,n=e.firstSelector;return t instanceof r&&(e.firstSelector=!0),t=t.toCSS?t.toCSS(e):t,e.firstSelector=n,""===t&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(e)+t},t.exports=o},{"./combinator":50,"./node":69,"./paren":71}],58:[function(e,t){var n=e("./node"),r=e("./paren"),i=e("./comment"),o=function(e){if(this.value=e,!e)throw new Error("Expression requires an array parameter")};o.prototype=new n,o.prototype.type="Expression",o.prototype.accept=function(e){this.value=e.visitArray(this.value)},o.prototype.eval=function(e){var t,n=this.parens&&!this.parensInOp,i=!1;return n&&e.inParenthesis(),this.value.length>1?t=new o(this.value.map(function(t){return t.eval(e)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(i=!0),t=this.value[0].eval(e)):t=this,n&&e.outOfParenthesis(),this.parens&&this.parensInOp&&!e.isMathOn()&&!i&&(t=new r(t)),t},o.prototype.genCSS=function(e,t){for(var n=0;this.value.length>n;n++)this.value[n].genCSS(e,t),this.value.length>n+1&&t.add(" ")},o.prototype.throwAwayComments=function(){this.value=this.value.filter(function(e){return!(e instanceof i)})},o.prototype.markReferenced=function(){this.value.forEach(function(e){e.markReferenced&&e.markReferenced()})},t.exports=o},{"./comment":51,"./node":69,"./paren":71}],59:[function(e,t){var n=e("./node"),r=function i(e,t,n){switch(this.selector=e,this.option=t,this.index=n,this.object_id=i.next_id++,this.parent_ids=[this.object_id],t){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};r.next_id=0,r.prototype=new n,r.prototype.type="Extend",r.prototype.accept=function(e){this.selector=e.visit(this.selector)},r.prototype.eval=function(e){return new r(this.selector.eval(e),this.option,this.index)},r.prototype.clone=function(){return new r(this.selector,this.option,this.index)},r.prototype.findSelfSelectors=function(e){var t,n,r=[];for(t=0;e.length>t;t++)n=e[t].elements,t>0&&n.length&&""===n[0].combinator.value&&(n[0].combinator.value=" "),r=r.concat(e[t].elements);this.selfSelectors=[{elements:r}]},t.exports=r},{"./node":69}],60:[function(e,t){var n=e("./node"),r=e("./media"),i=e("./url"),o=e("./quoted"),s=e("./ruleset"),a=e("./anonymous"),u=function(e,t,n,r,i){if(this.options=n,this.index=r,this.path=e,this.features=t,this.currentFileInfo=i,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var o=this.getPath();o&&/[#\.\&\?\/]css([\?;].*)?$/.test(o)&&(this.css=!0)}};u.prototype=new n,u.prototype.type="Import",u.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.path=e.visit(this.path),this.options.plugin||this.options.inline||!this.root||(this.root=e.visit(this.root))},u.prototype.genCSS=function(e,t){this.css&&void 0===this.path.currentFileInfo.reference&&(t.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(e,t),this.features&&(t.add(" "),this.features.genCSS(e,t)),t.add(";"))},u.prototype.getPath=function(){return this.path instanceof i?this.path.value.value:this.path.value},u.prototype.isVariableImport=function(){var e=this.path;return e instanceof i&&(e=e.value),e instanceof o?e.containsVariables():!0},u.prototype.evalForImport=function(e){var t=this.path;return t instanceof i&&(t=t.value),new u(t.eval(e),this.features,this.options,this.index,this.currentFileInfo)},u.prototype.evalPath=function(e){var t=this.path.eval(e),n=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(t instanceof i)){if(n){var r=t.value;r&&e.isPathRelative(r)&&(t.value=n+r)}t.value=e.normalizePath(t.value)}return t},u.prototype.eval=function(e){var t,n,i=this.features&&this.features.eval(e);if(this.options.plugin)return n=e.frames[0]&&e.frames[0].functionRegistry,n&&this.root&&this.root.functions&&n.addMultiple(this.root.functions),[];if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var o=new a(this.root,0,{filename:this.importedFilename,reference:this.path.currentFileInfo&&this.path.currentFileInfo.reference},!0,!0,!1);return this.features?new r([o],this.features.value):[o]}if(this.css){var l=new u(this.evalPath(e),i,this.options,this.index);if(!l.css&&this.error)throw this.error;return l}return t=new s(null,this.root.rules.slice(0)),t.evalImports(e),this.features?new r(t.rules,this.features.value):t.rules},t.exports=u},{"./anonymous":45,"./media":65,"./node":69,"./quoted":72,"./ruleset":75,"./url":79}],61:[function(e,t){var n={};n.Node=e("./node"),n.Alpha=e("./alpha"),n.Color=e("./color"),n.Directive=e("./directive"),n.DetachedRuleset=e("./detached-ruleset"),n.Operation=e("./operation"),n.Dimension=e("./dimension"),n.Unit=e("./unit"),n.Keyword=e("./keyword"),n.Variable=e("./variable"),n.Ruleset=e("./ruleset"),n.Element=e("./element"),n.Attribute=e("./attribute"),n.Combinator=e("./combinator"),n.Selector=e("./selector"),n.Quoted=e("./quoted"),n.Expression=e("./expression"),n.Rule=e("./rule"),n.Call=e("./call"),n.URL=e("./url"),n.Import=e("./import"),n.mixin={Call:e("./mixin-call"),Definition:e("./mixin-definition")},n.Comment=e("./comment"),n.Anonymous=e("./anonymous"),n.Value=e("./value"),n.JavaScript=e("./javascript"),n.Assignment=e("./assignment"),n.Condition=e("./condition"),n.Paren=e("./paren"),n.Media=e("./media"),n.UnicodeDescriptor=e("./unicode-descriptor"),n.Negative=e("./negative"),n.Extend=e("./extend"),n.RulesetCall=e("./ruleset-call"),t.exports=n},{"./alpha":44,"./anonymous":45,"./assignment":46,"./attribute":47,"./call":48,"./color":49,"./combinator":50,"./comment":51,"./condition":52,"./detached-ruleset":54,"./dimension":55,"./directive":56,"./element":57,"./expression":58,"./extend":59,"./import":60,"./javascript":62,"./keyword":64,"./media":65,"./mixin-call":66,"./mixin-definition":67,"./negative":68,"./node":69,"./operation":70,"./paren":71,"./quoted":72,"./rule":73,"./ruleset":75,"./ruleset-call":74,"./selector":76,"./unicode-descriptor":77,"./unit":78,"./url":79,"./value":80,"./variable":81}],62:[function(e,t){var n=e("./js-eval-node"),r=e("./dimension"),i=e("./quoted"),o=e("./anonymous"),s=function(e,t,n,r){this.escaped=t,this.expression=e,this.index=n,this.currentFileInfo=r};s.prototype=new n,s.prototype.type="JavaScript",s.prototype.eval=function(e){var t=this.evaluateJavaScript(this.expression,e);return"number"==typeof t?new r(t):"string"==typeof t?new i('"'+t+'"',t,this.escaped,this.index):new o(Array.isArray(t)?t.join(", "):t)},t.exports=s},{"./anonymous":45,"./dimension":55,"./js-eval-node":63,"./quoted":72}],63:[function(e,t){var n=e("./node"),r=e("./variable"),i=function(){};i.prototype=new n,i.prototype.evaluateJavaScript=function(e,t){var n,i=this,o={};if(void 0!==t.javascriptEnabled&&!t.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};e=e.replace(/@\{([\w-]+)\}/g,function(e,n){return i.jsify(new r("@"+n,i.index,i.currentFileInfo).eval(t))});try{e=new Function("return ("+e+")")}catch(s){throw{message:"JavaScript evaluation error: "+s.message+" from `"+e+"`",filename:this.currentFileInfo.filename,index:this.index}}var a=t.frames[0].variables();for(var u in a)a.hasOwnProperty(u)&&(o[u.slice(1)]={value:a[u].value,toJS:function(){return this.value.eval(t).toCSS()}});try{n=e.call(o)}catch(s){throw{message:"JavaScript evaluation error: '"+s.name+": "+s.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return n},i.prototype.jsify=function(e){return Array.isArray(e.value)&&e.value.length>1?"["+e.value.map(function(e){return e.toCSS()}).join(", ")+"]":e.toCSS()},t.exports=i},{"./node":69,"./variable":81}],64:[function(e,t){var n=e("./node"),r=function(e){this.value=e};r.prototype=new n,r.prototype.type="Keyword",r.prototype.genCSS=function(e,t){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};t.add(this.value)},r.True=new r("true"),r.False=new r("false"),t.exports=r},{"./node":69}],65:[function(e,t){var n=e("./ruleset"),r=e("./value"),i=e("./selector"),o=e("./anonymous"),s=e("./expression"),a=e("./directive"),u=function(e,t,o,s){this.index=o,this.currentFileInfo=s;var a=new i([],null,null,this.index,this.currentFileInfo).createEmptySelectors();this.features=new r(t),this.rules=[new n(a,e)],this.rules[0].allowImports=!0};u.prototype=new a,u.prototype.type="Media",u.prototype.isRulesetLike=!0,u.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.rules&&(this.rules=e.visitArray(this.rules))},u.prototype.genCSS=function(e,t){t.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(e,t),this.outputRuleset(e,t,this.rules)},u.prototype.eval=function(e){e.mediaBlocks||(e.mediaBlocks=[],e.mediaPath=[]);var t=new u(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,t.debugInfo=this.debugInfo);var n=!1;e.strictMath||(n=!0,e.strictMath=!0);try{t.features=this.features.eval(e)}finally{n&&(e.strictMath=!1)}return e.mediaPath.push(t),e.mediaBlocks.push(t),this.rules[0].functionRegistry=e.frames[0].functionRegistry.inherit(),e.frames.unshift(this.rules[0]),t.rules=[this.rules[0].eval(e)],e.frames.shift(),e.mediaPath.pop(),0===e.mediaPath.length?t.evalTop(e):t.evalNested(e)},u.prototype.evalTop=function(e){var t=this;if(e.mediaBlocks.length>1){var r=new i([],null,null,this.index,this.currentFileInfo).createEmptySelectors();t=new n(r,e.mediaBlocks),t.multiMedia=!0}return delete e.mediaBlocks,delete e.mediaPath,t},u.prototype.evalNested=function(e){var t,i,a=e.mediaPath.concat([this]);for(t=0;a.length>t;t++)i=a[t].features instanceof r?a[t].features.value:a[t].features,a[t]=Array.isArray(i)?i:[i];return this.features=new r(this.permute(a).map(function(e){for(e=e.map(function(e){return e.toCSS?e:new o(e)}),t=e.length-1;t>0;t--)e.splice(t,0,new o("and"));return new s(e)})),new n([],[])},u.prototype.permute=function(e){if(0===e.length)return[];if(1===e.length)return e[0];for(var t=[],n=this.permute(e.slice(1)),r=0;n.length>r;r++)for(var i=0;e[0].length>i;i++)t.push([e[0][i]].concat(n[r]));return t},u.prototype.bubbleSelectors=function(e){e&&(this.rules=[new n(e.slice(0),[this.rules[0]])])},t.exports=u},{"./anonymous":45,"./directive":56,"./expression":58,"./ruleset":75,"./selector":76,"./value":80}],66:[function(e,t){var n=e("./node"),r=e("./selector"),i=e("./mixin-definition"),o=e("../functions/default"),s=function(e,t,n,i,o){this.selector=new r(e),this.arguments=t||[],this.index=n,this.currentFileInfo=i,this.important=o};s.prototype=new n,s.prototype.type="MixinCall",s.prototype.accept=function(e){this.selector&&(this.selector=e.visit(this.selector)),this.arguments.length&&(this.arguments=e.visitArray(this.arguments))},s.prototype.eval=function(e){function t(t,n){var r,i,s;for(r=0;2>r;r++){for(I[r]=!0,o.value(r),i=0;n.length>i&&I[r];i++)s=n[i],s.matchCondition&&(I[r]=I[r]&&s.matchCondition(null,e));t.matchCondition&&(I[r]=I[r]&&t.matchCondition(x,e))}return I[0]||I[1]?I[0]!=I[1]?I[1]?R:F:M:k}var n,r,s,a,u,l,c,h,f,p,d,v,m,g,y,w,x=[],b=[],S=!1,C=[],I=[],k=-1,M=0,R=1,F=2;for(c=0;this.arguments.length>c;c++)if(a=this.arguments[c],u=a.value.eval(e),a.expand&&Array.isArray(u.value))for(u=u.value,h=0;u.length>h;h++)x.push({value:u[h]});else x.push({name:a.name,value:u});for(w=function(t){return t.matchArgs(null,e)},c=0;e.frames.length>c;c++)if((n=e.frames[c].find(this.selector,null,w)).length>0){for(d=!0,h=0;n.length>h;h++){for(r=n[h].rule,s=n[h].path,p=!1,f=0;e.frames.length>f;f++)if(!(r instanceof i)&&r===(e.frames[f].originalRuleset||e.frames[f])){p=!0;break}p||r.matchArgs(x,e)&&(v={mixin:r,group:t(r,s)},v.group!==k&&C.push(v),S=!0)}for(o.reset(),g=[0,0,0],h=0;C.length>h;h++)g[C[h].group]++;if(g[M]>0)m=F;else if(m=R,g[R]+g[F]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(x)+"`",index:this.index,filename:this.currentFileInfo.filename};for(h=0;C.length>h;h++)if(v=C[h].group,v===M||v===m)try{r=C[h].mixin,r instanceof i||(y=r.originalRuleset||r,r=new i("",[],r.rules,null,!1),r.originalRuleset=y),Array.prototype.push.apply(b,r.evalCall(e,x,this.important).rules)}catch(E){throw{message:E.message,index:this.index,filename:this.currentFileInfo.filename,stack:E.stack}}if(S){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(c=0;b.length>c;c++)l=b[c],l.markReferenced&&l.markReferenced();return b}}throw d?{type:"Runtime",message:"No matching definition was found for `"+this.format(x)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},s.prototype.format=function(e){return this.selector.toCSS().trim()+"("+(e?e.map(function(e){var t="";return e.name&&(t+=e.name+":"),t+=e.value.toCSS?e.value.toCSS():"???"}).join(", "):"")+")"},t.exports=s},{"../functions/default":19,"./mixin-definition":67,"./node":69,"./selector":76}],67:[function(e,t){var n=e("./selector"),r=e("./element"),i=e("./ruleset"),o=e("./rule"),s=e("./expression"),a=e("../contexts"),u=function(e,t,i,o,s,a){this.name=e,this.selectors=[new n([new r(null,e,this.index,this.currentFileInfo)])],this.params=t,this.condition=o,this.variadic=s,this.arity=t.length,this.rules=i,this._lookups={};var u=[];this.required=t.reduce(function(e,t){return!t.name||t.name&&!t.value?e+1:(u.push(t.name),e)},0),this.optionalParameters=u,this.frames=a};u.prototype=new i,u.prototype.type="MixinDefinition",u.prototype.evalFirst=!0,u.prototype.accept=function(e){this.params&&this.params.length&&(this.params=e.visitArray(this.params)),this.rules=e.visitArray(this.rules),this.condition&&(this.condition=e.visit(this.condition))},u.prototype.evalParams=function(e,t,n,r){var u,l,c,h,f,p,d,v,m=new i(null,null),g=this.params.slice(0),y=0;if(t.frames&&t.frames[0]&&t.frames[0].functionRegistry&&(m.functionRegistry=t.frames[0].functionRegistry.inherit()),t=new a.Eval(t,[m].concat(t.frames)),n)for(n=n.slice(0),y=n.length,c=0;y>c;c++)if(l=n[c],p=l&&l.name){for(d=!1,h=0;g.length>h;h++)if(!r[h]&&p===g[h].name){r[h]=l.value.eval(e),m.prependRule(new o(p,l.value.eval(e))),d=!0;break}if(d){n.splice(c,1),c--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+n[c].name+" not found"}}for(v=0,c=0;g.length>c;c++)if(!r[c]){if(l=n&&n[v],p=g[c].name)if(g[c].variadic){for(u=[],h=v;y>h;h++)u.push(n[h].value.eval(e));m.prependRule(new o(p,new s(u).eval(e)))}else{if(f=l&&l.value)f=f.eval(e);else{if(!g[c].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+y+" for "+this.arity+")"};f=g[c].value.eval(t),m.resetCache()}m.prependRule(new o(p,f)),r[c]=f}if(g[c].variadic&&n)for(h=v;y>h;h++)r[h]=n[h].value.eval(e);v++}return m},u.prototype.makeImportant=function(){var e=this.rules?this.rules.map(function(e){return e.makeImportant?e.makeImportant(!0):e}):this.rules,t=new u(this.name,this.params,e,this.condition,this.variadic,this.frames);return t},u.prototype.eval=function(e){return new u(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||e.frames.slice(0));
},u.prototype.evalCall=function(e,t,n){var r,u,l=[],c=this.frames?this.frames.concat(e.frames):e.frames,h=this.evalParams(e,new a.Eval(e,c),t,l);return h.prependRule(new o("@arguments",new s(l).eval(e))),r=this.rules.slice(0),u=new i(null,r),u.originalRuleset=this,u=u.eval(new a.Eval(e,[this,h].concat(c))),n&&(u=u.makeImportant()),u},u.prototype.matchCondition=function(e,t){return!this.condition||this.condition.eval(new a.Eval(t,[this.evalParams(t,new a.Eval(t,this.frames?this.frames.concat(t.frames):t.frames),e,[])].concat(this.frames||[]).concat(t.frames)))},u.prototype.matchArgs=function(e,t){var n,r=e&&e.length||0,i=this.optionalParameters,o=e?e.reduce(function(e,t){return i.indexOf(t.name)<0?e+1:e},0):0;if(this.variadic){if(this.required-1>o)return!1}else{if(this.required>o)return!1;if(r>this.params.length)return!1}n=Math.min(o,this.arity);for(var s=0;n>s;s++)if(!this.params[s].name&&!this.params[s].variadic&&e[s].value.eval(t).toCSS()!=this.params[s].value.eval(t).toCSS())return!1;return!0},t.exports=u},{"../contexts":10,"./element":57,"./expression":58,"./rule":73,"./ruleset":75,"./selector":76}],68:[function(e,t){var n=e("./node"),r=e("./operation"),i=e("./dimension"),o=function(e){this.value=e};o.prototype=new n,o.prototype.type="Negative",o.prototype.genCSS=function(e,t){t.add("-"),this.value.genCSS(e,t)},o.prototype.eval=function(e){return e.isMathOn()?new r("*",[new i(-1),this.value]).eval(e):new o(this.value.eval(e))},t.exports=o},{"./dimension":55,"./node":69,"./operation":70}],69:[function(e,t){var n=function(){};n.prototype.toCSS=function(e){var t=[];return this.genCSS(e,{add:function(e){t.push(e)},isEmpty:function(){return 0===t.length}}),t.join("")},n.prototype.genCSS=function(e,t){t.add(this.value)},n.prototype.accept=function(e){this.value=e.visit(this.value)},n.prototype.eval=function(){return this},n.prototype._operate=function(e,t,n,r){switch(t){case"+":return n+r;case"-":return n-r;case"*":return n*r;case"/":return n/r}},n.prototype.fround=function(e,t){var n=e&&e.numPrecision;return null==n?t:Number((t+2e-16).toFixed(n))},n.compare=function(e,t){if(e.compare&&"Quoted"!==t.type&&"Anonymous"!==t.type)return e.compare(t);if(t.compare)return-t.compare(e);if(e.type===t.type){if(e=e.value,t=t.value,!Array.isArray(e))return e===t?0:void 0;if(e.length===t.length){for(var r=0;e.length>r;r++)if(0!==n.compare(e[r],t[r]))return;return 0}}},n.numericCompare=function(e,t){return t>e?-1:e===t?0:e>t?1:void 0},t.exports=n},{}],70:[function(e,t){var n=e("./node"),r=e("./color"),i=e("./dimension"),o=function(e,t,n){this.op=e.trim(),this.operands=t,this.isSpaced=n};o.prototype=new n,o.prototype.type="Operation",o.prototype.accept=function(e){this.operands=e.visit(this.operands)},o.prototype.eval=function(e){var t=this.operands[0].eval(e),n=this.operands[1].eval(e);if(e.isMathOn()){if(t instanceof i&&n instanceof r&&(t=t.toColor()),n instanceof i&&t instanceof r&&(n=n.toColor()),!t.operate)throw{type:"Operation",message:"Operation on an invalid type"};return t.operate(e,this.op,n)}return new o(this.op,[t,n],this.isSpaced)},o.prototype.genCSS=function(e,t){this.operands[0].genCSS(e,t),this.isSpaced&&t.add(" "),t.add(this.op),this.isSpaced&&t.add(" "),this.operands[1].genCSS(e,t)},t.exports=o},{"./color":49,"./dimension":55,"./node":69}],71:[function(e,t){var n=e("./node"),r=function(e){this.value=e};r.prototype=new n,r.prototype.type="Paren",r.prototype.genCSS=function(e,t){t.add("("),this.value.genCSS(e,t),t.add(")")},r.prototype.eval=function(e){return new r(this.value.eval(e))},t.exports=r},{"./node":69}],72:[function(e,t){var n=e("./node"),r=e("./js-eval-node"),i=e("./variable"),o=function(e,t,n,r,i){this.escaped=null==n?!0:n,this.value=t||"",this.quote=e.charAt(0),this.index=r,this.currentFileInfo=i};o.prototype=new r,o.prototype.type="Quoted",o.prototype.genCSS=function(e,t){this.escaped||t.add(this.quote,this.currentFileInfo,this.index),t.add(this.value),this.escaped||t.add(this.quote)},o.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},o.prototype.eval=function(e){function t(e,t,n){var r=e;do e=r,r=e.replace(t,n);while(e!==r);return r}var n=this,r=this.value,s=function(t,r){return String(n.evaluateJavaScript(r,e))},a=function(t,r){var s=new i("@"+r,n.index,n.currentFileInfo).eval(e,!0);return s instanceof o?s.value:s.toCSS()};return r=t(r,/`([^`]+)`/g,s),r=t(r,/@\{([\w-]+)\}/g,a),new o(this.quote+r+this.quote,r,this.escaped,this.index,this.currentFileInfo)},o.prototype.compare=function(e){return"Quoted"!==e.type||this.escaped||e.escaped?e.toCSS&&this.toCSS()===e.toCSS()?0:void 0:n.numericCompare(this.value,e.value)},t.exports=o},{"./js-eval-node":63,"./node":69,"./variable":81}],73:[function(e,t){function n(e,t){var n,r="",i=t.length,o={add:function(e){r+=e}};for(n=0;i>n;n++)t[n].eval(e).genCSS(e,o);return r}var r=e("./node"),i=e("./value"),o=e("./keyword"),s=function(e,t,n,o,s,a,u,l){this.name=e,this.value=t instanceof r?t:new i([t]),this.important=n?" "+n.trim():"",this.merge=o,this.index=s,this.currentFileInfo=a,this.inline=u||!1,this.variable=void 0!==l?l:e.charAt&&"@"===e.charAt(0)};s.prototype=new r,s.prototype.type="Rule",s.prototype.genCSS=function(e,t){t.add(this.name+(e.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(e,t)}catch(n){throw n.index=this.index,n.filename=this.currentFileInfo.filename,n}t.add(this.important+(this.inline||e.lastRule&&e.compress?"":";"),this.currentFileInfo,this.index)},s.prototype.eval=function(e){var t,r=!1,i=this.name,a=this.variable;"string"!=typeof i&&(i=1===i.length&&i[0]instanceof o?i[0].value:n(e,i),a=!1),"font"!==i||e.strictMath||(r=!0,e.strictMath=!0);try{if(e.importantScope.push({}),t=this.value.eval(e),!this.variable&&"DetachedRuleset"===t.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var u=this.important,l=e.importantScope.pop();return!u&&l.important&&(u=l.important),new s(i,t,u,this.merge,this.index,this.currentFileInfo,this.inline,a)}catch(c){throw"number"!=typeof c.index&&(c.index=this.index,c.filename=this.currentFileInfo.filename),c}finally{r&&(e.strictMath=!1)}},s.prototype.makeImportant=function(){return new s(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)};var a=function(e){Array.isArray(e)?e.forEach(function(e){a(e)}):e.markReferenced&&e.markReferenced()};s.prototype.markReferenced=function(){this.value&&a(this.value)},t.exports=s},{"./keyword":64,"./node":69,"./value":80}],74:[function(e,t){var n=e("./node"),r=e("./variable"),i=function(e){this.variable=e};i.prototype=new n,i.prototype.type="RulesetCall",i.prototype.eval=function(e){var t=new r(this.variable).eval(e);return t.callEval(e)},t.exports=i},{"./node":69,"./variable":81}],75:[function(e,t){var n=e("./node"),r=e("./rule"),i=e("./selector"),o=e("./element"),s=e("./paren"),a=e("../contexts"),u=e("../functions/function-registry"),l=e("../functions/default"),c=e("./debug-info"),h=function(e,t,n){this.selectors=e,this.rules=t,this._lookups={},this.strictImports=n};h.prototype=new n,h.prototype.type="Ruleset",h.prototype.isRuleset=!0,h.prototype.isRulesetLike=!0,h.prototype.accept=function(e){this.paths?e.visitArray(this.paths,!0):this.selectors&&(this.selectors=e.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=e.visitArray(this.rules))},h.prototype.eval=function(e){var t,n,i,o,s=this.selectors,a=!1;if(s&&(n=s.length)){for(t=[],l.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),o=0;n>o;o++)i=s[o].eval(e),t.push(i),i.evaldCondition&&(a=!0);l.reset()}else a=!0;var c,f,p=this.rules?this.rules.slice(0):null,d=new h(t,p,this.strictImports);d.originalRuleset=this,d.root=this.root,d.firstRoot=this.firstRoot,d.allowImports=this.allowImports,this.debugInfo&&(d.debugInfo=this.debugInfo),a||(p.length=0),d.functionRegistry=function(e){for(var t,n=0,r=e.length;n!==r;++n)if(t=e[n].functionRegistry)return t;return u}(e.frames).inherit();var v=e.frames;v.unshift(d);var m=e.selectors;m||(e.selectors=m=[]),m.unshift(this.selectors),(d.root||d.allowImports||!d.strictImports)&&d.evalImports(e);var g=d.rules,y=g?g.length:0;for(o=0;y>o;o++)g[o].evalFirst&&(g[o]=g[o].eval(e));var w=e.mediaBlocks&&e.mediaBlocks.length||0;for(o=0;y>o;o++)"MixinCall"===g[o].type?(p=g[o].eval(e).filter(function(e){return e instanceof r&&e.variable?!d.variable(e.name):!0}),g.splice.apply(g,[o,1].concat(p)),y+=p.length-1,o+=p.length-1,d.resetCache()):"RulesetCall"===g[o].type&&(p=g[o].eval(e).rules.filter(function(e){return!(e instanceof r&&e.variable)}),g.splice.apply(g,[o,1].concat(p)),y+=p.length-1,o+=p.length-1,d.resetCache());for(o=0;g.length>o;o++)c=g[o],c.evalFirst||(g[o]=c=c.eval?c.eval(e):c);for(o=0;g.length>o;o++)if(c=g[o],c instanceof h&&c.selectors&&1===c.selectors.length&&c.selectors[0].isJustParentSelector()){g.splice(o--,1);for(var x=0;c.rules.length>x;x++)f=c.rules[x],f instanceof r&&f.variable||g.splice(++o,0,f)}if(v.shift(),m.shift(),e.mediaBlocks)for(o=w;e.mediaBlocks.length>o;o++)e.mediaBlocks[o].bubbleSelectors(t);return d},h.prototype.evalImports=function(e){var t,n,r=this.rules;if(r)for(t=0;r.length>t;t++)"Import"===r[t].type&&(n=r[t].eval(e),n&&n.length?(r.splice.apply(r,[t,1].concat(n)),t+=n.length-1):r.splice(t,1,n),this.resetCache())},h.prototype.makeImportant=function(){var e=new h(this.selectors,this.rules.map(function(e){return e.makeImportant?e.makeImportant():e}),this.strictImports);return e},h.prototype.matchArgs=function(e){return!e||0===e.length},h.prototype.matchCondition=function(e,t){var n=this.selectors[this.selectors.length-1];return n.evaldCondition?!n.condition||n.condition.eval(new a.Eval(t,t.frames)):!1},h.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},h.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(e,t){if(t instanceof r&&t.variable===!0&&(e[t.name]=t),"Import"===t.type&&t.root&&t.root.variables){var n=t.root.variables();for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e},{}):{}),this._variables},h.prototype.variable=function(e){return this.variables()[e]},h.prototype.rulesets=function(){if(!this.rules)return[];var e,t,n=[],r=this.rules,i=r.length;for(e=0;i>e;e++)t=r[e],t.isRuleset&&n.push(t);return n},h.prototype.prependRule=function(e){var t=this.rules;t?t.unshift(e):this.rules=[e]},h.prototype.find=function(e,t,n){t=t||this;var r,o,s=[],a=e.toCSS();return a in this._lookups?this._lookups[a]:(this.rulesets().forEach(function(a){if(a!==t)for(var u=0;a.selectors.length>u;u++)if(r=e.match(a.selectors[u])){if(e.elements.length>r){if(!n||n(a)){o=a.find(new i(e.elements.slice(r)),t,n);for(var l=0;o.length>l;++l)o[l].path.push(a);Array.prototype.push.apply(s,o)}}else s.push({rule:a,path:[]});break}}),this._lookups[a]=s,s)},h.prototype.genCSS=function(e,t){function n(e){return"boolean"==typeof e.isRulesetLike?e.isRulesetLike:"function"==typeof e.isRulesetLike?e.isRulesetLike():!1}var r,i,o,s,a,u=[],l=[];e.tabLevel=e.tabLevel||0,this.root||e.tabLevel++;var h,f=e.compress?"":Array(e.tabLevel+1).join("  "),p=e.compress?"":Array(e.tabLevel).join("  "),d=0,v=0;for(r=0;this.rules.length>r;r++)s=this.rules[r],"Comment"===s.type?(v===r&&v++,l.push(s)):s.isCharset&&s.isCharset()?(l.splice(d,0,s),d++,v++):"Import"===s.type?(l.splice(v,0,s),v++):l.push(s);if(l=u.concat(l),!this.root){o=c(e,this,p),o&&(t.add(o),t.add(p));var m,g=this.paths,y=g.length;for(h=e.compress?",":",\n"+p,r=0;y>r;r++)if(a=g[r],m=a.length)for(r>0&&t.add(h),e.firstSelector=!0,a[0].genCSS(e,t),e.firstSelector=!1,i=1;m>i;i++)a[i].genCSS(e,t);t.add((e.compress?"{":" {\n")+f)}for(r=0;l.length>r;r++){s=l[r],r+1===l.length&&(e.lastRule=!0);var w=e.lastRule;n(s)&&(e.lastRule=!1),s.genCSS?s.genCSS(e,t):s.value&&t.add(s.value.toString()),e.lastRule=w,e.lastRule?e.lastRule=!1:t.add(e.compress?"":"\n"+f)}this.root||(t.add(e.compress?"}":"\n"+p+"}"),e.tabLevel--),t.isEmpty()||e.compress||!this.firstRoot||t.add("\n")},h.prototype.markReferenced=function(){var e;if(this.selectors)for(e=0;this.selectors.length>e;e++)this.selectors[e].markReferenced();if(this.rules)for(e=0;this.rules.length>e;e++)this.rules[e].markReferenced&&this.rules[e].markReferenced()},h.prototype.getIsReferenced=function(){var e,t,n,r;if(this.paths)for(e=0;this.paths.length>e;e++)for(n=this.paths[e],t=0;n.length>t;t++)if(n[t].getIsReferenced&&n[t].getIsReferenced())return!0;if(this.selectors)for(e=0;this.selectors.length>e;e++)if(r=this.selectors[e],r.getIsReferenced&&r.getIsReferenced())return!0;return!1},h.prototype.joinSelectors=function(e,t,n){for(var r=0;n.length>r;r++)this.joinSelector(e,t,n[r])},h.prototype.joinSelector=function(e,t,n){function r(e,t){var n,r;if(0===e.length)n=new s(e[0]);else{var a=[];for(r=0;e.length>r;r++)a.push(new o(null,e[r],t.index,t.currentFileInfo));n=new s(new i(a))}return n}function a(e,t){var n,r;return n=new o(null,e,t.index,t.currentFileInfo),r=new i([n])}function u(e,t,n){function i(e){var t;return"Paren"!==e.value.type?null:(t=e.value.value,"Selector"!==t.type?null:t)}var s,f,p,d,v,m,g,y,w,x,b=!1;for(d=[],v=[[]],s=0;n.elements.length>s;s++)if(y=n.elements[s],"&"!==y.value){var S=i(y);if(null!=S){h(d,v);var C,I=[],k=[];for(C=u(I,t,S),b=b||C,p=0;I.length>p;p++){var M=a(r(I[p],y),y);c(v,[M],y,n,k)}v=k,d=[]}else d.push(y)}else{for(b=!0,m=[],h(d,v),f=0;v.length>f;f++)if(g=v[f],0===t.length)g.length>0&&g[0].elements.push(new o(y.combinator,"",y.index,y.currentFileInfo)),m.push(g);else for(p=0;t.length>p;p++){var R=l(g,t[p],y,n);m.push(R)}v=m,d=[]}for(h(d,v),s=0;v.length>s;s++)w=v[s].length,w>0&&(e.push(v[s]),x=v[s][w-1],v[s][w-1]=x.createDerived(x.elements,n.extendList));return b}function l(e,t,n,r){var i,s,a;if(i=[],e.length>0?(i=e.slice(0),s=i.pop(),a=r.createDerived(s.elements.slice(0))):a=r.createDerived([]),t.length>0){var u=n.combinator,l=t[0].elements[0];u.emptyOrWhitespace&&!l.combinator.emptyOrWhitespace&&(u=l.combinator),a.elements.push(new o(u,l.value,n.index,n.currentFileInfo)),a.elements=a.elements.concat(t[0].elements.slice(1))}return 0!==a.elements.length&&i.push(a),t.length>1&&(i=i.concat(t.slice(1))),i}function c(e,t,n,r,i){var o;for(o=0;e.length>o;o++){var s=l(e[o],t,n,r);i.push(s)}return i}function h(e,t){var n,r;if(0!==e.length){if(0===t.length)return void t.push([new i(e)]);for(n=0;t.length>n;n++)r=t[n],r.length>0?r[r.length-1]=r[r.length-1].createDerived(r[r.length-1].elements.concat(e)):r.push(new i(e))}}var f,p,d;if(p=[],d=u(p,t,n),!d)if(t.length>0)for(p=[],f=0;t.length>f;f++)p.push(t[f].concat(n));else p=[[n]];for(f=0;p.length>f;f++)e.push(p[f])},t.exports=h},{"../contexts":10,"../functions/default":19,"../functions/function-registry":21,"./debug-info":53,"./element":57,"./node":69,"./paren":71,"./rule":73,"./selector":76}],76:[function(e,t){var n=e("./node"),r=e("./element"),i=function(e,t,n,r,i,o){this.elements=e,this.extendList=t,this.condition=n,this.currentFileInfo=i||{},this.isReferenced=o,n||(this.evaldCondition=!0)};i.prototype=new n,i.prototype.type="Selector",i.prototype.accept=function(e){this.elements&&(this.elements=e.visitArray(this.elements)),this.extendList&&(this.extendList=e.visitArray(this.extendList)),this.condition&&(this.condition=e.visit(this.condition))},i.prototype.createDerived=function(e,t,n){n=null!=n?n:this.evaldCondition;var r=new i(e,t||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return r.evaldCondition=n,r.mediaEmpty=this.mediaEmpty,r},i.prototype.createEmptySelectors=function(){var e=new r("","&",this.index,this.currentFileInfo),t=[new i([e],null,null,this.index,this.currentFileInfo)];return t[0].mediaEmpty=!0,t},i.prototype.match=function(e){var t,n,r=this.elements,i=r.length;if(e.CacheElements(),t=e._elements.length,0===t||t>i)return 0;for(n=0;t>n;n++)if(r[n].value!==e._elements[n])return 0;return t},i.prototype.CacheElements=function(){if(!this._elements){var e=this.elements.map(function(e){return e.combinator.value+(e.value.value||e.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);e?"&"===e[0]&&e.shift():e=[],this._elements=e}},i.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},i.prototype.eval=function(e){var t=this.condition&&this.condition.eval(e),n=this.elements,r=this.extendList;return n=n&&n.map(function(t){return t.eval(e)}),r=r&&r.map(function(t){return t.eval(e)}),this.createDerived(n,r,t)},i.prototype.genCSS=function(e,t){var n,r;if(e&&e.firstSelector||""!==this.elements[0].combinator.value||t.add(" ",this.currentFileInfo,this.index),!this._css)for(n=0;this.elements.length>n;n++)r=this.elements[n],r.genCSS(e,t)},i.prototype.markReferenced=function(){this.isReferenced=!0},i.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},i.prototype.getIsOutput=function(){return this.evaldCondition},t.exports=i},{"./element":57,"./node":69}],77:[function(e,t){var n=e("./node"),r=function(e){this.value=e};r.prototype=new n,r.prototype.type="UnicodeDescriptor",t.exports=r},{"./node":69}],78:[function(e,t){var n=e("./node"),r=e("../data/unit-conversions"),i=function(e,t,n){this.numerator=e?e.slice(0).sort():[],this.denominator=t?t.slice(0).sort():[],n?this.backupUnit=n:e&&e.length&&(this.backupUnit=e[0])};i.prototype=new n,i.prototype.type="Unit",i.prototype.clone=function(){return new i(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},i.prototype.genCSS=function(e,t){var n=e&&e.strictUnits;1===this.numerator.length?t.add(this.numerator[0]):!n&&this.backupUnit?t.add(this.backupUnit):!n&&this.denominator.length&&t.add(this.denominator[0])},i.prototype.toString=function(){var e,t=this.numerator.join("*");for(e=0;this.denominator.length>e;e++)t+="/"+this.denominator[e];return t},i.prototype.compare=function(e){return this.is(e.toString())?0:void 0},i.prototype.is=function(e){return this.toString().toUpperCase()===e.toUpperCase()},i.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},i.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},i.prototype.isSingular=function(){return 1>=this.numerator.length&&0===this.denominator.length},i.prototype.map=function(e){var t;for(t=0;this.numerator.length>t;t++)this.numerator[t]=e(this.numerator[t],!1);for(t=0;this.denominator.length>t;t++)this.denominator[t]=e(this.denominator[t],!0)},i.prototype.usedUnits=function(){var e,t,n={};t=function(t){return e.hasOwnProperty(t)&&!n[i]&&(n[i]=t),t};for(var i in r)r.hasOwnProperty(i)&&(e=r[i],this.map(t));return n},i.prototype.cancel=function(){var e,t,n={};for(t=0;this.numerator.length>t;t++)e=this.numerator[t],n[e]=(n[e]||0)+1;for(t=0;this.denominator.length>t;t++)e=this.denominator[t],n[e]=(n[e]||0)-1;this.numerator=[],this.denominator=[];for(e in n)if(n.hasOwnProperty(e)){var r=n[e];if(r>0)for(t=0;r>t;t++)this.numerator.push(e);else if(0>r)for(t=0;-r>t;t++)this.denominator.push(e)}this.numerator.sort(),this.denominator.sort()},t.exports=i},{"../data/unit-conversions":13,"./node":69}],79:[function(e,t){var n=e("./node"),r=function(e,t,n,r){this.value=e,this.currentFileInfo=n,this.index=t,this.isEvald=r};r.prototype=new n,r.prototype.type="Url",r.prototype.accept=function(e){this.value=e.visit(this.value)},r.prototype.genCSS=function(e,t){t.add("url("),this.value.genCSS(e,t),t.add(")")},r.prototype.eval=function(e){var t,n=this.value.eval(e);if(!this.isEvald&&(t=this.currentFileInfo&&this.currentFileInfo.rootpath,t&&"string"==typeof n.value&&e.isPathRelative(n.value)&&(n.quote||(t=t.replace(/[\(\)'"\s]/g,function(e){return"\\"+e})),n.value=t+n.value),n.value=e.normalizePath(n.value),e.urlArgs&&!n.value.match(/^\s*data:/))){var i=-1===n.value.indexOf("?")?"?":"&",o=i+e.urlArgs;-1!==n.value.indexOf("#")?n.value=n.value.replace("#",o+"#"):n.value+=o}return new r(n,this.index,this.currentFileInfo,!0)},t.exports=r},{"./node":69}],80:[function(e,t){var n=e("./node"),r=function(e){if(this.value=e,!e)throw new Error("Value requires an array argument")};r.prototype=new n,r.prototype.type="Value",r.prototype.accept=function(e){this.value&&(this.value=e.visitArray(this.value))},r.prototype.eval=function(e){return 1===this.value.length?this.value[0].eval(e):new r(this.value.map(function(t){return t.eval(e)}))},r.prototype.genCSS=function(e,t){var n;for(n=0;this.value.length>n;n++)this.value[n].genCSS(e,t),this.value.length>n+1&&t.add(e&&e.compress?",":", ")},t.exports=r},{"./node":69}],81:[function(e,t){var n=e("./node"),r=function(e,t,n){this.name=e,this.index=t,this.currentFileInfo=n||{}};r.prototype=new n,r.prototype.type="Variable",r.prototype.eval=function(e){var t,n=this.name;if(0===n.indexOf("@@")&&(n="@"+new r(n.slice(1),this.index,this.currentFileInfo).eval(e).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+n,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,t=this.find(e.frames,function(t){var r=t.variable(n);if(r){if(r.important){var i=e.importantScope[e.importantScope.length-1];i.important=r.important}return r.value.eval(e)}}))return this.evaluating=!1,t;throw{type:"Name",message:"variable "+n+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},r.prototype.find=function(e,t){for(var n,r=0;e.length>r;r++)if(n=t.call(e,e[r]))return n;return null},t.exports=r},{"./node":69}],82:[function(e,t){t.exports={getLocation:function(e,t){for(var n=e+1,r=null,i=-1;--n>=0&&"\n"!==t.charAt(n);)i++;return"number"==typeof e&&(r=(t.slice(0,e).match(/\n/g)||"").length),{line:r,column:i}}}},{}],83:[function(e,t){var n=e("../tree"),r=e("./visitor"),i=e("../logger"),o=function(){this._visitor=new r(this),this.contexts=[],this.allExtendsStack=[[]]};o.prototype={run:function(e){return e=this._visitor.visit(e),e.allExtends=this.allExtendsStack[0],e},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitRuleset:function(e){if(!e.root){var t,r,i,o,s=[],a=e.rules,u=a?a.length:0;for(t=0;u>t;t++)e.rules[t]instanceof n.Extend&&(s.push(a[t]),e.extendOnEveryPath=!0);var l=e.paths;for(t=0;l.length>t;t++){var c=l[t],h=c[c.length-1],f=h.extendList;for(o=f?f.slice(0).concat(s):s,o&&(o=o.map(function(e){return e.clone()})),r=0;o.length>r;r++)this.foundExtends=!0,i=o[r],i.findSelfSelectors(c),i.ruleset=e,0===r&&(i.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(i)}this.contexts.push(e.selectors)}},visitRulesetOut:function(e){e.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(e){e.allExtends=[],this.allExtendsStack.push(e.allExtends)},visitMediaOut:function(){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(e){e.allExtends=[],this.allExtendsStack.push(e.allExtends)},visitDirectiveOut:function(){this.allExtendsStack.length=this.allExtendsStack.length-1}};var s=function(){this._visitor=new r(this)};s.prototype={run:function(e){var t=new o;if(this.extendIndicies={},t.run(e),!t.foundExtends)return e;e.allExtends=e.allExtends.concat(this.doExtendChaining(e.allExtends,e.allExtends)),this.allExtendsStack=[e.allExtends];var n=this._visitor.visit(e);return this.checkExtendsForNonMatched(e.allExtends),n},checkExtendsForNonMatched:function(e){var t=this.extendIndicies;e.filter(function(e){return!e.hasFoundMatches&&1==e.parent_ids.length}).forEach(function(e){var n="_unknown_";try{n=e.selector.toCSS({})}catch(r){}t[e.index+" "+n]||(t[e.index+" "+n]=!0,i.warn("extend '"+n+"' has no matches"))})},doExtendChaining:function(e,t,r){var i,o,s,a,u,l,c,h,f=[],p=this;for(r=r||0,i=0;e.length>i;i++)for(o=0;t.length>o;o++)l=e[i],c=t[o],l.parent_ids.indexOf(c.object_id)>=0||(u=[c.selfSelectors[0]],s=p.findMatch(l,u),s.length&&(l.hasFoundMatches=!0,l.selfSelectors.forEach(function(e){a=p.extendSelector(s,u,e),h=new n.Extend(c.selector,c.option,0),h.selfSelectors=a,a[a.length-1].extendList=[h],f.push(h),h.ruleset=c.ruleset,h.parent_ids=h.parent_ids.concat(c.parent_ids,l.parent_ids),c.firstExtendOnThisSelectorPath&&(h.firstExtendOnThisSelectorPath=!0,c.ruleset.paths.push(a))})));if(f.length){if(this.extendChainCount++,r>100){var d="{unable to calculate}",v="{unable to calculate}";try{d=f[0].selfSelectors[0].toCSS(),v=f[0].selector.toCSS()}catch(m){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+d+":extend("+v+")"}}return f.concat(p.doExtendChaining(f,t,r+1))}return f},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitSelector:function(e,t){t.visitDeeper=!1},visitRuleset:function(e){if(!e.root){var t,n,r,i,o=this.allExtendsStack[this.allExtendsStack.length-1],s=[],a=this;for(r=0;o.length>r;r++)for(n=0;e.paths.length>n;n++)if(i=e.paths[n],!e.extendOnEveryPath){var u=i[i.length-1].extendList;u&&u.length||(t=this.findMatch(o[r],i),t.length&&(o[r].hasFoundMatches=!0,o[r].selfSelectors.forEach(function(e){s.push(a.extendSelector(t,i,e))})))}e.paths=e.paths.concat(s)}},findMatch:function(e,t){var n,r,i,o,s,a,u,l=this,c=e.selector.elements,h=[],f=[];for(n=0;t.length>n;n++)for(r=t[n],i=0;r.elements.length>i;i++)for(o=r.elements[i],(e.allowBefore||0===n&&0===i)&&h.push({pathIndex:n,index:i,matched:0,initialCombinator:o.combinator}),a=0;h.length>a;a++)u=h[a],s=o.combinator.value,""===s&&0===i&&(s=" "),!l.isElementValuesEqual(c[u.matched].value,o.value)||u.matched>0&&c[u.matched].combinator.value!==s?u=null:u.matched++,u&&(u.finished=u.matched===c.length,u.finished&&!e.allowAfter&&(r.elements.length>i+1||t.length>n+1)&&(u=null)),u?u.finished&&(u.length=c.length,u.endPathIndex=n,u.endPathElementIndex=i+1,h.length=0,f.push(u)):(h.splice(a,1),a--);return f},isElementValuesEqual:function(e,t){if("string"==typeof e||"string"==typeof t)return e===t;if(e instanceof n.Attribute)return e.op!==t.op||e.key!==t.key?!1:e.value&&t.value?(e=e.value.value||e.value,t=t.value.value||t.value,e===t):!e.value&&!t.value;if(e=e.value,t=t.value,e instanceof n.Selector){if(!(t instanceof n.Selector)||e.elements.length!==t.elements.length)return!1;for(var r=0;e.elements.length>r;r++){if(e.elements[r].combinator.value!==t.elements[r].combinator.value&&(0!==r||(e.elements[r].combinator.value||" ")!==(t.elements[r].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(e.elements[r].value,t.elements[r].value))return!1}return!0}return!1},extendSelector:function(e,t,r){var i,o,s,a,u,l=0,c=0,h=[];for(i=0;e.length>i;i++)a=e[i],o=t[a.pathIndex],s=new n.Element(a.initialCombinator,r.elements[0].value,r.elements[0].index,r.elements[0].currentFileInfo),a.pathIndex>l&&c>0&&(h[h.length-1].elements=h[h.length-1].elements.concat(t[l].elements.slice(c)),c=0,l++),u=o.elements.slice(c,a.index).concat([s]).concat(r.elements.slice(1)),l===a.pathIndex&&i>0?h[h.length-1].elements=h[h.length-1].elements.concat(u):(h=h.concat(t.slice(l,a.pathIndex)),h.push(new n.Selector(u))),l=a.endPathIndex,c=a.endPathElementIndex,c>=t[l].elements.length&&(c=0,l++);return t.length>l&&c>0&&(h[h.length-1].elements=h[h.length-1].elements.concat(t[l].elements.slice(c)),l++),h=h.concat(t.slice(l,t.length))},visitRulesetOut:function(){},visitMedia:function(e){var t=e.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);t=t.concat(this.doExtendChaining(t,e.allExtends)),this.allExtendsStack.push(t)},visitMediaOut:function(){var e=this.allExtendsStack.length-1;this.allExtendsStack.length=e},visitDirective:function(e){var t=e.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);t=t.concat(this.doExtendChaining(t,e.allExtends)),this.allExtendsStack.push(t)},visitDirectiveOut:function(){var e=this.allExtendsStack.length-1;this.allExtendsStack.length=e}},t.exports=s},{"../logger":32,"../tree":61,"./visitor":89}],84:[function(e,t){function n(e){this.imports=[],this.variableImports=[],this._onSequencerEmpty=e,this._currentDepth=0}n.prototype.addImport=function(e){var t=this,n={callback:e,args:null,isReady:!1};return this.imports.push(n),function(){n.args=Array.prototype.slice.call(arguments,0),n.isReady=!0,t.tryRun()}},n.prototype.addVariableImport=function(e){this.variableImports.push(e)},n.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var e=this.imports[0];if(!e.isReady)return;this.imports=this.imports.slice(1),e.callback.apply(null,e.args)}if(0===this.variableImports.length)break;var t=this.variableImports[0];this.variableImports=this.variableImports.slice(1),t()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},t.exports=n},{}],85:[function(e,t){var n=e("../contexts"),r=e("./visitor"),i=e("./import-sequencer"),o=function(e,t){this._visitor=new r(this),this._importer=e,this._finish=t,this.context=new n.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new i(this._onSequencerEmpty.bind(this))};o.prototype={isReplacing:!1,run:function(e){try{this._visitor.visit(e)}catch(t){this.error=t}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(e,t){var r=e.options.inline;if(!e.css||r){var i=new n.Eval(this.context,this.context.frames.slice(0)),o=i.frames[0];this.importCount++,e.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,e,i,o)):this.processImportNode(e,i,o)}t.visitDeeper=!1},processImportNode:function(e,t,n){var r,i=e.options.inline;try{r=e.evalForImport(t)}catch(o){o.filename||(o.index=e.index,o.filename=e.currentFileInfo.filename),e.css=!0,e.error=o}if(!r||r.css&&!i)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{r.options.multiple&&(t.importMultiple=!0);for(var s=void 0===r.css,a=0;n.rules.length>a;a++)if(n.rules[a]===e){n.rules[a]=r;break}var u=this.onImported.bind(this,r,t),l=this._sequencer.addImport(u);this._importer.push(r.getPath(),s,r.currentFileInfo,r.options,l)}},onImported:function(e,t,n,r,i,o){n&&(n.filename||(n.index=e.index,n.filename=e.currentFileInfo.filename),this.error=n);var s=this,a=e.options.inline,u=e.options.plugin,l=e.options.optional,c=i||o in s.recursionDetector;if(t.importMultiple||(e.skip=c?!0:function(){return o in s.onceFileDetectionMap?!0:(s.onceFileDetectionMap[o]=!0,!1)}),!o&&l&&(e.skip=!0),r&&(e.root=r,e.importedFilename=o,!(a||u||!t.importMultiple&&c))){s.recursionDetector[o]=!0;var h=this.context;this.context=t;try{this._visitor.visit(r)}catch(n){this.error=n}this.context=h}s.importCount--,s.isFinished&&s._sequencer.tryRun()},visitRule:function(e,t){"DetachedRuleset"===e.value.type?this.context.frames.unshift(e):t.visitDeeper=!1},visitRuleOut:function(e){"DetachedRuleset"===e.value.type&&this.context.frames.shift()},visitDirective:function(e){this.context.frames.unshift(e)},visitDirectiveOut:function(){this.context.frames.shift()},visitMixinDefinition:function(e){this.context.frames.unshift(e)},visitMixinDefinitionOut:function(){this.context.frames.shift()},visitRuleset:function(e){this.context.frames.unshift(e)},visitRulesetOut:function(){this.context.frames.shift()},visitMedia:function(e){this.context.frames.unshift(e.rules[0])},visitMediaOut:function(){this.context.frames.shift()}},t.exports=o},{"../contexts":10,"./import-sequencer":84,"./visitor":89}],86:[function(e,t){var n={Visitor:e("./visitor"),ImportVisitor:e("./import-visitor"),ExtendVisitor:e("./extend-visitor"),JoinSelectorVisitor:e("./join-selector-visitor"),ToCSSVisitor:e("./to-css-visitor")};t.exports=n},{"./extend-visitor":83,"./import-visitor":85,"./join-selector-visitor":87,"./to-css-visitor":88,"./visitor":89}],87:[function(e,t){var n=e("./visitor"),r=function(){this.contexts=[[]],this._visitor=new n(this)};r.prototype={run:function(e){return this._visitor.visit(e)},visitRule:function(e,t){t.visitDeeper=!1;
},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitRuleset:function(e){var t,n=this.contexts[this.contexts.length-1],r=[];this.contexts.push(r),e.root||(t=e.selectors,t&&(t=t.filter(function(e){return e.getIsOutput()}),e.selectors=t.length?t:t=null,t&&e.joinSelectors(r,n,t)),t||(e.rules=null),e.paths=r)},visitRulesetOut:function(){this.contexts.length=this.contexts.length-1},visitMedia:function(e){var t=this.contexts[this.contexts.length-1];e.rules[0].root=0===t.length||t[0].multiMedia},visitDirective:function(e){var t=this.contexts[this.contexts.length-1];e.rules&&e.rules.length&&(e.rules[0].root=e.isRooted||0===t.length||null)}},t.exports=r},{"./visitor":89}],88:[function(e,t){var n=e("../tree"),r=e("./visitor"),i=function(e){this._visitor=new r(this),this._context=e};i.prototype={isReplacing:!0,run:function(e){return this._visitor.visit(e)},visitRule:function(e){return e.variable?void 0:e},visitMixinDefinition:function(e){e.frames=[]},visitExtend:function(){},visitComment:function(e){return e.isSilent(this._context)?void 0:e},visitMedia:function(e,t){return e.accept(this._visitor),t.visitDeeper=!1,e.rules.length?e:void 0},visitImport:function(e){return void 0!==e.path.currentFileInfo.reference&&e.css?void 0:e},visitDirective:function(e,t){function r(e){var t,n=e.rules;1!==n.length||n[0].paths&&0!==n[0].paths.length||(n=n[0].rules);for(var r=0;n.length>r;r++)if(t=n[r],t.getIsReferenced&&t.getIsReferenced())return!0;return!1}if("@charset"===e.name){if(!e.getIsReferenced())return;if(this.charset){if(e.debugInfo){var i=new n.Comment("/* "+e.toCSS(this._context).replace(/\n/g,"")+" */\n");return i.debugInfo=e.debugInfo,this._visitor.visit(i)}return}this.charset=!0}if(e.rules&&e.rules.length){if(this._mergeRules(e.rules[0].rules),e.accept(this._visitor),t.visitDeeper=!1,e.getIsReferenced())return e;if(!e.rules||!e.rules.length)return;if(r(e))return e.markReferenced(),e}else if(e.getIsReferenced())return e},checkPropertiesInRoot:function(e){for(var t,r=0;e.length>r;r++)if(t=e[r],t instanceof n.Rule&&!t.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:t.index,filename:t.currentFileInfo?t.currentFileInfo.filename:null}},visitRuleset:function(e,t){var r,i=[];if(e.firstRoot&&this.checkPropertiesInRoot(e.rules),e.root)e.accept(this._visitor),t.visitDeeper=!1,(e.firstRoot||e.rules&&e.rules.length>0)&&i.splice(0,0,e);else{e.paths&&(e.paths=e.paths.filter(function(e){var t;for(" "===e[0].elements[0].combinator.value&&(e[0].elements[0].combinator=new n.Combinator("")),t=0;e.length>t;t++)if(e[t].getIsReferenced()&&e[t].getIsOutput())return!0;return!1}));for(var o=e.rules,s=o?o.length:0,a=0;s>a;)r=o[a],r&&r.rules?(i.push(this._visitor.visit(r)),o.splice(a,1),s--):a++;s>0?e.accept(this._visitor):e.rules=null,t.visitDeeper=!1,o=e.rules,o&&(this._mergeRules(o),o=e.rules),o&&(this._removeDuplicateRules(o),o=e.rules),o&&o.length>0&&e.paths.length>0&&i.splice(0,0,e)}return 1===i.length?i[0]:i},_removeDuplicateRules:function(e){if(e){var t,r,i,o={};for(i=e.length-1;i>=0;i--)if(r=e[i],r instanceof n.Rule)if(o[r.name]){t=o[r.name],t instanceof n.Rule&&(t=o[r.name]=[o[r.name].toCSS(this._context)]);var s=r.toCSS(this._context);-1!==t.indexOf(s)?e.splice(i,1):t.push(s)}else o[r.name]=r}},_mergeRules:function(e){if(e){for(var t,r,i,o={},s=0;e.length>s;s++)r=e[s],r instanceof n.Rule&&r.merge&&(i=[r.name,r.important?"!":""].join(","),o[i]?e.splice(s--,1):o[i]=[],o[i].push(r));Object.keys(o).map(function(e){function i(e){return new n.Expression(e.map(function(e){return e.value}))}function s(e){return new n.Value(e.map(function(e){return e}))}if(t=o[e],t.length>1){r=t[0];var a=[],u=[];t.map(function(e){"+"===e.merge&&(u.length>0&&a.push(i(u)),u=[]),u.push(e)}),a.push(i(u)),r.value=s(a)}})}},visitAnonymous:function(e){return e.getIsReferenced()?(e.accept(this._visitor),e):void 0}},t.exports=i},{"../tree":61,"./visitor":89}],89:[function(e,t){function n(e){return e}function r(e,t){var n,i;for(n in e)if(e.hasOwnProperty(n))switch(i=e[n],typeof i){case"function":i.prototype&&i.prototype.type&&(i.prototype.typeIndex=t++);break;case"object":t=r(i,t)}return t}var i=e("../tree"),o={visitDeeper:!0},s=!1,a=function(e){this._implementation=e,this._visitFnCache=[],s||(r(i,1),s=!0)};a.prototype={visit:function(e){if(!e)return e;var t=e.typeIndex;if(!t)return e;var r,i=this._visitFnCache,s=this._implementation,a=t<<1,u=1|a,l=i[a],c=i[u],h=o;if(h.visitDeeper=!0,l||(r="visit"+e.type,l=s[r]||n,c=s[r+"Out"]||n,i[a]=l,i[u]=c),l!==n){var f=l.call(s,e,h);s.isReplacing&&(e=f)}return h.visitDeeper&&e&&e.accept&&e.accept(this),c!=n&&c.call(s,e),e},visitArray:function(e,t){if(!e)return e;var n,r=e.length;if(t||!this._implementation.isReplacing){for(n=0;r>n;n++)this.visit(e[n]);return e}var i=[];for(n=0;r>n;n++){var o=this.visit(e[n]);void 0!==o&&(o.splice?o.length&&this.flatten(o,i):i.push(o))}return i},flatten:function(e,t){t||(t=[]);var n,r,i,o,s,a;for(r=0,n=e.length;n>r;r++)if(i=e[r],void 0!==i)if(i.splice)for(s=0,o=i.length;o>s;s++)a=i[s],void 0!==a&&(a.splice?a.length&&this.flatten(a,t):t.push(a));else t.push(i);return t}},t.exports=a},{"../tree":61}],90:[function(e,t){function n(){if(!s){s=!0;for(var e,t=o.length;t;){e=o,o=[];for(var n=-1;++n<t;)e[n]();t=o.length}s=!1}}function r(){}var i=t.exports={},o=[],s=!1;i.nextTick=function(e){o.push(e),s||setTimeout(n,0)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=r,i.addListener=r,i.once=r,i.off=r,i.removeListener=r,i.removeAllListeners=r,i.emit=r,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],91:[function(e,t){"use strict";function n(e){function t(e){return null===u?void c.push(e):void o(function(){var t=u?e.onFulfilled:e.onRejected;if(null===t)return void(u?e.resolve:e.reject)(l);var n;try{n=t(l)}catch(r){return void e.reject(r)}e.resolve(n)})}function n(e){try{if(e===h)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void i(t.bind(e),n,s)}u=!0,l=e,a()}catch(r){s(r)}}function s(e){u=!1,l=e,a()}function a(){for(var e=0,n=c.length;n>e;e++)t(c[e]);c=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var u=null,l=null,c=[],h=this;this.then=function(e,n){return new h.constructor(function(i,o){t(new r(e,n,i,o))})},i(e,n,s)}function r(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function i(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(i){if(r)return;r=!0,n(i)}}var o=e("asap");t.exports=n},{asap:93}],92:[function(e,t){"use strict";function n(e){this.then=function(t){return"function"!=typeof t?this:new r(function(n,r){i(function(){try{n(t(e))}catch(i){r(i)}})})}}var r=e("./core.js"),i=e("asap");t.exports=r,n.prototype=r.prototype;var o=new n(!0),s=new n(!1),a=new n(null),u=new n(void 0),l=new n(0),c=new n("");r.resolve=function(e){if(e instanceof r)return e;if(null===e)return a;if(void 0===e)return u;if(e===!0)return o;if(e===!1)return s;if(0===e)return l;if(""===e)return c;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new r(t.bind(e))}catch(i){return new r(function(e,t){t(i)})}return new n(e)},r.all=function(e){var t=Array.prototype.slice.call(e);return new r(function(e,n){function r(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){r(o,e)},n)}t[o]=s,0===--i&&e(t)}catch(u){n(u)}}if(0===t.length)return e([]);for(var i=t.length,o=0;t.length>o;o++)r(o,t[o])})},r.reject=function(e){return new r(function(t,n){n(e)})},r.race=function(e){return new r(function(t,n){e.forEach(function(e){r.resolve(e).then(t,n)})})},r.prototype["catch"]=function(e){return this.then(null,e)}},{"./core.js":91,asap:93}],93:[function(e,t){(function(e){function n(){for(;i.next;){i=i.next;var e=i.task;i.task=void 0;var t=i.domain;t&&(i.domain=void 0,t.enter());try{e()}catch(r){if(u)throw t&&t.exit(),setTimeout(n,0),t&&t.enter(),r;setTimeout(function(){throw r},0)}t&&t.exit()}s=!1}function r(t){o=o.next={task:t,domain:u&&e.domain,next:null},s||(s=!0,a())}var i={task:void 0,next:null},o=i,s=!1,a=void 0,u=!1;if("undefined"!=typeof e&&e.nextTick)u=!0,a=function(){e.nextTick(n)};else if("function"==typeof setImmediate)a="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=n,a=function(){l.port2.postMessage(0)}}else a=function(){setTimeout(n,0)};t.exports=r}).call(this,e("_process"))},{_process:90}],94:[function(){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(){var e=arguments.length?this.then.apply(this,arguments):this;e.then(null,function(e){setTimeout(function(){throw e},0)})})},{}],95:[function(e){e("asap"),"undefined"==typeof Promise&&(Promise=e("./lib/core.js"),e("./lib/es6-extensions.js")),e("./polyfill-done.js")},{"./lib/core.js":91,"./lib/es6-extensions.js":92,"./polyfill-done.js":94,asap:93}]},{},[2])(2)});function Socket(e){pc.extend(this,pc.events),this._connected=!1,this.socket=new eio.Socket(e.url,{path:"/socket",transports:["websocket"]}),this.socket.on("open",this._onopen.bind(this)),this.socket.on("close",this._onclose.bind(this)),this.socket.on("message",this._waitingForProto.bind(this))}Socket.ReservedNames={connect:1,close:1,error:1,message:1},Socket.prototype._onopen=function(e){this._connected=!0,this.fire("connect",e)},Socket.prototype._onclose=function(e){this._connected=!1,this.fire("close",e)},Socket.prototype._onerror=function(e){this.fire("error",e)},Socket.prototype._waitingForProto=function(e){try{var t=JSON.parse(e);if(t.hasOwnProperty("proto")){this.socket.off("message");var o=dcodeIO.ProtoBuf,s=o.loadProto(t.proto);this.EventIDs=s.build("EventIDs"),this.eventNameById={},this.Decoders={};for(var r in this.EventIDs)if(this.EventIDs.hasOwnProperty(r)){var i=this.EventIDs[r];this.eventNameById[i]=r,this.Decoders[i]=s.build(r)}this.socket.binaryType="arraybuffer",this.socket.on("message",this._onmessage.bind(this)),this.send("joinLobby"),this.fire("message","init",{id:t.id,ctr:t.ctr}),this.fire("init",{id:t.id,ctr:t.ctr})}}catch(n){}},Socket.prototype._onmessage=function(e){var t=dcodeIO.ByteBuffer.wrap(e),o=t.readUint8(),s=this.Decoders[o];if(s)try{var r=s.decode(t),i=this.eventNameById[o];if(Socket.ReservedNames[i])return void this._onerror(new Error("could not receive message - name is reserved:",i));this.fire("message",i,r),this.fire(i,r)}catch(n){console.error(n.stack)}},Socket.prototype.close=function(e){e=e||{},e.code=e.code||1e3,e.reason=e.reason||"unknown",this.socket.close(e.code,e.reason)},Socket.prototype.send=function(e,t){if(Socket.ReservedNames[e])return void this._onerror(new Error("could not send message - name is reserved:",e));var o=this.EventIDs[e];if(o){var s=new this.Decoders[o](t),r=s.encode();r.prepend([o]),this.socket.send(r.toArrayBuffer())}};"use strict";function Block(s){this.deleted=!1,this.pos=new pc.Vec2(s.x,s.y),this.size=new pc.Vec2(s.width||1,s.height||1)}Block.prototype["delete"]=function(){this.deleted&&(this.deleted=!0)},Block.prototype.collideCircle=function(s){var t=this.size.x/2,i=this.size.y/2,e=s.pos.x-this.pos.x,a=s.pos.y-this.pos.y,h=Math.abs(e)<=t+s.radius;if(!h)return!1;var r=Math.abs(a)<=i+s.radius;if(!r)return!1;h=0>e?-1:1,r=0>a?-1:1;var o,u=Math.abs(e)<t,d=Math.abs(a)<i;if(u&&d)t-Math.abs(e)<i-Math.abs(a)?(r=0,o=t-Math.abs(e)+s.radius):(h=0,o=i-Math.abs(a)+s.radius);else if(u||d)u?(h=0,o=s.radius-(Math.abs(a)-i)):d&&(r=0,o=s.radius-(Math.abs(e)-t));else{h=e-h*t,r=a-r*i;var n=Math.sqrt(h*h+r*r);if(n>s.radius)return!1;h/=n,r/=n,o=s.radius-n}return[h*o,r*o]},Block.prototype.intersectPoint=function(s){return s[0]>=this.pos[0]-this.size[0]/2&&s[0]<=this.pos[0]+this.size[0]/2&&s[1]>=this.pos[1]-this.size[1]/2&&s[1]<=this.pos[1]+this.size[1]/2};!function(t,e){function n(t,e){for(var n in e)try{t.style[n]=e[n]}catch(o){}return t}function o(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function a(t,e){if("array"!==o(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,a=e.length;a>n;n++)if(e[n]===t)return n;return-1}function i(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(o(e[1][t])){case"object":e[0][t]=i({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?i.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function r(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}function h(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function l(t,s){function d(t,e,n,o){return S[0|t][Math.round(Math.min((e-n)/(o-n)*q,q))]}function g(){j.legend.fps!==G&&(j.legend.fps=G,j.legend[f]=G?"FPS":"ms"),E=G?H.fps:H.duration,j.count[f]=E>999?"999+":E.toFixed(E>99?0:T.decimals)}function m(){for(F=c(),N<F-T.threshold&&(H.fps-=H.fps/Math.max(1,60*T.smoothing/T.interval),H.duration=1e3/H.fps),A=T.history;A--;)V[A]=0===A?H.fps:V[A-1],W[A]=0===A?H.duration:W[A-1];if(g(),T.heat){if(D.length)for(A=D.length;A--;)D[A].el.style[O[D[A].name].heatOn]=G?d(O[D[A].name].heatmap,H.fps,0,T.maxFps):d(O[D[A].name].heatmap,H.duration,T.threshold,0);if(j.graph&&O.column.heatOn)for(A=I.length;A--;)I[A].style[O.column.heatOn]=G?d(O.column.heatmap,V[A],0,T.maxFps):d(O.column.heatmap,W[A],T.threshold,0)}if(j.graph)for(P=0;P<T.history;P++)I[P].style.height=(G?V[P]?Math.round(z/T.maxFps*Math.min(V[P],T.maxFps)):0:W[P]?Math.round(z/T.threshold*Math.min(W[P],T.threshold)):0)+"px"}function w(){20>T.interval?(C=u(w),m()):(C=setTimeout(w,T.interval),M=u(m))}function v(t){t=t||window.event,t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),H.toggle()}function y(){T.toggleOn&&h(j.container,T.toggleOn,v,1),t.removeChild(j.container)}function k(){if(j.container&&y(),O=l.theme[T.theme],S=O.compiledHeatmaps||[],!S.length&&O.heatmaps.length){for(P=0;P<O.heatmaps.length;P++)for(S[P]=[],A=0;q>=A;A++){var e,o=S[P],a=A;e=.33/q*A;var i=O.heatmaps[P].saturation,c=O.heatmaps[P].lightness,s=void 0,p=void 0,u=void 0,d=u=void 0,m=s=p=void 0,m=void 0,u=.5>=c?c*(1+i):c+i-c*i;0===u?e="#000":(d=2*c-u,p=(u-d)/u,e*=6,s=Math.floor(e),m=e-s,m*=u*p,0===s||6===s?(s=u,p=d+m,u=d):1===s?(s=u-m,p=u,u=d):2===s?(s=d,p=u,u=d+m):3===s?(s=d,p=u-m):4===s?(s=d+m,p=d):(s=u,p=d,u-=m),e="#"+r(s)+r(p)+r(u)),o[a]=e}O.compiledHeatmaps=S}j.container=n(document.createElement("div"),O.container),j.count=j.container.appendChild(n(document.createElement("div"),O.count)),j.legend=j.container.appendChild(n(document.createElement("div"),O.legend)),j.graph=T.graph?j.container.appendChild(n(document.createElement("div"),O.graph)):0,D.length=0;for(var f in j)j[f]&&O[f].heatOn&&D.push({name:f,el:j[f]});if(I.length=0,j.graph)for(j.graph.style.width=T.history*O.column.width+(T.history-1)*O.column.spacing+"px",A=0;A<T.history;A++)I[A]=j.graph.appendChild(n(document.createElement("div"),O.column)),I[A].style.position="absolute",I[A].style.bottom=0,I[A].style.right=A*O.column.width+A*O.column.spacing+"px",I[A].style.width=O.column.width+"px",I[A].style.height="0px";n(j.container,T),g(),t.appendChild(j.container),j.graph&&(z=j.graph.clientHeight),T.toggleOn&&("click"===T.toggleOn&&(j.container.style.cursor="pointer"),h(j.container,T.toggleOn,v))}"object"===o(t)&&t.nodeType===e&&(s=t,t=document.body),t||(t=document.body);var O,S,F,C,M,z,E,A,P,H=this,T=i({},l.defaults,s||{}),j={},I=[],q=100,D=[],L=0,R=T.threshold,B=0,N=c()-R,V=[],W=[],G="fps"===T.show;H.options=T,H.fps=0,H.duration=0,H.isPaused=0,H.tickStart=function(){B=c()},H.tick=function(){F=c(),L=F-N,R+=(L-R)/T.smoothing,H.fps=1e3/R,H.duration=N>B?R:F-B,N=F},H.pause=function(){return C&&(H.isPaused=1,clearTimeout(C),p(C),p(M),C=M=0),H},H.resume=function(){return C||(H.isPaused=0,w()),H},H.set=function(t,e){return T[t]=e,G="fps"===T.show,-1!==a(t,x)&&k(),-1!==a(t,b)&&n(j.container,T),H},H.showDuration=function(){return H.set("show","ms"),H},H.showFps=function(){return H.set("show","fps"),H},H.toggle=function(){return H.set("show",G?"ms":"fps"),H},H.hide=function(){return H.pause(),j.container.style.display="none",H},H.show=function(){return H.resume(),j.container.style.display="block",H},H.destroy=function(){H.pause(),y(),H.tick=H.tickStart=function(){}},k(),w()}var c,s=t.performance;c=s&&(s.now||s.webkitNow)?s[s.now?"now":"webkitNow"].bind(s):function(){return+new Date};for(var p=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,u=t.requestAnimationFrame,s=["moz","webkit","o"],d=0,g=0,m=s.length;m>g&&!p;++g)u=(p=t[s[g]+"CancelAnimationFrame"]||t[s[g]+"CancelRequestAnimationFrame"])&&t[s[g]+"RequestAnimationFrame"];p||(u=function(e){var n=c(),o=Math.max(0,16-(n-d));return d=n+o,t.setTimeout(function(){e(n+o)},o)},p=function(t){clearTimeout(t)});var f="string"===o(document.createElement("div").textContent)?"textContent":"innerText";l.extend=i,window.FPSMeter=l,l.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var x=["toggleOn","theme","heat","graph","history"],b="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter);!function t(i,e,n){function s(o,h){if(!e[o]){if(!i[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[o]={exports:{}};i[o][0].call(c.exports,function(t){var e=i[o][1][t];return s(e?e:t)},c,c.exports,t,i,e,n)}return e[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,i,e){function n(){this.hardwareUnitId="webvr-polyfill hardwareUnitId",this.deviceId="webvr-polyfill deviceId",this.deviceName="webvr-polyfill deviceName"}function s(){}function r(){}s.prototype=new n,r.prototype=new n,i.exports.VRDevice=n,i.exports.HMDVRDevice=s,i.exports.PositionSensorVRDevice=r},{}],2:[function(t,i,e){function n(){this.setMonocularFieldOfView_(o),this.setInterpupillaryDistance(r)}var s=t("./base.js").HMDVRDevice,r=.06,o=40,h={LEFT:"left",RIGHT:"right"};n.prototype=new s,n.prototype.getEyeParameters=function(t){var i,e,n;if(t==h.LEFT)i=this.eyeTranslationLeft,e=this.fieldOfViewLeft,n=this.renderRectLeft;else{if(t!=h.RIGHT)return console.error("Invalid eye provided: %s",t),null;i=this.eyeTranslationRight,e=this.fieldOfViewRight,n=this.renderRectRight}return{recommendedFieldOfView:e,eyeTranslation:i,renderRect:n}},n.prototype.setFieldOfView=function(t,i,e,n){t&&(this.fieldOfViewLeft=t),i&&(this.fieldOfViewRight=i),e&&(this.zNear=e),n&&(this.zFar=n)},n.prototype.setInterpupillaryDistance=function(t){this.eyeTranslationLeft={x:t*-.5,y:0,z:0},this.eyeTranslationRight={x:.5*t,y:0,z:0}},n.prototype.setRenderRect=function(t,i){t&&(this.renderRectLeft=t),i&&(this.renderRectRight=i)},n.prototype.setMonocularFieldOfView_=function(t){this.setFieldOfView(this.createSymmetricalFieldOfView_(t),this.createSymmetricalFieldOfView_(t))},n.prototype.createSymmetricalFieldOfView_=function(t){return{upDegrees:t,downDegrees:t,leftDegrees:t,rightDegrees:t}},i.exports=n},{"./base.js":1}],3:[function(t,i,e){function n(t){this.kFilter=t,this.currentAccelMeasurement=new s,this.currentGyroMeasurement=new s,this.previousGyroMeasurement=new s,this.filterQ=new r.Quaternion,this.previousFilterQ=new r.Quaternion,this.accelQ=new r.Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new r.Vector3,this.measuredGravity=new r.Vector3,this.gyroIntegralQ=new r.Quaternion}var s=t("./sensor-sample.js"),r=t("./three-math.js"),o=t("./util.js"),h=!1;n.prototype.addAccelMeasurement=function(t,i){this.currentAccelMeasurement.set(t,i)},n.prototype.addGyroMeasurement=function(t,i){this.currentGyroMeasurement.set(t,i);var e=i-this.previousGyroMeasurement.timestampS;o.isTimestampDeltaValid(e)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},n.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,i=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(i),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(i);var e=new r.Quaternion;e.copy(this.filterQ),e.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(e),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new r.Quaternion;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse(),h&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",r.Math.radToDeg(o.getQuaternionAngle(n)),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var s=new r.Quaternion;s.copy(this.filterQ),s.multiply(n),this.filterQ.slerp(s,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},n.prototype.getOrientation=function(){return this.filterQ},n.prototype.accelToQuaternion_=function(t){var i=new r.Vector3;i.copy(t),i.normalize();var e=new r.Quaternion;return e.setFromUnitVectors(new r.Vector3(0,0,-1),i),e.inverse(),e},n.prototype.gyroToQuaternionDelta_=function(t,i){var e=new r.Quaternion,n=new r.Vector3;return n.copy(t),n.normalize(),e.setFromAxisAngle(n,t.length()*i),e},i.exports=n},{"./sensor-sample.js":8,"./three-math.js":9,"./util.js":11}],4:[function(t,i,e){function n(){this.deviceId="webvr-polyfill:fused",this.deviceName="VR Position Device (webvr-polyfill:fused)",this.accelerometer=new a.Vector3,this.gyroscope=new a.Vector3,window.addEventListener("devicemotion",this.onDeviceMotionChange_.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChange_.bind(this)),this.filter=new r(WebVRConfig.K_FILTER||.98),this.posePredictor=new o(WebVRConfig.PREDICTION_TIME_S||.04),this.touchPanner=new h,this.filterToWorldQ=new a.Quaternion,u.isIOS()?this.filterToWorldQ.setFromAxisAngle(new a.Vector3(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new a.Vector3(1,0,0),-Math.PI/2),this.worldToScreenQ=new a.Quaternion,this.setScreenTransform_(),this.resetQ=new a.Quaternion,this.isFirefoxAndroid=u.isFirefoxAndroid(),this.isIOS=u.isIOS()}var s=t("./base.js").PositionSensorVRDevice,r=t("./complementary-filter.js"),o=t("./pose-predictor.js"),h=t("./touch-panner.js"),a=t("./three-math.js"),u=t("./util.js");n.prototype=new s,n.prototype.getState=function(){return{hasOrientation:!0,orientation:this.getOrientation(),hasPosition:!1,position:null}},n.prototype.getOrientation=function(){var t=this.filter.getOrientation();this.predictedQ=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);var i=new a.Quaternion;return i.copy(this.filterToWorldQ),i.multiply(this.resetQ),WebVRConfig.TOUCH_PANNER_DISABLED||i.multiply(this.touchPanner.getOrientation()),i.multiply(this.predictedQ),i.multiply(this.worldToScreenQ),WebVRConfig.YAW_ONLY&&(i.x=0,i.z=0,i.normalize()),i},n.prototype.resetSensor=function(){var t=new a.Euler;t.setFromQuaternion(this.filter.getOrientation());var i=t.y;console.log("resetSensor with yaw: %f",i),this.resetQ.setFromAxisAngle(new a.Vector3(0,0,1),-i),WebVRConfig.TOUCH_PANNER_DISABLED||this.touchPanner.resetSensor()},n.prototype.onDeviceMotionChange_=function(t){var i=t.accelerationIncludingGravity,e=t.rotationRate,n=t.timeStamp/1e3;this.isFirefoxAndroid&&(n/=1e3);var s=n-this.previousTimestampS;return s<=u.MIN_TIMESTEP||s>u.MAX_TIMESTEP?(console.warn("Invalid timestamps detected. Time step between successive gyroscope sensor samples is very small or not monotonic"),void(this.previousTimestampS=n)):(this.accelerometer.set(-i.x,-i.y,-i.z),this.gyroscope.set(e.alpha,e.beta,e.gamma),(this.isIOS||this.isFirefoxAndroid)&&this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,n),this.filter.addGyroMeasurement(this.gyroscope,n),void(this.previousTimestampS=n))},n.prototype.onScreenOrientationChange_=function(t){this.setScreenTransform_()},n.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new a.Vector3(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new a.Vector3(0,0,1),Math.PI/2);break;case 180:}},i.exports=n},{"./base.js":1,"./complementary-filter.js":3,"./pose-predictor.js":7,"./three-math.js":9,"./touch-panner.js":10,"./util.js":11}],5:[function(t,i,e){var n=t("./webvr-polyfill.js");window.WebVRConfig=window.WebVRConfig||{},new n},{"./webvr-polyfill.js":12}],6:[function(t,i,e){function n(){this.deviceId="webvr-polyfill:mouse-keyboard",this.deviceName="VR Position Device (webvr-polyfill:mouse-keyboard)",window.addEventListener("keydown",this.onKeyDown_.bind(this)),window.addEventListener("mousemove",this.onMouseMove_.bind(this)),window.addEventListener("mousedown",this.onMouseDown_.bind(this)),window.addEventListener("mouseup",this.onMouseUp_.bind(this)),this.phi=0,this.theta=0,this.targetAngle=null,this.euler=new r.Euler,this.orientation=new r.Quaternion,this.rotateStart=new r.Vector2,this.rotateEnd=new r.Vector2,this.rotateDelta=new r.Vector2}var s=t("./base.js").PositionSensorVRDevice,r=t("./three-math.js"),o=t("./util.js"),h=.15,a=80,u=.5,c=.3;n.prototype=new s,n.prototype.getState=function(){return this.euler.set(this.phi,this.theta,0,"YXZ"),this.orientation.setFromEuler(this.euler),{hasOrientation:!0,orientation:this.orientation,hasPosition:!1,position:null}},n.prototype.onKeyDown_=function(t){38==t.keyCode?this.animatePhi_(this.phi+h):39==t.keyCode?this.animateTheta_(this.theta-h):40==t.keyCode?this.animatePhi_(this.phi-h):37==t.keyCode&&this.animateTheta_(this.theta+h)},n.prototype.animateTheta_=function(t){this.animateKeyTransitions_("theta",t)},n.prototype.animatePhi_=function(t){t=o.clamp(t,-Math.PI/2,Math.PI/2),this.animateKeyTransitions_("phi",t)},n.prototype.animateKeyTransitions_=function(t,i){this.angleAnimation&&clearInterval(this.angleAnimation);var e=this[t],n=new Date;this.angleAnimation=setInterval(function(){var s=new Date-n;if(s>=a)return this[t]=i,void clearInterval(this.angleAnimation);var r=s/a;this[t]=e+(i-e)*r}.bind(this),1e3/60)},n.prototype.onMouseDown_=function(t){this.rotateStart.set(t.clientX,t.clientY),this.isDragging=!0},n.prototype.onMouseMove_=function(t){if(this.isDragging||this.isPointerLocked_()){if(this.isPointerLocked_()){var i=t.movementX||t.mozMovementX||0,e=t.movementY||t.mozMovementY||0;this.rotateEnd.set(this.rotateStart.x-i,this.rotateStart.y-e)}else this.rotateEnd.set(t.clientX,t.clientY);this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd);var n=document.body;this.phi+=2*Math.PI*this.rotateDelta.y/n.clientHeight*c,this.theta+=2*Math.PI*this.rotateDelta.x/n.clientWidth*u,this.phi=o.clamp(this.phi,-Math.PI/2,Math.PI/2)}},n.prototype.onMouseUp_=function(t){this.isDragging=!1},n.prototype.isPointerLocked_=function(){var t=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement;return void 0!==t},n.prototype.resetSensor=function(){console.error("Not implemented yet.")},i.exports=n},{"./base.js":1,"./three-math.js":9,"./util.js":11}],7:[function(t,i,e){function n(t){this.predictionTimeS=t,this.previousQ=new s.Quaternion,this.previousTimestampS=null,this.deltaQ=new s.Quaternion,this.outQ=new s.Quaternion}var s=t("./three-math.js"),r=!1;n.prototype.getPrediction=function(t,i,e){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=e,t;var n=new s.Vector3;n.copy(i),n.normalize();var o=i.length();if(o<s.Math.degToRad(20))return r&&console.log("Moving slowly, at %s deg/s: no prediction",s.Math.radToDeg(o).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;var h=(e-this.previousTimestampS,o*this.predictionTimeS);return this.deltaQ.setFromAxisAngle(n,h),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.outQ},i.exports=n},{"./three-math.js":9}],8:[function(t,i,e){function n(t,i){this.set(t,i)}n.prototype.set=function(t,i){this.sample=t,this.timestampS=i},n.prototype.copy=function(t){this.set(t.sample,t.timestampS)},i.exports=n},{}],9:[function(t,i,e){var n=window.THREE||{};n.Quaternion&&n.Vector3&&n.Vector2&&n.Euler&&n.Math||(n.Quaternion=function(t,i,e,n){this._x=t||0,this._y=i||0,this._z=e||0,this._w=void 0!==n?n:1},n.Quaternion.prototype={constructor:n.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,i,e,n){return this._x=t,this._y=i,this._z=e,this._w=n,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,i){if(t instanceof n.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=Math.cos(t._x/2),s=Math.cos(t._y/2),r=Math.cos(t._z/2),o=Math.sin(t._x/2),h=Math.sin(t._y/2),a=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=o*s*r+e*h*a,this._y=e*h*r-o*s*a,this._z=e*s*a+o*h*r,this._w=e*s*r-o*h*a):"YXZ"===t.order?(this._x=o*s*r+e*h*a,this._y=e*h*r-o*s*a,this._z=e*s*a-o*h*r,this._w=e*s*r+o*h*a):"ZXY"===t.order?(this._x=o*s*r-e*h*a,this._y=e*h*r+o*s*a,this._z=e*s*a+o*h*r,this._w=e*s*r-o*h*a):"ZYX"===t.order?(this._x=o*s*r-e*h*a,this._y=e*h*r+o*s*a,this._z=e*s*a-o*h*r,this._w=e*s*r+o*h*a):"YZX"===t.order?(this._x=o*s*r+e*h*a,this._y=e*h*r+o*s*a,this._z=e*s*a-o*h*r,this._w=e*s*r-o*h*a):"XZY"===t.order&&(this._x=o*s*r-e*h*a,this._y=e*h*r-o*s*a,this._z=e*s*a+o*h*r,this._w=e*s*r+o*h*a),i!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,i){var e=i/2,n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var i,e=t.elements,n=e[0],s=e[4],r=e[8],o=e[1],h=e[5],a=e[9],u=e[2],c=e[6],l=e[10],y=n+h+l;return y>0?(i=.5/Math.sqrt(y+1),this._w=.25/i,this._x=(c-a)*i,this._y=(r-u)*i,this._z=(o-s)*i):n>h&&n>l?(i=2*Math.sqrt(1+n-h-l),this._w=(c-a)/i,this._x=.25*i,this._y=(s+o)/i,this._z=(r+u)/i):h>l?(i=2*Math.sqrt(1+h-n-l),this._w=(r-u)/i,this._x=(s+o)/i,this._y=.25*i,this._z=(a+c)/i):(i=2*Math.sqrt(1+l-n-h),this._w=(o-s)/i,this._x=(r+u)/i,this._y=(a+c)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,i,e=1e-6;return function(s,r){return void 0===t&&(t=new n.Vector3),i=s.dot(r)+1,e>i?(i=0,Math.abs(s.x)>Math.abs(s.z)?t.set(-s.y,s.x,0):t.set(0,-s.z,s.y)):t.crossVectors(s,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=i,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,i){var e=t._x,n=t._y,s=t._z,r=t._w,o=i._x,h=i._y,a=i._z,u=i._w;return this._x=e*u+r*o+n*a-s*h,this._y=n*u+r*h+s*o-e*a,this._z=s*u+r*a+e*h-n*o,this._w=r*u-e*o-n*h-s*a,this.onChangeCallback(),this},multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var e=this._x,n=this._y,s=this._z,r=this._w,o=r*t._w+e*t._x+n*t._y+s*t._z;if(0>o?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=e,this._y=n,this._z=s,this;var h=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this._w=.5*(r+this._w),this._x=.5*(e+this._x),this._y=.5*(n+this._y),this._z=.5*(s+this._z),this;var u=Math.sin((1-i)*h)/a,c=Math.sin(i*h)/a;return this._w=r*u+this._w*c,this._x=e*u+this._x*c,this._y=n*u+this._y*c,this._z=s*u+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new n.Quaternion(this._x,this._y,this._z,this._w)}},n.Quaternion.slerp=function(t,i,e,n){return e.copy(t).slerp(i,n)},n.Vector2=function(t,i){this.x=t||0,this.y=i||0},n.Vector2.prototype={constructor:n.Vector2,set:function(t,i){return this.x=t,this.y=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i}else this.x=0,this.y=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this},clampScalar:function(){var t,i;return function(e,s){return void 0===t&&(t=new n.Vector2,i=new n.Vector2),t.set(e,e),i.set(s,s),this.clamp(t,i)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},setLength:function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},fromAttribute:function(t,i,e){return void 0===e&&(e=0),i=i*t.itemSize+e,this.x=t.array[i],this.y=t.array[i+1],this},clone:function(){return new n.Vector2(this.x,this.y)}},n.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},n.Vector3.prototype={constructor:n.Vector3,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(){var t;return function(i){return i instanceof n.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new n.Quaternion),this.applyQuaternion(t.setFromEuler(i)),this}}(),applyAxisAngle:function(){var t;return function(i,e){return void 0===t&&(t=new n.Quaternion),this.applyQuaternion(t.setFromAxisAngle(i,e)),this}}(),applyMatrix3:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*n,this.y=s[1]*i+s[4]*e+s[7]*n,this.z=s[2]*i+s[5]*e+s[8]*n,this},applyMatrix4:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n+s[12],this.y=s[1]*i+s[5]*e+s[9]*n+s[13],this.z=s[2]*i+s[6]*e+s[10]*n+s[14],this},applyProjection:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements,r=1/(s[3]*i+s[7]*e+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*e+s[8]*n+s[12])*r,this.y=(s[1]*i+s[5]*e+s[9]*n+s[13])*r,this.z=(s[2]*i+s[6]*e+s[10]*n+s[14])*r,this},applyQuaternion:function(t){var i=this.x,e=this.y,n=this.z,s=t.x,r=t.y,o=t.z,h=t.w,a=h*i+r*n-o*e,u=h*e+o*i-s*n,c=h*n+s*e-r*i,l=-s*i-r*e-o*n;return this.x=a*h+l*-s+u*-o-c*-r,this.y=u*h+l*-r+c*-s-a*-o,this.z=c*h+l*-o+a*-r-u*-s,this},project:function(){var t;return function(i){return void 0===t&&(t=new n.Matrix4),t.multiplyMatrices(i.projectionMatrix,t.getInverse(i.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(i){return void 0===t&&(t=new n.Matrix4),t.multiplyMatrices(i.matrixWorld,t.getInverse(i.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n,this.y=s[1]*i+s[5]*e+s[9]*n,this.z=s[2]*i+s[6]*e+s[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this.z<t.z?this.z=t.z:this.z>i.z&&(this.z=i.z),this},clampScalar:function(){var t,i;return function(e,s){return void 0===t&&(t=new n.Vector3,i=new n.Vector3),t.set(e,e,e),i.set(s,s,s),this.clamp(t,i)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},cross:function(t,i){if(void 0!==i)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i);var e=this.x,n=this.y,s=this.z;return this.x=n*t.z-s*t.y,this.y=s*t.x-e*t.z,this.z=e*t.y-n*t.x,this},crossVectors:function(t,i){var e=t.x,n=t.y,s=t.z,r=i.x,o=i.y,h=i.z;return this.x=n*h-s*o,this.y=s*r-e*h,this.z=e*o-n*r,this},projectOnVector:function(){var t,i;return function(e){return void 0===t&&(t=new n.Vector3),t.copy(e).normalize(),i=this.dot(t),this.copy(t).multiplyScalar(i)}}(),projectOnPlane:function(){var t;return function(i){return void 0===t&&(t=new n.Vector3),t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t;return function(i){return void 0===t&&(t=new n.Vector3),this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var i=this.dot(t)/(this.length()*t.length());return Math.acos(n.Math.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n},setEulerFromRotationMatrix:function(t,i){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(t,i){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,i){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,i)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var i=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),e=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),n=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=i,this.y=e,this.z=n,this},setFromMatrixColumn:function(t,i){var e=4*t,n=i.elements;return this.x=n[e],this.y=n[e+1],this.z=n[e+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i,e){return void 0===e&&(e=0),i=i*t.itemSize+e,this.x=t.array[i],this.y=t.array[i+1],this.z=t.array[i+2],this},clone:function(){return new n.Vector3(this.x,this.y,this.z)}},n.Euler=function(t,i,e,s){this._x=t||0,this._y=i||0,this._z=e||0,this._order=s||n.Euler.DefaultOrder},n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n.Euler.DefaultOrder="XYZ",n.Euler.prototype={constructor:n.Euler,_x:0,_y:0,_z:0,_order:n.Euler.DefaultOrder,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,i,e,n){return this._x=t,this._y=i,this._z=e,this._order=n||this._order,this.onChangeCallback(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,i,e){var s=n.Math.clamp,r=t.elements,o=r[0],h=r[4],a=r[8],u=r[1],c=r[5],l=r[9],y=r[2],d=r[6],f=r[10];return i=i||this._order,"XYZ"===i?(this._y=Math.asin(s(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-h,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===i?(this._x=Math.asin(-s(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-y,o),this._z=0)):"ZXY"===i?(this._x=Math.asin(s(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-y,f),this._z=Math.atan2(-h,c)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===i?(this._y=Math.asin(-s(y,-1,1)),Math.abs(y)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-h,c))):"YZX"===i?(this._z=Math.asin(s(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-y,o)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===i?(this._z=Math.asin(-s(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this._order=i,e!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(i,e,s){return void 0===t&&(t=new n.Matrix4),t.makeRotationFromQuaternion(i),this.setFromRotationMatrix(t,e,s),this}}(),setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(){var t=new n.Quaternion;return function(i){t.setFromEuler(this),this.setFromQuaternion(t,i)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new n.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new n.Euler(this._x,this._y,this._z,this._order)}},n.Math={generateUUID:function(){var t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=new Array(36),n=0;return function(){for(var s=0;36>s;s++)8==s||13==s||18==s||23==s?e[s]="-":14==s?e[s]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,e[s]=i[19==s?3&t|8:t]);return e.join("")}}(),clamp:function(t,i,e){return i>t?i:t>e?e:t},clampBottom:function(t,i){return i>t?i:t},mapLinear:function(t,i,e,n,s){return n+(t-i)*(s-n)/(e-i)},smoothstep:function(t,i,e){return i>=t?0:t>=e?1:(t=(t-i)/(e-i),t*t*(3-2*t))},smootherstep:function(t,i,e){return i>=t?0:t>=e?1:(t=(t-i)/(e-i),t*t*t*(t*(6*t-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,i){return Math.floor(this.randFloat(t,i))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(){var t=Math.PI/180;return function(i){return i*t}}(),radToDeg:function(){var t=180/Math.PI;return function(i){return i*t}}(),isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t}}),i.exports=n},{}],10:[function(t,i,e){function n(){window.addEventListener("touchstart",this.onTouchStart_.bind(this)),window.addEventListener("touchmove",this.onTouchMove_.bind(this)),
window.addEventListener("touchend",this.onTouchEnd_.bind(this)),this.isTouching=!1,this.rotateStart=new s.Vector2,this.rotateEnd=new s.Vector2,this.rotateDelta=new s.Vector2,this.theta=0,this.orientation=new s.Quaternion}var s=t("./three-math.js"),r=t("./util.js"),o=.5;n.prototype.getOrientation=function(){return this.orientation.setFromEuler(new s.Euler(0,0,this.theta)),this.orientation},n.prototype.resetSensor=function(){this.theta=0},n.prototype.onTouchStart_=function(t){1==t.touches.length&&(this.rotateStart.set(t.touches[0].pageX,t.touches[0].pageY),this.isTouching=!0)},n.prototype.onTouchMove_=function(t){if(this.isTouching){this.rotateEnd.set(t.touches[0].pageX,t.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd),r.isIOS()&&(this.rotateDelta.x*=-1);var i=document.body;this.theta+=2*Math.PI*this.rotateDelta.x/i.clientWidth*o}},n.prototype.onTouchEnd_=function(t){this.isTouching=!1},i.exports=n},{"./three-math.js":9,"./util.js":11}],11:[function(t,i,e){var n=window.Util||{};n.MIN_TIMESTEP=.001,n.MAX_TIMESTEP=1,n.clamp=function(t,i,e){return Math.min(Math.max(i,t),e)},n.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.platform)},n.isFirefoxAndroid=function(){return-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android")},n.isTimestampDeltaValid=function(t){return isNaN(t)?!1:t<=n.MIN_TIMESTEP?!1:!(t>n.MAX_TIMESTEP)},i.exports=n},{}],12:[function(t,i,e){function n(){this.devices=[],this.isWebVRAvailable()||this.enablePolyfill()}var s=t("./cardboard-hmd-vr-device.js"),r=t("./fusion-position-sensor-vr-device.js"),o=t("./mouse-keyboard-position-sensor-vr-device.js"),h=t("./base.js").HMDVRDevice,a=t("./base.js").PositionSensorVRDevice;n.prototype.isWebVRAvailable=function(){return"getVRDevices"in navigator||"mozGetVRDevices"in navigator},n.prototype.enablePolyfill=function(){this.isCardboardCompatible()&&this.devices.push(new s),this.isMobile()?this.devices.push(new r):WebVRConfig.MOUSE_KEYBOARD_CONTROLS_DISABLED||this.devices.push(new o),navigator.getVRDevices=this.getVRDevices.bind(this),window.HMDVRDevice=h,window.PositionSensorVRDevice=a},n.prototype.getVRDevices=function(){var t=this.devices;return new Promise(function(i,e){try{i(t)}catch(n){e(n)}})},n.prototype.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},n.prototype.isCardboardCompatible=function(){return this.isMobile()||WebVRConfig.FORCE_ENABLE_VR},i.exports=n},{"./base.js":1,"./cardboard-hmd-vr-device.js":2,"./fusion-position-sensor-vr-device.js":4,"./mouse-keyboard-position-sensor-vr-device.js":6}]},{},[5]);pc.extend(pc,function(){var e=function(e){this._graphicsDevice=e,this._vrstate=null,this._device=null,this._sensor=null,this._rotation=new pc.Quat,this._position=new pc.Vec3,this.stereo=!1,this.zeroMissingPosition=!1};return e.prototype={initialize:function(e){var t=this;if(navigator.getVRDevices||navigator.mozGetVRDevices){var s=function(s){for(var i=0;i<s.length;i++)if(s[i]instanceof HMDVRDevice&&(t._device=s[i],t.stereo=!0),s[i]instanceof PositionSensorVRDevice){t._sensor=s[i];try{!t._sensor.resetSensor||t._sensor instanceof MouseKeyboardPositionSensorVRDevice||t._sensor.resetSensor(),t._sensor.zeroSensor&&t._sensor.zeroSensor()}catch(o){}}e(null,t._device,t._sensor)};navigator.getVRDevices?navigator.getVRDevices().then(s):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(s)}else e(new Error("WebVR not supported"))},poll:function(){this._sensor&&(this._vrstate=this._sensor.getState())},enterFullscreen:function(){var e=this._graphicsDevice.canvas;e.webkitRequestFullscreen?e.webkitRequestFullscreen({vrDisplay:this._device}):e.mozRequestFullScreen&&e.mozRequestFullScreen({vrDisplay:this._device})},reset:function(){this._sensor&&this._sensor.resetSensor()}},Object.defineProperty(e.prototype,"rotation",{get:function(){if(this._sensor){var e;e=this._vrstate.hasOrientation||this._vrstate.orientation?this._vrstate.orientation:pc.Vec4.ZERO,this._rotation.set(e.x,e.y,e.z,e.w)}return this._rotation}}),Object.defineProperty(e.prototype,"position",{get:function(){if(this._sensor){var e;this._vrstate.hasPosition||this._vrstate.position?(e=this._vrstate.position,this._position.set(e.x,e.y,e.z)):this.zeroMissingPosition&&this._position.set(0,0,0)}return this._position}}),{Hmd:e}}());!function(){var n=pc.Application.getApplication(),i=n.loader.getHandler("texture");i.crossOrigin="anonymous"}();var Auth=pc.createScript("auth");Auth.prototype.initialize=function(){this.btnTwitter=document.createElement("div"),this.btnTwitter.className="auth-twitter",this.btnTwitter.textContent="Twitter",document.body.appendChild(this.btnTwitter),this.btnTwitter.addEventListener("click",function(){window.open(app.root.getChildren()[0].script.client.url+"/auth/twitter")})};var AutoDisable=pc.createScript("autoDisable");AutoDisable.prototype.initialize=function(){this.entity.enabled=!1};var Bullet=pc.createScript("bullet");Bullet.tmpVec=new pc.Vec3,Bullet.prototype.initialize=function(){this.tanks=this.app.root.getChildren()[0].script.tanks,this.speed=1,this.fires=this.app.root.getChildren()[0].script.fires,this.levels=this.app.root.getChildren()[0].script.levels,this.shadow=this.entity.findByName("shadow");var t=this;this.entity.on("culled",function(i){t.hidden(i)}),this.finished=!1},Bullet.prototype.update=function(t){if(!this.finished){var i=this.entity.getLocalPosition(),e=Bullet.tmpVec;e.copy(this.entity.targetPosition).sub(i).normalize().scale(this.entity.speed*t),this.entity.setLocalPosition(e.add(i)),i=this.entity.getLocalPosition();this.levels.current;e.copy(this.entity.targetPosition).sub(i).length()<this.entity.speed*t*1.5&&this.finish()}},Bullet.prototype.finish=function(t){if(!this.finished){var i=this;if(this.finished=!0,t)if(t.tank){var e=tanks[t.tank];e&&(e.script.tank.sp?(e.audiosource.pitch=.6*Math.random()-.3+1,e.audiosource.play("hit-shield"),e.script.tank.auraShield.enabled&&e.script.tank.auraShield.script.forceField.hit(this.entity.forward)):(e.audiosource.pitch=.6*Math.random()-.3+1,e.audiosource.play("hit"),Bullet.tmpVec.set(t.x-.5*this.entity.forward.x+.15*(Math.random()-.5),.3+.2*Math.random(),t.y-.5*this.entity.forward.z+.15*(Math.random()-.5)),this.app.fire("explosions:add",{type:1,pos:Bullet.tmpVec})))}else this.entity.audiosource.pitch=.2*Math.random()+.9,this.entity.audiosource.play("hit"),Bullet.tmpVec.set(t.x+.25*(Math.random()-.5),.3+.2*Math.random(),t.y+.25*(Math.random()-.5)),this.app.fire("explosions:add",{type:0,pos:Bullet.tmpVec});else this.entity.audiosource.pitch=.2*Math.random()+.9,this.entity.audiosource.play("hit"),Bullet.tmpVec.copy(this.entity.getLocalPosition()),this.app.fire("explosions:add",{type:0,pos:this.entity.getLocalPosition()});if(this.tanks.own&&!this.tanks.own.script.tank.dead){Bullet.tmpVec.copy(this.entity.getLocalPosition()).sub(this.tanks.own.getLocalPosition());var s=Bullet.tmpVec.length();7>s&&this.app.fire("camera:addShake",.2*(1-s/7))}this.hidden(!0),setTimeout(function(){i.finished=!1,i.entity.audiosource.stop(),i.hidden(!1),i.entity.fire("finish")},1e3)}},Bullet.prototype.hidden=function(t){this.finished&&(t=!0),this._hidden!==t&&(this._hidden=t,this.shadow.enabled=!this._hidden,this.entity.model.enabled=!this._hidden)};var Bullets=pc.createScript("bullets");Bullets.attributes.add("colorDefault",{type:"rgb",title:"colorDefault"}),Bullets.attributes.add("colorSpecial",{type:"rgb",title:"colorSpecial"}),Bullets.vecTmp=new pc.Vec3,Bullets.prototype.initialize=function(){this.tanks=this.app.root.findByName("tanks"),this.bullet=this.app.root.findByName("bullet"),this.bullet.enabled=!1,this.bullets=this.app.root.findByName("bullets"),this.active=[],this.pool=[],this.index={},this.length=0},Bullets.prototype["new"]=function(t){var e=this;Bullets.vecTmp;if(0===this.pool.length){var i=this.length;this.length+=8;for(var s=0;s<this.length-i;s++){var l=this.bullet.clone();l.on("finish",function(){e["delete"]({id:this.id})}),this.bullets.addChild(l),this.pool.push(l)}}var o=tanks[t.tank];if(o){var l=this.pool.pop();this.active.push(l),l.script.bullet.finished=!1,l.id=t.id,this.index[t.id]=l,o.script.tank_skin.gun&&l.setLocalPosition(o.script.tank_skin.gun.getPosition()),l.targetPosition=new pc.Vec3(t.tx,.9,t.ty),l.lookAt(l.targetPosition),l.speed=50*t.sp*.25,l.model.model&&(t.s?l.model.meshInstances[0].setParameter("material_diffuse",this.colorSpecial.data3):l.model.meshInstances[0].setParameter("material_diffuse",this.colorDefault.data3)),l.enabled=!0,l.audiosource.pitch=.2*Math.random()+.9,l.audiosource.play("shoot")}},Bullets.prototype.finish=function(t){var e=this.index[t.id];e&&e.script.bullet.finish(t)},Bullets.prototype["delete"]=function(t){var e=this.index[t.id];if(e){delete this.index[t.id],e.audiosource.stop(),e.enabled=!1,this.pool.push(e);var i=this.active.indexOf(e);-1!==i&&this.active.splice(i,1)}};var CanvasText=pc.createScript("text");CanvasText.attributes.add("text",{type:"string","default":"Hello World"}),CanvasText.prototype.initialize=function(){this.canvas=document.createElement("canvas"),this.canvas.height=256,this.canvas.width=256,this.texture=new pc.Texture(app.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,autoMipmap:!0}),this.texture.setSource(this.canvas),this.texture.minFilter=pc.FILTER_LINEAR_MIPMAP_LINEAR,this.texture.magFilter=pc.FILTER_LINEAR,this.texture.addressU=pc.ADDRESS_CLAMP_TO_EDGE,this.texture.addressV=pc.ADDRESS_CLAMP_TO_EDGE,this.updateScores([0,0,0,0]);var t=this.entity.model.material;t.diffuseMap=this.texture,t.opacityMap=this.texture,t.blendType=pc.BLEND_NORMAL,t.update(),app.on("score:update",this.updateScores,this)},CanvasText.prototype.updateScores=function(t){var e=this.canvas.getContext("2d"),a=e.canvas.width,i=e.canvas.height;e.fillStyle="#000000",e.fillRect(0,0,a,i),e.fillStyle="#ffffff",e.font="bold 48px furore",e.textAlign="left",e.textBaseline="middle";var s=function(t,a,i){e.fillStyle=a,e.fillRect(10,i-24,48,48),e.fillStyle="#ffffff",e.fillText(t,78,i)};s(t[0],"#44a9f1",i/8),s(t[1],"#fb222f",3*i/8),s(t[2],"#7bc64b",5*i/8),s(t[3],"#fb9130",7*i/8),this.texture.upload()};var Client=pc.createScript("client");Client.gamepadNum=new pc.URI(window.location.href).getQuery().gamepad,Client.prototype.initialize=function(){this.id=null,this.movement=[0,0];var e=this.app;e.overlayLayer=0,e.firstStart=0,e.loginTooltipTime=0,this.pulseTime=0,e.keyboard=new pc.Keyboard(document.body),document.body.style.cursor="none",this.latency=0,e.allowGameInput=!0,this.tanks=e.root.getChildren()[0].script.tanks,this.bullets=e.root.getChildren()[0].script.bullets,this.pickables=e.root.getChildren()[0].script.pickables,this.teams=e.root.getChildren()[0].script.teams,this.profile=e.root.getChildren()[0].script.profile,this.levels=e.root.getChildren()[0].script.levels;var t=this,s={local:"localhost:30044",us:"us-west-001.tanx.io",eu:"eu-west-001.tanx.io",dev:"eu-dev.tanx.io","default":"tanx.io"};window.location.href.indexOf("playcanvas.com/editor")>=0?s["default"]=s.dev:window.location.href.indexOf("localhost")>=0?s["default"]=s.local:window.location.href.indexOf("tanx-eu-west-dev")>=0?s["default"]=s.dev:window.location.href.indexOf("eu-dev")>=0&&(s["default"]=s.dev);var i=t.queryParse();this.protocol=window.location.protocol,this.protocol="https:",this.url=this.protocol+"//"+(i&&i.keys.server&&s[i.keys.server]||s["default"]);var o=new XMLHttpRequest;o.withCredentials=!0,o.addEventListener("load",function(){try{var s=JSON.parse(o.responseText);if(t.session=s.session,t.user=s.user,t.profile.set(t.user.name),e.ui.userLevel&&(e.ui.userLevel.textContent=t.user.level),s.xpPercent&&e.ui.userProgressBar&&(e.ui.userProgressBar.style.width=s.xpPercent+"%"),i){i.keys.u!==t.user.share&&(t.userJoin=i.keys.u),i.keys.room&&(t.roomJoin=i.keys.room),i.keys.name&&(t.userName=decodeURIComponent(i.keys.name)),i.keys.u=t.user.share,-1===i.order.indexOf("u")&&i.order.push("u");var n=t.querySerialize(i);n!==window.location.search&&window.history.replaceState({},"TANX",window.location.pathname+n)}else window.history.replaceState({},"TANX",window.location.pathname+"?u="+t.user.share);e.ui.shareInput&&(e.ui.shareInput.value="http://tanx.playcanvas.com?u="+t.user.share),t.createSocket(s.url)}catch(a){console.error(a),t.overlay.disconnected()}}),o.addEventListener("error",function(e){t.overlay.disconnected()}),i&&i.keys.u?o.open("GET",t.url+"/auth/?join="+i.keys.u):i&&i.keys.room?o.open("GET",t.url+"/auth/?room="+i.keys.room):o.open("GET",t.url+"/auth"),o.send(),this.connected=!1,this.overlay=e.root.getChildren()[0].script.overlay,e.mouse.disableContextMenu(),e.mouse.on("mousedown",this.onMouseDown,this),e.mouse.on("mouseup",this.onMouseUp,this),this.gamepadConnected=!1,this.gamepadActive=!1,window.addEventListener("gamepadconnected",function(){this.gamepadConnected=!0}.bind(this)),window.addEventListener("gamepaddisconnected",function(){this.gamepadConnected=!1}.bind(this)),window.addEventListener("keydown",function(e){40!==e.keyCode&&38!==e.keyCode||e.preventDefault()},!1),e.touch&&e.ui.overlayHelpDesktop&&e.ui.overlayHelpDesktop.classList.remove("active")},Client.prototype.queryParse=function(){if(!window.location.search)return null;for(var e=window.location.search.slice(1).split("&"),t={},s=[],i=0;i<e.length;i++)if(-1!==e[i].indexOf("=")){var o=e[i].split("=");t.hasOwnProperty(o[0])?t[o[0]]instanceof Array?t[o[0]].push(o[1]):t[o[0]]=[t[o[0]],o[1]]:(t[o[0]]=o[1],s.push(o[0]))}else t[e[i]]=null,s.push(e[i]);return{keys:t,order:s}},Client.prototype.querySerialize=function(e){if(!e||0===e.order.length)return"";for(var t=[],s=0;s<e.order.length;s++){var i=e.keys[e.order[s]];if(i instanceof Array)for(var o=0;o<i.length;o++)t.push(e.order[s]+"="+i[o]);else null===i?t.push(e.order[s]):t.push(e.order[s]+"="+i)}return"?"+t.join("&")},Client.prototype.createSocket=function(e){var t,s=this,i=this.app;t=e?this.protocol+"//"+e:this.url,t+="?s="+this.session,this.userJoin&&(t+="&join="+this.userJoin),this.roomJoin&&(t+="&room="+this.roomJoin);var o=this.socket=new Socket({url:t});o.on("error",function(e){console.log(e)}),o.on("close",function(){s.tanks.deadAll(),s.overlay.disconnected()}),o.on("init",function(e){s.id=e.id,s.controller=e.ctr,s.connected=!0,i.on("users:name:"+s.id,function(e){s.profile.set(e)})}),o.on("message",function(e,t){i.fire("net:"+e,t)}),o.on("initLevel",function(e){s.levels.set(e),s.userName&&(s.profile.set(s.userName),o.send("userName",{name:s.userName}))}),o.on("ping",function(e){o.send("pong",{data:e.data}),s.latency=e.latency}),users.bind(this.app,o),o.on("tankNew",function(e){s.tanks["new"](e)}),o.on("tankDelete",function(e){s.tanks["delete"](e)}),o.on("resetTeams",function(){s.teams.reset()}),i.on("inputRespawn",function(){o.send("inputRespawn")}),o.on("award",function(e){if(i.ui.awardMessages){var t=document.createElement("div");t.innerHTML=e.message+": "+e.value,i.ui.awardMessages.appendChild(t),i.ui.awardMessages.scrollTop=i.ui.awardMessages.scrollHeight}"add xp"===e.message?(i.ui.userProgressBar&&(i.ui.userProgressBar.style.width=e.xpPercent+"%"),s.app.ui.userProgressBar&&(s.app.ui.userProgressBar.classList.add("pulse"),s.pulseTime=.3)):"level up"===e.message&&(i.ui.userLevel&&(i.ui.userLevel.textContent=e.value),i.ui.userProgressBar&&(i.ui.userProgressBar.style.width=e.xpPercent+"%"),i.fire("users:level:"+e.id,e.value),s.tanks.own.script.tank.levelup(e.value))});o.on("update",function(e){if(e.bullets)for(var t=0;t<e.bullets.length;t++)s.bullets["new"](e.bullets[t]);if(e.bulletsDelete)for(var t=0;t<e.bulletsDelete.length;t++)s.bullets.finish(e.bulletsDelete[t]);if(e.pickable)for(var t=0;t<e.pickable.length;t++)s.pickables["new"](e.pickable[t]);if(e.pickableDelete)for(var t=0;t<e.pickableDelete.length;t++)s.pickables.finish(e.pickableDelete[t]);if(e.tanks&&s.tanks.updateData(e.tanks),e.tanksRespawn)for(var t=0;t<e.tanksRespawn.length;t++)s.tanks.respawn(e.tanksRespawn[t]);if(e.teams)for(var t=0;t<e.teams.length;t++)s.teams.teamScore(t,e.teams[t]);e.winner&&(s.shoot(!1),s.teams.teamWin(e.winner))}),o.on("changeAbility",function(e){console.log("changeAbility: "+e.name+", current value = "+e.value)})},Client.prototype.update=function(e){if(this.connected){var t=this.app,s=this;t.ui.userProgressBar&&t.ui.userProgressBar.classList.contains("pulse")&&(s.pulseTime-=e,s.pulseTime<0&&(t.ui.userProgressBar.classList.remove("pulse"),s.pulseTime=0));var i;if(t.allowGameInput?(i=[t.keyboard.isPressed(pc.KEY_D)-t.keyboard.isPressed(pc.KEY_A),t.keyboard.isPressed(pc.KEY_S)-t.keyboard.isPressed(pc.KEY_W)],i[0]+=t.keyboard.isPressed(pc.KEY_RIGHT)-t.keyboard.isPressed(pc.KEY_LEFT),i[1]+=t.keyboard.isPressed(pc.KEY_DOWN)-t.keyboard.isPressed(pc.KEY_UP)):i=[0,0],t.gamepads.gamepadsSupported&&this.gamepadConnected){var o=Client.gamepadNum-1;if(this.link||(this.link=t.root.findByName("camera").script.link),t.gamepads.poll()[o]){var n=t.gamepads.getAxis(o,pc.PAD_L_STICK_X),a=t.gamepads.getAxis(o,pc.PAD_L_STICK_Y);n*n+a*a>.25&&(i[0]+=n,i[1]+=a);var r=t.gamepads.getAxis(o,pc.PAD_R_STICK_X),l=t.gamepads.getAxis(o,pc.PAD_R_STICK_Y);if((n||a||r||l)&&(this.gamepadActive=!0,this.link&&this.link.mouse)){this.link.mouse.move=!1;var p=t.root.findByName("target");p&&p.destroy()}r*r+l*l>.25?(this.shoot(!0),this.link&&(this.link.mPos=[r/2*(t.graphicsDevice.width/2),l/2*(t.graphicsDevice.height/2)],this.link.angle=Math.floor(Math.atan2(r,l)/(Math.PI/180)+45),this.link.link.targeting(this.link.angle))):this.shoot(!1),t.gamepads.isPressed(o,pc.PAD_FACE_4)&&t.fire("vr:reset")}else this.gamepadActive&&this.link&&this.link.mouse&&(this.link.mouse.move=!0,this.gamepadActive=!1)}var u=i[0]*Math.sin(.75*Math.PI)-i[1]*Math.cos(.75*Math.PI);i[1]=i[1]*Math.sin(.75*Math.PI)+i[0]*Math.cos(.75*Math.PI),i[0]=u,i[0]===this.movement[0]&&i[1]===this.movement[1]||(this.movement=i,this.socket.send("move",{dir:this.movement}));var c=[[pc.KEY_F,"maxHp",1],[pc.KEY_V,"maxHp",-1],[pc.KEY_G,"damage",1],[pc.KEY_B,"damage",-1],[pc.KEY_H,"reloadTime",-25],[pc.KEY_N,"reloadTime",25],[pc.KEY_M,"speed",-.05],[pc.KEY_J,"speed",.05],[pc.KEY_Z,"healthRegenDelay",500],[pc.KEY_X,"healthRegenDelay",-500],[pc.KEY_1,"healthRegenTime",-250],[pc.KEY_2,"healthRegenTime",250],[pc.KEY_3,"repairHP",1],[pc.KEY_4,"repairHP",-1],[pc.KEY_5,"shield",1],[pc.KEY_6,"shield",-1],[pc.KEY_7,"heavyWeaponCount",1],[pc.KEY_8,"heavyWeaponCount",-1],[pc.KEY_9,"heavyWeaponDamage",1],[pc.KEY_0,"heavyWeaponDamage",-1]],s=this;c.forEach(function(e){t.keyboard.wasPressed(e[0])&&s.socket.send("changeAbility",{name:e[1],value:e[2]})})}},Client.prototype.onMouseDown=function(){this.app.allowGameInput&&this.shoot(!0)},Client.prototype.onMouseUp=function(){this.app.allowGameInput&&this.shoot(!1)},Client.prototype.shoot=function(e){this.connected&&this.shootingState!==e&&(this.shootingState=e,this.socket.send("shoot",{state:this.shootingState}))};var Cluster=pc.createScript("cluster");Cluster.prototype.initialize=function(){this.size=4},Cluster.prototype.fill=function(t){this.width=Math.ceil(t.width/this.size),this.height=Math.ceil(t.height/this.size),this.nodes=[],this.length=0;for(var i=0;i<this.height;i++)for(var s=0;s<this.width;s++){var h=[];h.x=s,h.y=i,h.ind=this.nodes.length,h.root=this,this.nodes.push(h)}for(var e=t.blocks,o=0;o<e.length;o++){var r=e[o];r.x+=r.width/2,r.y+=r.height/2,this.addToMultiple(new Block(r))}},Cluster.prototype.addToMultiple=function(t){for(var i=t.pos.x-t.size.x/2+.5,s=t.pos.y-t.size.y/2+.5,h=Math.floor(i/this.size),e=Math.floor(s/this.size),o=t.pos.x+t.size.x/2-.5,r=t.pos.y+t.size.y/2-.5,n=Math.floor(o/this.size),a=Math.floor(r/this.size),l=e;a>=l;l++)for(var d=h;n>=d;d++){var p=this.nodes[l*this.width+d];p.push(t),t.node=p,t.traversed=!1,this.length++}},Cluster.prototype.ind=function(t){return Math.max(0,Math.min(this.width-1,Math.floor(t.x/this.size)))%this.width+Math.max(0,Math.min(this.height-1,Math.floor(t.y/this.size)))*this.width},Cluster.prototype.pick=function(t){return this.nodes[this.ind(t)||0]},Cluster.prototype.forEachOnCorner=function(t,i){function s(t){return t=+t,0===t||isNaN(t)?1:t>0?1:-1}function h(t){function i(i,s){var h=o.x+i,r=o.y+s;h>=0&&h<e.width&&r>=0&&r<e.height&&e.nodes[r*e.width+h].forEach(t)}o.forEach(t),i(r,0),i(0,n),i(r,n)}var e=this,o=this.pick(t.pos),r=s(t.pos.x-(o.x*this.size+this.size/2)),n=s(t.pos.y-(o.y*this.size+this.size/2));h(function(t){t.traversed=!1}),h(function(t){t.traversed||(i(t),t.traversed=!0)})};var CullingItem=pc.createScript("cullingItem");CullingItem.attributes.add("radius",{type:"number","default":1}),CullingItem.attributes.add("single",{type:"boolean","default":!1}),CullingItem.culling=null,CullingItem.prototype.initialize=function(){this._ignore=!1,this.culled=!1,this.sphere=new pc.BoundingSphere(this.entity.getPosition().clone(),this.radius);var t=this;CullingItem.culling||(CullingItem.culling=this.app.root.getChildren()[0].script.culling),this.entity.on("start",function(){t.entity.getPosition(),t.sphere.center.copy(t.entity.position),CullingItem.culling.add(t)}),this.entity.on("finish",function(){CullingItem.culling.remove(t)}),this.entity.on("destroy",function(){CullingItem.culling.remove(t)})},CullingItem.prototype.state=function(t){this.culled!==t&&(this.culled=t,this.entity.fire("culled",t),this.single&&(this.entity.enabled=!t))},CullingItem.prototype.update=function(t){this.sphere.center.copy(this.entity.getPosition())},Object.defineProperty(CullingItem.prototype,"ignore",{get:function(){return this.single||this.entity.enabled?this._ignore:!0},set:function(t){this._ignore=t}});var Culling=pc.createScript("culling");Culling.prototype.initialize=function(){this.camera=null,this.list=[]},Culling.prototype.update=function(t){if(this.camera)for(var i=!1,l=null,e=0;e<this.list.length;e++)l=this.list[e],l.ignore||(i=!this.camera.frustum.containsSphere(l.sphere),i!==l.culled&&l.state(i))},Culling.prototype.setCamera=function(t){this.camera=t},Culling.prototype.add=function(t){this.list.push(t)},Culling.prototype.remove=function(t){var i=this.list.indexOf(t);-1!==i&&this.list.splice(i,1)};var DetailPatch=pc.createScript("detail_patch");DetailPatch.attributes.add("assetNormals",{type:"asset",assetType:"shader"}),DetailPatch.attributes.add("assetDetail",{type:"asset",assetType:"shader"}),DetailPatch.prototype.initialize=function(){this.replace=!1,this.assetNormals.on("load",this.updateMaterials,this),this.assetDetail.on("load",this.updateMaterials,this),this.updateMaterials()},DetailPatch.prototype.update=function(t){this.replace||0!==this.app.overlayLayer||(this.updateMaterials(),this.replace=!0)},DetailPatch.prototype.updateMaterial=function(t){t.chunks.normalXYZPS=this.assetNormals.resource,t.chunks.aoTexPS=this.assetDetail.resource,t.update()},DetailPatch.prototype.updateMaterials=function(){for(var t=this,a=this.app.assets.findByTag("detail-patch"),e=0;e<a.length;e++)a[e].resource?this.updateMaterial(a[e].resource):a[e].once("load",function(){t.updateMaterial(this.resource)})};var Fullscreen=pc.createScript("fullscreen");Fullscreen.prototype.initialize=function(){document.body.style.width="100%",document.body.requestFullScreen=document.body.requestFullScreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullScreen,document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen},Fullscreen.prototype.postInitialize=function(){document.body.requestFullScreen&&(this.uiAttach(),this.app.on("ui:template",this.uiAttach,this))},Fullscreen.prototype.changeState=function(){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?document.exitFullscreen():document.body.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},Fullscreen.prototype.uiAttach=function(){this.app.ui.fullscreenButton&&this.app.ui.fullscreenButton.addEventListener("click",this.changeState.bind(this),!1)};var HomeScreen=pc.createScript("homeScreen");HomeScreen.attributes.add("html",{type:"asset",assetType:"html"}),HomeScreen.attributes.add("css",{type:"asset",assetType:"css"});var LOCAL_STORAGE_DISMISSED="add_home_screen_dismissed_count",LOCAL_STORAGE_VIEW="add_home_screen_view_count";HomeScreen.prototype.initialize=function(){return this.element=null,this.html?this.css?(this.storeView(),void(this.shouldShow()&&this.createBubble())):void console.error("Missing css asset"):void console.error("Missing html asset")},HomeScreen.prototype.storeView=function(){try{result=Number(window.localStorage[LOCAL_STORAGE_VIEW])||0,result++,window.localStorage[LOCAL_STORAGE_VIEW]=result}catch(e){}},HomeScreen.prototype.getViewCount=function(){var e;try{e=Number(window.localStorage[LOCAL_STORAGE_VIEW])}catch(t){}return e||0},HomeScreen.prototype.shouldShow=function(){return this.getViewCount()>1&&this.isMobileSafari()&&!this.hasBeenDismissedTooManyTimes()&&!this.isFullscreen()},HomeScreen.prototype.isMobileSafari=function(){return/iPhone|iPod|iPad/.test(window.navigator.userAgent)},HomeScreen.prototype.isIpad=function(){return/iPad/.test(window.navigator.userAgent)},HomeScreen.prototype.hasBeenDismissedTooManyTimes=function(){try{return Number(window.localStorage[LOCAL_STORAGE_DISMISSED]||0)>1}catch(e){return!0}},HomeScreen.prototype.isFullscreen=function(){return!!window.navigator.standalone},HomeScreen.prototype.createBubble=function(){var e=this,t=this.html,n=document.createElement("div");n.innerHTML=t.resource,this.isIpad()&&n.classList.add("ipad"),document.body.appendChild(n),this.element=n;var o=function(){var t=document.getElementById("close");t&&(t.addEventListener("click",e.dismiss.bind(e)),t.addEventListener("touchend",e.dismiss.bind(e)))};o(),t.on("change",function(){n.innerHTML=t.resource,o()}.bind(this));var r=this.css,i=pc.createStyle(r.resource);document.head.appendChild(i),r.on("change",function(){i.innerHTML=r.resource})},HomeScreen.prototype.dismiss=function(){this.element.parentElement.removeChild(this.element);try{var e=Number(window.localStorage[LOCAL_STORAGE_DISMISSED]||0);window.localStorage[LOCAL_STORAGE_DISMISSED]=e+1}catch(t){}};var Indicator=pc.createScript("indicator");Indicator.attributes.add("camera",{type:"entity"}),Indicator.attributes.add("height",{type:"number","default":4}),Indicator.prototype.initialize=function(){this.plane=this.entity.getChildren()[0],this.app.on("own:update",function(t){this.entity.setPosition(t.x,this.height,t.z),this.camera&&this.entity.lookAt(this.camera.getPosition())},this),this.app.on("own:hide",function(t){t?this.plane.enabled=!1:(this.plane.enabled=!0,this.timer=5)},this)},Indicator.prototypeupdate=function(t){this.timer>0&&(this.timer-=t,this.timer<0&&(this.plane.enabled=!1))};var InfoBox=pc.createScript("infoBox");InfoBox.prototype.initialize=function(){var i=this.app;this.uiAttach(),i.on("ui:template",this.uiAttach,this),window.addEventListener("keydown",function(t){i.allowGameInput&&(27===t.keyCode&&i.ui.infoBox&&i.ui.infoBox.classList.contains("active")&&i.ui.infoBox.classList.remove("active"),73===t.keyCode&&i.ui.infoBox&&!i.ui.infoBox.classList.contains("active")&&i.ui.infoBox.classList.add("active"))},!1)},InfoBox.prototype.uiAttach=function(){var i=this.app;if(i.ui.infoButton){var t=function(){i.ui.infoBox.classList.add("active")};i.ui.infoButton.addEventListener("click",t,!1),i.ui.infoButton.addEventListener("touchstart",t,!1)}if(i.ui.infoBox){var o=function(){i.ui.infoBox.classList.remove("active")};i.ui.infoBox.addEventListener("click",o,!1),i.ui.infoBox.addEventListener("touchstart",o,!1)}};var Levels=pc.createScript("levels");Levels.attributes.add("lightsUpdate",{type:"number",placeholder:"ms","default":200,title:"Lights Update",description:"How often dynamic lights update"}),Levels.prototype.initialize=function(){this.cluster=this.app.root.getChildren()[0].script.cluster,this.pickables=this.app.root.getChildren()[0].script.pickables,this.current=null,this.lights=[],this.lightsUpdated=0,this.lightsOn=!1},Levels.prototype.set=function(t){var i=t.name,e=this.app,s=this;null!==this.current&&(e.root.findByName(this.current.name).enabled=!1),this.pickables.clear(),this.lights=[];var h=e.root.findByName(i);h.enabled=!0;for(var l=e.assets.findByTag(i),a=0,r=function(){if(a++,a===l.length){e.lightmapper.bake();for(var t=h.findByTag("shadowmap-update"),i=0;i<t.length;i++)t[i].light&&s.lights.push(t[i]);s.lightsUpdated=s.lightsUpdate/1e3,e.firstStart++}},d=0;d<l.length;d++)l[d].ready(r),e.assets.load(l[d]);this.cluster.fill(t),this.current={name:i,width:this.cluster.width*this.cluster.size,height:this.cluster.height*this.cluster.size}},Levels.prototype.update=function(t){if(this.lightsUpdated+=t,this.lightsOn){this.lightsOn=!1;for(var i=0;i<this.lights.length;i++)this.lights[i].light.shadowUpdateMode=pc.SHADOWUPDATE_NONE}else if(this.lights.length&&1e3*this.lightsUpdated>this.lightsUpdate){this.lightsUpdated=0,this.lightsOn=!0;for(var i=0;i<this.lights.length;i++)this.lights[i].light.shadowUpdateMode=pc.SHADOWUPDATE_REALTIME}};var Link=pc.createScript("link");Link.attributes.add("centreLocation",{type:"vec2","default":[24,24],placeholder:["x","z"],title:"Centre Location"}),Link.attributes.add("offset",{type:"vec3","default":[8.5,12,8.5],placeholder:["x","y","z"],title:"Offset"}),Link.attributes.add("pitch",{type:"number","default":-45,placeholder:"pitch",title:"Pitch Angle"}),Link.vec3A=new pc.Vec3,Link.vec3B=new pc.Vec3,Link.vec2A=new pc.Vec2,Link.prototype.initialize=function(){this.entity.link=this.link.bind(this),this.link=null,this.vec=new pc.Vec2,this.vecS=new pc.Vec3,this.angle=0,this.lastAngle=0,this.lastSend=0,this.mPos=[0,0],this.strengthShake=0,this.mouse={move:!1,x:0,y:0};var t=this.app;t.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.client=t.root.getChildren()[0].script.client,this.entity.setLocalEulerAngles(this.pitch,45,0),this.on("attr:pitch",function(){this.entity.setLocalEulerAngles(this.pitch,45,0)}),t.root.getChildren()[0].script.culling.setCamera(this.entity.camera),"ontouchstart"in document.documentElement?t.root.findByName("target").destroy():this.target=t.root.findByName("target"),this._vr=!1,t.on("vr:enter",function(){this._vr=!0},this),t.on("vr:leave",function(){this._vr=!1},this),t.on("camera:addShake",this.addShake,this)},Link.prototype.update=function(t){var i=Link.vec3A,e=Link.vec3B,s=Link.vec2A,n=this.app;if(this.link){var h=this.link;if(this._vr)h&&this.entity.setLocalPosition(0,0,0);else{if(this.link.script.tank.dead?(this.target&&(this.target.enabled=!1),h=this.link.script.tank.killer&&this.link.script.tank.killer.script&&!this.link.script.tank.killer.script.tank.dead?this.link.script.tank.killer:null):this.target&&(this.target.enabled=!0),h){if(i.copy(this.offset),i.x+=h.getLocalPosition().x,i.z+=h.getLocalPosition().z,!this.link.script.tank.dead){s.set(this.mPos[0],this.mPos[1]),s.x/=n.graphicsDevice.width/2,s.y/=n.graphicsDevice.height/2,s.y*=1.5;var a=s.x*Math.sin(.75*Math.PI)-s.y*Math.cos(.75*Math.PI);s.y=s.y*Math.sin(.75*Math.PI)+s.x*Math.cos(.75*Math.PI),s.x=a,i.x+=4*s.x,i.z+=4*s.y}}else i.set(this.centreLocation.x+this.offset.x,this.offset.y,this.centreLocation.y+this.offset.z);this.entity.setLocalPosition(i.lerp(this.entity.getLocalPosition(),i,.1))}if(this.mouse&&this.mouse.move){var o=n.graphicsDevice.clientRect||n.graphicsDevice.canvas.getBoundingClientRect();if(this.mPos[0]=this.mouse.x-o.width/2,this.mPos[1]=this.mouse.y-o.height/2,this.entity.camera.screenToWorld(this.mouse.x,this.mouse.y,2,this.vecS),this.target&&this.target.setPosition(this.vecS),!this.link.script.tank.dead){var c=this.entity.getLocalPosition(),r=this.entity.camera.screenToWorld(this.mouse.x,this.mouse.y,1),l=i.set(0,0,0).sub2(r,c).normalize(),k=e.set(0,1,0),g=k.dot(l),p=(k.dot(c)-0)/g,d=l.scale(-p).add(c);d.sub(this.link.getLocalPosition()).normalize(),this.angle=Math.floor(Math.atan2(d.x,d.z)/(Math.PI/180)),this.link.targeting(this.angle)}}}Date.now()-this.lastSend>100&&this.angle!==this.lastAngle&&(this.lastSend=Date.now(),this.lastAngle=this.angle,this.client.socket.send("target",{angle:this.angle})),this.strengthShake>0&&(this.strengthShake-=t,this.entity.setLocalPosition(this.entity.getLocalPosition().x+pc.math.random(-this.strengthShake,this.strengthShake),this.entity.getLocalPosition().y+pc.math.random(-this.strengthShake,this.strengthShake),this.entity.getLocalPosition().z+pc.math.random(-this.strengthShake,this.strengthShake)))},Link.prototype.addShake=function(t){this.strengthShake=Math.min(this.strengthShake+t,1)},Link.prototype.onMouseMove=function(t){this.mouse.x=t.x,this.mouse.y=t.y,this.mouse.move=!0},Link.prototype.link=function(t){this.link=t};var Music=pc.createScript("music");Music.attributes.add("mute",{type:"boolean","default":!1}),Music.attributes.add("music",{type:"boolean","default":!1}),Music.prototype.initialize=function(){this.volume=.5,this.volumeTarget=.5,this.app.on("overlay:state",this.onOverlayState,this),this.soundSystem=this.app.systems.sound,this.uiAttach();var t=this.mute?"0":"1";localStorage.mute&&localStorage.mute!==t&&this.toggleState(),t=this.music?"0":"1",localStorage.music&&localStorage.music!==t?this.toggleStateMusic():this.entity.sound.play("music")},Music.prototype.onOverlayState=function(t){t?this.volumeTarget=.5:this.volumeTarget=.2},Music.prototype.toggleState=function(){var t=this.app;this.mute?(this.soundSystem.volume=1,t.ui.muteButton.classList.remove("disabled"),t.ui.musicButton.classList.remove("hidden"),this.music||this.entity.sound.play("music")):(this.entity.sound.pause(),this.soundSystem.volume=0,t.ui.muteButton.classList.add("disabled"),t.ui.musicButton.classList.add("hidden")),this.mute=!this.mute,localStorage.mute=this.mute?"0":"1"},Music.prototype.toggleStateMusic=function(){var t=this.app;this.mute||(this.music?(this.entity.sound.play("music"),t.ui.musicButton.classList.remove("disabled")):(this.entity.sound.pause(),t.ui.musicButton.classList.add("disabled")),this.music=!this.music,localStorage.music=this.music?"0":"1")},Music.prototype.uiAttach=function(){var t=this.app;t.ui.muteButton&&(t.ui.muteButton.addEventListener("click",this.toggleState.bind(this),!1),t.ui.muteButton.addEventListener("touchstart",this.toggleState.bind(this),!1)),t.ui.musicButton&&(t.ui.musicButton.addEventListener("click",this.toggleStateMusic.bind(this),!1),t.ui.musicButton.addEventListener("touchstart",this.toggleStateMusic.bind(this),!1))},Music.prototype.update=function(t){this.mute||this.volume===this.volumeTarget||(this.volume+=.1*(this.volumeTarget-this.volume),Math.abs(this.volume-this.volumeTarget)<.01&&(this.volume=this.volumeTarget),this.entity.sound.volume=this.volume)};var Overlay=pc.createScript("overlay");Overlay.prototype.initialize=function(){var e=this.app;this.uiAttach(),e.on("ui:template",this.uiAttach,this),this.usernameFn=null,this.timerStart=0,this.timerElapse=1,this.timerSecond=0,this.imagesStore="https://s3-eu-west-1.amazonaws.com/static.playcanvas.com/tanx/",this.touch=e.root.getChildren()[0].script.touch,this.overlay(!0),this.cinematic(!0),this.timer(5)},Overlay.prototype.uiAttach=function(){var e=this.app;e.ui.powered&&e.ui.powered.addEventListener("touchstart",function(){window.open(this.href)},!1),e.ui.overlayDisconnectedPlayAgain&&(e.ui.overlayDisconnectedPlayAgain.addEventListener("click",function(){window.location.reload()},!1),e.ui.overlayDisconnectedPlayAgain.addEventListener("touchstart",function(){window.location.reload()},!1)),e.ui.overlayFirstStart&&(e.keyboard.on(pc.EVENT_KEYDOWN,function(i){i.key===pc.KEY_SPACE&&e.fire("inputRespawn")}),e.ui.overlayFirstStart.addEventListener("click",function(){e.fire("inputRespawn")},!1),e.ui.overlayFirstStart.addEventListener("touchstart",function(){e.fire("inputRespawn")},!1)),e.ui.overlayKillerRespawn&&(e.keyboard.on(pc.EVENT_KEYDOWN,function(i){i.key===pc.KEY_SPACE&&e.fire("inputRespawn")}),e.ui.overlayKillerRespawn.addEventListener("click",function(){e.fire("inputRespawn")},!1),e.ui.overlayKillerRespawn.addEventListener("touchstart",function(){e.fire("inputRespawn")},!1))},Overlay.prototype.update=function(e){var i=this.app;if(i.ui.userLoginTooltip.classList.contains("active")&&(i.loginTooltipTime-=500*e,i.loginTooltipTime<=0&&i.ui.userLoginTooltip.classList.remove("active")),!i.ui.overlayDisconnected.classList.contains("active"))if(this.timerStart){var t=this.timerElapse-Math.round((Date.now()-this.timerStart)/1e3);t>=0?this.timerSecond!==t&&(this.timerSecond=t,i.ui.overlayKillerRespawn&&(i.ui.overlayKillerRespawn.textContent="respawn in "+t,i.ui.overlayKillerRespawn.classList.contains("ready")&&i.ui.overlayKillerRespawn.classList.remove("ready"))):(this.timerStart=0,i.ui.overlayKillerRespawn&&(i.ui.overlayKillerRespawn.textContent="respawn",i.ui.overlayKillerRespawn.classList.contains("ready")||i.ui.overlayKillerRespawn.classList.add("ready")))}else 1===i.firstStart&&(i.ui.overlayHelpDesktop&&i.ui.overlayHelpDesktop.classList.remove("active"),i.ui.overlayLoading&&i.ui.overlayLoading.classList.remove("active"),i.ui.overlayFirstStart&&i.ui.overlayFirstStart.classList.add("active"),i.firstStart++)},Overlay.prototype.overlay=function(e){var i=this.app;e?(i.ui.overlay&&(i.ui.overlay.style.backgroundColor="rgba(50, 50, 50, 0.8)",i.ui.overlay.classList.add("active"),i.overlayLayer++),this.touch.hidden(!0),i.fire("overlay:state",e)):(i.overlayLayer--,i.overlayLayer<=0&&(i.overlayLayer=0,i.ui.overlay.style.backgroundColor="rgba(50, 50, 50, 0)",i.ui.overlay.classList.remove("active"),this.touch.hidden(!1),this.timer(!1),i.fire("overlay:state",e)),i.ui.overlayLogo&&(i.ui.overlayLogo.style.display="none"),i.ui.logo&&i.ui.logo.classList.remove("active"),i.ui.powered&&i.ui.powered.classList.remove("initial"))},Overlay.prototype.cinematic=function(e){var i=this.app;i.ui.cinematic&&(e?i.ui.cinematic.classList.add("active"):i.ui.cinematic.classList.remove("active"))},Overlay.prototype.username=function(e,i){var t=this.app;if(e===!0)t.ui.usernamePopup&&t.ui.usernamePopup.classList.remove("active"),this.usernameFn&&t.ui.usernamePopupInput&&this.usernameFn(t.ui.usernamePopupInput);else if(e){this.usernameFn=i,t.ui.usernamePopup&&t.ui.usernamePopup.classList.add("active"),t.ui.usernamePopupInput&&(t.ui.usernamePopupInput.value=e);setTimeout(function(){t.ui.usernamePopupInput&&(t.ui.usernamePopupInput.focus(),t.ui.usernamePopupInput.select())},200)}else t.ui.usernamePopup&&t.ui.usernamePopup.classList.remove("active"),this.usernameFn&&this.usernameFn()},Overlay.prototype.winner=function(e){var i=this.app;i.firstStart=1,e?(this.killer(!1),i.ui.overlayWinner&&i.ui.overlayWinner.classList.add("active"),i.ui.overlayWinnerTeam&&(i.ui.overlayWinnerTeam.textContent=e),i.ui.overlayWinnerIcon&&(i.ui.overlayWinnerIcon.className="icon "+e)):i.ui.overlayWinner&&i.ui.overlayWinner.classList.remove("active")},Overlay.prototype.timer=function(e){var i=this.app;!e||i.ui.overlayDisconnected&&i.ui.overlayDisconnected.classList.contains("active")?this.timerStart=0:(this.timerStart=Date.now(),this.timerElapse=e,this.timerSecond=-1)},Overlay.prototype.killer=function(e,i){var t=this.app;!e||t.ui.overlayDisconnected&&t.ui.overlayDisconnected.classList.contains("active")||t.ui.overlayWinner&&t.ui.overlayWinner.classList.contains("active")?(this.timerStart=null,t.ui.overlayKiller&&t.ui.overlayKiller.classList.remove("active")):(this.timerStart=Date.now(),t.ui.overlayKiller&&t.ui.overlayKiller.classList.add("active"),t.ui.overlayKillerIcon&&(t.ui.overlayKillerIcon.className="icon "+i),t.ui.overlayKillerName&&(t.ui.overlayKillerName.textContent=e))},Overlay.prototype.disconnected=function(){var e=this.app;e.ui.overlayDisconnected&&e.ui.overlayDisconnected.classList.add("active"),e.ui.overlayLogo&&e.ui.overlayLogo.classList.remove("active"),e.ui.overlayHelpDesktop&&e.ui.overlayHelpDesktop.classList.remove("active"),e.ui.leaderboards&&e.ui.leaderboards.classList.remove("active"),e.ui.profile&&e.ui.profile.classList.remove("active"),e.ui.userProgressBar&&e.ui.userProgressBar.classList.remove("pulse"),e.ui.overlayWinner&&e.ui.overlayWinner.classList.remove("active"),e.ui.overlayKiller&&e.ui.overlayKiller.classList.remove("active"),e.ui.overlayLoading&&e.ui.overlayLoading.classList.remove("active"),e.ui.overlayFirstStart&&e.ui.overlayFirstStart.classList.remove("active"),e.ui.userInfo&&e.ui.userInfo.classList.add("hidden"),e.ui.userName&&e.ui.userName.classList.add("hidden"),e.ui.userStats&&e.ui.userStats.classList.add("hidden"),e.ui.fullscreenButton&&(e.ui.fullscreenButton.style.display="none"),e.ui.infoButton&&(e.ui.infoButton.style.display="none"),e.ui.teams&&(e.ui.teams.style.display="none"),this.overlay(!0)};var Pickable=pc.createScript("pickable");Pickable.prototype.initialize=function(){this._hidden=!1,this.model=this.entity.findByName("model"),this.glow=this.entity.findByName("glow"),this.aura=this.entity.findByName("aura"),this.scaleY=this.entity.getLocalScale().y,this.finished=!1;var i=this;this.entity.on("culled",function(t){i.hidden(t)}),this.el=document.getElementById("stat"),this.yaw=0},Pickable.prototype.update=function(i){if(!this.finished&&!this._hidden){this.yaw-=180*i;var t=Math.sin(this.yaw/64);this.model.setLocalEulerAngles(0,this.yaw,0),this.model.setLocalPosition(0,(.7+.2*t)/this.scaleY,0);var e=1.5+.5*t;this.glow.setLocalScale(e,1,e)}},Pickable.prototype.hidden=function(i){this._hidden!==i&&(this._hidden=i,this.model.enabled=!this._hidden,this.glow.enabled=!this._hidden,this.aura.enabled=!this._hidden)},Pickable.prototype.finish=function(){if(!this.finished){this.finished=!0,this.hidden(!0),this.entity.audiosource.play(this.entity.audiosource.data.currentSource);var i=this;setTimeout(function(){i.entity.audiosource.stop(),i.entity.fire("finish"),i.hidden(!1),i.entity.enabled=!1,i.finished=!1},1500)}};var Pickables=pc.createScript("pickables");Pickables.prototype.initialize=function(){var i=this.app;this.templates=i.root.findByName("pickables-templates"),this.templates.enabled=!1,this.pickables=i.root.findByName("pickables"),this.pick={},this.pool={},this.length={},this.index={};for(var t=this.templates.getChildren(),e=0;e<t.length;e++){var s=t[e].name.slice(9);this.pool[s]=[],this.length[s]=0,this.pick[s]=t[e]}},Pickables.prototype["new"]=function(i){var t=this,e=i.t||"default";if(0===this.pool[e].length){var s=this.length[e];this.length[e]+=4;for(var l=0;l<this.length[e]-s;l++){var h=this.pick[e].clone();h.type=e,h.on("finish",function(){t["delete"]({id:this.id})}),this.pool[e].push(h)}}var h=this.pool[e].pop();this.index[i.id]=h,h.id=i.id,h.enabled=!0,h.setLocalPosition(i.x,0,i.y),this.pickables.addChild(h),h.fire("start")},Pickables.prototype.finish=function(i){var t=this.index[i.id];t&&t.script.pickable.finish()},Pickables.prototype["delete"]=function(i){var t=this.index[i.id];if(t){t.enabled=!1,this.pickables.removeChild(t);var e=this.pool[t.type].indexOf(t);this.pool[t.type].splice(e,1),delete this.index[i.id],this.pool[t.type].push(t)}},Pickables.prototype.clear=function(){for(var i in this.index)this["delete"]({id:i})};var Profile=pc.createScript("profile"),prepareFormData=function(e){var i=[];for(var n in e)i.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return i.join("&").replace(/%20/g,"+")};Profile.prototype.initialize=function(){var e=this.app;this.client=e.root.getChildren()[0].script.client,this.overlay=e.root.getChildren()[0].script.overlay,this.value="Log In",this.uiAttach(),e.on("ui:template",this.uiAttach,this),window.addEventListener("keydown",function(i){13===i.keyCode,27===i.keyCode&&e.ui.profileSignInPane.classList.contains("active")&&e.ui.profileClose&&e.ui.profileClose.click()},!1)},Profile.prototype.uiAttach=function(){var e=this,i=this.app;if(i.ui.userInfo){var n=function(){e.client.connected&&(e.client.user.twitter||e.client.user.facebook||e.client.user.email?window.location=e.client.url+"/profile/overview":i.ui.profile&&i.ui.profileSignInPane&&(i.ui.profileSignInPane.classList.add("active"),i.ui.leaderboards.classList.contains("active")&&i.ui.leaderboards&&(i.ui.leaderboards.classList.remove("active"),e.overlay.overlay(!1,!0)),i.ui.profile.classList.contains("active")||(i.ui.profile.classList.add("active"),e.overlay.overlay(!0),i.allowGameInput=!1),e.resetInput(),i.ui.profileSignInPane.classList.add("active"),i.ui.profileSignUpPane.classList.remove("active"),i.ui.profileResetPane.classList.remove("active")))};i.ui.userInfo.addEventListener("click",n,!1),i.ui.userInfo.addEventListener("touchstart",n,!1)}if(i.ui.userName){var t=function(){e.client.connected&&(e.client.user.twitter||e.client.user.facebook||e.client.user.email?window.location=e.client.url+"/profile/overview":i.ui.profile&&i.ui.profileSignInPane&&(i.ui.profileSignInPane.classList.add("active"),i.ui.leaderboards.classList.contains("active")&&i.ui.leaderboards&&(i.ui.leaderboards.classList.remove("active"),e.overlay.overlay(!1,!0)),i.ui.profile.classList.contains("active")||(i.ui.profile.classList.add("active"),e.overlay.overlay(!0),i.allowGameInput=!1),e.resetInput(),i.ui.profileSignInPane.classList.add("active"),i.ui.profileSignUpPane.classList.remove("active"),i.ui.profileResetPane.classList.remove("active")))};i.ui.userName.addEventListener("click",t,!1),i.ui.userName.addEventListener("touchstart",t,!1)}if(i.ui.profileSignInPaneSignIn){var a=function(){if(e.client.connected){var n=new XMLHttpRequest;n.withCredentials=!0,n.addEventListener("load",function(){var e=JSON.parse(n.responseText);200==this.status?window.location.reload():e.error&&i.ui.profileSignInPaneSignInErrors&&(i.ui.profileSignInPaneSignInErrors.classList.add("active"),i.ui.profileSignInPaneSignInErrors.innerHTML=e.error)});var t=prepareFormData({email:i.ui.profileSignInPaneEmailInput.value,password:i.ui.profileSignInPanePasswordInput.value});n.open("POST",e.client.url+"/login"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t)}};i.ui.profileSignInPaneSignIn.addEventListener("click",a,!1),i.ui.profileSignInPaneSignIn.addEventListener("touchstart",a,!1)}if(i.ui.profileSignInPaneSignUpTab){var r=function(){i.ui.profileSignUpPane&&i.ui.profileSignUpPane.classList.add("active"),i.ui.profileSignInPane&&(i.ui.profileSignInPane.classList.remove("active"),i.ui.profileResetPane.classList.remove("active")),e.resetInput()};i.ui.profileSignInPaneSignUpTab.addEventListener("click",r,!1),i.ui.profileSignInPaneSignUpTab.addEventListener("touchstart",r,!1)}if(i.ui.profileSignUpPaneSignInTab){var o=function(){i.ui.profileSignInPane&&i.ui.profileSignInPane.classList.add("active"),i.ui.profileSignUpPane&&(i.ui.profileSignUpPane.classList.remove("active"),i.ui.profileResetPane.classList.remove("active")),e.resetInput()};i.ui.profileSignUpPaneSignInTab.addEventListener("click",o,!1),i.ui.profileSignUpPaneSignInTab.addEventListener("touchstart",o,!1)}if(i.ui.profileSignUpPaneSignUp&&i.ui.profileSignUpPaneEmailInput&&i.ui.profileSignUpPanePasswordInput&&i.ui.profileSignUpPanePasswordConfirmInput&&i.ui.profileSignUpPaneNameInput){var s=function(){if(e.client.connected){var n=i.ui.profileSignUpPaneNameInput.value,t=i.ui.profileSignUpPaneEmailInput.value,a=new XMLHttpRequest;a.withCredentials=!0,a.addEventListener("load",function(){console.log(a.responseText);var r=JSON.parse(a.responseText);200==this.status?(i.ui.profileSignUpPaneSignUpErrors.classList.remove("active"),e.client.user.email=t,e.client.user.name=n,e.set(n),i.ui.userLoginTooltip&&i.ui.userLoginTooltip.classList.add("hidden"),i.ui.userName&&i.ui.userName.classList.remove("login"),i.ui.leaderboards&&i.ui.leaderboards.classList.remove("guest"),i.ui.profileSignUpPane.classList.contains("active")&&i.ui.profileClose&&i.ui.profileClose.click()):r.error&&i.ui.profileSignUpPaneSignUpErrors&&(i.ui.profileSignUpPaneSignUpErrors.classList.add("active"),i.ui.profileSignUpPaneSignUpErrors.innerHTML=r.error)});var r=prepareFormData({name:n,email:t,password:i.ui.profileSignUpPanePasswordInput.value,confirm_password:i.ui.profileSignUpPanePasswordConfirmInput.value});a.open("POST",e.client.url+"/signup"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(r)}};i.ui.profileSignUpPaneSignUp.addEventListener("click",s,!1),i.ui.profileSignUpPaneSignUp.addEventListener("touchstart",s,!1)}if(i.ui.profileSignInPaneForgotTab){var l=function(){i.ui.profileResetPane&&i.ui.profileResetPane.classList.add("active"),i.ui.profileSignInPane&&i.ui.profileSignInPane.classList.remove("active"),e.resetInput()};i.ui.profileSignInPaneForgotTab.addEventListener("click",l,!1),i.ui.profileSignInPaneForgotTab.addEventListener("touchstart",l,!1)}if(i.ui.profileResetPaneReset&&i.ui.profileResetPaneEmailInput){var u=function(){i.ui.profileResetPane.classList.remove("active"),i.ui.profileSocialPane.classList.remove("active"),i.ui.profileResetSentPane.classList.add("active"),e.resetInput()};i.ui.profileResetPaneReset.addEventListener("click",u,!1),i.ui.profileResetPaneReset.addEventListener("touchstart",u,!1)}if(i.ui.profileResetPaneBack){var p=function(){i.ui.profileSignInPane&&(i.ui.profileSignInPane.classList.add("active"),i.ui.profileSocialPane.classList.add("active")),i.ui.profileSignUpPane&&(i.ui.profileSignUpPane.classList.remove("active"),i.ui.profileResetPane.classList.remove("active")),e.resetInput()};i.ui.profileResetPaneBack.addEventListener("click",p,!1),i.ui.profileResetPaneBack.addEventListener("touchstart",p,!1)}if(i.ui.profileResetSentPaneBack){var c=function(){i.ui.profileSignInPane&&(i.ui.profileSignInPane.classList.add("active"),i.ui.profileSocialPane.classList.add("active")),i.ui.profileResetSentPane&&i.ui.profileResetSentPane.classList.remove("active"),e.resetInput()};i.ui.profileResetSentPaneBack.addEventListener("click",c,!1),i.ui.profileResetSentPaneBack.addEventListener("touchstart",c,!1)}if(i.ui.profileTwitter){var f=function(){e.client.connected&&(e.resetInput(),window.location=e.client.url+"/auth/twitter")};i.ui.profileTwitter.addEventListener("click",f,!1),i.ui.profileTwitter.addEventListener("touchstart",f,!1)}if(i.ui.profileFacebook){var d=function(){e.client.connected&&(e.resetInput(),window.location=e.client.url+"/auth/facebook")};i.ui.profileFacebook.addEventListener("click",d,!1),i.ui.profileFacebook.addEventListener("touchstart",d,!1)}if(i.ui.profileClose){var v=function(){e.client.connected&&(i.ui.profile&&i.ui.profile.classList.remove("active"),i.ui.profileSignIn&&i.ui.profileSignIn.classList.remove("active"),e.resetInput(),e.overlay.overlay(!1),i.allowGameInput=!0)};i.ui.profileClose.addEventListener("click",v,!1),i.ui.profileClose.addEventListener("touchstart",v,!1)}},Profile.prototype.resetInput=function(){var e=this.app;e.ui.profileSignInPaneSignInErrors&&(e.ui.profileSignInPaneSignInErrors.classList.remove("active"),e.ui.profileSignInPaneSignInErrors.innerHTML=""),e.ui.profileSignUpPaneSignUpErrors&&(e.ui.profileSignUpPaneSignUpErrors.classList.remove("active"),e.ui.profileSignUpPaneSignUpErrors.innerHTML=""),e.ui.profileSignInPaneEmailInput.value="",e.ui.profileSignInPanePasswordInput.value="",e.ui.profileSignUpPaneNameInput.value="",e.ui.profileSignUpPaneEmailInput.value="",e.ui.profileSignUpPanePasswordInput.value="",e.ui.profileSignUpPanePasswordConfirmInput.value="",e.ui.profileResetPaneEmailInput.value=""},Profile.prototype.set=function(e){this.client.user.twitter||this.client.user.facebook||this.client.user.email?this.app.ui.userLoginTooltip&&this.app.ui.userLoginTooltip.classList.add("hidden"):this.app.ui.userName&&this.app.ui.userName.classList.add("login"),this.app.ui.userName&&(this.app.ui.userName.textContent=e)};var Share=pc.createScript("share");Share.prototype.initialize=function(){var e=this.app;this.client=e.root.getChildren()[0].script.client,this.uiAttach(),e.on("ui:template",this.uiAttach,this),window.addEventListener("keydown",function(t){27===t.keyCode&&e.ui.share&&e.ui.share.classList.contains("active")&&e.ui.share.classList.remove("active")},!1)},Share.prototype.uiAttach=function(){var e=this,t=this.app;if(t.ui.shareInput&&this.client.user&&(t.ui.shareInput.value="http://tanx.playcanvas.com?u="+this.client.user.share),t.ui.shareButton){var i=function(){t.ui.share&&(t.ui.share.classList.add("active"),t.ui.shareCopied&&t.ui.shareCopied.classList.remove("active"),t.ui.shareInput&&t.ui.shareInput.focus())};t.ui.shareButton.addEventListener("click",i,!1),t.ui.shareButton.addEventListener("touchstart",i,!1)}if(t.ui.shareInput){var a=function(){if(t.ui.shareInput.select(),document.execCommand)try{var e=document.execCommand("copy");e&&t.ui.shareCopied&&t.ui.shareCopied.classList.add("active")}catch(i){}};t.ui.shareInput.addEventListener("focus",a,!1),t.ui.shareInput.addEventListener("click",a,!1),t.ui.shareInput.addEventListener("touchstart",a,!1)}if(t.ui.shareCopied){var s=function(){t.ui.shareCopied.classList.remove("active")};t.ui.shareCopied.addEventListener("click",s,!1),t.ui.shareCopied.addEventListener("touchstart",s,!1)}if(t.ui.shareClose){var r=function(){t.ui.share.classList.remove("active")};t.ui.shareClose.addEventListener("click",r,!1),t.ui.shareClose.addEventListener("touchstart",r,!1)}if(t.ui.shareTwitter){var n=function(){e.share("twitter")};t.ui.shareTwitter.addEventListener("click",n,!1),t.ui.shareTwitter.addEventListener("touchstart",n,!1)}if(t.ui.shareFacebook){var o=function(){e.share("facebook")};t.ui.shareFacebook.addEventListener("click",o,!1),t.ui.shareFacebook.addEventListener("touchstart",o,!1)}},Share.prototype.share=function(e){var t=this.app,i=screen.width/2-320,a=screen.height/2-190,s=encodeURIComponent(t.ui.shareInput.value),r=encodeURIComponent("Join me in multiplayer @tanxgame! Powered by PlayCanvas");switch(e){case"facebook":s="https://facebook.com/sharer/sharer.php?u="+s;break;case"twitter":s="https://twitter.com/intent/tweet?url="+s+"&text="+r}var n=window.open(s,"name","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=640, height=380, top="+a+", left="+i);window.focus&&n&&n.focus()};var TankName=pc.createScript("tank_name");TankName.camera=null,TankName.prototype.initialize=function(){var t=this,e=this.app;Tank.camera||(Tank.camera=e.root.findByName("camera").camera),this.vec=new pc.Vec2,this.element=document.createElement("div"),this.element.classList.add("name");var i=users[this.entity.owner];this.element.textContent="["+i.level+"] "+(i&&i.name)||"guest",e.on("users:level:"+this.entity.owner,function(t){i.level=t,this.element.textContent="["+i.level+"] "+(i&&i.name)||"guest"},this),e.on("users:name:"+this.entity.owner,function(t){this.element.textContent="["+i.level+"] "+t},this),this.uiAttach(),e.on("ui:template",this.uiAttach,this),this.entity.on("state",function(t){t?this.element.classList.remove("active"):this.element.classList.add("active")},this),this.entity.on("color",function(t){this.element.style.color="rgb("+t[0]+", "+t[1]+", "+t[2]+")"},this),this.entity.on("destroy",function(){t.destroy()})},TankName.prototype.setLevel=function(t){return users[this.entity.owner].level===t?!1:(users[this.entity.owner].level=t,this.element.textContent="["+t+"] "+users[this.entity.owner].name,!0)},TankName.prototype.uiAttach=function(){this.app.ui.names&&this.app.ui.names.appendChild(this.element)},TankName.prototype.destroy=function(){this.element.parentNode.removeChild(this.element),this.app.off("ui:template",this.uiAttach,this)},TankName.prototype.postUpdate=function(){if(!this.entity.script.tank._hidden&&!this.entity.script.cullingItem.culled){var t=this.entity.script.tank.hpBar.getPosition();t.y+=.1,Tank.camera.worldToScreen(t,this.vec);var e=this.app.graphicsDevice.clientRect||this.app.graphicsDevice.canvas.getBoundingClientRect();this.element.style.transform="translate("+(e.left+this.vec.x).toFixed(2)+"px, "+(e.top+this.vec.y).toFixed(2)+"px)"}};var TankSkin=pc.createScript("tank_skin");TankSkin.prototype.initialize=function(){this.current="",this.body=this.entity.findByTag("body")[0],this.tower=this.entity.findByTag("tower")[0],this.shadow=this.entity.findByTag("shadow")[0],this.gun=null},TankSkin.prototype.setSkin=function(e,t,s){var a=this.app,r=e+";"+t+";"+s;if(a.skins.skins[e]&&this.current!==r){this.current=r;var n,i=this,o=a.assets.findByTag(["tank","model",e,"body"])[0],u=a.assets.findByTag(["tank","model",e,"tower"])[0],d=a.assets.findByTag(["tank","texture",e,"amd","low"])[0],m=a.assets.findByTag(["tank","texture",e,"ng","low"])[0],l=a.assets.findByTag(["tank","texture",e,"shadow"])[0],c=a.assets.findByTag(["paintjob","texture",t])[0],f=a.assets.findByTag(["trim","texture",s])[0],h=[o,u,d,m,l,c,f];for(n=0;n<h.length;n++)if(!h[n])return void console.log("skin",e,"has missing asset",n);var g=0,y=function(){g++,g===h.length&&p()};for(n=0;n<h.length;n++)h[n].resource?g++:(h[n].once("load",y),a.assets.load(h[n]));var p=function(){if(i.current===r){i.body.model.asset=o.id,i.tower.model.asset=u.id;var e=i.body.findByName("tower");e?i.tower.setPosition(e.getPosition()):i.tower.setLocalPosition(0,0,0),i.shadow.model.meshInstances[0].setParameter("texture_emissiveMap",l.resource);var t=function(e){for(var t=0;t<e.length;t++){var s=e[t];s.setParameter("texture_aoMap",d.resource),s.setParameter("texture_normalMap",m.resource),"trim"===s.material.name?(s.setParameter("texture_diffuseMap",f.resource),s.setParameter("texture_metalnessMap",f.resource),s.setParameter("texture_glossMap",f.resource)):"paintjob"===s.material.name&&(s.setParameter("texture_metalnessMap",d.resource),s.setParameter("texture_glossMap",m.resource),s.setParameter("texture_diffuseMap",c.resource))}};t(i.body.model.meshInstances),t(i.tower.model.meshInstances),i.gun=i.tower.findByName("gun"),a.fire("skin:load")}};g===h.length&&p()}};var TankSkins=pc.createScript("tankSkins");TankSkins.attributes.add("list",{type:"string","default":""}),TankSkins.attributes.add("default",{type:"string","default":"classic"}),TankSkins.prototype.initialize=function(){this.skins={},this.on("attr:list",this.onListChanged,this),this.onListChanged(this.list),this.app.skins=this},TankSkins.prototype.onListChanged=function(t){this.skins={};for(var i=(t||"").split(","),s=0;s<i.length;s++)this.skins[i[s].trim()]=!0};function lerp(t,e,i){var s=e-t;Math.abs(s)>180&&(s=(360-Math.abs(s))*(-1*Math.sign(s)));var a=t+s*i;return a-=360*Math.floor((a+180)/360)}var Tank=pc.createScript("tank");Tank.tmpVec=new pc.Vec3,Tank.tmpVecB=new pc.Vec3,Tank.matPaintjob=null,Tank.matTrims=null,Tank.matShadow=null,Tank.matGlow=null,Tank.matCircle=null,Tank.camera=null,Tank.prototype.initialize=function(){var t=this.app,e=this.entity;this.entity.angle=this.angle.bind(this),this.entity.targeting=this.targeting.bind(this),this.moveVec=new pc.Vec2,this.movePoint=new pc.Vec3,this.extrapolatePoint=new pc.Vec3,this.currentHeadAngle=0,this.targetHeadAngle=0,this.currentTankAngle=null,this.gun=null,this.tower=null,this.hpBar=null,this.hp=0,this.sp=0,this.id=null,this._hidden=!1,this.currentState=null,this.radius=.75,this.speed=6,this.currentUpdate={time:0,latency:0,pos:new pc.Vec3(e.getPosition())},this.previousUpdate={time:0,pos:new pc.Vec3(e.getPosition())},this.timeToExtrapolate=0,this.collisionItem={pos:{x:0,y:0},radius:this.radius},Tank.camera||(Tank.camera=t.root.findByName("camera").camera);var i=this;this.profile=t.root.getChildren()[0].script.profile,this.tanks=t.root.getChildren()[0].script.tanks,this.tower=this.entity.findByName("tower"),this.body=this.entity.findByName("body"),this.auraShield=this.entity.findByName("shield"),this.hpBar=this.entity.findByName("hp"),this.hpBarLeft=this.hpBar.findByName("left"),this.hpBarRight=this.hpBar.findByName("right"),null===Tank.matGlow&&(Tank.matGlow=t.assets.findByTag(["tpl","glow"])[0].resource),null===Tank.matCircle&&(Tank.matCircle=t.assets.findByTag(["tpl","circle"])[0].resource),this.matGlow=Tank.matGlow.clone(),this.matCircle=Tank.matCircle.clone(),this.entity.fire("ready"),this.movePoint.copy(this.entity.getPosition()),this.extrapolatePoint.copy(this.entity.getPosition()),this.respawned=Date.now(),this.dead=!0,this.flashState=!1,this.flashStateEnd=!1,this.client=t.root.getChildren()[0].script.client,this.ally=!1,this.client.id===this.entity.owner&&(this.own=!0,this.overlay=t.root.getChildren()[0].script.overlay,this.cluster=t.root.getChildren()[0].script.cluster),this.teams=t.root.getChildren()[0].script.teams,this.entity.on("culled",function(t){i.dead||i.hidden(t)}),this.currentState=this.states.killed,this.level=0,this.levelupFX=!0,this.levelupState=!1,this.levelupTime=0},Tank.prototype.postInitialize=function(){this.blinkParts=this.entity.findByTag("sub-part"),this.blinkParts.push(this.entity.findByName("shadow")),this.blinkParts.push(this.hpBar);var t=this.glow=this.entity.findByName("glow");t.model.material=this.matGlow,this.blinkParts.push(t),this.hidden(!0)},Tank.prototype.states={killed:function(){var t=this.app;return this.dead?!0:(this.respawned=Date.now(),this.hidden(!1),this.own&&(t.ui.profile&&this.overlay.overlay(!1),t.ui.overlayFirstStart.classList.contains("active")&&t.ui.overlayFirstStart.classList.remove("active"),this.overlay.cinematic(!1),this.overlay.killer(!1)),this.currentState=this.states.blinking,void 0)},blinking:function(){this.app;if(Date.now()-this.respawned<1500){this.flashStateEnd=!1;var t=Math.floor((Date.now()-this.respawned)/100)%2===1;this.flashState!==t&&(this.flashState=t,this.hidden(!t))}else this.flashState||(this.flashStateEnd=!0,this.flashState=!0,this.hidden(!1)),this.currentState=this.states.usual},usual:function(t){var e=this.app;if(this.dead){if(this.hidden(!0),this.own){window.navigator.vibrate&&window.navigator.vibrate(100+Math.floor(100*Math.random()));var i=this.killer&&users[this.killer.owner],s=i&&i.name||"guest";this.overlay.killer(s,this.teams.names[this.killer&&this.killer.script&&this.killer.script.tank.team]),e.ui.profile&&this.overlay.overlay(!0),this.overlay.cinematic(!0),this.overlay.timer(5),this.app.fire("camera:addShake",.5)}else if(this.tanks.own&&!this.tanks.own.script.tank.dead){Tank.tmpVec.copy(this.entity.getLocalPosition()).sub(this.tanks.own.getLocalPosition());var a=Tank.tmpVec.length();12>a&&this.app.fire("camera:addShake",.5*(1-a/12)),this.tanks.own.owner===this.iKilled.owner&&(Tank.tmpVec.copy(t),Tank.tmpVec.y+=1.5,this.app.fire("award:add",{type:1,pos:Tank.tmpVec,life:200,value:100}))}return this.entity.audiosource.pitch=.6*Math.random()-.3+1,this.entity.audiosource.play("tank_explosion"),Tank.tmpVec.copy(t),Tank.tmpVec.y+=.3,this.app.fire("explosions:add",{type:2,pos:Tank.tmpVec}),this.app.fire("decals:add",{x:t.x,z:t.z,life:1e4}),this.currentState=this.states.killed,!0}}},Tank.prototype.levelup=function(t){var e=this,i=[1,.784,0];e.level=t,e.levelupFX=!0,e.levelupState=!0,e.levelupTime=0,e.tower.model.meshInstances[0].setParameter("state",e.levelupState),e.tower.model.meshInstances[1].setParameter("state",e.levelupState),e.tower.model.meshInstances[0].setParameter("color",i),e.tower.model.meshInstances[1].setParameter("color",i),e.body.model.meshInstances[0].setParameter("state",e.levelupState),e.body.model.meshInstances[1].setParameter("state",e.levelupState),e.body.model.meshInstances[0].setParameter("color",i),e.body.model.meshInstances[1].setParameter("color",i),e.entity.audiosource.pitch=.5,e.entity.audiosource.play("shield")},Tank.prototype.update=function(t){var e,i=this.app,s=this,a=this.entity.getLocalPosition(),n=Tank.tmpVec,o=Tank.tmpVecB;if(s.tower.model.meshInstances&&(s.levelupState===!0&&s.levelupTime<2?(s.levelupTime+=2*t,s.tower.model.meshInstances[0].setParameter("t",s.levelupTime),s.tower.model.meshInstances[1].setParameter("t",s.levelupTime),s.body.model.meshInstances[0].setParameter("t",s.levelupTime),s.body.model.meshInstances[1].setParameter("t",s.levelupTime),s.levelupTime>=1&&s.levelupFX===!0&&(s.levelupFX=!1,i.fire("award:add",{type:0,tank:s.entity}),i.fire("award:add",{type:2,tank:s.entity,life:200,value:s.level}))):s.levelupState===!0&&(s.levelupFX=!0,s.levelupState=!1,s.levelupTime=0,s.tower.model.meshInstances[0].setParameter("state",s.levelupState),s.tower.model.meshInstances[1].setParameter("state",s.levelupState),s.body.model.meshInstances[0].setParameter("state",s.levelupState),s.body.model.meshInstances[1].setParameter("state",s.levelupState))),s.dead)if(this.own)for(var r=0;r<s.tanks.pointers.length;r++)null!==s.tanks.pointers[r].id&&s.tanks.pointers[r].pointer.enabled&&(s.tanks.pointers[r].pointer.enabled=!1);else for(var h=0;h<s.tanks.pointers.length;h++)null!==s.tanks.pointers[h].id&&s.tanks.pointers[h].id===s.id&&s.tanks.pointers[h].pointer.enabled&&(s.tanks.pointers[h].pointer.enabled=!1);else if(Tank.camera.frustum.containsPoint(a))for(var l=0;l<s.tanks.pointers.length;l++)null!==s.tanks.pointers[l].id&&s.tanks.pointers[l].id===s.id&&s.tanks.pointers[l].pointer.enabled&&(s.tanks.pointers[l].pointer.enabled=!1);else for(var p=0;p<s.tanks.pointers.length;p++)null!==s.tanks.pointers[p].id&&s.tanks.pointers[p].id===s.id&&s.tanks.pointers[p].pointer.script.pointer.updateTarget(a.x,a.z);if(!this.currentState.call(this,a))if(this._hidden||this.entity.script.cullingItem.culled)this.entity.setLocalPosition(this.currentUpdate.pos.x,0,this.currentUpdate.pos.z);else{o.copy(a),this.movePoint.copy(a);var c=this.speed*t;this.extrapolation(t),this.own?this.moveVec.set(this.client.movement[0],this.client.movement[1]):this.moveVec.set(0,0),e=this.moveVec.length(),e>0?(this.moveVec.normalize().scale(1.5),this.timeToExtrapolate=Date.now()):Date.now()-this.timeToExtrapolate>3*this.client.latency&&(this.moveVec.x=this.extrapolatePoint.x-this.movePoint.x,this.moveVec.y=this.extrapolatePoint.z-this.movePoint.z),e=this.moveVec.length(),e>0&&(e>1&&this.moveVec.normalize(),this.moveVec.scale(c),this.movePoint.x+=this.moveVec.x,this.movePoint.z+=this.moveVec.y),this.moveVec.x=this.extrapolatePoint.x-this.movePoint.x,this.moveVec.y=this.extrapolatePoint.z-this.movePoint.z,e=this.moveVec.length(),e>0&&(e>5*this.radius||(e*c>c&&this.moveVec.normalize(),this.moveVec.scale(c*(this.own?.5:.25))),this.movePoint.x+=this.moveVec.x,this.movePoint.z+=this.moveVec.y),n.copy(this.movePoint),this.own&&(this.collisionItem.pos.x=a.x,this.collisionItem.pos.y=a.z,this.collisionItem.radius=this.radius,this.cluster.forEachOnCorner(this.collisionItem,function(t){var e=t.collideCircle(s.collisionItem);e&&(n.x+=e[0],n.z+=e[1])}),n.x=Math.max(this.radius,Math.min(this.cluster.width*this.cluster.size-this.radius,n.x)),n.z=Math.max(this.radius,Math.min(this.cluster.height*this.cluster.size-this.radius,n.z))),this.entity.setLocalPosition(n),this.own?n.sub(o).scale(-1):n.copy(this.previousUpdate.pos).sub(this.currentUpdate.pos);var d=n.length();if(d>.06){var m=Math.floor(Math.atan2(n.x,n.z)/(Math.PI/180));null===this.currentTankAngle?this.currentTankAngle=this.entity.getEulerAngles().y:this.currentTankAngle=lerp(this.currentTankAngle,m+180,Math.min(1,.2*(t/(1/60)))),this.entity.setEulerAngles(0,this.currentTankAngle,0)}if(this.currentHeadAngle=lerp(this.currentHeadAngle,this.targetHeadAngle,Math.min(1,.3*(t/(1/60)))),this.tower.setEulerAngles(0,this.currentHeadAngle,0),!this._hidden){if(this.sp){if(this.auraShield.enabled=!0,this.auraShield.setRotation(0,0,0,1),!this.auraShield.script.forceField.state){var u=this.glow.model.material.emissive;this.auraShield.script.forceField.setColor(u.r,u.g,u.b),this.auraShield.script.forceField.setState(!0)}}else this.auraShield.script.forceField.setState(!1);this.hpBar.setRotation(0,0,0,1),this.hpBar.rotate(0,45,0)}this.own&&i.fire("own:update",this.entity.getLocalPosition())}},Tank.prototype.setHP=function(t){if(this.hp!=t){if(this.own&&this.hp>t){var e=this.hp-t;this.app.fire("camera:addShake",.05*(e/3)),window.navigator.vibrate&&window.navigator.vibrate(30+Math.floor(40*Math.random()))}this.hp=t;var i=Math.min(10,t/10);this.hpBarLeft.setLocalScale(i,.1,.1),this.hpBarLeft.setLocalPosition(-Math.max(.01,1-i)/2,0,0),this.hpBarRight.setLocalScale(Math.max(.01,1-i),.1,.1),this.hpBarRight.setLocalPosition(i/2,0,0)}},Tank.prototype.setSP=function(t){if(this.sp!=t){if(this.own&&this.sp>t){var e=this.sp-t;this.app.fire("camera:addShake",.05*(e/3)),window.navigator.vibrate&&window.navigator.vibrate(20+Math.floor(30*Math.random()))}this.sp=t}},Tank.prototype.setName=function(t){},Tank.prototype.setDead=function(t){if(this.dead!=t){this.dead=t;var e=this.app,i=e.ui.teams.querySelectorAll(".team-"+(this.team+1)+" > .tank")[this.inTeam];if(this.dead){if(e.ui.teams&&i&&i.classList.contains("active"))return void i.classList.add("respawn")}else if(e.ui.teams&&i&&i.classList.contains("active"))return void i.classList.remove("respawn")}},Tank.prototype.angle=function(t){this.entity.setRotation(this.entity.getRotation().setFromEulerAngles(0,t,0))},Tank.prototype.targeting=function(t){this.targetHeadAngle=t},Tank.prototype.extrapolation=function(t){var e=(this.currentUpdate.latency+(Date.now()-this.currentUpdate.time))/1e3,i=this.currentUpdate.pos.x,s=this.currentUpdate.pos.z,a=this.currentUpdate.pos.x-this.previousUpdate.pos.x,n=this.currentUpdate.pos.z-this.previousUpdate.pos.z,o=Math.sqrt(a*a+n*n);if(o){a/=o,n/=o;var r=this.speed*t*(e/t);i+=a*r,s+=n*r}this.extrapolatePoint.set(i,0,s)},Tank.prototype.moveTo=function(t){this.previousUpdate.time=this.currentUpdate.time,this.previousUpdate.pos.copy(this.currentUpdate.pos),this.currentUpdate.time=Date.now(),this.currentUpdate.latency=this.client.latency,this.currentUpdate.pos.set(t[0],0,t[1]),this.dead&&this.entity.setPosition(this.currentUpdate.pos)},Tank.prototype.hidden=function(t){if(t=t||!this.entity.script||this.entity.script.cullingItem.culled,this._hidden!==t){this._hidden=t;for(var e=0;e<this.blinkParts.length;e++)this.blinkParts[e].enabled=!this._hidden;this.entity.fire("state",this._hidden),this.own&&this.app.fire("own:hide",this._hidden),this._hidden&&(this.auraShield.script.forceField.setState(!1),this.auraShield.enabled=!1)}},Tank.prototype.setColor=function(t){var e=this.matGlow;(this.own||this.ally)&&(e=this.matCircle),this.glow.model.material=e,e.emissive.set(t[0]/255,t[1]/255,t[2]/255),e.update(),this.auraShield.script.forceField.setColor(t[0]/255,t[1]/255,t[2]/255),this.entity.fire("color",t)},Tank.prototype.disconnect=function(){this.setDead(!0),this.hidden(!0),this.currentState=this.states.killed};var Tanks=pc.createScript("tanks");window.tanks||(window.tanks={}),Tanks.prototype.initialize=function(){this.ind=0,this.tank=this.app.root.findByName("tank"),this.tank.enabled=!1,this.container=this.app.root.findByName("tanks"),this.client=this.app.root.getChildren()[0].script.client,this.camera=this.app.root.findByName("camera"),this.teams=this.app.root.getChildren()[0].script.teams,this.pointer=this.entity.findByName("pointer"),this.pointer.enabled=!1,this.targetPointer=new pc.Vec3,this.pointers=[],this.own=null,this.overlay=this.app.root.getChildren()[0].script.overlay},Tanks.prototype["new"]=function(t){var i=this.tank.clone();if(i.setName("tank_"+t.id),i.owner=t.owner,i.enabled=!0,i.setLocalPosition(t.posX,0,t.posZ),i.rotate(0,360*Math.random(),0),i.script.tank.id=t.id,users[t.owner].tank=i,tanks[t.id]=i,t.owner===this.client.id){this.camera.script.link.link=i,this.own=i;for(var e in tanks){var n=tanks[e];n.script.tank.team===t.team&&(n=n.script.tank,n.ally=!0,n.setColor(this.teams.colors[n.team]),parseInt(e)!==t.id&&this.addPointer(parseInt(e),this.teams.colors[t.team]))}}else users[this.client.id]&&users[this.client.id].tank&&users[this.client.id].tank.script.tank.team===t.team&&(i.script.tank.ally=!0,this.own&&this.addPointer(t.id,this.teams.colors[t.team]));this.teams.tankAdd(i.script.tank,t.team),this.container.addChild(i),i.script.tank_skin.setSkin(t.model,t.paint,t.trim),i.fire("start"),this.app.fire("tanks:new",t.id,i)},Tanks.prototype["delete"]=function(t){var i=tanks[t.id];if(i){i.script.tank.id=null,i.fire("destroy"),i.destroy(),delete tanks[t.id];for(var e=0;e<this.pointers.length;e++)if(this.pointers[e].id===t.id){this.pointers[e].id=null,this.pointers[e].pointer.enabled=!1;break}}},Tanks.prototype.deadAll=function(){for(var t in tanks)tanks[t].script.tank.id=null,tanks[t].script.tank.disconnect();window.tanks={},this.overlay.cinematic(!0),this.overlay.overlay(!0);for(var i=0;i<this.pointers.length;i++)this.pointers[i].id=null,this.pointers[i].pointer.enabled=!1},Tanks.prototype.updateData=function(t){for(var i=(this.app,0);i<t.length;i++){var e=t[i],n=tanks[e.id];n&&(e.level&&n.script.tank_name.setLevel(e.level)&&n.script.tank.levelup(e.level),n=n.script.tank,!e.hasOwnProperty("x")||isNaN(e.x)||isNaN(e.y)||n.moveTo([e.x,e.y]),!n.own&&e.hasOwnProperty("a")&&n.targeting(e.a),e.hasOwnProperty("hp")&&n.setHP(e.hp),n.setSP(e.sp||0),null!==e.killer&&(n.own?n.killer=tanks[e.killer]:n.iKilled=tanks[e.killer]),n.setDead(e.dead||!1))}},Tanks.prototype.addPointer=function(t,i){var e,n,s=this;if(!s.pointers.length)for(var a=0;2>a;a++)e={pointer:s.pointer.clone(),id:null},s.own.addChild(e.pointer),s.pointers.push(e);for(var r=0;r<s.pointers.length;r++)if(null===s.pointers[r].id){s.pointers[r].id=t,s.pointers[r].pointer.setLocalPosition(0,s.pointers[r].pointer.getLocalPosition().y,0),s.pointers[r].pointer.rotateLocal(0,pc.math.random(0,360),0),s.pointers[r].pointer.translateLocal(0,0,-1.3),n=s.pointers[r].pointer.model.material,n.emissive.set(i[0]/255,i[1]/255,i[2]/255),n.update();break}};var Teams=pc.createScript("teams");Teams.prototype.initialize=function(){this.overlay=this.app.root.getChildren()[0].script.overlay,this.colors=[[68,169,241],[251,34,47],[123,198,75],[251,145,48]],this.names=["blue","red","green","yellow"],this.scores=[0,0,0,0]},Teams.prototype.tankAdd=function(e,t){var a=this.app;if(a.ui.teams)for(var s=0;3>s;s++){var i=a.ui.teams.querySelectorAll(".team-"+(t+1)+" > .tank")[s];if(i&&!i.classList.contains("active")){i.classList.add("active"),i.classList.add("respawn"),e.inTeam=s;break}}e.team=t,e.setColor(this.colors[t]);e.entity.on("destroy",function(){if(a.ui.teams)for(var e=3;e--;){var s=a.ui.teams.querySelectorAll(".team-"+(t+1)+" > .tank")[e];if(s&&s.classList.contains("active"))return s.classList.remove("active"),void s.classList.remove("respawn")}})},Teams.prototype.reset=function(){var e=this.app;if(e.ui.teams)for(var t=1;4>=t;t++)for(var a=0;3>a;a++){var s=e.ui.teams.querySelectorAll(".team-"+t+" > .tank")[a];if(s&&s.classList.contains("active")){s.classList.remove("active"),s.classList.remove("respawn");break}}},Teams.prototype.teamScore=function(e,t){var a=this.app;if(this.scores[e]=t,a.ui.teams){var s=a.ui.teams.querySelector(".team-"+(e+1)+" > .top > .score");s&&(s.textContent=t)}a.fire("score:update",this.scores)},Teams.prototype.teamWin=function(e){var t=this.app;this.overlay.overlay(!0),this.overlay.cinematic(!0),this.overlay.winner(this.names[e.team]),this.overlay.timer(5),t.fire("score:winner",e.team);var a=this;setTimeout(function(){t.ui.overlayWinner&&t.ui.overlayWinner.classList.contains("active")&&a.overlay.overlay(!1),a.overlay.winner(!1)},5e3)};var Touch=pc.createScript("touch");try{document.body.style.userSelect="none",document.body.style.mozUserSelect="none",document.body.style.khtmlUserSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}catch(ex){console.error(ex)}Touch.prototype.initialize=function(){if(this.touch="ontouchstart"in document.documentElement,this.touch){this.touches={},this.size=164,this.joyPadding=6,this.vec=new pc.Vec2(0,0),this.tmp=new pc.Vec2(0,0),this.joyLeft=document.createElement("canvas"),this.joyLeft.width=this.size,this.joyLeft.height=this.size,this.joyLeft.ctx=this.joyLeft.getContext("2d"),this.joyLeft.style.position="absolute",this.joyLeft.style.left=this.joyPadding+"px",this.joyLeft.style.bottom=this.joyPadding+"px";var t=this.joyLeft.ctx;this.drawHex(t,"rgba(255, 255, 255, .07)"),document.body.appendChild(this.joyLeft),this.joyRight=document.createElement("canvas"),this.joyRight.width=this.size,this.joyRight.height=this.size,this.joyRight.ctx=this.joyRight.getContext("2d"),this.joyRight.style.position="absolute",this.joyRight.style.right=this.joyPadding+"px",this.joyRight.style.bottom=this.joyPadding+"px",t=this.joyRight.ctx,this.drawHex(t,"rgba(255, 255, 255, .07)"),document.body.appendChild(this.joyRight),this.lastMove=Date.now(),this.lastRender=Date.now(),this.lastVec=[0,0],this._hidden=!0,window.addEventListener("touchstart",this.onTouchStart.bind(this),!0),window.addEventListener("touchend",this.onTouchEnd.bind(this),!1),window.addEventListener("touchmove",this.onTouchMove.bind(this),!1),this.client=this.app.root.getChildren()[0].script.client,this.link=this.app.root.findByName("camera").script.link,this.resize(!0)}},Touch.prototype.resize=function(t){if(this.joyLeft&&this.joyRight){var i=69*Math.max(2,Math.min(4,Math.floor(window.innerWidth/240)))+24;if(i!==this.size||t){this.size=i,this.joyLeft.width=this.size,this.joyLeft.height=this.size,this.joyRight.width=this.size,this.joyRight.height=this.size;var e=this.joyLeft.ctx;this.drawHex(e,"rgba(255, 255, 255, .07)","#2ecc71"),e=this.joyRight.ctx,this.drawHex(e,"rgba(255, 255, 255, .07)","#2ecc71")}}},Touch.prototype.hidden=function(t){this._hidden!=t&&(this._hidden=t,this.resize(!0))},Touch.prototype.drawHex=function(t,i,e){if(!this._hidden){t.beginPath();for(var h=0;11>h;h++)t.lineTo(this.size/2*Math.sin(2*Math.PI/10*(h+.5))+this.size/2,this.size/2*Math.cos(2*Math.PI/10*(h+.5))+this.size/2);t.fillStyle=i,t.fill()}},Touch.prototype.update=function(t){if(this.touch){if(this.resize(),this.client.connected){this.forEach("start",function(t){var i=this.joyLeft.getBoundingClientRect();this.vec.set(t.x-i.left-this.size/2,t.y-i.top-this.size/2),this.vec.length()<this.size/2&&(t.joy=this.joyLeft),i=this.joyRight.getBoundingClientRect(),this.vec.set(t.x-i.left-this.size/2,t.y-i.top-this.size/2),this.vec.length()<this.size/2&&(t.joy=this.joyRight)}.bind(this));var i=!1;this.forEach("down",function(t){if(t.joy){var e=t.joy.getBoundingClientRect();this.vec.set(t.x-e.left-this.size/2,t.y-e.top-this.size/2),this.vec.length()>this.size/2-24&&this.vec.normalize().mul(this.tmp.set(this.size/2-24,this.size/2-24));var h=t.joy.ctx;if(h.clearRect(0,0,t.joy.width,t.joy.height),!this._hidden){this.drawHex(h,"rgba(255, 255, 255, .03)","#2ecc71"),h.beginPath();for(var s=0;11>s;s++)h.lineTo(24*Math.sin(2*Math.PI/10*s)+this.size/2+this.vec.x,24*Math.cos(2*Math.PI/10*s)+this.size/2+this.vec.y);h.fillStyle="rgba(255, 255, 255, .2)",h.fill()}if(t.joy==this.joyRight&&this.link.link){i=!0,this.link.mPos=[this.vec.x/(this.size/2)*(this.app.graphicsDevice.width/2),this.vec.y/(this.size/2)*(this.app.graphicsDevice.height/2)],this.vec.normalize();var o=this.vec.x*Math.sin(.75*Math.PI)-this.vec.y*Math.cos(.75*Math.PI);this.vec.y=this.vec.y*Math.sin(.75*Math.PI)+this.vec.x*Math.cos(.75*Math.PI),this.vec.x=o,this.link.angle=Math.floor(Math.atan2(this.vec.x,this.vec.y)/(Math.PI/180)),this.link.link.targeting(this.link.angle),this.client.shoot(!0)}else if(t.joy==this.joyLeft){this.tmp.copy(this.vec),this.vec.normalize();var o=this.vec.x*Math.sin(.75*Math.PI)-this.vec.y*Math.cos(.75*Math.PI);if(this.vec.y=this.vec.y*Math.sin(.75*Math.PI)+this.vec.x*Math.cos(.75*Math.PI),this.vec.x=o,Date.now()-this.lastMove>100){this.lastMove=Date.now();var c=parseFloat(this.vec.x.toFixed(1)),n=parseFloat(this.vec.y.toFixed(1));this.lastVec[0]===c&&this.lastVec[1]===n||(this.lastVec[0]=c,this.lastVec[1]=n,this.client.socket.send("move",{dir:this.lastVec}))}i||(this.link.mPos=[this.tmp.x/(this.size/2)*(this.app.graphicsDevice.width/2),this.tmp.y/(this.size/2)*(this.app.graphicsDevice.height/2)],this.link.angle=Math.floor(Math.atan2(this.vec.x,this.vec.y)/(Math.PI/180)),this.link.link.targeting(this.link.angle))}}}.bind(this)),this.forEach("end",function(t){if(t.joy){var e=t.joy.ctx;e.clearRect(0,0,t.joy.width,t.joy.height),this._hidden||this.drawHex(e,"rgba(255, 255, 255, .1)","#2ecc71"),t.joy==this.joyRight?this.client.shoot(!1):this.client.socket.send("move",{dir:[0,0]}),i&&t.joy!=this.joyRight||(this.link.mPos=[0,0])}}.bind(this))}this.touchFlush()}},Touch.prototype.onTouchStart=function(t){for(var i,e=t.touches.length;e--;)i=t.touches[e].identifier,this.touches[i]||(this.touches[i]={x:t.touches[e].clientX,y:t.touches[e].clientY,start:!0});this.app.allowGameInput&&t.preventDefault()},Touch.prototype.onTouchEnd=function(t){for(var i,e=t.changedTouches.length;e--;)i=t.changedTouches[e].identifier,void 0===this.touches[i]||this.touches[i].end||(delete this.touches[i].start,delete this.touches[i].down,this.touches[i].end=!0);this.app.allowGameInput&&t.preventDefault()},Touch.prototype.onTouchMove=function(t){for(var i,e=t.touches.length;e--;)i=t.touches[e].identifier,this.touches[i]&&(this.touches[i].x=t.touches[e].clientX,this.touches[i].y=t.touches[e].clientY);this.app.allowGameInput&&t.preventDefault()},Touch.prototype.touchFlush=function(){for(var t in this.touches)this.touches[t].start&&(delete this.touches[t].start,this.touches[t].down=!0),this.touches[t].end&&delete this.touches[t]},Touch.prototype.forEach=function(t,i){for(var e in this.touches)this.touches[e][t]&&i(this.touches[e])};var Ui=pc.createScript("ui");Ui.attributes.add("html",{type:"asset",assetType:"html"}),Ui.attributes.add("less",{type:"asset",assetType:"css"}),Ui.attributes.add("fps",{type:"boolean","default":!0}),Ui.prototype.initialize=function(){var e=this.app;e.ui={},this.selectors={logo:".logo",powered:".powered",cinematic:".cinematic",names:".names",userInfo:".user > .userinfo",userLevel:".user > .userinfo > .userlevel",userProgressBar:".user > .userinfo > .progressBar > .progress",userName:".user > .username",userLoginTooltip:".user > .loginTooltip",userStats:".user > .stats",userStatsKills:".user > .stats > .k",userStatsDeaths:".user > .stats > .d",leaderboards:".leaderboards",leaderboardsClose:".leaderboards > .topClose",leaderboardsUsers:".leaderboards > table > tbody",profile:".profile",profileTwitter:".profile > .socialPane .twitter",profileFacebook:".profile > .socialPane .facebook",profileClose:".profile > .close",profileSignInPane:".profile > .signinPane",profileSignInPaneSignIn:".profile > .signinPane .signin",profileSignInPaneSignInErrors:".profile > .signinPane .signinErrors",profileSignInPaneEmailInput:".signinPane > input[name=email]",profileSignInPanePasswordInput:".signinPane > input[name=password]",profileSignInPaneForgotTab:".profile > .signinPane .forgot",profileSignInPaneSignUpTab:".profile > .signinPane .signupTab",profileSignUpPane:".profile > .signupPane",profileSignUpPaneSignUp:".profile > .signupPane .signup",profileSignUpPaneSignUpErrors:".profile > .signupPane .signUpErrors",profileSignUpPaneSignInTab:".profile > .signupPane .signinTab",profileSignUpPaneNameInput:".signupPane > input[name=name]",profileSignUpPaneEmailInput:".signupPane > input[name=email]",profileSignUpPanePasswordInput:".signupPane > input[name=password]",profileSignUpPanePasswordConfirmInput:".signupPane > input[name=confirm_password]",profileResetPane:".profile > .resetPane",profileResetPaneEmailInput:".resetPane > input[name=reset_email]",profileResetPaneReset:".profile > .resetPane .reset",profileResetPaneSignInTab:".profile > .resetPane .signinTab",profileResetPaneBack:".profile > .resetPane .signinTab",profileResetSentPane:".profile > .resetSentPane",profileResetSentPaneBack:".profile > .resetSentPane .signinTab",profileSocialPane:".socialPane",shareButton:".shareButton",share:".share",shareInput:".share > input",shareCopied:".share > .copied",shareTwitter:".share > .buttons > .twitter",shareFacebook:".share > .buttons > .facebook",shareClose:".share > .close",muteButton:".muteButton",musicButton:".musicButton",fullscreenButton:".fullscreenButton",infoButton:".infoButton",infoBox:".infoBox",vrButton:".vrButton",teams:".teams",overlay:".overlay",overlayLogo:".overlay > .logo",overlayHelpDesktop:".overlay > .helpDesktop",overlayLoading:".overlay > .loading",overlayFirstStart:".overlay > .firstStart",overlayWinner:".overlay > .winner",overlayWinnerTeam:".overlay > .winner > .team",overlayWinnerIcon:".overlay > .winner > .icon",overlayWinnerText:".overlay > .winner > .text",overlayKiller:".overlay > .killer",overlayKillerIcon:".overlay > .killer > .icon",overlayKillerName:".overlay > .killer > .name",overlayKillerRespawn:".overlay > .killer > .respawn",overlayDisconnected:".overlay > .disconnected",overlayDisconnectedPlayAgain:".overlay > .disconnected > .playAgain"},this.assetImage=e.assets.get(this.image),this.assetHtml=null,this.element=document.createElement("div"),this.element.id="ui-container",document.body.appendChild(this.element),this.element.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),this.loadHtml(this.html.id),this.on("attr:html",function(e){this.loadHtml(e.id)},this),this.assetLess=null,this.style=document.createElement("style"),document.head.appendChild(this.style),this.loadLess(this.less.id),this.on("attr:css",function(e){this.loadLess(e.id)},this),(this.fps||window.location.search&&-1!==window.location.search.indexOf("fps=1"))&&(this.meter=new FPSMeter({top:"auto",left:"16px",bottom:"16px"}));var t=document.getElementById("loginInput");t&&t.addEventListener("keydown",function(e){e.stopPropagation()})},Ui.prototype.replaceTags=function(e){for(var t=this.app,s=e.match(/\{.+?\}/g),i=0;i<s.length;i++){var n=s[i].match(/\{asset\[(.+?)\]\.(.+?)\}/i);if(n){var a=n[1],o=n[2].split("."),r=t.assets.findByTag(a);if(!r||!r.length){console.error("Could not find asset with tag "+a);continue}for(var l=r[0],p=0;p<o.length;p++)l="function"==typeof l[o[p]]?l[o[p]].call(l):l[o[p]];e=e.replace(s[i],l)}}return e},Ui.prototype.templateHtml=function(){var e=this.app;this.element.innerHTML=this.replaceTags(this.assetHtml&&this.assetHtml.resource||""),e.ui={};for(var t in this.selectors)e.ui[t]=this.element.querySelector(this.selectors[t]);e.fire("ui:template"),e.ui.templated=!0},Ui.prototype.loadHtml=function(e){var t=this.app;this.assetHtml&&(this.assetHtml.off("load",this.templateHtml,this),this.assetHtml=null),e&&(this.assetHtml=t.assets.get(e),this.assetHtml.on("load",this.templateHtml,this),t.assets.load(this.assetHtml)),this.templateHtml()},Ui.prototype.templateLess=function(){var e=this.style;this.assetLess&&this.assetLess.resource?less.render(this.replaceTags(this.assetLess.resource)).then(function(t){e.innerHTML=t.css},function(e){console.log(e)}):e.innerHTML=""},Ui.prototype.loadLess=function(e){var t=this.app;this.assetLess&&(this.assetLess.off("load",this.templateLess,this),this.assetLess=null),e&&(this.assetLess=t.assets.get(e),this.assetLess.on("load",this.templateLess,this),t.assets.load(this.assetLess)),this.templateLess()},Ui.prototype.update=function(e){this.meter&&this.meter.tick()};var Leaderboard=pc.createScript("leaderboard");Leaderboard.prototype.initialize=function(){var e=this,t=this.app;this.client=t.root.getChildren()[0].script.client,this.overlay=t.root.getChildren()[0].script.overlay,this.kills=0,this.deaths=0,t.on("ui:template",this.uiAttach,this),t.ui.templated&&this.uiAttach(),t.on("net:userStats",function(s){s.kills&&t.ui.userStatsKills&&(t.ui.userStatsKills.textContent=e.kills=s.kills),s.deaths&&t.ui.userStatsDeaths&&(t.ui.userStatsDeaths.textContent=e.deaths=s.deaths)}),t.on("net:init",function(){t.ui.leaderboards&&(e.client.user.twitter||e.client.user.facebook||e.client.user.email?t.ui.leaderboards.classList.remove("guest"):t.ui.leaderboards.classList.add("guest"))}),window.addEventListener("keydown",function(e){27===e.keyCode&&t.ui.leaderboards&&t.ui.leaderboards.classList.contains("active")&&t.ui.leaderboardsClose&&t.ui.leaderboardsClose.click(),9===e.keyCode&&t.ui.leaderboards&&t.ui.profile&&!t.ui.profile.classList.contains("active")&&(t.ui.leaderboards.classList.contains("active")?t.ui.leaderboardsClose.click():t.ui.userStats.click(),e.preventDefault())},!1)},Leaderboard.prototype.uiAttach=function(){var e=this,t=this.app;if(t.ui.userStats){var s=function(){if(t.ui.leaderboards&&t.ui.leaderboardsUsers){t.ui.leaderboardsUsers.innerHTML="loading...";var s=new XMLHttpRequest;s.withCredentials=!0,s.addEventListener("load",function(){try{t.ui.leaderboardsUsers.innerHTML="";for(var a=JSON.parse(s.responseText),i=!1,r=0;r<a.users.length;r++){var l=document.createElement("tr"),d=document.createElement("td");d.classList.add("place"),d.textContent=r+1,l.appendChild(d);var o=document.createElement("td");o.classList.add("name"),o.textContent=a.users[r].name,l.appendChild(o);var n=document.createElement("td");n.classList.add("score"),n.textContent=a.users[r].kills,l.appendChild(n),t.ui.leaderboardsUsers.appendChild(l),a.users[r].id===e.client.user.id?(l.classList.add("self"),i=!0):9===r&&!i&&a.self&&(d.textContent=a.self.position,o.textContent=a.self.name,n.textContent=a.self.kills,l.classList.add("self"))}}catch(u){console.error(u),t.ui.leaderboardsUsers.innerHTML="error"}}),s.open("GET",e.client.url+"/leaderboards"),s.send(),t.ui.profile.classList.contains("active")&&t.ui.profile&&(t.ui.profile.classList.remove("active"),e.overlay.overlay(!1,!0)),!t.ui.leaderboards.classList.contains("active")&&t.ui.leaderboards&&(t.ui.leaderboards.classList.add("active"),e.overlay.overlay(!0),t.allowGameInput=!1)}};t.ui.userStats.addEventListener("click",s,!1),t.ui.userStats.addEventListener("touchstart",s,!1)}if(t.ui.leaderboards&&this.client.user&&!(this.client.user.twitter||this.client.user.facebook||e.client.user.email)&&t.ui.leaderboards.classList.add("guest"),t.ui.leaderboardsClose){var a=function(){t.ui.leaderboards.classList.remove("active"),e.overlay.overlay(!1),t.allowGameInput=!0};t.ui.leaderboardsClose.addEventListener("click",a,!1),t.ui.leaderboardsClose.addEventListener("touchstart",a,!1)}this.kills&&t.ui.userStatsKills&&(t.ui.userStatsKills.textContent=this.kills),this.deaths&&t.ui.userStatsDeaths&&(t.ui.userStatsDeaths.textContent=this.deaths)};window.users||(window.users={},users.bind=function(e,s){s.on("userAdd",function(s){users[s.id]=s,e.fire("users:add",s)}),s.on("userSync",function(s){for(var r=0;r<s.users.length;r++)users[s.users[r].id]=s.users[r],e.fire("users:add",s.users[r])}),s.on("userRemove",function(s){var r=users[s.id];delete users[s.id],e.fire("users:remove",r)}),s.on("userName",function(s){var r=users[s.id];r&&(r.name=s.name,e.fire("users:name:"+r.id,r.name),e.fire("users:name",r.id,r.name))})});var Vr=pc.createScript("vr");Vr.attributes.add("camera",{type:"entity"}),Vr.uri=new pc.URI(window.location.href),Vr.query=Vr.uri.getQuery(),Vr.vrEnabled=!!Vr.query.vr,Vr.vrScale=Vr.query.vrscale?parseFloat(Vr.query.vrscale):50,Vr.prototype.initialize=function(){this.available=!1;var t=this.app;t.on("vr:ready",function(e,r){e&&Vr.vrEnabled?(this.available=!0,this.uiAttach(),t.on("ui:template",this.uiAttach,this),t.root.findByName("vr").enabled=!0):(this.available=!1,this.uiAttach(),t.on("ui:template",this.uiAttach,this),t.root.findByName("vr").enabled=!1)},this),t.on("vr:missing",function(){this.available=!1,this.uiAttach(),t.on("ui:template",this.uiAttach,this),t.root.findByName("vr").enabled=!1},this),this._angles=this.camera.getLocalEulerAngles().clone(),t.on("vr:leave",function(){this.camera.setLocalEulerAngles(this._angles)},this),t.on("vr:reset",function(){this.camera.script.vrCamera.forceReset()},this),t.on("score:winner",function(e){var r=t.root.findByName("scoreboard"),a=t.root.findByName("win-boards").getChildren();a[e]&&(a[e].enabled=!0,r.enabled=!1,setTimeout(function(){a[e].enabled=!1,r.enabled=!0},5e3))})},Vr.prototype.toggleVr=function(){var t=this.app;this.camera&&(this.camera.script.vrCamera.inVr?(this.camera.script.vrCamera.leaveVr(),this.camera.script.vrCamera.enabled=!1,this.entity.script.culling.setCamera(this.entity.camera)):(this.camera.script.vrCamera.setRotationOffset(0,45,0),this.camera.script.vrCamera.setOffsetScale(Vr.vrScale),this.camera.script.vrCamera.setOrigin(48,16,48),this.camera.script.vrCamera.enabled=!0,this.camera.script.vrCamera.enterVr(),this.entity.script.culling.setCamera(this.camera.script.vrCamera.left.camera)),t.fire("vr:toggle",this.camera.script.vrCamera.inVr))},Vr.prototype.uiAttach=function(){var t=this.app;Vr.vrEnabled&&this.available||t.ui.vrButton&&t.ui.vrButton.parentNode.removeChild(t.ui.vrButton),t.ui.vrButton&&this.available&&(t.ui.vrButton.addEventListener("click",this.toggleVr.bind(this),!1),t.ui.vrButton.addEventListener("touchend",this.toggleVr.bind(this),!1))},Vr.prototype.update=function(t){};var VrCamera=pc.createScript("vrCamera");VrCamera.attributes.add("ignoreTranslation",{type:"boolean","default":!1}),pc.PROJECTION_VR=2,VrCamera.q=new pc.Quat,VrCamera.fieldOfViewToProjectionMatrix=function(t,e,i,r){e=e||{upDegrees:53.09438672063491,rightDegrees:46.63209544498114,downDegrees:53.09438672063491,leftDegrees:47.527693754615306};var a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),n=Math.tan(e.rightDegrees*Math.PI/180),h=2/(o+n),c=2/(a+s);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((o-n)*h*.5),t[9]=(a-s)*c*.5,t[10]=-(i+r)/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=-(2*r*i)/(r-i),t[15]=0,t},pc.Camera.prototype.getProjectionMatrix=function(){if(this._projMatDirty){if(this._projection===pc.PROJECTION_PERSPECTIVE)this._projMat.setPerspective(this._fov,this._aspect,this._nearClip,this._farClip);else if(this._projection===pc.PROJECTION_VR)VrCamera.fieldOfViewToProjectionMatrix(this._projMat.data,this._vrFov,this._nearClip,this._farClip);else{var t=this._orthoHeight,e=t*this._aspect;this._projMat.setOrtho(-e,e,-t,t,this._nearClip,this._farClip)}this._projMatDirty=!1}return this._projMat},VrCamera.prototype.initialize=function(){var t=this;this.ready=!1,this.offsetRotation=new pc.Quat,this.offset=new pc.Vec3,this.offsetScale=1,this.origin=new pc.Vec3,this.inVr=!1;var e;e=this.entity.camera?this.entity.camera.clearColor:new pc.Color(.1,.1,.1),this.left=this.entity,this.left=new pc.fw.Entity,this.entity.addChild(this.left),this.left.addComponent("camera",{clearColor:e,rect:new pc.Vec4(0,0,.5,1)}),this.left.camera.projection=pc.PROJECTION_VR,this.left.enabled=!1,this.right=new pc.fw.Entity,this.entity.addChild(this.right),this.right.addComponent("camera",{clearColor:e,rect:new pc.Vec4(.5,0,.5,1)}),this.right.camera.projection=pc.PROJECTION_VR,this.right.enabled=!1;var i=new pc.Entity;i.setLocalScale(.01,.01,.01),i.rotate(-90,0,0),i.addComponent("model",{type:"cone"}),this.left.addChild(i.clone()),this.right.addChild(i.clone());var r=this.app;this.hmd=new pc.Hmd(r.graphicsDevice),this.hmd.initialize(function(e,i,a){return e?console.warn("Failed to initialize HMD"):void(a?(r.fire("vr:ready",i,a),t.ready=!0):r.fire("vr:missing"))}),this.origin=new pc.Vec3(0,0,0)},VrCamera.prototype.enterVr=function(){if(!this.inVr){var t=function(){document.mozFullScreenElement||document.fullscreenElement||this.leaveVr()}.bind(this);document.addEventListener("fullscreenchange",t,!1),this.entity.camera.enabled=!1,this.hmd.stereo&&(this.right.camera.projection=pc.PROJECTION_VR,this.right.camera.camera._vrFov=this.hmd._device.getEyeParameters("right").recommendedFieldOfView,this.right.enabled=!0,this.left.camera.projection=pc.PROJECTION_VR,this.left.camera.camera._vrFov=this.hmd._device.getEyeParameters("left").recommendedFieldOfView,this.left.enabled=!0,this.inVr=!0,this.app.fire("vr:enter")),this.hmd.enterFullscreen()}},VrCamera.prototype.leaveVr=function(){this.inVr&&(this.right.enabled=!1,this.left.enabled=!1,this.entity.camera&&(this.entity.camera.enabled=!0),this.inVr=!1,this.app.fire("vr:leave"))},VrCamera.prototype.update=function(t){if(this.ready){this.hmd&&this.hmd.poll();var e=VrCamera.q;if(this.inVr&&this.hmd){this.entity.setLocalRotation(e.copy(this.offsetRotation).mul(this.hmd.rotation));var i;if(this.ignoreTranslation?i=this.entity.getLocalPosition():(this.offset.copy(this.hmd.position).scale(this.offsetScale),this.offsetRotation.transformVector(this.offset,this.offset),i=this.offset.add(this.origin)),this.entity.setLocalPosition(i),this.hmd.stereo){var r=this.hmd._device.getEyeParameters("left").eyeTranslation,a=this.hmd._device.getEyeParameters("right").eyeTranslation;this.left.setLocalPosition(r.x,r.y,r.z),this.right.setLocalPosition(a.x,a.y,a.z)}}}},VrCamera.prototype.activate=function(){this.right.enabled=!0,this.left.enabled=!0},VrCamera.prototype.forceReset=function(){this.hmd.reset()},VrCamera.prototype.setRotationOffset=function(t,e,i){this.offsetRotation.setFromEulerAngles(t,e,i)},VrCamera.prototype.setOffsetScale=function(t){this.offsetScale=t},VrCamera.prototype.setOrigin=function(t,e,i){this.origin.set(t,e,i)};var NormalPatch=pc.createScript("normal_patch");NormalPatch.attributes.add("assetNormals",{type:"asset",assetType:"shader"}),NormalPatch.prototype.initialize=function(){this.assetNormals.on("load",this.updateMaterials,this),this.updateMaterials()},NormalPatch.prototype.updateMaterial=function(a){a.chunks.normalXYZPS=this.assetNormals.resource,a.update()},NormalPatch.prototype.updateMaterials=function(){for(var a=this,t=this.app.assets.findByTag("normal-patch"),e=0;e<t.length;e++)t[e].resource?this.updateMaterial(t[e].resource):t[e].once("load",function(){a.updateMaterial(this.resource)})};var FogPatch=pc.createScript("fog_patch");FogPatch.attributes.add("assetFog",{type:"asset",assetType:"shader"}),FogPatch.prototype.initialize=function(){pc.shaderChunks.fogLinearPS=this.assetFog.resource};var ForceField=pc.createScript("forceField");ForceField.attributes.add("vs",{type:"asset",assetType:"shader",title:"Vertex Shader"}),ForceField.attributes.add("fs",{type:"asset",assetType:"shader",title:"Fragment Shader"}),ForceField.attributes.add("ffColor",{type:"rgb",title:"ffColor"}),ForceField.attributes.add("diffuseMap",{type:"asset",assetType:"texture",title:"Diffuse Map"}),ForceField.attributes.add("dMapTO",{type:"vec4",title:"d_tiling_offset"}),ForceField.attributes.add("normalMap",{type:"asset",assetType:"texture",title:"Normal Map"}),ForceField.attributes.add("nMapTO",{type:"vec4",title:"n_tiling_offset"}),ForceField.prototype.initialize=function(){this.emissive=2,this.time=0,this.tOn=.2,this.state=!1,this.camera=this.app.root.findByName("camera"),this.hitAngle=new pc.Vec3,this.hitStrength=0;var t=this.app.graphicsDevice;this.model=this.entity.model.model;this.diffuseMap.resource||(this.diffuseMap.once("load",function(){this.material.setParameter("diffuseMap",this.diffuseMap.resource)},this),this.app.assets.load(this.diffuseMap)),this.normalMap.resource||(this.normalMap.once("load",function(){this.material.setParameter("normalMap",this.normalMap.resource)},this),this.app.assets.load(this.normalMap));var e=this.vs.resource,i="precision "+t.precision+" float;\n";i+=this.fs.resource;var a={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0,aNormal:pc.SEMANTIC_NORMAL},vshader:e,fshader:i};this.shader=new pc.Shader(t,a),this.material=new pc.Material,this.material.setShader(this.shader),this.material.setParameter("time",0),this.material.setParameter("emissive",this.emissive),this.material.setParameter("yMax",this.dMapTO.y),this.material.setParameter("dMapTO",this.dMapTO.data),this.material.setParameter("nMapTO",this.nMapTO.data),this.material.setParameter("color",this.ffColor.data3),this.material.setParameter("tOn",this.tOn),this.material.setParameter("viewPos",this.camera.getPosition().data),this.material.setParameter("worldPos",this.entity.getPosition().data),this.material.setParameter("hitAngle",this.hitAngle.data),this.material.setParameter("hitStrength",this.hitStrength),this.diffuseMap.resource&&this.material.setParameter("diffuseMap",this.diffuseMap.resource),this.normalMap.resource&&this.material.setParameter("normalMap",this.normalMap.resource),this.material.blendType=pc.BLEND_ADDITIVEALPHA,this.material.depthWrite=!1,this.entity.model.material=this.material,this.entity.model.model.meshInstances[0].drawOrder=2},ForceField.prototype.setState=function(t){this.state!==t&&(this.state=t,this.state?(this.entity.enabled=!0,this.emissive=1.5,this.time=0,this.tOn=.2):this.tOn=.8)},ForceField.prototype.update=function(t){this.time+=t,this.material.setParameter("time",this.time),this.hitStrength>0&&(this.hitStrength-=.75*t,this.material.setParameter("hitStrength",this.hitStrength)),this.state===!0&&this.tOn<1&&(this.tOn+=.75*t,this.material.setParameter("tOn",this.tOn)),this.state!==!0&&this.tOn>0&&(this.tOn-=.75*t,this.material.setParameter("tOn",this.tOn)),this.emissive>2&&(this.emissive-=10*t),this.material.setParameter("emissive",this.emissive),this.material.setParameter("viewPos",this.camera.getPosition().data),this.material.setParameter("worldPos",this.entity.getPosition().data),!this.state&&this.tOn<=0&&(this.entity.enabled=!1)},ForceField.prototype.hit=function(t){this.hitAngle.copy(t),this.hitAngle.y=0,this.hitAngle.normalize(),this.hitAngle.scale(-1),this.hitStrength=1,this.emissive=4,this.material.setParameter("hitAngle",this.hitAngle.data),this.material.setParameter("hitStrength",this.hitStrength),this.material.setParameter("emissive",this.emissive)},ForceField.prototype.setColor=function(t,e,i){this.ffColor&&(this.ffColor.set(t,e,i),this.material.setParameter("color",this.ffColor.data3))};var Explosion=pc.createScript("explosion");Explosion.prototype.initialize=function(){this.type=0},Explosion.prototype.spawn=function(t){this.entity.setLocalPosition(t.pos),this.entity.enabled=!0,this.entity.particlesystem.reset(),this.entity.particlesystem.play(),this.entity.particlesystem.emitter.meshInstance.drawOrder=30},Explosion.prototype.update=function(t){this.entity.particlesystem.isPlaying()||(this.app.fire("explosions:finish",this.entity),this.entity.particlesystem.stop(),this.entity.enabled=!1)};var Explosions=pc.createScript("explosions");Explosions.attributes.add("container",{type:"entity",title:"Container"}),Explosions.attributes.add("explosionBullet",{type:"entity",title:"Bullet Hit"}),Explosions.attributes.add("explosionHit",{type:"entity",title:"Tank Hit"}),Explosions.attributes.add("explosionTank",{type:"entity",title:"Tank Explode"}),Explosions.attributes.add("explosionSparkes",{type:"entity",title:"Tank Sparkles"}),Explosions.prototype.initialize=function(){this.app;this.templates=[this.explosionBullet,this.explosionHit,this.explosionTank,this.explosionSparkes];for(var t=0;t<this.templates.length;t++)this.templates[t].particlesystem.noFog=!0;this.explosionTank.particlesystem.blendType=7,this.pools=[[],[],[],[]],this.app.on("explosions:finish",this.onFinish,this),this.app.on("explosions:add",this.onAdd,this),this.tmpVec=new pc.Vec3},Explosions.prototype.onFinish=function(t){this.pools[t.type].push(t)},Explosions.prototype.onAdd=function(t){if(!this.pools[t.type].length)for(var i=0;8>i;i++){var s=this.templates[t.type].clone();s.type=t.type,this.container.addChild(s),this.pools[t.type].push(s)}var o=this.pools[t.type].pop();o.script.explosion.spawn(t)};Object.defineProperty(pc.ParticleEmitter.prototype,"pack8",{set:function(){},get:function(){return!1}});var Decal=pc.createScript("decal");Decal.prototype.initialize=function(){this.life=0,this.lifetime=0},Decal.prototype.spawn=function(t,i,e){this.entity.setLocalPosition(i,.01,e),this.entity.setLocalEulerAngles(0,360*Math.random(),0),this.entity.enabled=!0,this.life=this.lifetime=t},Decal.prototype.update=function(t){this.life-=500*t,this.life>0?this.entity.model.model.meshInstances[0].setParameter("material_opacity",this.life/this.lifetime):(this.entity.fire("finish"),this.entity.enabled=!1)},Decal.prototype.swap=function(t){this.life=t.life,this.lifetime=t.lifetime};var Decals=pc.createScript("decals");Decals.attributes.add("container",{type:"entity"}),Decals.attributes.add("template",{type:"entity"}),Decals.prototype.initialize=function(){var t=this.app;this.pool=[],this.template.enabled=!1,t.on("decals:add",this.onAdd,this),t.on("decals:finish",this.onFinish,this)},Decals.prototype.onFinish=function(t){this.pool.push(t)},Decals.prototype.onAdd=function(t){if(!this.pool.length)for(var i=0;8>i;i++){var e=this.template.clone();this.container.addChild(e),this.pool.push(e)}var a=this.pool.pop();a.script.decal.spawn(t.life,t.x,t.z)};var DrawOrder=pc.createScript("drawOrder");DrawOrder.attributes.add("order",{type:"number","default":0,description:'By default order is not affected, but any larger number will make meshes to be drawn "closer" to the camera'}),DrawOrder.prototype.initialize=function(){if(this.order&&this.entity.model.model)for(var e=this.entity.model.model.meshInstances,r=0;r<e.length;r++)e[r].drawOrder=this.order};var Pointer=pc.createScript("pointer");Pointer.prototype.initialize=function(){this.entity.enabled=!1,this.target={x:0,y:0}},Pointer.prototype.update=function(t){if(console.log(this.entity.enabled),this.entity.enabled){var i=this.entity.getLocalPosition().y;this.entity.setLocalPosition(0,i,0),this.entity.lookAt(this.target.x,i,this.target.z),this.entity.translateLocal(0,0,-1.3),(isNaN(this.entity.getLocalPosition().x)||isNaN(this.entity.getLocalPosition().y)||isNaN(this.entity.getLocalPosition().z))&&this.entity.setLocalPosition(0,i,0)}},Pointer.prototype.updateTarget=function(t,i){if(!this.entity.enabled){var e=this.entity.getLocalPosition().y;this.entity.setLocalPosition(0,e,0),this.entity.lookAt(t,e,i),this.entity.translateLocal(0,0,-1.3),(isNaN(this.entity.getLocalPosition().x)||isNaN(this.entity.getLocalPosition().y)||isNaN(this.entity.getLocalPosition().z))&&this.entity.setLocalPosition(0,e,0),this.entity.enabled=!0}this.target.x=t,this.target.z=i};var Award=pc.createScript("award");Award.prototype.initialize=function(){var t=this;t.type=null,t.tank=null,t.life=0,t.lifeTime=0,t.entity.enabled=!1},Award.prototype.spawn=function(t){var e=this;e.type=t.type,0===e.type?(e.tank=t.tank,e.entity.setLocalPosition(e.tank.getLocalPosition().x,e.tank.getLocalPosition().y+1.5,e.tank.getLocalPosition().z),e.entity.enabled=!0,e.entity.particlesystem.reset(),e.entity.particlesystem.play(),e.entity.particlesystem.emitter.meshInstance.drawOrder=30):1===e.type?(e.life=e.lifeTime=t.life,e.entity.setLocalPosition(t.pos),e.entity.setRotation(0,0,0,1),e.entity.rotate(0,45,0),e.entity.element.text="+ "+t.value+"xp",e.entity.enabled=!0,e.app.ui.userLoginTooltip.classList.contains("hidden")||(e.app.ui.userLoginTooltip.classList.add("active"),e.app.loginTooltipTime=1e3)):2===e.type&&(e.tank=t.tank,e.life=e.lifeTime=t.life,e.entity.setLocalPosition(e.tank.getLocalPosition().x,e.tank.getLocalPosition().y+1.5,e.tank.getLocalPosition().z),e.entity.setRotation(0,0,0,1),e.entity.rotate(0,45,0),e.entity.element.text="level up ["+t.value+"]",e.entity.enabled=!0)},Award.prototype.update=function(t){var e=this;if(e.entity.enabled){var i,n,a;0===e.type?(e.tank&&null!==e.tank&&e.entity.setLocalPosition(e.tank.getLocalPosition().x,e.tank.getLocalPosition().y+1.5,e.tank.getLocalPosition().z),e.entity.particlesystem.isPlaying()||(e.tank=null,e.app.fire("award:finish",e.entity),e.entity.particlesystem.stop(),e.entity.enabled=!1)):1===e.type?(e.life-=500*t,e.life>0?(e.entity.translateLocal(0,4*t,0),i=e.life/e.lifeTime,n=Math.pow(e.life/e.lifeTime,2),a=i-n,e.entity.element.opacity=i+a):(e.entity.fire("award:finish"),e.entity.enabled=!1)):2===e.type&&(e.life-=500*t,e.life>0?(e.entity.translateLocal(0,4*t,0),i=e.life/e.lifeTime,n=Math.pow(e.life/e.lifeTime,2),a=i-n,e.entity.element.opacity=i+a,e.entity.setLocalPosition(e.tank.getLocalPosition().x,e.entity.getLocalPosition().y,e.tank.getLocalPosition().z)):(e.entity.fire("award:finish"),e.entity.enabled=!1))}};var Awards=pc.createScript("awards");Awards.attributes.add("container",{type:"entity"}),Awards.attributes.add("levelUpPS",{type:"entity"}),Awards.attributes.add("xp",{type:"entity"}),Awards.attributes.add("levelUp",{type:"entity"}),Awards.prototype.initialize=function(){var t=this.app,e=this;e.templates=[e.levelUpPS,e.xp,e.levelUp],e.levelUpPS.particlesystem.noFog=!0,e.pools=[[],[],[]],t.on("award:add",e.onAdd,e),t.on("award:finish",e.onFinish,e)},Awards.prototype.onFinish=function(t){var e=this;e.pools[t.type].push(t)},Awards.prototype.onAdd=function(t){var e,p=this;if(!p.pools[t.type].length)for(var a=0;8>a;a++)e=p.templates[t.type].clone(),e.type=t.type,p.container.addChild(e),p.pools[t.type].push(e);e=p.pools[t.type].pop(),e.script.award.spawn(t)};var CustomParticles=pc.createScript("customParticles");CustomParticles.attributes.add("vs",{type:"asset",assetType:"shader",title:"Vertex Shader"}),CustomParticles.attributes.add("fs",{type:"asset",assetType:"shader",title:"Fragment Shader"}),CustomParticles.attributes.add("ffColor",{type:"rgb",title:"ffColor","default":[1,1,1]}),CustomParticles.attributes.add("diffuseMap",{type:"asset",assetType:"texture",title:"Diffuse Map"}),CustomParticles.attributes.add("dMapTO",{type:"vec4",title:"d_tiling_offset"}),CustomParticles.attributes.add("normalMap",{type:"asset",assetType:"texture",title:"Normal Map"}),CustomParticles.attributes.add("nMapTO",{type:"vec4",title:"n_tiling_offset"}),CustomParticles.prototype.initialize=function(){this.emissive=2,this.time=0,this.tOn=.2,this.state=!1,this.camera=this.app.root.findByName("camera"),this.hitAngle=new pc.Vec3,this.hitStrength=0;var t=this.app.graphicsDevice;this.model=this.entity.model.model;this.diffuseMap.resource||(this.diffuseMap.once("load",function(){this.material.setParameter("diffuseMap",this.diffuseMap.resource)},this),this.app.assets.load(this.diffuseMap)),this.normalMap.resource||(this.normalMap.once("load",function(){this.material.setParameter("normalMap",this.normalMap.resource)},this),this.app.assets.load(this.normalMap));var e=this.vs.resource,s="precision "+t.precision+" float;\n";s+=this.fs.resource;var i={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0,aNormal:pc.SEMANTIC_NORMAL},vshader:e,fshader:s};this.shader=new pc.Shader(t,i),this.material=new pc.Material,this.material.setShader(this.shader),this.material.setParameter("time",0),this.material.setParameter("emissive",this.emissive),this.material.setParameter("yMax",this.dMapTO.y),this.material.setParameter("dMapTO",this.dMapTO.data),this.material.setParameter("nMapTO",this.nMapTO.data),this.material.setParameter("color",this.ffColor.data3),this.material.setParameter("tOn",this.tOn),this.material.setParameter("viewPos",this.camera.getPosition().data),this.material.setParameter("worldPos",this.entity.getPosition().data),this.material.setParameter("hitAngle",this.hitAngle.data),this.material.setParameter("hitStrength",this.hitStrength),this.diffuseMap.resource&&this.material.setParameter("diffuseMap",this.diffuseMap.resource),this.normalMap.resource&&this.material.setParameter("normalMap",this.normalMap.resource),this.material.blendType=pc.BLEND_ADDITIVEALPHA,this.material.depthWrite=!1,this.entity.model.material=this.material,this.entity.model.model.meshInstances[0].drawOrder=2},CustomParticles.prototype.setState=function(t){this.state!==t&&(this.state=t,this.state?(this.entity.enabled=!0,this.emissive=2,this.time=0,this.tOn=.2):this.tOn=.8)},CustomParticles.prototype.update=function(t){this.setState(!0),this.time+=t,this.material.setParameter("time",this.time),this.hitStrength>0&&(this.hitStrength-=.75*t,this.material.setParameter("hitStrength",this.hitStrength)),this.state===!0&&this.tOn<1&&(this.tOn+=.75*t,this.material.setParameter("tOn",this.tOn)),this.state!==!0&&this.tOn>0&&(this.tOn-=.75*t,this.material.setParameter("tOn",this.tOn)),this.emissive>2&&(this.emissive-=10*t),this.material.setParameter("emissive",this.emissive),this.material.setParameter("viewPos",this.camera.getPosition().data),this.material.setParameter("worldPos",this.entity.getPosition().data),!this.state&&this.tOn<=0&&(this.entity.enabled=!1)},CustomParticles.prototype.hit=function(t){this.hitAngle.copy(t),this.hitAngle.y=0,this.hitAngle.normalize(),this.hitAngle.scale(-1),this.hitStrength=1,this.emissive=4,this.material.setParameter("hitAngle",this.hitAngle.data),this.material.setParameter("hitStrength",this.hitStrength),this.material.setParameter("emissive",this.emissive)},CustomParticles.prototype.setColor=function(t,e,s){this.ffColor&&(this.ffColor.set(t,e,s),this.material.setParameter("color",this.ffColor.data3))};var DetailPatchTank=pc.createScript("detailPatchTank");DetailPatchTank.attributes.add("assetNormals",{type:"asset",assetType:"shader"}),DetailPatchTank.attributes.add("assetDetail",{type:"asset",assetType:"shader"}),DetailPatchTank.prototype.initialize=function(){this.replace=!1,this.updateMaterials(),this.assetNormals.on("load",this.updateMaterials,this),this.assetDetail.on("load",this.updateMaterials,this),this.app.on("skin:load",this.updateMaterials,this)},DetailPatchTank.prototype.update=function(t){this.replace||0!==this.app.overlayLayer||(this.updateMaterials(),this.replace=!0)},DetailPatchTank.prototype.updateMaterial=function(t){t.chunks.normalXYZPS=this.assetNormals.resource,t.chunks.aoTexPS=this.assetDetail.resource,t.update()},DetailPatchTank.prototype.updateMaterials=function(){for(var t=this,a=this.app.assets.findByTag("detail-patch-tank"),e=0;e<a.length;e++)a[e].resource?this.updateMaterial(a[e].resource):a[e].once("load",function(){t.updateMaterial(this.resource)})};